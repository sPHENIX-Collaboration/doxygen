<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" />
<title>Analysis Software: coresoftware/blob/master/calibrations/tpc/generator/ChargeMapReader.cc Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script> <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script> 
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-155388685-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-155388685-2');
</script>
</head>
<body>
	<div id="top">
		<!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectlogo"><a href="https://wiki.bnl.gov/sPHENIX/index.php/Main_Page"><img
								alt="Logo" src="../../sphenix.png" /></a></td>
						<td style="padding-left: 0.5em;">
							<div id="projectname">
								Analysis Software
							</div> 
							<div id="projectbrief">
								Documentation for <a href="https://wiki.bnl.gov/sPHENIX/index.php/Main_Page">sPHENIX</a> simulation software
							</div> 
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Home&#160;page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../../usergroup0.html"><span>External&#160;Links</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d5/dcf/ChargeMapReader_8cc_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ChargeMapReader.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d5/dcf/ChargeMapReader_8cc.html">Go to the documentation of this file.</a> Or view <a target="top" href="https://github.com/sPHENIX-Collaboration/coresoftware/blob/master/calibrations/tpc/generator/ChargeMapReader.cc">the newest version in sPHENIX GitHub for file ChargeMapReader.cc</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d43/ChargeMapReader_8h.html">ChargeMapReader.h</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d3e/MultiArray_8h.html">MultiArray.h</a>&quot;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;TAxis.h&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;TFile.h&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;TH2.h&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;TH3.h&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno"><a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">   14</a></span>&#160;<span class="preprocessor">#define DEBUG false</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00016"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#a47b2bbe9b5bccc40a643aaa26f491e84">   16</a></span>&#160;<a class="code" href="../../d4/d14/classChargeMapReader.html#a47b2bbe9b5bccc40a643aaa26f491e84">ChargeMapReader::ChargeMapReader</a>()</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  : <a class="code" href="../../d4/d14/classChargeMapReader.html">ChargeMapReader</a>(20, 20.0, 78.0, 20, 0, 2 * M_PI, 40, -105.5, 105.5)</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;{</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;made a new ChargeMapReader with default values -- cascading to next constructor\n&quot;</span>);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;}</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#a57cfd03609958cec6b40e64acf3fed20">   23</a></span>&#160;<a class="code" href="../../d4/d14/classChargeMapReader.html#a47b2bbe9b5bccc40a643aaa26f491e84">ChargeMapReader::ChargeMapReader</a>(<span class="keywordtype">int</span> _nr, <span class="keywordtype">float</span> _rmin, <span class="keywordtype">float</span> _rmax, <span class="keywordtype">int</span> _nphi, <span class="keywordtype">float</span> _phimin, <span class="keywordtype">float</span> _phimax, <span class="keywordtype">int</span> _nz, <span class="keywordtype">float</span> _zmin, <span class="keywordtype">float</span> _zmax)</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;{</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;made a new ChargeMapReader with defined values:\n %d %.2f %.2f\n %d %.2f %.2f\n %d %.2f %.2f\n&quot;</span>,</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;         _nr, _rmin, _rmax, _nphi, _phimin, _phimax, _nz, _zmin, _zmax);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a05a649d8663fa6e2d1c944463f642b8b">SetOutputParameters</a>(_nr, _rmin, _rmax, _nphi, _phimin, _phimax, _nz, _zmin, _zmax);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;}</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#abfbafc656b2272057fa251aa4d0a76da">   31</a></span>&#160;<a class="code" href="../../d4/d14/classChargeMapReader.html#abfbafc656b2272057fa251aa4d0a76da">ChargeMapReader::~ChargeMapReader</a>()</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;{</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="comment">// printf(&quot;deleting histograms in ChargeMapReader\n&quot;);</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="comment">// we don&#39;t explicitly malloc() anything, so we shouldn&#39;t need to free() anything.</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;}</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#a979b14dada6a065550d4f1cb11e5ea10">   38</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a979b14dada6a065550d4f1cb11e5ea10">ChargeMapReader::CanInterpolateAt</a>(<span class="keywordtype">float</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#af81c6155a5d0b16cd581615034225ae9">r</a>, <span class="keywordtype">float</span> <a class="code" href="../../d6/d34/namespaceActsTests_1_1PropagationDatasets.html#a4722f5524134f5f139681f91e6c50038">phi</a>, <span class="keywordtype">float</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>)</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;{</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a979b14dada6a065550d4f1cb11e5ea10">CanInterpolateAt</a>(phi, r, z, <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">// a convenient method to check whether it&#39;s safe to interpolate for a particular histogram.</span></div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#a7defc261543b90afff94d9b3e66ef012">   44</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a979b14dada6a065550d4f1cb11e5ea10">ChargeMapReader::CanInterpolateAt</a>(<span class="keywordtype">float</span> <a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>, <span class="keywordtype">float</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>, <span class="keywordtype">float</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>, TH3* <a class="code" href="../../d7/dde/ctrl_8cpp.html#a41c788a90c812f238c2ba72996bb9594">h</a>)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;{</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordflow">if</span> (h == <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  }</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordtype">float</span> <a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a182617618c30f1ba6a9c7540ae655340">pos</a>[3] = {<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>, <a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>, z};</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="comment">// todo: is it worth keeping these values somewhere for ease of access?</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  TAxis* <a class="code" href="../../de/d6e/namespaceCKF__timing__vs__mu.html#aa2b521f788eda02bb09083946af96ad7">ax</a>[3] = {<span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>};</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  ax[0] = h-&gt;GetXaxis();</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  ax[1] = h-&gt;GetYaxis();</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  ax[2] = h-&gt;GetZaxis();</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../df/d51/dvcs__plot_8C.html#a468a1928a2d2dd88800a5d42a74b5624">nbins</a>[3];</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; 3; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    nbins[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = ax[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]-&gt;GetNbins();  <span class="comment">// number of bins, not counting under and overflow.</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">if</span> (nbins[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] == 1)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// if there&#39;s only one non over/under bin, then no place is safe to interpolate.</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">//   0     1     2   ...   n-1    n    n+1</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">// under|first|   ..|  ..  |  .. |last| over</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; 3; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  {  <span class="comment">// check each axis:</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordtype">int</span> axbin = ax[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]-&gt;FindBin(pos[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">if</span> (axbin &lt; 1 || axbin &gt; nbins[i])</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// before the first bin, or after the last bin</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">if</span> (axbin &gt; 1 &amp;&amp; axbin &lt; nbins[i])</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="keywordflow">continue</span>;  <span class="comment">// if we&#39;re in a middle bin, we&#39;re fine on this axis.</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    }</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// now we need to check if we&#39;re in the safe parts of the first and last bins:</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordtype">float</span> low = ax[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]-&gt;GetBinLowEdge(axbin);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordtype">float</span> high = ax[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]-&gt;GetBinUpEdge(axbin);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordtype">float</span> binmid = 0.5 * (high + low);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">if</span> (axbin == 1 &amp;&amp; pos[i] &lt;= binmid)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// we&#39;re in the first bin, but below the midpoint, so we would interpolate out of bounds</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> (axbin == nbins[i] &amp;&amp; pos[i] &gt;= binmid)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// we&#39;re in the last bin, but above the midpoint, so we would interpolate out of bounds</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    }</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">// if we get here, we are in the okay-range of all three axes.</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;}</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#afd341ac8e1366361b4190ed9a2df0c86">  101</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#afd341ac8e1366361b4190ed9a2df0c86">ChargeMapReader::FillChargeHistogram</a>(TH3* <a class="code" href="../../d7/dde/ctrl_8cpp.html#a41c788a90c812f238c2ba72996bb9594">h</a>)</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;{</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">// fills the provided histogram with the data from the internal representation.</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">//   0     1     2     ...   n-1</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="comment">// first|   ..|  ..  |  .. |last</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordtype">float</span> <a class="code" href="../../d3/d58/namespaceINTTVtxZ.html#a7ee39891286fe7af16a879bb139bead2">dphi</a>, dr, <a class="code" href="../../df/d9f/PHG4EPDDetector_8cc.html#ae7ad3d414b6c5188eed2a2427237d90b">dz</a>;  <span class="comment">// bin widths in each dimension.  Got too confusing to make these an array.</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;filling chargehistogram\n&quot;</span>);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  dr = <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[0];</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  dphi = <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[1];</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  dz = <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[2];</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordtype">float</span> phimid, zmid;  <span class="comment">// midpoints at each step.</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>[3];</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordflow">for</span> (i[0] = 0; i[0] &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0]; i[0]++)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  {  <span class="comment">// r</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordtype">float</span> rmid = <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[0] + (i[0] + 0.5) * dr;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">for</span> (i[1] = 0; i[1] &lt; nBins[1]; i[1]++)</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    {  <span class="comment">// phi</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      phimid = <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[1] + (i[1] + 0.5) * <a class="code" href="../../d3/d58/namespaceINTTVtxZ.html#a7ee39891286fe7af16a879bb139bead2">dphi</a>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      <span class="keywordflow">for</span> (i[2] = 0; i[2] &lt; nBins[2]; i[2]++)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      {  <span class="comment">// z</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        zmid = <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[2] + (i[2] + 0.5) * <a class="code" href="../../df/d9f/PHG4EPDDetector_8cc.html#ae7ad3d414b6c5188eed2a2427237d90b">dz</a>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        h-&gt;Fill(phimid, rmid, zmid, <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a>-&gt;<a class="code" href="../../d8/d64/classMultiArray.html#aec5a4ca1ee2a856a7574a75d6ad48568">Get</a>(i[0], i[1], i[2]));</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      }  <span class="comment">// z</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    }    <span class="comment">// phi</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  }      <span class="comment">// r</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;}</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#afc833e5ba798c93772159f2c66bcb44d">  135</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#afc833e5ba798c93772159f2c66bcb44d">ChargeMapReader::RegenerateCharge</a>()</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;{</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">// Builds the charge 3D array (internal representation) from the internal charge density map.</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">// either the density map has changed, or the binning of the output has changed (hopefully not the latter, because that&#39;s a very unusual thing to change mid-run.</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="comment">// we want to rebuild the charge per bin of our output representation in any case.  Generally, we will interpolate from the charge density that we know we have, but we need to be careful not to ask to interpolate in regions where that is not allowed.</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;regenerating charge array contents with axis scale=%1.2E and charge scale=%1.2E\n&quot;</span>, <a class="code" href="../../d4/d14/classChargeMapReader.html#a940acaf7356904d81e52328fa95cc46d">inputAxisScale</a>, <a class="code" href="../../d4/d14/classChargeMapReader.html#a4ade83eab91dc91d81fb8ed6f95ac033">inputChargeScale</a>);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a> == <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">// we don&#39;t have charge information, so set everything to zeroes</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;no charge data found.  Setting all charges to 0.0\n&quot;</span>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a>-&gt;<a class="code" href="../../d8/d64/classMultiArray.html#a1b666288096a1a966e481c7c563861a7">SetAll</a>(0);  <span class="comment">// otherwise set the array to all zeroes.</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="comment">//   0     1     2     ...   n-1</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="comment">// first|   ..|  ..  |  .. |last</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordtype">float</span> <a class="code" href="../../d3/d58/namespaceINTTVtxZ.html#a7ee39891286fe7af16a879bb139bead2">dphi</a>, dr, <a class="code" href="../../df/d9f/PHG4EPDDetector_8cc.html#ae7ad3d414b6c5188eed2a2427237d90b">dz</a>;  <span class="comment">// internal rep bin widths in each dimension.  Got too confusing to make these an array.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  dr = <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[0];</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  dphi = <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[1];</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  dz = <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[2];</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordtype">float</span> dzhist, drhist;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  dzhist = dz / <a class="code" href="../../d4/d14/classChargeMapReader.html#a940acaf7356904d81e52328fa95cc46d">inputAxisScale</a>;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  drhist = dr / <a class="code" href="../../d4/d14/classChargeMapReader.html#a940acaf7356904d81e52328fa95cc46d">inputAxisScale</a>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordtype">float</span> phimid, zmid;  <span class="comment">// position of the center of each fixed-width array bin, in the input histogram units</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="comment">// note that since we computed density using the hist units, we must use those units for the volume term again here.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>[3];</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordflow">for</span> (i[0] = 0; i[0] &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0]; i[0]++)</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  {  <span class="comment">// r</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordtype">float</span> rmid = (<a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[0] + (i[0] + 0.5) * dr) / <a class="code" href="../../d4/d14/classChargeMapReader.html#a940acaf7356904d81e52328fa95cc46d">inputAxisScale</a>;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// float rlow = (lowerBound[0] + dr * i[0]) / inputAxisScale;</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordtype">float</span> histBinVolume = dzhist * dphi * rmid * drhist;  <span class="comment">// volume of our output bin in histogram units.</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">// note that since we have equal bin widths, the volume term depends only on r.</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">//  Q_bin=Density_ion_interp*bin_volume*(coulomb/ion)</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordtype">float</span> scaleFactor = histBinVolume * <a class="code" href="../../d4/d14/classChargeMapReader.html#a4ade83eab91dc91d81fb8ed6f95ac033">inputChargeScale</a>;  <span class="comment">// hence the total scale factor is the volume term times the charge scale factor</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">for</span> (i[1] = 0; i[1] &lt; nBins[1]; i[1]++)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    {  <span class="comment">// phi</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      phimid = <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[1] + (i[1] + 0.5) * <a class="code" href="../../d3/d58/namespaceINTTVtxZ.html#a7ee39891286fe7af16a879bb139bead2">dphi</a>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="keywordflow">for</span> (i[2] = 0; i[2] &lt; nBins[2]; i[2]++)</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      {  <span class="comment">// z</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        zmid = (<a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[2] + (i[2] + 0.5) * <a class="code" href="../../df/d9f/PHG4EPDDetector_8cc.html#ae7ad3d414b6c5188eed2a2427237d90b">dz</a>) / <a class="code" href="../../d4/d14/classChargeMapReader.html#a940acaf7356904d81e52328fa95cc46d">inputAxisScale</a>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordtype">float</span> q = 0;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a979b14dada6a065550d4f1cb11e5ea10">CanInterpolateAt</a>(phimid, rmid, zmid, <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>))</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        {  <span class="comment">// interpolate if we can</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">false</span>)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;          {  <span class="comment">// deep debug statements.</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;function said we could interpolate at (r,phi,z)=(%.2f, %.2f,%.2f), bounds are:\n&quot;</span>, rmid, phimid, zmid);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;  r: %.2f &lt; %.2f &lt; %.2f\n&quot;</span>, <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;GetYaxis()-&gt;GetXmin(), rmid, <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;GetYaxis()-&gt;GetXmax());</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;  p: %.2f &lt; %.2f &lt; %.2f\n&quot;</span>, <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;GetXaxis()-&gt;GetXmin(), phimid, <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;GetXaxis()-&gt;GetXmax());</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;  z: %.2f &lt; %.2f &lt; %.2f\n&quot;</span>, <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;GetZaxis()-&gt;GetXmin(), zmid, <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;GetZaxis()-&gt;GetXmax());</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;          }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;          q = scaleFactor * <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;Interpolate(phimid, rmid, zmid);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        {  <span class="comment">// otherwise, just take the central value and assume it&#39;s flat.  Better than a zero.</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          q = scaleFactor * <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;GetBinContent(<a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;FindBin(phimid, rmid, zmid));</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">false</span>)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        {  <span class="comment">// deep debug statements.</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;          <span class="keywordtype">int</span> global = <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;FindBin(phimid, rmid, zmid);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a979b14dada6a065550d4f1cb11e5ea10">CanInterpolateAt</a>(phimid, rmid, zmid, <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>))</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;density debug report (interp) (r,phi,z)=(%.2f, %.2f,%.2f), glob=%d, q_dens=%E&quot;</span>, rmid, phimid, zmid, global, q);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;, density=%E, vol=%E&quot;</span>, <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;Interpolate(phimid, rmid, zmid), histBinVolume);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;, q_bin=%E, q_bin_coul=%E&quot;</span>,</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                   <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;GetBinContent(<a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;FindBin(phimid, rmid, zmid)),</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                   <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;GetBinContent(<a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;FindBin(phimid, rmid, zmid)) * inputChargeScale);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;, q_interp=%E, q_bin_coul/vol=%E\n&quot;</span>,</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                   <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;Interpolate(phimid, rmid, zmid),</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                   <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;GetBinContent(<a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;FindBin(phimid, rmid, zmid)) / histBinVolume);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;          }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;          {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;density debug report (getbin) (r,phi,z)=(%.2f, %.2f,%.2f), glob=%d, q_dens=%E&quot;</span>, rmid, phimid, zmid, global, q);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;, density=%E, vol=%E&quot;</span>, <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;GetBinContent(<a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;FindBin(phimid, rmid, zmid)), histBinVolume);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;, q_bin=%E, q_bin_ions=%E&quot;</span>,</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                   <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;GetBinContent(<a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;FindBin(phimid, rmid, zmid)),</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                   <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;GetBinContent(<a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;FindBin(phimid, rmid, zmid)) / inputChargeScale);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;, q_bin_ions/vol=%E\n&quot;</span>,</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                   <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;GetBinContent(<a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;FindBin(phimid, rmid, zmid)) / scaleFactor);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;          }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a>-&gt;<a class="code" href="../../d8/d64/classMultiArray.html#a0cf24ea8c5d6c9ae66222d7e32957890">Set</a>(i[0], i[1], i[2], q);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      }  <span class="comment">// z</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    }    <span class="comment">// phi</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  }      <span class="comment">// r</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;done regenerating charge array contents\n&quot;</span>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  }</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;}</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div>
<div class="line"><a name="l00234"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#a14409699eaa40ca0c2b6e3721511e13b">  234</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a14409699eaa40ca0c2b6e3721511e13b">ChargeMapReader::RegenerateDensity</a>()</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;{</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="comment">// assume the input map has changed, so we need to rebuild our internal representation of the density.</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="comment">// this is done by cloning the SourceCharge histogram and dividing each bin in it by its volume</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;regenerating density histogram\n&quot;</span>);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="comment">// if we have one already, delete it.</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a> != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;deleting old density histogram\n&quot;</span>);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keyword">delete</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a> == <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">// the source data doesn&#39;t exist, so we will fail if we try to clone</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;no source charge data file is open, or the histogram was not found.\n&quot;</span>);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="comment">// clone this from the source histogram, which we assume is open.</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a> = <span class="keyword">static_cast&lt;</span>TH3*<span class="keyword">&gt;</span>(<a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;Clone(<span class="stringliteral">&quot;hChargeDensity&quot;</span>));</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;Reset();</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="comment">// then go through it, bin by bin, and replace each bin content with the corresponding density, so we can interpolate correctly.</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="comment">// TODO:  Does this mean we once again need &#39;guard&#39; bins?  Gross.</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  TAxis* <a class="code" href="../../de/d6e/namespaceCKF__timing__vs__mu.html#aa2b521f788eda02bb09083946af96ad7">ax</a>[3] = {<span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>};</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  ax[0] = <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;GetXaxis();</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  ax[1] = <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;GetYaxis();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  ax[2] = <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;GetZaxis();</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../df/d51/dvcs__plot_8C.html#a468a1928a2d2dd88800a5d42a74b5624">nbins</a>[3];</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; 3; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    nbins[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = ax[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]-&gt;GetNbins();  <span class="comment">// number of bins, not counting under and overflow.</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  }</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="comment">//   0     1     2   ...   n-1    n    n+1</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="comment">// under|first|   ..|  ..  |  .. |last| over</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>[3];</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordtype">float</span> low[3], high[3];</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordtype">float</span> dr, <a class="code" href="../../df/d9f/PHG4EPDDetector_8cc.html#ae7ad3d414b6c5188eed2a2427237d90b">dz</a>;  <span class="comment">// bin widths in each dimension.  Got too confusing to make these an array.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="comment">// note that all of this is done in the native units of the source data, specifically, the volume element is in hist units, not our internal units.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordflow">for</span> (i[0] = 1; i[0] &lt;= nbins[0]; i[0]++)</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  {  <span class="comment">// phi</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a> = 0;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    low[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>] = ax[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>]-&gt;GetBinLowEdge(i[a]);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    high[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>] = ax[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>]-&gt;GetBinUpEdge(i[a]);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="../../d3/d58/namespaceINTTVtxZ.html#a7ee39891286fe7af16a879bb139bead2">dphi</a> = high[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>] - low[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>];</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">for</span> (i[1] = 1; i[1] &lt;= nbins[1]; i[1]++)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    {  <span class="comment">// r</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      a = 1;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      low[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>] = ax[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>]-&gt;GetBinLowEdge(i[a]);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      high[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>] = ax[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>]-&gt;GetBinUpEdge(i[a]);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      dr = high[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>] - low[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>];</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="keywordtype">float</span> rphiterm = dphi * (low[1] + 0.5 * dr) * dr;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="keywordflow">for</span> (i[2] = 1; i[2] &lt;= nbins[2]; i[2]++)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      {  <span class="comment">// z</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        a = 2;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        low[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>] = ax[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>]-&gt;GetBinLowEdge(i[a]);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        high[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>] = ax[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>]-&gt;GetBinUpEdge(i[a]);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        dz = high[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>] - low[<a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>];</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="comment">// float volume=dz*dphi*(low[1]+0.5*dr)*dr;</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordtype">float</span> volume = dz * rphiterm;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordtype">int</span> globalBin = <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;GetBin(i[0], i[1], i[2]);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keywordtype">float</span> q = <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;GetBinContent(globalBin);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;SetBinContent(globalBin, q / volume);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">false</span>)</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        {  <span class="comment">// deep debug statements.</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;          <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;iprz=(%d,%d,%d),glob=%d&quot;</span>, i[0], i[1], i[2], globalBin);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;          <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;edges=[%.2f,%.2f],[%.1f,%.1f],[%.1f,%f.1],&quot;</span>, low[0], high[0], low[1], high[1], low[2], high[2]);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;          <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;\tq=%E,vol=%E,dens=%E\n&quot;</span>, q, volume, <a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a>-&gt;GetBinContent(globalBin));</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    }</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;done regenerating density histogram\n&quot;</span>);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;}</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div>
<div class="line"><a name="l00325"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#a068ea2263b63982a8313c8dc3690827a">  325</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a068ea2263b63982a8313c8dc3690827a">ChargeMapReader::ReadSourceCharge</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d4/d23/Prototype2_2EMCal_2macros_2EnergyCalibFit_8m.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>, <span class="keyword">const</span> <span class="keywordtype">char</span>* histname, <span class="keywordtype">float</span> axisScale, <span class="keywordtype">float</span> contentScale)</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;{</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="comment">// load the charge-per-bin data from the specified file.</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a940acaf7356904d81e52328fa95cc46d">inputAxisScale</a> = axisScale;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a4ade83eab91dc91d81fb8ed6f95ac033">inputChargeScale</a> = contentScale;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  TFile* inputFile = TFile::Open(filename, <span class="stringliteral">&quot;READ&quot;</span>);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  inputFile-&gt;GetObject(histname, <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a> == <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  }</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a14409699eaa40ca0c2b6e3721511e13b">RegenerateDensity</a>();</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#afc833e5ba798c93772159f2c66bcb44d">RegenerateCharge</a>();</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  inputFile-&gt;Close();</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="comment">// after this, the source histogram doesn&#39;t exist anymore.</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#adfc535a4ce875a76675ed0b9a66a922a">  343</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a068ea2263b63982a8313c8dc3690827a">ChargeMapReader::ReadSourceCharge</a>(TH3* sourceHist, <span class="keywordtype">float</span> axisScale, <span class="keywordtype">float</span> contentScale)</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;{</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;reading charge from %s\n&quot;</span>, sourceHist-&gt;GetName());</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a940acaf7356904d81e52328fa95cc46d">inputAxisScale</a> = axisScale;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a4ade83eab91dc91d81fb8ed6f95ac033">inputChargeScale</a> = contentScale;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a> = sourceHist;  <span class="comment">// note that this means we don&#39;t own this histogram!</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a> == <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a14409699eaa40ca0c2b6e3721511e13b">RegenerateDensity</a>();</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#afc833e5ba798c93772159f2c66bcb44d">RegenerateCharge</a>();</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;done reading charge from %s\n&quot;</span>, sourceHist-&gt;GetName());</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;}</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#aa18322fd9e81c28af24ee272c74fee66">  367</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#aa18322fd9e81c28af24ee272c74fee66">ChargeMapReader::ReadSourceAdc</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* adcfilename, <span class="keyword">const</span> <span class="keywordtype">char</span>* adchistname, <span class="keyword">const</span> <span class="keywordtype">char</span>* ibfgainfilename, <span class="keyword">const</span> <span class="keywordtype">char</span>* ibfgainhistname, <span class="keywordtype">float</span> axisScale, <span class="keywordtype">float</span> contentScale)</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;{</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="comment">// load the adc-per-bin data from the specified file.</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  TFile* adcInputFile = TFile::Open(adcfilename, <span class="stringliteral">&quot;READ&quot;</span>);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  TH3* hAdc = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  adcInputFile-&gt;GetObject(adchistname, hAdc);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a> == <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;Source Charge hist or file %s not found!\n&quot;</span>, adcfilename);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="comment">// load the conversion factor from adc sum to ibf</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  TFile* ibfGainInputFile = TFile::Open(ibfgainfilename, <span class="stringliteral">&quot;READ&quot;</span>);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  TH2* hIbfGain = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  ibfGainInputFile-&gt;GetObject(ibfgainhistname, hIbfGain);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordflow">if</span> (hIbfGain == <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;IBF Gain hist or file %s not found!\n&quot;</span>, ibfgainfilename);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="comment">// and then hand the task off to the next function</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordtype">bool</span> ret = <a class="code" href="../../d4/d14/classChargeMapReader.html#aa18322fd9e81c28af24ee272c74fee66">ReadSourceAdc</a>(hAdc, hIbfGain, axisScale, contentScale);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  adcInputFile-&gt;Close();</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="comment">// after this, the source histograms don&#39;t exist anymore.</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;}</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div>
<div class="line"><a name="l00395"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#a5fe500e20400148e1a95f1ab791252f8">  395</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#aa18322fd9e81c28af24ee272c74fee66">ChargeMapReader::ReadSourceAdc</a>(TH3* adcHist, TH2* gainHist, <span class="keywordtype">float</span> axisScale, <span class="keywordtype">float</span> contentScale)</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;{</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;reading ADCs from %s, ibfGain from %s\n&quot;</span>, adcHist-&gt;GetName(), gainHist-&gt;GetName());</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a940acaf7356904d81e52328fa95cc46d">inputAxisScale</a> = axisScale;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a4ade83eab91dc91d81fb8ed6f95ac033">inputChargeScale</a> = contentScale;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a> = adcHist;  <span class="comment">// note that this means we don&#39;t own this histogram!  It may disappear.</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a> == <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="comment">// scale the voxels of the sourcecharge by the gainhist data.</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  TAxis* <a class="code" href="../../de/d6e/namespaceCKF__timing__vs__mu.html#aa2b521f788eda02bb09083946af96ad7">ax</a>[3] = {<span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>};</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  ax[0] = <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;GetXaxis();</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  ax[1] = <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;GetYaxis();</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  ax[2] = <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;GetZaxis();</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../df/d51/dvcs__plot_8C.html#a468a1928a2d2dd88800a5d42a74b5624">nbins</a>[3];</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; 3; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    nbins[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = ax[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]-&gt;GetNbins();  <span class="comment">// number of bins, not counting under and overflow.</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="comment">//   0     1     2   ...   n-1    n    n+1</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="comment">// under|first|   ..|  ..  |  .. |last| over</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>[3];</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordflow">for</span> (i[0] = 1; i[0] &lt;= nbins[0]; i[0]++)</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  {  <span class="comment">// phi</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">for</span> (i[1] = 1; i[1] &lt;= nbins[1]; i[1]++)</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    {  <span class="comment">// r</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordtype">int</span> globalBin2D = gainHist-&gt;GetBin(i[0], i[1]);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordtype">float</span> scalefactor = gainHist-&gt;GetBinContent(globalBin2D);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="keywordflow">for</span> (i[2] = 1; i[2] &lt;= nbins[2]; i[2]++)</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      {  <span class="comment">// z</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordtype">int</span> globalBin = <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;GetBin(i[0], i[1], i[2]);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordtype">float</span> q = <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;GetBinContent(globalBin);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <a class="code" href="../../d4/d14/classChargeMapReader.html#a311697edc5b10674b670d3ffc3d520f8">hSourceCharge</a>-&gt;SetBinContent(globalBin, q * scalefactor);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">false</span>)</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        {  <span class="comment">// deep debug statements.</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;          <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;applying gain to adc input:  iprz=(%d,%d,%d), glob3d=%d, glob2d=%d, adc=%f, scale=%f\n&quot;</span>, i[0], i[1], i[2], globalBin, globalBin2D, q, scalefactor);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      }  <span class="comment">// z</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    }    <span class="comment">// r</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  }      <span class="comment">// phi</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;done converting adc hist to ions\n&quot;</span>);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a14409699eaa40ca0c2b6e3721511e13b">RegenerateDensity</a>();</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#afc833e5ba798c93772159f2c66bcb44d">RegenerateCharge</a>();</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;done converting ADCs from %s\n&quot;</span>, adcHist-&gt;GetName());</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;}</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#a05a649d8663fa6e2d1c944463f642b8b">  460</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a05a649d8663fa6e2d1c944463f642b8b">ChargeMapReader::SetOutputParameters</a>(<span class="keywordtype">int</span> _nr, <span class="keywordtype">float</span> _rmin, <span class="keywordtype">float</span> _rmax, <span class="keywordtype">int</span> _nphi, <span class="keywordtype">float</span> _phimin, <span class="keywordtype">float</span> _phimax, <span class="keywordtype">int</span> _nz, <span class="keywordtype">float</span> _zmin, <span class="keywordtype">float</span> _zmax)</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;{</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="comment">// change all the parameters of our output array and rebuild the array from scratch.</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keywordflow">if</span> (!(_rmax &gt; _rmin) || !(_phimax &gt; _phimin) || !(_zmax &gt; _zmin))</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// the bounds are not well-ordered.</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  }</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordflow">if</span> (_nr &lt; 1 || _nphi &lt; 1 || _nz &lt; 1)</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// must be at least one bin wide.</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0] = _nr;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[1] = _nphi;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[2] = _nz;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[0] = _rmin;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[1] = _phimin;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[2] = _zmin;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#ad064ba4bd0206b0f778805bab46a5c17">upperBound</a>[0] = _rmax;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#ad064ba4bd0206b0f778805bab46a5c17">upperBound</a>[1] = _phimax;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#ad064ba4bd0206b0f778805bab46a5c17">upperBound</a>[2] = _zmax;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; 3; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = (<a class="code" href="../../d4/d14/classChargeMapReader.html#ad064ba4bd0206b0f778805bab46a5c17">upperBound</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] - <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]) / (1.0 * <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="comment">// if the array exists, delete it.</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a> != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;charge array existed.  deleting\n&quot;</span>);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keyword">delete</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a>;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  }</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;building new charge array\n&quot;</span>);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  }</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;should have %d elements\n&quot;</span>, <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0] * <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[1] * <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[2]);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a> = <span class="keyword">new</span> <a class="code" href="../../d8/d64/classMultiArray.html">MultiArray&lt;float&gt;</a>(<a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0], nBins[1], nBins[2]);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a> != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;charge density data exists, regenerating charge\n&quot;</span>);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    }</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <a class="code" href="../../d4/d14/classChargeMapReader.html#afc833e5ba798c93772159f2c66bcb44d">RegenerateCharge</a>();  <span class="comment">// fill the array with the charge data if available</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  {</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a>-&gt;<a class="code" href="../../d8/d64/classMultiArray.html#a1b666288096a1a966e481c7c563861a7">SetAll</a>(0);  <span class="comment">// otherwise set the array to all zeroes.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;finished building array\n&quot;</span>);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;}</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#ab4e25a648f87ed99a79cd266354d2ee5">  528</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#ab4e25a648f87ed99a79cd266354d2ee5">ChargeMapReader::SetOutputBounds</a>(<span class="keywordtype">float</span> _rmin, <span class="keywordtype">float</span> _rmax, <span class="keywordtype">float</span> _phimin, <span class="keywordtype">float</span> _phimax, <span class="keywordtype">float</span> _zmin, <span class="keywordtype">float</span> _zmax)</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;{</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="comment">// change all the bounds of our output array and rebuild the array from scratch, leaving the original binning</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordflow">if</span> (!(_rmax &gt; _rmin) || !(_phimax &gt; _phimin) || !(_zmax &gt; _zmin))</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// the bounds are not well-ordered.</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[0] = _rmin;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[1] = _phimin;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[2] = _zmin;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#ad064ba4bd0206b0f778805bab46a5c17">upperBound</a>[0] = _rmax;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#ad064ba4bd0206b0f778805bab46a5c17">upperBound</a>[1] = _phimax;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#ad064ba4bd0206b0f778805bab46a5c17">upperBound</a>[2] = _zmax;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; 3; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = (<a class="code" href="../../d4/d14/classChargeMapReader.html#ad064ba4bd0206b0f778805bab46a5c17">upperBound</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] - <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]) / (1.0 * <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="comment">// if the array exists, delete it.</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a> != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keyword">delete</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a>;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  }</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a> = <span class="keyword">new</span> <a class="code" href="../../d8/d64/classMultiArray.html">MultiArray&lt;float&gt;</a>(<a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0], nBins[1], nBins[2]);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a> != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <a class="code" href="../../d4/d14/classChargeMapReader.html#afc833e5ba798c93772159f2c66bcb44d">RegenerateCharge</a>();  <span class="comment">// fill the array with the charge data if available</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a>-&gt;<a class="code" href="../../d8/d64/classMultiArray.html#a1b666288096a1a966e481c7c563861a7">SetAll</a>(0);  <span class="comment">// otherwise set the array to all zeroes.</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;}</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div>
<div class="line"><a name="l00570"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#a5ace7ce407346da4e68b5742794ceadc">  570</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a5ace7ce407346da4e68b5742794ceadc">ChargeMapReader::SetOutputBins</a>(<span class="keywordtype">int</span> _nr, <span class="keywordtype">int</span> _nphi, <span class="keywordtype">int</span> _nz)</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;{</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="comment">// change the number of bins of our output array and rebuild the array from scratch, leaving the bounds alone.</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="keywordflow">if</span> (_nr &lt; 1 || _nphi &lt; 1 || _nz &lt; 1)</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// must be at least one bin wide.</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0] = _nr;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[1] = _nphi;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[2] = _nz;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; 3; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = (<a class="code" href="../../d4/d14/classChargeMapReader.html#ad064ba4bd0206b0f778805bab46a5c17">upperBound</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] - <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]) / (1.0 * <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  }</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="comment">// if the array exists, delete it.</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a> != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keyword">delete</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a> = <span class="keyword">new</span> <a class="code" href="../../d8/d64/classMultiArray.html">MultiArray&lt;float&gt;</a>(<a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0], nBins[1], nBins[2]);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d14/classChargeMapReader.html#a74a2428727ba76cac5a63f3d2dd7133e">hChargeDensity</a> != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <a class="code" href="../../d4/d14/classChargeMapReader.html#afc833e5ba798c93772159f2c66bcb44d">RegenerateCharge</a>();  <span class="comment">// fill the array with the charge data if available</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a>-&gt;<a class="code" href="../../d8/d64/classMultiArray.html#a1b666288096a1a966e481c7c563861a7">SetAll</a>(0);  <span class="comment">// otherwise set the array to all zeroes.</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;}</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div>
<div class="line"><a name="l00605"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#aedba92d22432856a02fd4ee0f4209cc3">  605</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#aedba92d22432856a02fd4ee0f4209cc3">ChargeMapReader::AddChargeInBin</a>(<span class="keywordtype">int</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#af81c6155a5d0b16cd581615034225ae9">r</a>, <span class="keywordtype">int</span> <a class="code" href="../../d6/d34/namespaceActsTests_1_1PropagationDatasets.html#a4722f5524134f5f139681f91e6c50038">phi</a>, <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>, <span class="keywordtype">float</span> q)</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;{</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <a class="code" href="../../df/df7/DrawTrackingEval_8C.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(r &gt; 0 &amp;&amp; r &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0]);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <a class="code" href="../../df/df7/DrawTrackingEval_8C.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(phi &gt; 0 &amp;&amp; phi &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[1]);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <a class="code" href="../../df/df7/DrawTrackingEval_8C.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(z &gt; 0 &amp;&amp; z &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[2]);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;adding charge in array element %d %d %d to %.2E\n&quot;</span>, r, phi, z, q);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a>-&gt;<a class="code" href="../../d8/d64/classMultiArray.html#a33bbe655697ef0d6b52428f200869917">Add</a>(r, phi, z, q);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;}</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#ad01208955996b75fe8bdac8699cde2e2">  619</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#ad01208955996b75fe8bdac8699cde2e2">ChargeMapReader::AddChargeAtPosition</a>(<span class="keywordtype">float</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#af81c6155a5d0b16cd581615034225ae9">r</a>, <span class="keywordtype">float</span> <a class="code" href="../../d6/d34/namespaceActsTests_1_1PropagationDatasets.html#a4722f5524134f5f139681f91e6c50038">phi</a>, <span class="keywordtype">float</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>, <span class="keywordtype">float</span> q)</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;{</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <span class="comment">// bounds checking are handled by the binwise function, so no need to do so here:</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#aedba92d22432856a02fd4ee0f4209cc3">AddChargeInBin</a>((r - <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[0]) / <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[0], (phi - <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[1]) / <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[1], (z - <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[2]) / <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[2], q);</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;}</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div>
<div class="line"><a name="l00626"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#a2abb6186153f2d2b740a356023e7d0b5">  626</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a2abb6186153f2d2b740a356023e7d0b5">ChargeMapReader::GetChargeInBin</a>(<span class="keywordtype">int</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#af81c6155a5d0b16cd581615034225ae9">r</a>, <span class="keywordtype">int</span> <a class="code" href="../../d6/d34/namespaceActsTests_1_1PropagationDatasets.html#a4722f5524134f5f139681f91e6c50038">phi</a>, <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>)</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;{</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="keywordflow">if</span> (!(r &gt;= 0 &amp;&amp; r &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0]))</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  {</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;requested rbin %d, but bounds are %d to %d. Failing.\n&quot;</span>, r, 0, <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0]);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <a class="code" href="../../df/df7/DrawTrackingEval_8C.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(r &gt;= 0 &amp;&amp; r &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0]);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordflow">if</span> (!(phi &gt;= 0 &amp;&amp; phi &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[1]))</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;requested phibin %d, but bounds are %d to %d. Failing.\n&quot;</span>, phi, 0, <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[1]);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <a class="code" href="../../df/df7/DrawTrackingEval_8C.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(phi &gt;= 0 &amp;&amp; phi &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[1]);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="keywordflow">if</span> (!(z &gt;= 0 &amp;&amp; z &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[2]))</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;requested rbin %d, but bounds are %d to %d. Failing.\n&quot;</span>, z, 0, <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[2]);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <a class="code" href="../../df/df7/DrawTrackingEval_8C.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(z &gt;= 0 &amp;&amp; z &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[2]);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  }</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;getting charge in array element %d %d %d\n&quot;</span>, r, phi, z);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a>-&gt;<a class="code" href="../../d8/d64/classMultiArray.html#aec5a4ca1ee2a856a7574a75d6ad48568">Get</a>(r, phi, z);</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;}</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div>
<div class="line"><a name="l00652"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#a64364113cd14edf3a356e3a2eebd352e">  652</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a64364113cd14edf3a356e3a2eebd352e">ChargeMapReader::GetChargeAtPosition</a>(<span class="keywordtype">float</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#af81c6155a5d0b16cd581615034225ae9">r</a>, <span class="keywordtype">float</span> <a class="code" href="../../d6/d34/namespaceActsTests_1_1PropagationDatasets.html#a4722f5524134f5f139681f91e6c50038">phi</a>, <span class="keywordtype">float</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>)</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;{</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="comment">// bounds checking are handled by the binwise function, so no need to do so here:</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a2abb6186153f2d2b740a356023e7d0b5">GetChargeInBin</a>((r - <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[0]) / <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[0], (phi - <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[1]) / <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[1], (z - <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[2]) / <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[2]);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;}</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div>
<div class="line"><a name="l00658"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#a7154373c45f48af3c2f5074d2c76a880">  658</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#a7154373c45f48af3c2f5074d2c76a880">ChargeMapReader::SetChargeInBin</a>(<span class="keywordtype">int</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#af81c6155a5d0b16cd581615034225ae9">r</a>, <span class="keywordtype">int</span> <a class="code" href="../../d6/d34/namespaceActsTests_1_1PropagationDatasets.html#a4722f5524134f5f139681f91e6c50038">phi</a>, <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>, <span class="keywordtype">float</span> q)</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;{</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="keywordflow">if</span> (!(r &gt;= 0 &amp;&amp; r &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0]))</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  {</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;requested rbin %d, but bounds are %d to %d. Failing.\n&quot;</span>, r, 0, <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0]);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <a class="code" href="../../df/df7/DrawTrackingEval_8C.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(r &gt;= 0 &amp;&amp; r &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[0]);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="keywordflow">if</span> (!(phi &gt;= 0 &amp;&amp; phi &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[1]))</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;requested phibin %d, but bounds are %d to %d. Failing.\n&quot;</span>, phi, 0, <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[1]);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <a class="code" href="../../df/df7/DrawTrackingEval_8C.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(phi &gt;= 0 &amp;&amp; phi &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[1]);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  }</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="keywordflow">if</span> (!(z &gt;= 0 &amp;&amp; z &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[2]))</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;requested rbin %d, but bounds are %d to %d. Failing.\n&quot;</span>, z, 0, <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[2]);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <a class="code" href="../../df/df7/DrawTrackingEval_8C.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(z &gt;= 0 &amp;&amp; z &lt; <a class="code" href="../../d4/d14/classChargeMapReader.html#a658f7ec2a833466a77318d38df1e1b71">nBins</a>[2]);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/dcf/ChargeMapReader_8cc.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>)</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  {</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <a class="code" href="../../da/d23/msg__buffer_8cc.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;setting charge in array element %d %d %d to %.2E\n&quot;</span>, r, phi, z, q);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  }</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a8906c0a272d5d3575284ebfcdc1498b2">charge</a>-&gt;<a class="code" href="../../d8/d64/classMultiArray.html#a0cf24ea8c5d6c9ae66222d7e32957890">Set</a>(r, phi, z, q);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;}</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div>
<div class="line"><a name="l00684"></a><span class="lineno"><a class="code" href="../../d4/d14/classChargeMapReader.html#afe19edf85f0b470bc75e2b06f210fb86">  684</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d14/classChargeMapReader.html#afe19edf85f0b470bc75e2b06f210fb86">ChargeMapReader::SetChargeAtPosition</a>(<span class="keywordtype">float</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#af81c6155a5d0b16cd581615034225ae9">r</a>, <span class="keywordtype">float</span> <a class="code" href="../../d6/d34/namespaceActsTests_1_1PropagationDatasets.html#a4722f5524134f5f139681f91e6c50038">phi</a>, <span class="keywordtype">float</span> <a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>, <span class="keywordtype">float</span> q)</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;{</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="comment">// bounds checking are handled by the binwise function, so no need to do so here:</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <a class="code" href="../../d4/d14/classChargeMapReader.html#a7154373c45f48af3c2f5074d2c76a880">SetChargeInBin</a>((r - <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[0]) / <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[0], (phi - <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[1]) / <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[1], (z - <a class="code" href="../../d4/d14/classChargeMapReader.html#ac3a693a4f762682d01468016ec24e578">lowerBound</a>[2]) / <a class="code" href="../../d4/d14/classChargeMapReader.html#a2463b8a08caeec755b4bd900152d3340">binWidth</a>[2], q);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->

<!-- start footer part -->
<div id="nav-path" class="navpath">
	<!-- id is needed for treeview function! -->
	<ul>
		<li class="navelem"><a class="el" href="../../dir_34b5111c58c3e86475589dfb505e95b7.html">coresoftware</a></li><li class="navelem"><a class="el" href="../../dir_3e7931e6e90ebf6929d89428e4ceb4f8.html">blob</a></li><li class="navelem"><a class="el" href="../../dir_b8a5edcdb55b282a13921e9cd7fd920e.html">master</a></li><li class="navelem"><a class="el" href="../../dir_d9556802b20bf1631a87617ee9edec73.html">calibrations</a></li><li class="navelem"><a class="el" href="../../dir_496d1eb0d44f2dace8a6935396932400.html">tpc</a></li><li class="navelem"><a class="el" href="../../dir_146e58f2e38b06a79eb0b78c99b82309.html">generator</a></li><li class="navelem"><a class="el" href="../../d5/dcf/ChargeMapReader_8cc.html">ChargeMapReader.cc</a></li>
		<li class="footer">
		Built by <a href="mailto:jhuang@bnl.gov">Jin Huang</a></em>.
			updated: <em>Sat Feb 17 2024 22:17:59</em> using <a
			href="http://www.doxygen.org/index.html"> <img class="footer"
				src="../../doxygen.png" alt="doxygen" /></a> 1.8.2 
				with <a href="https://github.com/sPHENIX-Collaboration">sPHENIX GitHub integration</a>
		</li>
	</ul>
</div>
</body>
</html>
