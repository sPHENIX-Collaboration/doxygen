<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" />
<title>Analysis Software: JETSCAPE/blob/main/src/hadronization/HybridHadronization.cc Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script> <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script> 
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-155388685-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-155388685-2');
</script>
</head>
<body>
	<div id="top">
		<!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectlogo"><a href="https://wiki.bnl.gov/sPHENIX/index.php/Main_Page"><img
								alt="Logo" src="../../sphenix.png" /></a></td>
						<td style="padding-left: 0.5em;">
							<div id="projectname">
								Analysis Software
							</div> 
							<div id="projectbrief">
								Documentation for <a href="https://wiki.bnl.gov/sPHENIX/index.php/Main_Page">sPHENIX</a> simulation software
							</div> 
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Home&#160;page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../../usergroup0.html"><span>External&#160;Links</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d4/d49/HybridHadronization_8cc_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">HybridHadronization.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d4/d49/HybridHadronization_8cc.html">Go to the documentation of this file.</a> Or view <a target="top" href="https://github.com/sPHENIX-Collaboration/JETSCAPE/blob/main/src/hadronization/HybridHadronization.cc">the newest version in sPHENIX GitHub for file HybridHadronization.cc</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*******************************************************************************</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright (c) The JETSCAPE Collaboration, 2019</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Modular, task-based framework for simulating all aspects of heavy-ion collisions</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * For the list of contributors see AUTHORS.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Report issues at https://github.com/JETSCAPE/JETSCAPE/issues</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * or via email to bugs.jetscape@gmail.com</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * Distributed under the GNU General Public License 3.0 (GPLv3 or later).</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * See COPYING for details.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> ******************************************************************************/</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/dc6/HybridHadronization_8h.html">HybridHadronization.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/dcd/ThermPtnSampler_8h.html">ThermPtnSampler.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/da4/JetScapeXML_8h.html">JetScapeXML.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d14/JetScapeLogger_8h.html">JetScapeLogger.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d95/tinyxml2_8h.html">tinyxml2.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d54/JetScapeConstants_8h.html">JetScapeConstants.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d9b/FluidDynamics_8h.html">FluidDynamics.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/da7/FluidCellInfo_8h.html">FluidCellInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/d51/SurfaceCellInfo_8h.html">SurfaceCellInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/dac/FluidEvolutionHistory_8h.html">FluidEvolutionHistory.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/d13/JetScapeSignalManager_8h.html">JetScapeSignalManager.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &lt;random&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &lt;limits&gt;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">//#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">using namespace </span>Jetscape;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../df/d21/namespaceINPUTGENERATOR.html#af60631bc6eadf732affaf771ec866a6f">Pythia8</a>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">// Register the module with the base class</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<a class="code" href="../../da/dcf/classJetscape_1_1RegisterJetScapeModule.html">RegisterJetScapeModule&lt;HybridHadronization&gt;</a> <a class="code" href="../../d5/dce/classHybridHadronization.html#a6add35f3819dfb6c09dced175d1d83cf">HybridHadronization::reg</a>(<span class="stringliteral">&quot;HybridHadronization&quot;</span>);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">// Initialize static helper here</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;Pythia8::Pythia <a class="code" href="../../d5/dce/classHybridHadronization.html#ac2ac9e13b28471227f8f540c1d483c77">HybridHadronization::pythia</a> (<span class="stringliteral">&quot;IntentionallyEmpty&quot;</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">//RNG - Mersenne Twist - 64 bit</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">//std::mt19937_64 eng(std::random_device{}());</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">//std::mt19937_64 eng(1);</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">//returns a random number between 0 and 1, based on above engine</span></div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a88c8ed9b28a195f02a70f6ea09fe09f7">   51</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#a88c8ed9b28a195f02a70f6ea09fe09f7">HybridHadronization::ran</a>() {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  std::uniform_real_distribution&lt;double&gt; uniran(0.0,1.0);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">return</span> uniran(eng);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;}</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a4dcafedfde37512c180f0ca6b092e477">   56</a></span>&#160;<a class="code" href="../../d5/dce/classHybridHadronization.html#a4dcafedfde37512c180f0ca6b092e477">HybridHadronization::HybridHadronization</a>(){</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <a class="code" href="../../d9/d03/KFParticleBaseSIMD_8h.html#a54e90ac79a3a19f1b65ddb17766a4046" title="Sets the Id of the particle. After the construction of a particle should be set by user...">SetId</a>(<span class="stringliteral">&quot;HybridHadronization&quot;</span>);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="../../d1/dd2/PHG4PhenixEventAction_8cc.html#a4a20323806e186f80a443d377d400e69">VERBOSE</a>(8);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a4e9baa8e990e8793ab621949577f84f5">   61</a></span>&#160;<a class="code" href="../../d5/dce/classHybridHadronization.html#a4e9baa8e990e8793ab621949577f84f5">HybridHadronization::~HybridHadronization</a>(){</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <a class="code" href="../../d1/dd2/PHG4PhenixEventAction_8cc.html#a4a20323806e186f80a443d377d400e69">VERBOSE</a>(8);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;}</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">//meson width function</span></div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a667e299539c8d57585efc222d23b27f1">   66</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#a667e299539c8d57585efc222d23b27f1">HybridHadronization::SigM2_calc</a>(<span class="keywordtype">double</span> R2chg, <span class="keywordtype">double</span> qm1, <span class="keywordtype">double</span> qm2, <span class="keywordtype">double</span> qq1, <span class="keywordtype">double</span> qq2){</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordflow">return</span> R2chg*(2./3.)*(qm1+qm2)*(qm1+qm2)/(std::abs(qq1)*qm2*qm2 + std::abs(qq2)*qm1*qm1) * (std::abs(qq1) + std::abs(qq2));</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;}</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">//baryon width function</span></div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#ace3352c4435c2f97e034df9bcaa92b1f">   71</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#ace3352c4435c2f97e034df9bcaa92b1f">HybridHadronization::SigBR2_calc</a>(<span class="keywordtype">double</span> R2chg, <span class="keywordtype">double</span> qm1, <span class="keywordtype">double</span> qm2, <span class="keywordtype">double</span> qm3, <span class="keywordtype">double</span> qq1, <span class="keywordtype">double</span> qq2, <span class="keywordtype">double</span> qq3){</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keywordflow">return</span> R2chg*(2./3.)*(qm1+qm2+qm3)/(std::abs(qq1)*qm2*(qm2+qm3)/(qm1+qm2)+std::abs(qq2)*qm1*(qm1+qm3)/(qm1+qm2)+std::abs(qq3)*(qm1*qm2)/qm3) * (std::abs(qq1) + std::abs(qq2) + std::abs(qq3));</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#adc3e628aa7b59d1a87d157e5e581aa7e">   75</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#adc3e628aa7b59d1a87d157e5e581aa7e">HybridHadronization::SigBL2_calc</a>(<span class="keywordtype">double</span> SigBR2, <span class="keywordtype">double</span> qm1, <span class="keywordtype">double</span> qm2, <span class="keywordtype">double</span> qm3){</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keywordflow">return</span> SigBR2*((qm1*qm2)/(qm1+qm2))/(qm3*(qm1+qm2)/(qm1+qm2+qm3));</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a65cc44925516e60bb6cb6a232f0b4b5e">   79</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#a65cc44925516e60bb6cb6a232f0b4b5e">HybridHadronization::Init</a>(){</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <a class="code" href="../../d5/d83/classtinyxml2_1_1XMLElement.html">tinyxml2::XMLElement</a> *hadronization = GetXMLElement({<span class="stringliteral">&quot;JetHadronization&quot;</span>});</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">if</span> ( !hadronization ) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;Couldn&#39;t find tag Jet Hadronization&quot;</span>;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordflow">throw</span> std::runtime_error (<span class="stringliteral">&quot;Couldn&#39;t find tag Jet Hadronization&quot;</span>);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  }</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordflow">if</span> (hadronization) {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordtype">string</span> <a class="code" href="../../d5/d1e/namespacephysmon__simulation.html#afe07c0feff8b9ad0d479f54ff63a1a0d">s</a> = hadronization-&gt;<a class="code" href="../../d6/de3/classtinyxml2_1_1XMLNode.html#a4a38e0da23f4d97673a86c77d5cae5c2">FirstChildElement</a>( <span class="stringliteral">&quot;name&quot;</span> )-&gt;<a class="code" href="../../d5/d83/classtinyxml2_1_1XMLElement.html#a56cc727044dad002b978256754d43a4b">GetText</a>();</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;          <span class="comment">//std::string s = GetXMLElementText({&quot;JetHadronization&quot;, &quot;name&quot;});</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;          <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#a3b34504875531f73908383180beab139">JSDEBUG</a> &lt;&lt; s &lt;&lt; <span class="stringliteral">&quot; to be initialized ...&quot;</span>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;          <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#ad8c4c11cb01f911840136b6880a172d7">JSINFO</a>&lt;&lt;<span class="stringliteral">&quot;Initialize Hybrid Hadronization ...&quot;</span>;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#a3b34504875531f73908383180beab139">JSDEBUG</a>&lt;&lt;<span class="stringliteral">&quot;Initialize HybridHadronization&quot;</span>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="../../d1/dd2/PHG4PhenixEventAction_8cc.html#a4a20323806e186f80a443d377d400e69">VERBOSE</a>(8);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    maxM_level    = 1;          <span class="comment">//maximum energy level considered for meson recombination; maximum: 4</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    maxB_level    = 1;    <span class="comment">//maximum energy level considered for baryon recombination; no maximum but no physical baryons beyond 0</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    goldstonereco = <span class="keyword">false</span>; <span class="comment">// don&#39;t allow recombination of Goldstone bosons</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;          <a class="code" href="../../de/de0/matchedfilter_8C.html#ad41592f98ca3e701262b09723764d997">gmax</a>          = 1.25;         <span class="comment">//maximum allowed mass of the gluon (for q-qbar split), in GeV</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;          xmq           = 0.33; <span class="comment">//light quark mass, in GeV</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;          xms           = 0.5;  <span class="comment">//strange quark mass, in GeV</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    xmc           = 1.5;  <span class="comment">//charm quark mass in GeV</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    xmb           = 4.8;  <span class="comment">//bottom quark mass in GeV</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;          <a class="code" href="../../d8/da2/GubserHydro_8cc.html#a4d3af1654c1aa1f521233a74975bb76f">hbarc</a>         = 0.197327;     <span class="comment">// GeV*fm - maybe just set this as a constant in common?</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;          dist2cut      = 25.;          <span class="comment">//maximum distance [fm] squared for recombination (involving thermal partons) - in lab frame</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;          sh_recofactor = 1.;           <span class="comment">//suppression/enhancement factor for shower-shower recombination</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;          th_recofactor = 1.;           <span class="comment">//suppression/enhancement factor for shower-thermal recombination</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;          attempts_max  = 15;           <span class="comment">//maximum number of failed attempts to hadronize a single event before we give up.</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;          p_fake        = 0.;           <span class="comment">//momentum used for fake parton, if needed</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;          rand_seed     = 0;            <span class="comment">//seed for RNGs used - 0 means use a randomly determined random seed (from system time or std::random_device{}())</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;          had_prop      = 0.;           <span class="comment">//propagation of hadrons after formation by this time in lab frame</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    part_prop     = 0.;   <span class="comment">//minimum propagation time of partons after last split</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    reco_hadrons_pythia = 0; <span class="comment">//flag to put recombination hadrons into pythia for decays (position would be lost)</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;          <span class="comment">//xml read in to alter settings...</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;          <span class="keywordtype">double</span> xml_doublein = -1.; <span class="keywordtype">int</span> xml_intin = -1; <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xml_uintin = std::numeric_limits&lt;unsigned int&gt;::max();</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;          xml_doublein = GetXMLElementDouble({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;eCMforHadronization&quot;</span>});</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;          <span class="keywordflow">if</span>(xml_doublein &gt;= 0.){p_fake = xml_doublein / 6.;} xml_doublein = -1.; <span class="comment">// for colliders set fake momentum to valence quark energy</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;          xml_doublein = GetXMLElementDouble({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;thermreco_distmax&quot;</span>});</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;          <span class="keywordflow">if</span>(xml_doublein &gt;= 0.){dist2cut = xml_doublein*xml_doublein;} xml_doublein = -1.;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;          xml_doublein = GetXMLElementDouble({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;shower_recofactor&quot;</span>});</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;          <span class="keywordflow">if</span>(xml_doublein &gt;= 0.){sh_recofactor = xml_doublein;} xml_doublein = -1.;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;          xml_doublein = GetXMLElementDouble({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;thermal_recofactor&quot;</span>});</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;          <span class="keywordflow">if</span>(xml_doublein &gt;= 0.){th_recofactor = xml_doublein;} xml_doublein = -1.;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    xml_intin = GetXMLElementInt({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;reco_Mlevelmax&quot;</span>});</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;          <span class="keywordflow">if</span>(xml_intin &gt;= 0){maxM_level = xml_intin;} xml_intin = -1;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    xml_intin = GetXMLElementInt({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;reco_Blevelmax&quot;</span>});</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;          <span class="keywordflow">if</span>(xml_intin &gt;= -1){maxB_level = xml_intin;} xml_intin = -1;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    xml_intin = GetXMLElementInt({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;reco_goldstone&quot;</span>});</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;          <span class="keywordflow">if</span>(xml_intin &gt;= 0){goldstonereco = xml_intin;} xml_intin = -1;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    torder_reco = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;          xml_intin = GetXMLElementInt({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;recobias_t&quot;</span>});</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;          <span class="keywordflow">if</span>(xml_intin == 1){torder_reco = <span class="keyword">true</span>;} xml_intin = -1;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    xml_doublein = GetXMLElementDouble({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;hydro_Tc&quot;</span>});</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;          <span class="keywordflow">if</span>(xml_doublein &gt;= 0){hydro_Tc = xml_doublein;} xml_doublein = -1;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    xml_doublein = GetXMLElementDouble({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;had_postprop&quot;</span>});</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;          <span class="keywordflow">if</span>(xml_doublein &gt;= 0){had_prop = xml_doublein;} xml_doublein = -1;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    xml_doublein = GetXMLElementDouble({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;part_prop&quot;</span>});</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;          <span class="keywordflow">if</span>(xml_doublein &gt;= 0){part_prop = xml_doublein;} xml_doublein = -1;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;          xml_intin = GetXMLElementInt({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;reco_hadrons_in_pythia&quot;</span>});</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;          <span class="keywordflow">if</span>(xml_intin == 0 || xml_intin == 1){reco_hadrons_pythia = xml_intin;} xml_intin = -1;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    xml_intin = GetXMLElementInt({<span class="stringliteral">&quot;Afterburner&quot;</span>, <span class="stringliteral">&quot;include_fragmentation_hadrons&quot;</span>});</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;          <span class="keywordflow">if</span>(xml_intin == 1){afterburner_frag_hadrons = <span class="keyword">true</span>;} xml_intin = -1;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span>(maxM_level &gt; 4) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      maxM_level=4;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;Requested maximum energy level for mesons too large. Set it to 4.&quot;</span>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    }</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">// No, really, the maximum is four</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;          <span class="comment">// random seed</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;          <span class="comment">// xml limits us to unsigned int :-/ -- but so does 32 bits Mersenne Twist</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;          <a class="code" href="../../d5/d83/classtinyxml2_1_1XMLElement.html">tinyxml2::XMLElement</a> *RandomXmlDescription = GetXMLElement({<span class="stringliteral">&quot;Random&quot;</span>});</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;          <span class="keywordflow">if</span> ( RandomXmlDescription ){</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                  <a class="code" href="../../d5/d83/classtinyxml2_1_1XMLElement.html">tinyxml2::XMLElement</a> *xmle; xmle = RandomXmlDescription-&gt;<a class="code" href="../../d6/de3/classtinyxml2_1_1XMLNode.html#a4a38e0da23f4d97673a86c77d5cae5c2">FirstChildElement</a>( <span class="stringliteral">&quot;seed&quot;</span> );</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                  xmle-&gt;<a class="code" href="../../d5/d83/classtinyxml2_1_1XMLElement.html#a2192091dec0c06be8b14f4e912c01758" title="See QueryIntText()">QueryUnsignedText</a>(&amp;xml_uintin);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                  <span class="keywordflow">if</span>(xml_uintin &lt; std::numeric_limits&lt;unsigned int&gt;::max()){rand_seed = xml_uintin;} xml_uintin = std::numeric_limits&lt;unsigned int&gt;::max();</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;          }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                  <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;No &lt;Random&gt; element found in xml, seeding to 0&quot;</span>;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;          }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;          <a class="code" href="../../d1/dd2/PHG4PhenixEventAction_8cc.html#a4a20323806e186f80a443d377d400e69">VERBOSE</a>(7) &lt;&lt;<span class="stringliteral">&quot;Seeding PYTHIA(hadronization) to &quot;</span>&lt;&lt; rand_seed;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;          <span class="comment">//not sure if we can seed with a negative integer...</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;          <span class="keywordflow">if</span>(rand_seed != 0){eng.seed(rand_seed);}</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;          <span class="comment">//else{eng.seed(std::random_device{}());}</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;          <span class="keywordflow">else</span>{ <span class="comment">//seeding the mt19937_64 object &#39;eng&#39; PROPERLY!</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                  std::random_device <a class="code" href="../../d7/d77/usmData_8h.html#acc67242c8fbd2357ae40be4c9f7a1e51">rd</a>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                  std::array&lt;int,std::mt19937_64::state_size&gt; seedarray; std::generate_n(seedarray.data(), seedarray.size(), <a class="code" href="../../d2/df6/namespacecheck__smearing__config.html#aa205168f21e7dcfd80fde5c07d7e9ab9">std::ref</a>(rd));</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                  std::seed_seq seeds(<a class="code" href="../../d7/d6a/namespaceparse__cmake__options.html#a96dc2e9352f5bb441b89628e674d2678">std::begin</a>(seedarray), <a class="code" href="../../d7/dde/ctrl_8cpp.html#a13455ba845bf5d4dba37be491bc6a036">std::end</a>(seedarray)); eng.seed(seeds);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;          }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;          <span class="comment">//Since PYTHIA has no spacetime information, we shouldn&#39;t use recombination as it is necessary to calculate recombination probabilities</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;          <span class="comment">//later, this will instead update to set a flag to attempt to artificially generate this information</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;          <span class="comment">//for now, we just print a warning - but still try to run recombination.  It will just be unphysically enhanced, esp. for certain configurations</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;          <span class="comment">//tinyxml2::XMLElement *XmlPythiaGun=JetScapeXML::Instance()-&gt;GetXMLRoot()-&gt;FirstChildElement(&quot;Hard&quot; )-&gt;FirstChildElement(&quot;PythiaGun&quot;);</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">/*  tinyxml2::XMLElement *XmlPythiaGun = GetXMLElement({&quot;Hard&quot;, &quot;PythiaGun&quot;});</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">          bool PYgun_FSRon = false;</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">          if ( XmlPythiaGun ){</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">                  tinyxml2::XMLElement *xmle; xmle = XmlPythiaGun-&gt;FirstChildElement( &quot;FSR_on&quot; );</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">                  xmle-&gt;QueryIntText(&amp;xml_intin);</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">                  if(xml_intin == 1){PYgun_FSRon = true;} xml_intin = -1;</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">          }</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">          if(PYgun_FSRon &amp;&amp; (sh_recofactor &gt; 0.0000000001)){JSWARN &lt;&lt; &quot;Recombination with a PYTHIA FSR shower is not fully implemented.&quot;;}</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          xml_intin = GetXMLElementInt({<span class="stringliteral">&quot;Hard&quot;</span>, <span class="stringliteral">&quot;PythiaGun&quot;</span>, <span class="stringliteral">&quot;FSR_on&quot;</span>});</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;          <span class="keywordflow">if</span>(xml_intin &amp;&amp; (sh_recofactor &gt; 0.0000000001)){<a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;Recombination with a PYTHIA FSR shower is not fully implemented.&quot;</span>;}</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;          xml_intin = -1;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;          <span class="comment">//quark masses/charges used to get widths from charged radii (use Pythia masses)</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;          <span class="keywordtype">double</span> Qm_ud = xmq; <span class="keywordtype">double</span> Qm_s = xms; <span class="keywordtype">double</span> Qm_c = xmc; <span class="keywordtype">double</span> Qm_b = xmb;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;          <span class="keywordtype">double</span> chg_u = 2./3.; <span class="keywordtype">double</span> chg_d = -1./3.;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;          <span class="comment">//rms charge radii</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;          <span class="comment">//mesons</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;          <span class="keywordtype">double</span> R2chg_Pi  = 0.42 ;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;          <span class="keywordtype">double</span> R2chg_Phi = 0.21 ;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;          <span class="keywordtype">double</span> R2chg_K   = 0.34 ;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;          <span class="keywordtype">double</span> R2chg_Jpi = 0.04 ;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;          <span class="keywordtype">double</span> R2chg_Ds  = 0.09 ;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;          <span class="keywordtype">double</span> R2chg_D   = 0.165;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;          <span class="keywordtype">double</span> R2chg_Ups = 0.032; <span class="comment">//????? setting to a linear extrapolation from Jpsi -&gt; Bc -&gt; Ups</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;          <span class="keywordtype">double</span> R2chg_Bc  = 0.036;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;          <span class="keywordtype">double</span> R2chg_B   = 0.273;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;          <span class="comment">//baryons</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;          <span class="keywordtype">double</span> R2chg_Nuc  = 0.69 ;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;          <span class="keywordtype">double</span> R2chg_Omg  = 0.355;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;          <span class="keywordtype">double</span> R2chg_Xi   = 0.52 ;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;          <span class="keywordtype">double</span> R2chg_Sig  = 0.61 ;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;          <span class="keywordtype">double</span> R2chg_Occc = 0.179; <span class="comment">//?????</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;          <span class="keywordtype">double</span> R2chg_Occ  = 0.043; <span class="comment">//?</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;          <span class="keywordtype">double</span> R2chg_Xicc = 0.049; <span class="comment">//?</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;          <span class="keywordtype">double</span> R2chg_Oc   = 0.1  ; <span class="comment">//?????</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;          <span class="keywordtype">double</span> R2chg_Xic  = 0.24 ; <span class="comment">//?</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;          <span class="keywordtype">double</span> R2chg_Sigc = 0.27 ; <span class="comment">//?</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;          <span class="keywordtype">double</span> R2chg_Obbb = 0.001; <span class="comment">//?????</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;          <span class="keywordtype">double</span> R2chg_Obbc = 0.001; <span class="comment">//?????</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;          <span class="keywordtype">double</span> R2chg_Obb  = 0.001; <span class="comment">//?????</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;          <span class="keywordtype">double</span> R2chg_Xibb = 0.001; <span class="comment">//?????</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;          <span class="keywordtype">double</span> R2chg_Obcc = 0.001; <span class="comment">//?????</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;          <span class="keywordtype">double</span> R2chg_Obc  = 0.001; <span class="comment">//?????</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;          <span class="keywordtype">double</span> R2chg_Xibc = 0.001; <span class="comment">//?????</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;          <span class="keywordtype">double</span> R2chg_Ob   = 0.6  ; <span class="comment">//?????</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;          <span class="keywordtype">double</span> R2chg_Xib  = 0.63 ; <span class="comment">//?????</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;          <span class="keywordtype">double</span> R2chg_Sigb = 0.66 ; <span class="comment">//?????</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;          <span class="comment">//meson width calculations (r2) - recalc if r2chg is changed on command line...</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;          SigPi2  = SigM2_calc(R2chg_Pi,  Qm_ud, Qm_ud, chg_d, chg_u);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;          SigPhi2 = SigM2_calc(R2chg_Phi, Qm_s,  Qm_s,  chg_d, -chg_d); <span class="comment">//normalizing</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;          SigK2   = SigM2_calc(R2chg_K,   Qm_s,  Qm_ud, chg_d, chg_u);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;          SigJpi2 = SigM2_calc(R2chg_Jpi, Qm_c,  Qm_c,  chg_u, -chg_u); <span class="comment">//normalizing</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;          SigDs2  = SigM2_calc(R2chg_Ds,  Qm_c,  Qm_s,  chg_u, chg_d);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;          SigD2   = SigM2_calc(R2chg_D,   Qm_c,  Qm_ud, chg_u, chg_d);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;          SigUps2 = SigM2_calc(R2chg_Ups, Qm_b,  Qm_b,  chg_d, -chg_d); <span class="comment">//normalizing</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;          SigBc2  = SigM2_calc(R2chg_Bc,  Qm_b,  Qm_c,  chg_d, chg_u);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;          SigB2   = SigM2_calc(R2chg_B,   Qm_b,  Qm_ud, chg_d, chg_u); <span class="comment">// (treating B_s as B)</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;          <span class="comment">//baryon width calculations (r2) - recalc if r2chg is changed on command line...</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;          <span class="comment">//light/strange baryons</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;          SigNucR2 = SigBR2_calc(R2chg_Nuc, Qm_ud, Qm_ud, Qm_ud, chg_d, chg_u, chg_u);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;          SigNucL2 = SigBL2_calc(SigNucR2,  Qm_ud, Qm_ud, Qm_ud);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;          SigOmgR2 = SigBR2_calc(R2chg_Omg, Qm_s,  Qm_s,  Qm_s,  chg_d, chg_d, chg_d);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;          SigOmgL2 = SigBL2_calc(SigOmgR2,  Qm_s,  Qm_s,  Qm_s );</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;          SigXiR2  = SigBR2_calc(R2chg_Xi,  Qm_s,  Qm_s,  Qm_ud, chg_d, chg_d, chg_d);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;          SigXiL2  = SigBL2_calc(SigXiR2,   Qm_s,  Qm_s,  Qm_ud);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;          SigSigR2 = SigBR2_calc(R2chg_Sig, Qm_s,  Qm_ud, Qm_ud, chg_d, chg_u, chg_u);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;          SigSigL2 = SigBL2_calc(SigSigR2,  Qm_s,  Qm_ud, Qm_ud);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;          <span class="comment">//charm baryons</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;          SigOcccR2 = SigBR2_calc(R2chg_Occc, Qm_c, Qm_c,  Qm_c,  chg_d, chg_d, chg_d); <span class="comment">// ! maybe need to normalize? (just setting all to -1/3 for now)</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;          SigOcccL2 = SigBL2_calc(SigOcccR2,  Qm_c, Qm_c,  Qm_c );</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;          SigOccR2  = SigBR2_calc(R2chg_Occ,  Qm_c, Qm_c,  Qm_s,  chg_u, chg_u, chg_d);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;          SigOccL2  = SigBL2_calc(SigOccR2,   Qm_c, Qm_c,  Qm_s );</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;          SigXiccR2 = SigBR2_calc(R2chg_Xicc, Qm_c, Qm_c,  Qm_ud, chg_u, chg_u, chg_d);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;          SigXiccL2 = SigBL2_calc(SigXiccR2,  Qm_c, Qm_c,  Qm_ud);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;          SigOcR2   = SigBR2_calc(R2chg_Oc,   Qm_c, Qm_s,  Qm_s,  chg_d, chg_d, chg_d); <span class="comment">// ! setting all quark charges to -1/3</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;          SigOcL2   = SigBL2_calc(SigOcR2,    Qm_c, Qm_s,  Qm_s );</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;          SigXicR2  = SigBR2_calc(R2chg_Xic,  Qm_c, Qm_s,  Qm_ud, chg_u, chg_d, chg_u);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;          SigXicL2  = SigBL2_calc(SigXicR2,   Qm_c, Qm_s,  Qm_ud);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;          SigSigcR2 = SigBR2_calc(R2chg_Sigc, Qm_c, Qm_ud, Qm_ud, chg_u, chg_d, chg_u);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;          SigSigcL2 = SigBL2_calc(SigSigcR2,  Qm_c, Qm_ud, Qm_ud);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;          <span class="comment">//bottom baryons</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;          SigObbbR2 = SigBR2_calc(R2chg_Obbb, Qm_b, Qm_b,  Qm_b,  chg_d, chg_d, chg_d);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;          SigObbbL2 = SigBL2_calc(SigObbbR2,  Qm_b, Qm_b,  Qm_b );</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;          SigObbcR2 = SigBR2_calc(R2chg_Obbc, Qm_b, Qm_b,  Qm_c,  chg_d, chg_d, chg_d); <span class="comment">// ! setting all quark charges to -1/3</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;          SigObbcL2 = SigBL2_calc(SigObbcR2,  Qm_b, Qm_b,  Qm_c );</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;          SigObbR2  = SigBR2_calc(R2chg_Obb,  Qm_b, Qm_b,  Qm_s,  chg_d, chg_d, chg_d);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;          SigObbL2  = SigBL2_calc(SigObbR2,   Qm_b, Qm_b,  Qm_s );</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;          SigXibbR2 = SigBR2_calc(R2chg_Xibb, Qm_b, Qm_b,  Qm_ud, chg_d, chg_d, chg_d);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;          SigXibbL2 = SigBL2_calc(SigXibbR2,  Qm_b, Qm_b,  Qm_ud);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;          SigObccR2 = SigBR2_calc(R2chg_Obcc, Qm_b, Qm_c,  Qm_c,  chg_d, chg_u, chg_u);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;          SigObccL2 = SigBL2_calc(SigObccR2,  Qm_b, Qm_c,  Qm_c );</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;          SigObcR2  = SigBR2_calc(R2chg_Obc,  Qm_b, Qm_c,  Qm_s,  chg_d, chg_d, chg_d); <span class="comment">// ! flipping c quark charge (all to -1/3)</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;          SigObcL2  = SigBL2_calc(SigObcR2,   Qm_b, Qm_c,  Qm_s );</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;          SigXibcR2 = SigBR2_calc(R2chg_Xibc, Qm_b, Qm_c,  Qm_ud, chg_d, chg_u, chg_u);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;          SigXibcL2 = SigBL2_calc(SigXibcR2,  Qm_b, Qm_c,  Qm_ud);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;          SigObR2   = SigBR2_calc(R2chg_Ob,   Qm_b, Qm_s,  Qm_s,  chg_d, chg_d, chg_d);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;          SigObL2   = SigBL2_calc(SigObR2,    Qm_b, Qm_s,  Qm_s );</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;          SigXibR2  = SigBR2_calc(R2chg_Xib,  Qm_b, Qm_s,  Qm_ud, chg_d, chg_d, chg_d);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;          SigXibL2  = SigBL2_calc(SigXibR2,   Qm_b, Qm_s,  Qm_ud);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;          SigSigbR2 = SigBR2_calc(R2chg_Sigb, Qm_b, Qm_ud, Qm_ud, chg_d, chg_u, chg_u);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;          SigSigbL2 = SigBL2_calc(SigSigbR2,  Qm_b, Qm_ud, Qm_ud);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// No event record printout.</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    pythia.readString(<span class="stringliteral">&quot;Next:numberShowInfo = 0&quot;</span>);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    pythia.readString(<span class="stringliteral">&quot;Next:numberShowProcess = 0&quot;</span>);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    pythia.readString(<span class="stringliteral">&quot;Next:numberShowEvent = 0&quot;</span>);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    pythia.readString(<span class="stringliteral">&quot;Init:showProcesses = off&quot;</span>);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    pythia.readString(<span class="stringliteral">&quot;Init:showChangedSettings = off&quot;</span>);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    pythia.readString(<span class="stringliteral">&quot;Init:showMultipartonInteractions = off&quot;</span>);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    pythia.readString(<span class="stringliteral">&quot;Init:showChangedParticleData = off&quot;</span>);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">// Standard settings</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    pythia.readString(<span class="stringliteral">&quot;ProcessLevel:all = off&quot;</span>);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;          <span class="comment">//pythia.readString(&quot;PartonLevel:FSR=off&quot;); //is this necessary?</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">// General settings for hadron decays</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    pythia_decays = GetXMLElementText({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;pythia_decays&quot;</span>});</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordtype">double</span> tau0Max = 10.0;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordtype">double</span> tau0Max_xml = GetXMLElementDouble({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;tau0Max&quot;</span>});</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;          <span class="keywordflow">if</span>(tau0Max_xml &gt;= 0){tau0Max = tau0Max_xml;}</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">else</span>{<a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;tau0Max should be larger than 0. Set it to 10.&quot;</span>;}</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span>(pythia_decays == <span class="stringliteral">&quot;on&quot;</span>){</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#ad8c4c11cb01f911840136b6880a172d7">JSINFO</a> &lt;&lt; <span class="stringliteral">&quot;Pythia decays are turned on for tau0Max &lt; &quot;</span> &lt;&lt; tau0Max;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      pythia.readString(<span class="stringliteral">&quot;HadronLevel:Decay = on&quot;</span>);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      pythia.readString(<span class="stringliteral">&quot;ParticleDecays:limitTau0 = on&quot;</span>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      pythia.readString(<span class="stringliteral">&quot;ParticleDecays:tau0Max = &quot;</span> + <a class="code" href="../../d9/d52/HoughTransformSeeder_8cpp.html#a1f2cfb6e3644c66f2bfe3c54f699a72a">std::to_string</a>(tau0Max));</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#ad8c4c11cb01f911840136b6880a172d7">JSINFO</a> &lt;&lt; <span class="stringliteral">&quot;Pythia decays are turned off&quot;</span>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      pythia.readString(<span class="stringliteral">&quot;HadronLevel:Decay = off&quot;</span>);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">// Settings for decays (old flag, will be depracted at some point)</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">// This overwrites the previous settings if the user xml file contains the flag</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <a class="code" href="../../d0/da7/namespacetesting_1_1internal.html#a8e8ff5b11e64078831112677156cb111">std::string</a> weak_decays =</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      GetXMLElementText({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;weak_decays&quot;</span>});</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordflow">if</span> (weak_decays == <span class="stringliteral">&quot;off&quot;</span>) {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#ad8c4c11cb01f911840136b6880a172d7">JSINFO</a> &lt;&lt; <span class="stringliteral">&quot;Hadron decays are turned off.&quot;</span>;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;This parameter will be depracted at some point. Use &#39;pythia_decays&#39; instead.\nOverwriting &#39;pythia_decays&#39;.&quot;</span>;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      pythia.readString(<span class="stringliteral">&quot;HadronLevel:Decay = off&quot;</span>);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(weak_decays == <span class="stringliteral">&quot;on&quot;</span>) {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#ad8c4c11cb01f911840136b6880a172d7">JSINFO</a> &lt;&lt; <span class="stringliteral">&quot;Hadron decays inside a range of 10 mm/c are turned on.&quot;</span>;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;This parameter will be depracted at some point. Use &#39;pythia_decays&#39; and &#39;tau0Max&#39; for more control on decays.\nOverwriting &#39;pythia_decays&#39; and fix &#39;tau0Max&#39; to 10.&quot;</span>;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      pythia.readString(<span class="stringliteral">&quot;HadronLevel:Decay = on&quot;</span>);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      pythia.readString(<span class="stringliteral">&quot;ParticleDecays:limitTau0 = on&quot;</span>);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      pythia.readString(<span class="stringliteral">&quot;ParticleDecays:tau0Max = 10.0&quot;</span>);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    }</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;          <span class="comment">//setting seed, or using random seed</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;          pythia.readString(<span class="stringliteral">&quot;Random:setSeed = on&quot;</span>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;          pythia.readString(<span class="stringliteral">&quot;Random:seed = &quot;</span> + <a class="code" href="../../d9/d52/HoughTransformSeeder_8cpp.html#a1f2cfb6e3644c66f2bfe3c54f699a72a">std::to_string</a>(rand_seed));</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;          <span class="comment">//additional settings</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;          <span class="comment">//turning off pythia checks for runtime decrease (can be turned back on if necessary, but it shouldn&#39;t make much of a difference)</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;          pythia.readString(<span class="stringliteral">&quot;Check:event = off&quot;</span>);      <span class="comment">// is probably a bad idea, but shouldn&#39;t really be necessary... will use a bit of runtime on event checks...</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;          pythia.readString(<span class="stringliteral">&quot;Check:history = off&quot;</span>);    <span class="comment">// might be a good idea to set &#39;off&#39; as it saves runtime - provided we know that we&#39;ve set up mother/daughter relations correctly...</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;          <span class="comment">//making the pythia event checks a little less stringent (PYTHIA documentation already states that LHC events will occasionally violate default constraint, without concern)</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;          <span class="comment">//pythia.readString(&quot;Check:epTolWarn = 1e-4&quot;);   // setting E/P conservation violation constraint somewhat weaker, just for ease</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;          <span class="comment">//pythia.readString(&quot;Check:epTolErr  = 1e-2&quot;);   // setting E/P conservation violation constraint somewhat weaker, just for ease</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;          <span class="comment">//pythia.readString(&quot;Check:mTolWarn  = 1e-2&quot;);   // setting EP/M conservation violation constraint somewhat weaker, just for ease</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;          <span class="comment">//pythia.readString(&quot;Check:mTolErr   = 1e-1&quot;);   // setting EP/M conservation violation constraint somewhat weaker, just for ease</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;          <span class="comment">//allowing for partonic space-time information to be used by PYTHIA</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;          <span class="comment">//pythia.readString(&quot;PartonVertex:setVertex = on&quot;);        //this might allow PYTHIA to keep track of partonic space-time information (default was for &#39;rope hadronization&#39;)</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;          <span class="comment">//setting hadron color tags so that spacetime information can be reconstructed</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;          pythia.readString(<span class="stringliteral">&quot;StringFragmentation:TraceColours = on&quot;</span>);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;          <span class="comment">//using QCD based color reconnection (original PYTHIA MPI based CR can&#39;t be used at hadron level)</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;          pythia.readString(<span class="stringliteral">&quot;ColourReconnection:reconnect = off&quot;</span>);          <span class="comment">//allowing color reconnections (should have been default on, but doing it here for clarity)</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="comment">/*pythia.readString(&quot;ColourReconnection:mode = 1&quot;);                //sets the color reconnection scheme to &#39;new&#39; QCD based scheme (TODO: make sure this is better than (2)gluon move)</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">          pythia.readString(&quot;ColourReconnection:forceHadronLevelCR = on&quot;);  //allowing color reconnections for these constructed strings!</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">                                                                            //a few params for the QCD based color reconnection scheme are set below.</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">          pythia.readString(&quot;MultipartonInteractions:pT0Ref = 2.15&quot;);       //not sure if this is needed for this setup, but is part of the recommended &#39;default&#39;</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">          pythia.readString(&quot;ColourReconnection:allowDoubleJunRem = off&quot;);  //default on - allows directly connected double junction systems to split into two strings</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">          pythia.readString(&quot;ColourReconnection:junctionCorrection = 1.15&quot;);</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">          pythia.readString(&quot;ColourReconnection:timeDilationMode = 3&quot;);     //allow reconnection if single pair of dipoles are in causal contact (maybe try 5 as well?)</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">          pythia.readString(&quot;ColourReconnection:timeDilationPar = 0.18&quot;);   //parameter used in causal interaction between strings (mode set above)(maybe try 0.073?)</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    std::stringstream <a class="code" href="../../d7/dc9/namespacetest__fpe.html#a57c4fd9ead9c25ae1b6b618bb7afdfbd">lines</a>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    lines &lt;&lt; GetXMLElementText({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;LinesToRead&quot;</span>}, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">while</span> (std::getline(lines, s, <span class="charliteral">&#39;\n&#39;</span>)) {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keywordflow">if</span> (s.find_first_not_of(<span class="stringliteral">&quot; \t\v\f\r&quot;</span>) == s.npos)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">continue</span>; <span class="comment">// skip empty lines</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#ad8c4c11cb01f911840136b6880a172d7">JSINFO</a> &lt;&lt; <span class="stringliteral">&quot;Also reading in: &quot;</span> &lt;&lt; <a class="code" href="../../d5/d1e/namespacephysmon__simulation.html#afe07c0feff8b9ad0d479f54ff63a1a0d">s</a>;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      pythia.readString(s);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">// optional input of another pythia particle data xml file (higher excited states,...)</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    xml_intin = GetXMLElementInt({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;additional_pythia_particles&quot;</span>});</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;          <span class="keywordflow">if</span>(xml_intin == 0 || xml_intin == 1){additional_pythia_particles = xml_intin;} xml_intin = -1;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordflow">if</span>(additional_pythia_particles == 1) {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <a class="code" href="../../d0/da7/namespacetesting_1_1internal.html#a8e8ff5b11e64078831112677156cb111">std::string</a> additional_pythia_particle_file =</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        GetXMLElementText({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;additional_pythia_particles_path&quot;</span>});</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      pythia.particleData.readXML(additional_pythia_particle_file,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    }</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="comment">// And initialize</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    pythia.init();</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="comment">//reading in info for thermal partons</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;          inbrick = <span class="keyword">false</span>; brickL = -1.;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    inhydro = <span class="keyword">false</span>; nreusehydro = 1;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;          xml_intin = GetXMLElementInt({<span class="stringliteral">&quot;Eloss&quot;</span>, <span class="stringliteral">&quot;Matter&quot;</span>, <span class="stringliteral">&quot;brick_med&quot;</span>});</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;          <span class="keywordflow">if</span>(xml_intin == 1){inbrick = <span class="keyword">true</span>;} xml_intin = -1;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;          xml_doublein = GetXMLElementDouble({<span class="stringliteral">&quot;Eloss&quot;</span>, <span class="stringliteral">&quot;Matter&quot;</span>, <span class="stringliteral">&quot;brick_length&quot;</span>});</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;          <span class="keywordflow">if</span>(inbrick &amp;&amp; (xml_doublein &gt;= 0.)){brickL = xml_doublein;} xml_doublein = -1.;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    xml_intin = GetXMLElementInt({<span class="stringliteral">&quot;nReuseHydro&quot;</span>});</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;          <span class="keywordflow">if</span>(xml_intin &gt; 0){nreusehydro = xml_intin;} xml_intin = -1;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;          xml_doublein = GetXMLElementDouble({<span class="stringliteral">&quot;Eloss&quot;</span>, <span class="stringliteral">&quot;deltaT&quot;</span>});</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;          <span class="keywordflow">if</span>(xml_doublein &gt;= 0.){delta_t = xml_doublein;} xml_doublein = -1.;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="comment">// Check if hydro is used in user xml file</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <a class="code" href="../../d5/d83/classtinyxml2_1_1XMLElement.html">tinyxml2::XMLElement</a> *elementXML = (<a class="code" href="../../d5/d83/classtinyxml2_1_1XMLElement.html">tinyxml2::XMLElement</a> *)<a class="code" href="../../d9/d2b/classJetscape_1_1JetScapeXML.html#ac0c782c87ff0949d02f613de3469a04a">JetScapeXML::Instance</a>()-&gt;<a class="code" href="../../d9/d2b/classJetscape_1_1JetScapeXML.html#a289e9d6a1177ae9b041ae3bdc2567217">GetXMLRootUser</a>()-&gt;<a class="code" href="../../d6/de3/classtinyxml2_1_1XMLNode.html#a4a38e0da23f4d97673a86c77d5cae5c2">FirstChildElement</a>();</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">while</span> (elementXML) {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <a class="code" href="../../d0/da7/namespacetesting_1_1internal.html#a8e8ff5b11e64078831112677156cb111">std::string</a> elementName = elementXML-&gt;<a class="code" href="../../d5/d83/classtinyxml2_1_1XMLElement.html#a8bff355472bce2c60d4b50a212bf7f5f" title="Get the name of an element (which is the Value() of the node.)">Name</a>();</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      <span class="keywordflow">if</span> (elementName == <span class="stringliteral">&quot;Hydro&quot;</span>) {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        inhydro = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      elementXML = elementXML-&gt;<a class="code" href="../../d6/de3/classtinyxml2_1_1XMLNode.html#ab66a0818d72cee86e0952ed2da701f8b" title="Get the next (right) sibling element of this node, with an optionally supplied name.">NextSiblingElement</a>();</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    } <span class="comment">// at this point the hydro could still be a brick -&gt; check this in the following part</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">if</span>(inhydro){</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <a class="code" href="../../d5/d83/classtinyxml2_1_1XMLElement.html">tinyxml2::XMLElement</a> *<a class="code" href="../../d5/d71/namespacefixGDML.html#a3ceb8811bdea2af323513d9f998064f3">element</a> = (<a class="code" href="../../d5/d83/classtinyxml2_1_1XMLElement.html">tinyxml2::XMLElement</a> *)<a class="code" href="../../d9/d2b/classJetscape_1_1JetScapeXML.html#ac0c782c87ff0949d02f613de3469a04a">JetScapeXML::Instance</a>()-&gt;<a class="code" href="../../d9/d2b/classJetscape_1_1JetScapeXML.html#a289e9d6a1177ae9b041ae3bdc2567217">GetXMLRootUser</a>()-&gt;<a class="code" href="../../d6/de3/classtinyxml2_1_1XMLNode.html#a4a38e0da23f4d97673a86c77d5cae5c2">FirstChildElement</a>();</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      <span class="keywordflow">while</span> (element) {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <a class="code" href="../../d0/da7/namespacetesting_1_1internal.html#a8e8ff5b11e64078831112677156cb111">std::string</a> elementName = element-&gt;<a class="code" href="../../d5/d83/classtinyxml2_1_1XMLElement.html#a8bff355472bce2c60d4b50a212bf7f5f" title="Get the name of an element (which is the Value() of the node.)">Name</a>();</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="keywordflow">if</span> (elementName == <span class="stringliteral">&quot;Hydro&quot;</span>) {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;          inhydro = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;          <a class="code" href="../../d5/d83/classtinyxml2_1_1XMLElement.html">tinyxml2::XMLElement</a> *childElement = (<a class="code" href="../../d5/d83/classtinyxml2_1_1XMLElement.html">tinyxml2::XMLElement</a> *)element-&gt;<a class="code" href="../../d6/de3/classtinyxml2_1_1XMLNode.html#a4a38e0da23f4d97673a86c77d5cae5c2">FirstChildElement</a>();</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;          <span class="keywordflow">while</span> (childElement) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <a class="code" href="../../d0/da7/namespacetesting_1_1internal.html#a8e8ff5b11e64078831112677156cb111">std::string</a> childElementName = childElement-&gt;<a class="code" href="../../d5/d83/classtinyxml2_1_1XMLElement.html#a8bff355472bce2c60d4b50a212bf7f5f" title="Get the name of an element (which is the Value() of the node.)">Name</a>();</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="keywordflow">if</span> (childElementName == <span class="stringliteral">&quot;Brick&quot;</span>) {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;              inbrick = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;              inhydro = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            childElement = childElement-&gt;<a class="code" href="../../d6/de3/classtinyxml2_1_1XMLNode.html#ab66a0818d72cee86e0952ed2da701f8b" title="Get the next (right) sibling element of this node, with an optionally supplied name.">NextSiblingElement</a>();</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;          }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        element = element-&gt;<a class="code" href="../../d6/de3/classtinyxml2_1_1XMLNode.html#ab66a0818d72cee86e0952ed2da701f8b" title="Get the next (right) sibling element of this node, with an optionally supplied name.">NextSiblingElement</a>();</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">// this is only important if a boost invariant 2+1d hydro is used</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    xml_doublein = GetXMLElementDouble({<span class="stringliteral">&quot;JetHadronization&quot;</span>, <span class="stringliteral">&quot;eta_max_boost_inv&quot;</span>});</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;          <span class="keywordflow">if</span>(inhydro &amp;&amp; (xml_doublein &gt;= 0.)){eta_max_boost_inv = xml_doublein;} xml_doublein = -1.;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;}</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div>
<div class="line"><a name="l00447"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a027b682dc2e1aab5a0eb98f148f83613">  447</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#a027b682dc2e1aab5a0eb98f148f83613">HybridHadronization::WriteTask</a>(weak_ptr&lt;JetScapeWriter&gt; w){</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <a class="code" href="../../d1/dd2/PHG4PhenixEventAction_8cc.html#a4a20323806e186f80a443d377d400e69">VERBOSE</a>(8);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keyword">auto</span> <a class="code" href="../../d7/dde/ctrl_8cpp.html#a4d8dfd0d62f1f4d6ee444333ceefb7ba">f</a> = w.lock();</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keywordflow">if</span> ( !<a class="code" href="../../d7/dde/ctrl_8cpp.html#a4d8dfd0d62f1f4d6ee444333ceefb7ba">f</a> ) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <a class="code" href="../../d7/dde/ctrl_8cpp.html#a4d8dfd0d62f1f4d6ee444333ceefb7ba">f</a>-&gt;WriteComment(<span class="stringliteral">&quot;Hadronization Module : &quot;</span>+GetId());</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;}</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">//TODO: Junction Strings, Thermal Partons</span></div>
<div class="line"><a name="l00455"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#acb2fea06695221975150eda56f635d56">  455</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#acb2fea06695221975150eda56f635d56">HybridHadronization::DoHadronization</a>(vector&lt;vector&lt;<a class="code" href="../../d4/d67/classshared__ptr.html">shared_ptr&lt;Parton&gt;</a>&gt;&gt;&amp; <a class="code" href="../../d3/d9d/classshower.html">shower</a>, vector&lt;<a class="code" href="../../d4/d67/classshared__ptr.html">shared_ptr&lt;Hadron&gt;</a>&gt;&amp; hOut, vector&lt;<a class="code" href="../../d4/d67/classshared__ptr.html">shared_ptr&lt;Parton&gt;</a>&gt;&amp; pOut){</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  number_p_fake = 0;    <span class="comment">//reset counter for the number of fake partons</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordtype">double</span> energy_hadrons = 0.; <span class="comment">//needed for the kinetic scaling of the negative hadrons</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="comment">//JSINFO&lt;&lt;&quot;Start Hybrid Hadronization using both Recombination and PYTHIA Lund string model.&quot;;</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  pythia.event.reset(); HH_shower.clear();</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a> neg_ptns;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="comment">//pointer to get hydro temperature info</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  std::unique_ptr&lt;FluidCellInfo&gt; check_fluid_info_ptr;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordtype">bool</span> boost_invariant = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordtype">bool</span> Cartesian_hydro = <span class="keyword">false</span>; <span class="comment">// not properly initialized by all hydro modules at the moment, don&#39;t use it</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordflow">if</span>(inhydro){</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      std::shared_ptr&lt;FluidDynamics&gt; hydro_ptr = <a class="code" href="../../d6/d27/classJetscape_1_1JetScapeSignalManager.html#abbbae21686eecd5bca47a1c772a9d847">JetScapeSignalManager::Instance</a>()-&gt;<a class="code" href="../../d6/d27/classJetscape_1_1JetScapeSignalManager.html#a249ee5094ae4a1c79180df2ef442891e">GetHydroPointer</a>().lock();</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d3/d99/classJetscape_1_1EvolutionHistory.html">EvolutionHistory</a>&amp; bulk_info = hydro_ptr-&gt;get_bulk_info();</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      boost_invariant = bulk_info.<a class="code" href="../../d3/d99/classJetscape_1_1EvolutionHistory.html#ad7c41652a8621b812ba145745b6cf3f4">is_boost_invariant</a>();</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      Cartesian_hydro = bulk_info.<a class="code" href="../../d3/d99/classJetscape_1_1EvolutionHistory.html#a695db114db8228e0d394094ec7cadf41">is_Cartesian</a>();</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      Cartesian_hydro = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  }</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="comment">//negative brickL, then we will not run a brick sampler</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">if</span>(brickL &lt; 0.){brickL = 0.; inbrick = <span class="keyword">false</span>;}</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="comment">//The framework uses unsigned int for partons, while HHpartons have int anti-/color tags.</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="comment">//Changing the HH partons to unsigned int is not that easy as some workflow, e.g. in recomb(),</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="comment">//needs them to be integer in some structures. Let&#39;s have a workaround and set the</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="comment">//tags of partons which are too large for an int value to a new unused value.</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  convert_color_tags_to_int_type(<a class="code" href="../../d3/d9d/classshower.html">shower</a>);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordtype">double</span> total_shower_energy = 0.; <span class="comment">// used to scale the negative hadrons</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordtype">double</span> total_shower_energy_neg = 0.; <span class="comment">// used to scale the negative hadrons</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="comment">//sort positive partons into HH_shower and negative partons from LBT to neg_ptns</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ishower=0; ishower &lt; <a class="code" href="../../d3/d9d/classshower.html">shower</a>.size(); ++ishower){</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ipart=0; ipart &lt; <a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).size(); ++ipart){</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> sh_parton;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                  sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a1a9299c88d28bdad525a2b125aa8b2b4">is_shower</a>(<span class="keyword">true</span>); sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(<a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;pid()); sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(0); <span class="comment">//sh_parton.string_id(str)</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                  sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(<a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;px()); sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(<a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;py());</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                  sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(<a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;pz()); sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(<a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;e());</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                  sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a51d252718fbe2c74369041a231f4a186">x</a>( <a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;x_in().x() ); sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a08c82f3d9df5f16ac663f2fd1457b07d">y</a>( <a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;x_in().y() );</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                  sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a73547d7fbba88c93bd3b20ff9ef02b4e">z</a>( <a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;x_in().z() ); sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>(<a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;x_in().t() );</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                  sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>( sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>()*sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>() - sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() - sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() - sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() );</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                  sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>( (sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>() &gt;= 0.) ? sqrt(sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()) : sqrt(-sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()) );</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                  sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>( <a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;color() ); sh_parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>( <a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;anti_color() );</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                  <span class="keywordflow">if</span>(<a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;pstat()&gt;-1){</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        HH_shower.add(sh_parton);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        total_shower_energy += HH_shower[HH_shower.num()-1].e();</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        neg_ptns.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(sh_parton);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        total_shower_energy_neg += neg_ptns[neg_ptns.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].e();</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      }</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;          }</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;          <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#a3b34504875531f73908383180beab139">JSDEBUG</a>&lt;&lt;<span class="stringliteral">&quot;Shower#&quot;</span>&lt;&lt;ishower+1 &lt;&lt; <span class="stringliteral">&quot;. Number of partons to hadronize: &quot;</span> &lt;&lt; HH_shower.num();</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;          <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#a3b34504875531f73908383180beab139">JSDEBUG</a>&lt;&lt;<span class="stringliteral">&quot;Shower#&quot;</span>&lt;&lt;ishower+1 &lt;&lt; <span class="stringliteral">&quot;. Number of (neg) partons to hadronize: &quot;</span> &lt;&lt; neg_ptns.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>();</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="comment">//sample thermal partons, brick or hydro hypersurface</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="comment">//checking to see if we need to sample thermal partons, if either in brick or hydro</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="keywordtype">bool</span> runsampler = (((inhydro || inbrick) &amp;&amp; HH_thermal.num()==0) || (GetCurrentEvent()%nreusehydro==0)) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordflow">if</span>(runsampler &amp;&amp; inbrick){</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    HH_thermal.clear(); <span class="comment">//emptying the thermal partons if we&#39;re resampling</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <a class="code" href="../../d7/d0a/classThermalPartonSampler.html">ThermalPartonSampler</a> brick(rand_seed); <span class="comment">//creating a thermal brick</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;          brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#aaf89276becb5f8e3dce7d7988bb85a45">brick_length_width</a>(brickL,brickL);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;          brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#af6fa8f7f95fda4ea997d31423e9f2d67">brick_flow</a>(0., 0., 0.);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a0228e49687336bca5c9b39eb1192a3cd">brick_Tc</a>(hydro_Tc);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;          brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#aa3c8d01b10e68b2c40edcfad725f5fe0">samplebrick</a>();</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;          <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#ad8c4c11cb01f911840136b6880a172d7">JSINFO</a> &lt;&lt; <span class="stringliteral">&quot;A &quot;</span> &lt;&lt; brickL &lt;&lt; <span class="stringliteral">&quot; fm brick was sampled, generating &quot;</span> &lt;&lt; brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#ad1a198314988b324620ce9abc8784f96">nTot</a>() &lt;&lt; <span class="stringliteral">&quot; partons (&quot;</span> &lt;&lt; brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a4b6c3e61162ea6ea3baf997e1c5b4c7d">th_nL</a>() &lt;&lt; <span class="stringliteral">&quot; light, &quot;</span> &lt;&lt; brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#aa90253118f5e0cb2f7bd0393f77fffa4">th_nS</a>() &lt;&lt; <span class="stringliteral">&quot; strange).&quot;</span>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ith=0; ith&lt;brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#ad1a198314988b324620ce9abc8784f96">nTot</a>(); ++ith){</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> thparton;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#af3f776ba437bcde57670e1ae0621d81f">is_thermal</a>(<span class="keyword">true</span>); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#acf116004f80d143dfd8937c7fa4677f9">th_pid</a>(ith)); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(1); <span class="comment">//sh_parton.string_id(str)</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(0); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(0);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a322c96b09141960837a1d578c0481f4d">th_px</a>(ith)); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a70f394d98d0771d0f37521d073ae1d40">th_py</a>(ith)); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#ab983e2f9b892b805b7c8c69a45737881">th_pz</a>(ith)); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(  brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#af84bd3dae5b9ef50288f1ce60dfea128">th_e</a>(ith));</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a51d252718fbe2c74369041a231f4a186">x</a>( brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#af339edf1b3bf77cb264d6fde04553a47">th_x</a>(ith) ); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a08c82f3d9df5f16ac663f2fd1457b07d">y</a>( brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a94534a38e04131ddb78ac9f57addd75a">th_y</a>(ith) ); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a73547d7fbba88c93bd3b20ff9ef02b4e">z</a>( brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a7a82e959cacb5cb8e3b54923743c043e">th_z</a>(ith) ); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>(brick.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a528f6b71387e4682aa286b8eefa4d769">th_t</a>(ith));</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>( thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>()*thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>() - thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() - thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() - thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() );</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>( (thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>() &gt;= 0.) ? sqrt(thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()) : sqrt(-thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()) );</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a4b25b468609274f46868ee9eddc21160">pos_str</a>(1);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                HH_thermal.add(thparton); <span class="comment">//adding this parton to thermal collection</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;          }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;          <span class="comment">//read in thermal partons, THEN do sibling setup...</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_thermal.num();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].sibling(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].string_id(-<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used(<span class="keyword">true</span>); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].sibling( findthermalsibling(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>, HH_thermal) ); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;          }</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(runsampler &amp;&amp; inhydro){</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    HH_thermal.clear(); <span class="comment">//emptying the thermal partons if we&#39;re resampling</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                std::vector&lt;SurfaceCellInfo&gt; surface_cells;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    GetHydroHyperSurface(hydro_Tc, surface_cells);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">/*std::cout &lt;&lt; &quot;\n\n     Surface Cells\n&quot;;</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">    for(int icel=0; icel&lt;surface_cells.size(); ++icel){</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">        if(icel % int(surface_cells.size()/100) != 0){continue;}</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">        std::cout &lt;&lt; surface_cells[icel].tau &lt;&lt; &quot;:&quot; &lt;&lt; surface_cells[icel].eta &lt;&lt; &quot;:&quot; &lt;&lt; surface_cells[icel].x &lt;&lt; &quot;:&quot; &lt;&lt; surface_cells[icel].y &lt;&lt; &quot;,   &quot;;</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">        std::cout &lt;&lt; surface_cells[icel].vx &lt;&lt; &quot;:&quot; &lt;&lt; surface_cells[icel].vy &lt;&lt; &quot;:&quot; &lt;&lt; surface_cells[icel].vz &lt;&lt; &quot;,   &quot;;</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">        std::cout &lt;&lt; surface_cells[icel].qgp_fraction &lt;&lt; &quot;:&quot; &lt;&lt; surface_cells[icel].temperature &lt;&lt; &quot;:&quot; &lt;&lt; surface_cells[icel].pressure &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">    std::cout &lt;&lt; &quot;\n\n&quot;;*/</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                <span class="comment">//not happy about having to do this, this way, but it is what it is.</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                std::vector&lt;std::vector&lt;double&gt;&gt; <a class="code" href="../../d0/d63/namespacewriteMapConfig.html#af15bdc7bf9a3c2302b83fe06c484381d">surface</a>;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icel=0; icel&lt;surface_cells.size(); ++icel){</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                        std::vector&lt;double&gt; cell;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                        cell.push_back(surface_cells[icel].<a class="code" href="../../de/de0/matchedfilter_8C.html#a601aabebe469b5de4fc41fbd0dc87166">tau</a>); cell.push_back(surface_cells[icel].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>); cell.push_back(surface_cells[icel].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>); cell.push_back(surface_cells[icel].<a class="code" href="../../db/d04/EMCalTowerRingStudy_8C.html#aa66df887c67e0d1025831e9998ea2415">eta</a>);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                        cell.push_back(surface_cells[icel].d3sigma_mu[0]); cell.push_back(surface_cells[icel].d3sigma_mu[1]);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                        cell.push_back(surface_cells[icel].d3sigma_mu[2]); cell.push_back(surface_cells[icel].d3sigma_mu[3]);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                        cell.push_back(surface_cells[icel].temperature);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                        cell.push_back(surface_cells[icel].<a class="code" href="../../db/d04/EMCalTowerRingStudy_8C.html#acc5551145483c34dbce97a78fec79e5c">vx</a>); cell.push_back(surface_cells[icel].<a class="code" href="../../db/d04/EMCalTowerRingStudy_8C.html#ae1f2083eee12edee824f706c8b84deee">vy</a>); cell.push_back(surface_cells[icel].<a class="code" href="../../db/d04/EMCalTowerRingStudy_8C.html#af8e260f66a609961516fba3ee9cebbcf">vz</a>);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                        surface.push_back(cell);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                }</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                <a class="code" href="../../d7/d0a/classThermalPartonSampler.html">ThermalPartonSampler</a> part_samp(rand_seed); <span class="comment">//initializing sampler with random seed</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#aebb01c29a650a803a8bb3c03c35119fa">set_hypersurface</a>(surface);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">if</span>(boost_invariant){</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a6d7ceab9f94cdedd2d5041dd89462e62">sample_2p1d</a>(eta_max_boost_inv);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a9eb0349bd58a7113efaf9f1f76d40fa3">sample_3p1d</a>(Cartesian_hydro);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#ad8c4c11cb01f911840136b6880a172d7">JSINFO</a> &lt;&lt; <span class="stringliteral">&quot;Hydro was sampled, generating &quot;</span> &lt;&lt; part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#ad1a198314988b324620ce9abc8784f96">nTot</a>() &lt;&lt; <span class="stringliteral">&quot; partons (&quot;</span> &lt;&lt; part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a4b6c3e61162ea6ea3baf997e1c5b4c7d">th_nL</a>() &lt;&lt; <span class="stringliteral">&quot; light, &quot;</span> &lt;&lt; part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#aa90253118f5e0cb2f7bd0393f77fffa4">th_nS</a>() &lt;&lt; <span class="stringliteral">&quot; strange).&quot;</span>;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ith=0; ith&lt;part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#ad1a198314988b324620ce9abc8784f96">nTot</a>(); ++ith){</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> thparton;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                        thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#af3f776ba437bcde57670e1ae0621d81f">is_thermal</a>(<span class="keyword">true</span>); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#acf116004f80d143dfd8937c7fa4677f9">th_pid</a>(ith)); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(1); <span class="comment">//sh_parton.string_id(str)</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                        thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a322c96b09141960837a1d578c0481f4d">th_px</a>(ith)); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a70f394d98d0771d0f37521d073ae1d40">th_py</a>(ith)); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#ab983e2f9b892b805b7c8c69a45737881">th_pz</a>(ith)); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(  part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#af84bd3dae5b9ef50288f1ce60dfea128">th_e</a>(ith));</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                        thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a51d252718fbe2c74369041a231f4a186">x</a>( part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#af339edf1b3bf77cb264d6fde04553a47">th_x</a>(ith) ); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a08c82f3d9df5f16ac663f2fd1457b07d">y</a>( part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a94534a38e04131ddb78ac9f57addd75a">th_y</a>(ith) ); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a73547d7fbba88c93bd3b20ff9ef02b4e">z</a>( part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a7a82e959cacb5cb8e3b54923743c043e">th_z</a>(ith) ); thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>(part_samp.<a class="code" href="../../d7/d0a/classThermalPartonSampler.html#a528f6b71387e4682aa286b8eefa4d769">th_t</a>(ith));</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                        thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>( thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>()*thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>() - thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() - thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() - thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() );</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                        thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>( (thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>() &gt;= 0.) ? sqrt(thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()) : sqrt(-thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()) );</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                        thparton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a4b25b468609274f46868ee9eddc21160">pos_str</a>(1);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                        HH_thermal.add(thparton); <span class="comment">//adding this parton to thermal collection</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                <span class="comment">//read in thermal partons, THEN do sibling setup...</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_thermal.num();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                        HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].sibling(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].string_id(-<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                        HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used(<span class="keyword">true</span>); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].sibling( findthermalsibling(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>, HH_thermal) ); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <span class="keywordflow">if</span>(!inbrick &amp;&amp; !inhydro){ <span class="comment">//propagate positive and negative partons for time part_prop in vacuum</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i_sh=0; i_sh&lt;HH_shower.num(); ++i_sh){</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="keywordtype">double</span> max_t_dif = part_prop;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                        <span class="keywordtype">double</span> vel[3]; vel[0]=HH_shower[i_sh].px()/HH_shower[i_sh].e(); vel[1]=HH_shower[i_sh].py()/HH_shower[i_sh].e(); vel[2]=HH_shower[i_sh].pz()/HH_shower[i_sh].e();</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                        HH_shower[i_sh].x(HH_shower[i_sh].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>() + vel[0]*max_t_dif); HH_shower[i_sh].y(HH_shower[i_sh].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>() + vel[1]*max_t_dif); HH_shower[i_sh].z(HH_shower[i_sh].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>() + vel[2]*max_t_dif);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                        HH_shower[i_sh].x_t(HH_shower[i_sh].x_t() + max_t_dif);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i_sh=0; i_sh&lt;neg_ptns.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++i_sh){</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="keywordtype">double</span> max_t_dif = part_prop;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                        <span class="keywordtype">double</span> vel[3]; vel[0]=neg_ptns[i_sh].px()/neg_ptns[i_sh].e(); vel[1]=neg_ptns[i_sh].py()/neg_ptns[i_sh].e(); vel[2]=neg_ptns[i_sh].pz()/neg_ptns[i_sh].e();</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                        neg_ptns[i_sh].x(neg_ptns[i_sh].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>() + vel[0]*max_t_dif); neg_ptns[i_sh].y(neg_ptns[i_sh].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>() + vel[1]*max_t_dif); neg_ptns[i_sh].z(neg_ptns[i_sh].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>() + vel[2]*max_t_dif);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                        neg_ptns[i_sh].x_t(neg_ptns[i_sh].x_t() + max_t_dif);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="comment">//checking to see if partons are inside medium, and if so then propagate all partons to hypersurface!</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="comment">//also can propagate by part_prop time</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i_sh=0; i_sh&lt;HH_shower.num(); ++i_sh){</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                <span class="keywordtype">double</span> vel[3]; vel[0]=HH_shower[i_sh].px()/HH_shower[i_sh].e(); vel[1]=HH_shower[i_sh].py()/HH_shower[i_sh].e(); vel[2]=HH_shower[i_sh].pz()/HH_shower[i_sh].e();</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                <span class="keywordtype">double</span> t_dif = 0.;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">if</span>(inbrick &amp;&amp; HH_shower[i_sh].x_t() &lt; brickL){</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      t_dif = brickL - HH_shower[i_sh].x_t();</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(inhydro){</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="keywordtype">double</span> temp=999999.;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="keywordflow">while</span>(temp &gt; hydro_Tc){</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                          <span class="keywordtype">double</span> tnow = HH_shower[i_sh].x_t() + delta_t*<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(i);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                          <span class="keywordtype">double</span> xnow = HH_shower[i_sh].x() + vel[0]*delta_t*<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(i);</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                          <span class="keywordtype">double</span> ynow = HH_shower[i_sh].y() + vel[1]*delta_t*<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(i);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                          <span class="keywordtype">double</span> znow = HH_shower[i_sh].z() + vel[2]*delta_t*<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(i);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                          GetHydroCellSignal(tnow, xnow, ynow, znow, check_fluid_info_ptr);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                          temp = check_fluid_info_ptr-&gt;<a class="code" href="../../df/de4/classJetscape_1_1FluidCellInfo.html#a2c5cfb30997bf6edbb82a991245477ed" title="Local temperature [GeV].">temperature</a>;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                          <span class="keywordflow">if</span>(temp &lt;= hydro_Tc){</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;          t_dif = delta_t*<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(i);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                          ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                  }</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                <span class="keywordtype">double</span> max_t_dif = std::max(t_dif,part_prop);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                HH_shower[i_sh].x(HH_shower[i_sh].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>() + vel[0]*max_t_dif); HH_shower[i_sh].y(HH_shower[i_sh].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>() + vel[1]*max_t_dif); HH_shower[i_sh].z(HH_shower[i_sh].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>() + vel[2]*max_t_dif);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                HH_shower[i_sh].x_t(HH_shower[i_sh].x_t() + max_t_dif);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                <span class="comment">//JSINFO&lt;&lt;&quot;Parton propagated to: &quot; &lt;&lt; HH_shower[i_sh].x() &lt;&lt; &quot;, &quot; &lt;&lt; HH_shower[i_sh].y() &lt;&lt; &quot;, &quot; &lt;&lt; HH_shower[i_sh].z() &lt;&lt; &quot;, &quot; &lt;&lt; HH_shower[i_sh].x_t();</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="comment">//do the same for the negative partons</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i_sh=0; i_sh&lt;neg_ptns.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++i_sh){</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                <span class="keywordtype">double</span> vel[3]; vel[0]=neg_ptns[i_sh].px()/neg_ptns[i_sh].e(); vel[1]=neg_ptns[i_sh].py()/neg_ptns[i_sh].e(); vel[2]=neg_ptns[i_sh].pz()/neg_ptns[i_sh].e();</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                <span class="keywordtype">double</span> t_dif = 0.;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">if</span>(inbrick &amp;&amp; neg_ptns[i_sh].x_t() &lt; brickL){</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      t_dif = brickL - neg_ptns[i_sh].x_t();</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(inhydro){</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="keywordtype">double</span> temp=999999.;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="keywordflow">while</span>(temp &gt; hydro_Tc){</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                          <span class="keywordtype">double</span> tnow = neg_ptns[i_sh].x_t() + delta_t*<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(i);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                          <span class="keywordtype">double</span> xnow = neg_ptns[i_sh].x() + vel[0]*delta_t*<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(i);</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                          <span class="keywordtype">double</span> ynow = neg_ptns[i_sh].y() + vel[1]*delta_t*<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(i);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                          <span class="keywordtype">double</span> znow = neg_ptns[i_sh].z() + vel[2]*delta_t*<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(i);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                          GetHydroCellSignal(tnow, xnow, ynow, znow, check_fluid_info_ptr);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                          temp = check_fluid_info_ptr-&gt;<a class="code" href="../../df/de4/classJetscape_1_1FluidCellInfo.html#a2c5cfb30997bf6edbb82a991245477ed" title="Local temperature [GeV].">temperature</a>;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                          <span class="keywordflow">if</span>(temp &lt;= hydro_Tc){</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;          t_dif = delta_t*<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(i);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                          ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                  }</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                <span class="keywordtype">double</span> max_t_dif = std::max(t_dif,part_prop);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                neg_ptns[i_sh].x(neg_ptns[i_sh].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>() + vel[0]*max_t_dif); neg_ptns[i_sh].y(neg_ptns[i_sh].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>() + vel[1]*max_t_dif); neg_ptns[i_sh].z(neg_ptns[i_sh].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>() + vel[2]*max_t_dif);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                neg_ptns[i_sh].x_t(neg_ptns[i_sh].x_t() + max_t_dif);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                <span class="comment">//JSINFO&lt;&lt;&quot;Parton propagated to: &quot; &lt;&lt; neg_ptns[i_sh].x() &lt;&lt; &quot;, &quot; &lt;&lt; neg_ptns[i_sh].y() &lt;&lt; &quot;, &quot; &lt;&lt; neg_ptns[i_sh].z() &lt;&lt; &quot;, &quot; &lt;&lt; neg_ptns[i_sh].x_t();</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="comment">/*for(int i=0; i&lt;HH_thermal.num(); i++){</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">    std::cout &lt;&lt; HH_thermal[i].id() &lt;&lt; &quot;,&quot; &lt;&lt; HH_thermal[i].x_t() &lt;&lt; &quot;,&quot; &lt;&lt; HH_thermal[i].x()</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment">    &lt;&lt; &quot;,&quot; &lt;&lt; HH_thermal[i].y() &lt;&lt; &quot;,&quot; &lt;&lt; HH_thermal[i].z() &lt;&lt; &quot;,&quot; &lt;&lt; HH_thermal[i].e()</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">    &lt;&lt; &quot;,&quot; &lt;&lt; HH_thermal[i].px() &lt;&lt; &quot;,&quot; &lt;&lt; HH_thermal[i].py() &lt;&lt; &quot;,&quot; &lt;&lt; HH_thermal[i].pz()</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">    &lt;&lt; &quot;,&quot; &lt;&lt; HH_thermal[i].mass() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="comment">//separately running over positive and negative partons</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> pos_ptn = 1; pos_ptn&gt;=0; --pos_ptn){</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordtype">double</span> tmp_threco = th_recofactor; <span class="comment">//need to keep track of th_recofactor (strength) to disable it for negative partons</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordtype">double</span> tmp_maxB_level = maxB_level; <span class="comment">//need to keep track of maxB_level to disable baryon recombination for negative partons</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordtype">int</span> tmp_reco_hadrons_pythia = reco_hadrons_pythia;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">if</span>(pos_ptn == 0){<span class="comment">//handling negative partons by wiping shower partons &amp; hadrons, then rerunning with negative partons</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            pythia.event.reset(); HH_shower.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>(); HH_shower = neg_ptns; <span class="comment">//hadrons, remnants, pyremn cleared below</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <span class="comment">// if the fragmentation hadrons are given to the afterburner module</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      <span class="comment">// let the negative partons decay here, as they are not propagated in the</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="comment">// afterburner</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="keywordflow">if</span>(afterburner_frag_hadrons){</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        reco_hadrons_pythia = 1;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        pythia.readString(<span class="stringliteral">&quot;HadronLevel:Decay = on&quot;</span>);</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        pythia.init();</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      }</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="comment">//add holes left by used thermal partons to HH_shower</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_thermal.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <span class="keywordflow">if</span>(HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used()) {</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;          HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;          HH_shower.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="comment">//add Extrapartons from recomb() of hadrons to HH_shower of negative partons</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_recomb_extrapartons.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        HH_shower.add(HH_recomb_extrapartons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      }</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="keywordflow">if</span>(HH_shower.num() != 0){</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        th_recofactor = 0.;<span class="comment">//killing thermal + negative parton recombination.</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        maxB_level = -1;<span class="comment">//disable baryon recombination for negative partons</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      } <span class="comment">//do this only if there are negative partons, otherwise the baryon recombination would be switched off after the first event without negative partons</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    }</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">if</span>(HH_shower.num() == 0){</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    } <span class="comment">//attempting to handle events/configurations with 0 partons will result in a crash</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordtype">int</span> attempt_num = 0; <span class="keywordtype">bool</span> run_successfully = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">while</span>((attempt_num &lt; attempts_max) &amp;&amp; (!run_successfully)){</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            HH_showerptns = HH_shower;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            <span class="comment">//clearing hadrons and remnants collections</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            HH_hadrons.clear(); HH_remnants.clear(); HH_pyremn.clear(); HH_pythia_hadrons.clear(); HH_recomb_extrapartons.clear();</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            <span class="comment">//since we &#39;might&#39; need to reset the thermal partons (if present!)... because we alter the thermal parton collection in the string repair routine</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_thermal.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                    HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used(<span class="keyword">false</span>); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_decayedglu(<span class="keyword">false</span>); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_remnant(<span class="keyword">false</span>); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].used_reco(<span class="keyword">false</span>); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].used_str(<span class="keyword">false</span>); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_thermal(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                    HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].orig(1); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].par(-1); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].status(0); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].col(0); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol(0); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_fakeparton(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                    HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_par1(-1); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_par2(-1); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau1(-1); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau2(-1); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_stat(23);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                    HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].string_id(-<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_strendpt(<span class="keyword">false</span>); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pos_str(1); HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].endpt_id(0);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="keywordflow">if</span>(pos_ptn == 0) {</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;          HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used(<span class="keyword">true</span>); <span class="comment">//set all the thermal partons to is used for negative partons, such that they are not used in the findthermalsibling routine</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        }</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            }</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            <span class="comment">//checking the shower for any color singlet particles to just dump into PYTHIA</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            <span class="comment">//also handling colored non-partonic particles</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            <span class="keywordtype">int</span> i_show=0;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <span class="keywordflow">while</span>(i_show&lt;HH_showerptns.num()){</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                    <span class="keywordflow">if</span>(HH_showerptns[i_show].<span class="keywordtype">id</span>() == 21){++i_show; <span class="keywordflow">continue</span>;} <span class="comment">//is gluon</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_showerptns[i_show].<span class="keywordtype">id</span>()) &lt;= 6){++i_show; <span class="keywordflow">continue</span>;} <span class="comment">//is quark</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((std::abs(HH_showerptns[i_show].<span class="keywordtype">id</span>()) &gt;= 1103) &amp;&amp; (std::abs(HH_showerptns[i_show].<span class="keywordtype">id</span>()) &lt;= 5503) &amp;&amp; ((HH_showerptns[i_show].<span class="keywordtype">id</span>()/10)%10 == 0)){++i_show; <span class="keywordflow">continue</span>;} <span class="comment">//is diquark</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pythia.particleData.colType(HH_showerptns[i_show].id()) == 2){<span class="comment">//this is a non-gluon color octet...</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                            HH_showerptns[i_show].PY_origid(HH_showerptns[i_show].<span class="keywordtype">id</span>()); HH_showerptns[i_show].id(21); ++i_show; <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                    }<span class="comment">//this is a non-(simple)quark color triplet... (pid 42(scalar leptoquark), 4000001(1-6, excited quarks), and SUSY particles)</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(pythia.particleData.colType(HH_showerptns[i_show].id())) == 1){</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                            HH_showerptns[i_show].PY_origid( HH_showerptns[i_show].<span class="keywordtype">id</span>() );</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                            HH_showerptns[i_show].id( 1*(2*std::signbit(-pythia.particleData.colType(HH_showerptns[i_show].id()))-1) ); ++i_show; <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                    } <span class="comment">//and the two above should catch &#39;colored technihadrons&#39; too!</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(HH_showerptns[i_show].<span class="keywordtype">id</span>() == 90){HH_showerptns.remove(i_show); <span class="keywordflow">continue</span>;} <span class="comment">//PYTHIA specific pid for the &#39;system&#39; as a whole, shouldn&#39;t actually be here.  Dumping it.</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                    <span class="comment">//is none of the above (a colorless object of some sort (a hadron, photon, lepton...))</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                    <a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html">HHhadron</a> had; had.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a8673e70390fe194d7268ac18fa3373b2">id</a>( HH_showerptns[i_show].<span class="keywordtype">id</span>() ); had.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a81504dcc627c3e9290368567b1331d50">orig</a>( HH_showerptns[i_show].orig() ); had.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a048b35ba82d82b0c177b0968485bab3d">mass</a>( HH_showerptns[i_show].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>() );</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                    had.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a7ce336bb518c8fe59fe9bc044d9f0ca6">pos</a>(HH_showerptns[i_show].<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a182617618c30f1ba6a9c7540ae655340">pos</a>()); had.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a14ac05d5f4db7a690b834078050e695f">P</a>(HH_showerptns[i_show].<a class="code" href="../../d2/dc5/KFPTrackVector_8h.html#a39a53a622c6abde5e888e4ad46fb04af" title="Returns momentum of the track with index &quot;n&quot;.">P</a>());</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                    HH_hadrons.add(had); HH_showerptns.remove(i_show);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            <span class="comment">//setting up the strings appropriately for showers - assumes that color tags are set.</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <span class="comment">//if there are colored particles without set color tags, it will dump those partons in particular into a single string</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            <span class="keywordtype">int</span> num_strings = 0;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            stringform();</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            num_strings = HH_showerptns[HH_showerptns.num()-1].string_id();</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      <span class="comment">// last attempt in hadronization is done without recombination</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      <span class="keywordtype">double</span> sh_recofactor_store = sh_recofactor;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <span class="keywordflow">if</span>(attempt_num == attempts_max -1) {</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        sh_recofactor = 0.;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">if</span>(pos_ptn == 1) {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;          <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;Hadronization failed, try without recombination one more time&quot;</span>;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;          <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;Hadronization of negative partons failed, try without recombination one more time&quot;</span>;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        }</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      }</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <span class="comment">//running recombination</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            recomb();</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      sh_recofactor = sh_recofactor_store;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            <span class="comment">//function to prepare strings for input into PYTHIA8</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            <span class="comment">//will need a final reindexing for py_remn (all PY_par#, PY_dau# will need to be += 1) AFTER this function (either here, or in invoke_py)</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            <span class="comment">//when recursive &#39;workaround&#39; for large strings is properly handled/removed, then can put this reindexing inside the function</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            <span class="keywordflow">if</span>(HH_remnants.num()){</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="keywordtype">bool</span> cut = (attempt_num &gt; -1) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        stringprep(HH_remnants, HH_pyremn, cut);</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="comment">//temporary workaround to force all formed hadrons to be final state - so pythia won&#39;t overwrite spacetime info</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_hadrons.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_final(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      <span class="comment">//if negative fakepartons, we set the momenta and energy to zero before giving them to pythia</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      <span class="keywordflow">if</span> (pos_ptn == 0) {</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipart = 0; ipart &lt; HH_pyremn.num(); ipart++) {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;          <span class="keywordflow">if</span>(HH_pyremn[ipart].is_fakeparton()) {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            <span class="keywordflow">if</span>(HH_pyremn[ipart].<span class="keywordtype">id</span>() == 21 &amp;&amp; HH_pyremn[ipart].mass() &gt; (2.*pythia.particleData.m0(211) + 0.01)) {</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;              HH_pyremn[ipart].mass(2.*pythia.particleData.m0(211) + 0.01);</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;            }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            HH_pyremn[ipart].e(HH_pyremn[ipart].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>());</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            HH_pyremn[ipart].px(0.);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            HH_pyremn[ipart].py(0.);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            HH_pyremn[ipart].pz(0.);</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;          }</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        }</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      }</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            <span class="comment">//running remaining partons through PYTHIA8 string fragmentation</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            run_successfully = invoke_py();</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            <span class="comment">//for a successful run, go though final hadrons here and set parton parents up</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      <span class="comment">//bring the hadrons to their corresponding pythia mass shell</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <span class="keywordflow">if</span>(run_successfully){</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="comment">//remove all hadrons from HH_hadrons if reco hadrons are put into pythia</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="comment">//in this case they are already contained in HH_pythia_hadrons</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="keywordflow">if</span>(reco_hadrons_pythia) {</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;          HH_hadrons.clear();</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        }</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="comment">//add all fragmentation hadrons from pythia to HH_hadrons, now that pythia hadronization was successfull</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iHad = 0; iHad &lt; HH_pythia_hadrons.num(); iHad++) {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;          HH_hadrons.add(HH_pythia_hadrons[iHad]);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        }</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        bring_hadrons_to_mass_shell(HH_hadrons);</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <span class="comment">//hadron propagation (neglect the photons)</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iHad=0; iHad&lt;HH_hadrons.num(); ++iHad){</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                          <span class="keywordflow">if</span>(std::abs(had_prop) &gt; 0.0001 &amp;&amp; HH_hadrons[iHad].id() != 22){ <span class="comment">//assumes that hadron will be propagated by more than 0.0001 fm/c in lab frame - can even propagate backwards, if that&#39;s something wanted...</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                                  <span class="keywordtype">double</span> vel[3]; vel[0]=HH_hadrons[iHad].px()/HH_hadrons[iHad].e(); vel[1]=HH_hadrons[iHad].py()/HH_hadrons[iHad].e(); vel[2]=HH_hadrons[iHad].pz()/HH_hadrons[iHad].e();</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                                  <span class="keywordtype">double</span> t_prop = had_prop/sqrt(1. - vel[0]*vel[0] - vel[1]*vel[1] - vel[2]*vel[2]);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                                    HH_hadrons[iHad].x(HH_hadrons[iHad].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>() + vel[0]*t_prop); HH_hadrons[iHad].y(HH_hadrons[iHad].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>() + vel[1]*t_prop); HH_hadrons[iHad].z(HH_hadrons[iHad].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>() + vel[2]*t_prop);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                                    HH_hadrons[iHad].x_t(HH_hadrons[iHad].x_t() + had_prop);</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                                  <span class="comment">//JSINFO&lt;&lt;&quot;Hadron propagated to: &quot; &lt;&lt; HH_hadrons[iHad].x() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[iHad].y() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[iHad].z() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[iHad].x_t();</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                          }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                    }</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <span class="keywordtype">double</span> energy_check = 0.;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iHad = 0; iHad &lt; HH_hadrons.num(); iHad++){</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;          energy_check += HH_hadrons[iHad].e();</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        }</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="keywordflow">if</span>(pos_ptn == 1 &amp;&amp; (energy_check &lt; 0.99*total_shower_energy)){</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;          run_successfully = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            }</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      ++attempt_num;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    }</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordflow">if</span>(!run_successfully){</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      HH_hadrons.clear();</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      <span class="keywordflow">if</span>(pos_ptn == 1) {</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;This event could not be hadronized.&quot;</span>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;The negative partons of this event could not be hadronized.&quot;</span>;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      }</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    }</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="comment">// scale the negative hadron energies/momenta such that the energy is</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="comment">// conserved when subtracting negative hadrons from the positive ones</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keywordflow">if</span>(pos_ptn == 0){</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <span class="keywordflow">if</span>(HH_hadrons.num() &gt; 0){</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        scale_kinematics_negative_hadrons(HH_hadrons, total_shower_energy-total_shower_energy_neg, energy_hadrons);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      }</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iHad=0; iHad&lt;HH_hadrons.num(); ++iHad){</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            <span class="keywordflow">if</span>(HH_hadrons[iHad].is_final()){</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                    <span class="comment">//setting status flag =&gt; xy -&gt; x=1 reco, x=2 frag; y=1 sh-sh, y=2 sh-th; neg sign means negative hadron</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <span class="comment">//all colorless particles get fragmentation status labels</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                    <span class="keywordtype">int</span> stat = (HH_hadrons[iHad].is_recohad()) ? 810 : 820;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                  stat += (HH_hadrons[iHad].is_shth()) ? 2 : 1;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                  stat *= (pos_ptn == 0) ? -1 : 1 ;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                    <span class="keywordtype">int</span> lab = (pos_ptn == 0) ? -1 : 1 ;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                  <span class="keywordtype">int</span> idH = HH_hadrons[iHad].id(); <span class="keywordtype">double</span> mH = HH_hadrons[iHad].mass();</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                    <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> <a class="code" href="../../dc/d78/namespacemerge__hashes.html#a63313c3a4f2b0cb6f7cea830c9ff269d">p</a>(HH_hadrons[iHad].<a class="code" href="../../d2/dc5/KFPTrackVector_8h.html#a39a53a622c6abde5e888e4ad46fb04af" title="Returns momentum of the track with index &quot;n&quot;.">P</a>()); <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> <a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>(HH_hadrons[iHad].<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a182617618c30f1ba6a9c7540ae655340">pos</a>());</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                    hOut.push_back(std::make_shared&lt;Hadron&gt; (<a class="code" href="../../d9/d52/classJetscape_1_1Hadron.html">Hadron</a> (lab,idH,stat,p,x,mH)));</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="keywordflow">if</span>(pos_ptn == 1){ <span class="comment">// used for scaling of negative hadrons</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;          energy_hadrons += HH_hadrons[iHad].e();</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        }</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            }</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    }</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          th_recofactor = tmp_threco;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    maxB_level = tmp_maxB_level;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    reco_hadrons_pythia = tmp_reco_hadrons_pythia;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="keywordflow">if</span>(pythia_decays == <span class="stringliteral">&quot;off&quot;</span>){pythia.readString(<span class="stringliteral">&quot;HadronLevel:Decay = off&quot;</span>); pythia.init();}</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        }</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;}</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment">// scale the negative hadron energies/momenta such that the energy is</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment">// conserved when subtracting negative hadrons from the positive ones</span></div>
<div class="line"><a name="l00885"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a583b1f33ed51f64808b43f6faa26c08d">  885</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#a583b1f33ed51f64808b43f6faa26c08d">HybridHadronization::scale_kinematics_negative_hadrons</a>(<a class="code" href="../../de/d96/classHybridHadronization_1_1hadron__collection.html">hadron_collection</a>&amp; HH_hadrons, <span class="keywordtype">double</span> shower_energy, <span class="keywordtype">double</span> positive_hadrons_energy){</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordtype">double</span> negative_hadrons_energy_initial = 0;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; HH_hadrons.<a class="code" href="../../de/d96/classHybridHadronization_1_1hadron__collection.html#a999851873f2bb31cc5ed00dc32bc4e00">num</a>(); <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++){</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    negative_hadrons_energy_initial += HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e();</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="keywordtype">double</span> e_scaling_factor = (positive_hadrons_energy - shower_energy) / negative_hadrons_energy_initial;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="keywordflow">if</span>(e_scaling_factor &lt; 0.){</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#a3b34504875531f73908383180beab139">JSDEBUG</a> &lt;&lt; <span class="stringliteral">&quot;e_scaling_factor negative, hadron energy below parton energy: &quot;</span> &lt;&lt; positive_hadrons_energy - shower_energy &lt;&lt; <span class="stringliteral">&quot;GeV&quot;</span>;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  }</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; HH_hadrons.<a class="code" href="../../de/d96/classHybridHadronization_1_1hadron__collection.html#a999851873f2bb31cc5ed00dc32bc4e00">num</a>(); <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++){</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordtype">double</span> new_energy = HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e() * e_scaling_factor;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordflow">if</span>(new_energy &gt; HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()){</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e(new_energy);</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <span class="keywordtype">double</span> new_abs_momentum = std::sqrt(new_energy*new_energy - HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>());</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <span class="keywordtype">double</span> p_scaling_factor = new_abs_momentum / std::sqrt(HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px()+HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py()+HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz());</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px(HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px() * p_scaling_factor);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py(HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py() * p_scaling_factor);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz(HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz() * p_scaling_factor);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e(HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>());</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px(0.0);</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py(0.0);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz(0.0);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    }</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  }</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;}</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div>
<div class="line"><a name="l00915"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a5bb816f70dc51ffd12832baa8354b30e">  915</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#a5bb816f70dc51ffd12832baa8354b30e">HybridHadronization::convert_color_tags_to_int_type</a>(vector&lt;vector&lt;<a class="code" href="../../d4/d67/classshared__ptr.html">shared_ptr&lt;Parton&gt;</a>&gt;&gt;&amp; <a class="code" href="../../d3/d9d/classshower.html">shower</a>){</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="comment">//check which partons have anti-/color tags larger than the int limit</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  std::vector&lt;unsigned int&gt; used_tags;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="comment">//reduce the upper limit -&gt; the maxtag could fail otherwise, if it becomes larger than maximum int</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keywordtype">int</span> max_allowed_tag = std::numeric_limits&lt;int&gt;::max() - 1e6;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ishower = 0; ishower &lt; <a class="code" href="../../d3/d9d/classshower.html">shower</a>.size(); ishower++) {</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ipart = 0; ipart &lt; <a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).size(); ipart++) {</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      used_tags.push_back(<a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;color());</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      used_tags.push_back(<a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;anti_color());</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="comment">//remove consecutive duplicates in the sorted vector</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <a class="code" href="../../d2/da5/namespaceActs_1_1Experimental_1_1detail_1_1BlueprintHelper.html#a308a6456db2655fc6a1a916696da20c8" title="Sort the nodes in the blueprint container node.">std::sort</a>(used_tags.begin(), used_tags.end());</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  used_tags.resize(<a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(used_tags.begin(), std::unique(used_tags.begin(), used_tags.end())));</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="comment">//count the number of needed tags</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  std::vector&lt;unsigned int&gt; needed_tags_values;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="keywordtype">int</span> number_needed_tags = 0;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tag : used_tags) {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordflow">if</span> (tag &gt; max_allowed_tag) {</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      needed_tags_values.push_back(tag);</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      number_needed_tags++;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    }</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="comment">//find the first free tag that is not yet used</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="keywordtype">int</span> lower_limit_tag = 100;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  std::vector&lt;int&gt; new_tags;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="keywordflow">while</span> (new_tags.size() &lt; number_needed_tags) {</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      <span class="keywordflow">if</span> (std::find(used_tags.begin(), used_tags.end(), lower_limit_tag) == used_tags.end()) {</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;          new_tags.push_back(lower_limit_tag);</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      }</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      lower_limit_tag++;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  }</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="comment">//exchange the tags which are too large by the new ones</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> tag = 0; tag &lt; number_needed_tags; tag++) {</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ishower = 0; ishower &lt; <a class="code" href="../../d3/d9d/classshower.html">shower</a>.size(); ishower++) {</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ipart = 0; ipart &lt; <a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).size(); ipart++) {</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> current_tag = needed_tags_values.at(tag);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;color() == current_tag) {</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;          <a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;set_color(new_tags.at(tag));</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        }</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;anti_color() == current_tag) {</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;          <a class="code" href="../../d3/d9d/classshower.html">shower</a>.at(ishower).at(ipart)-&gt;set_anti_color(new_tags.at(tag));</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        }</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      }</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    }</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;}</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment">//was used in the pygen code to create ordered strings (and assigned string ids) from color tags</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment">//currently has junction functionality commented out until I know how to incorporate it within JETSCAPE</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">//junction functionality WILL be needed in the event that any given string configurations contain them!</span></div>
<div class="line"><a name="l00969"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a34c47863a23a1c1f16ed785950af7117">  969</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#a34c47863a23a1c1f16ed785950af7117">HybridHadronization::stringform</a>(){</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <span class="keywordtype">int</span> nstr=1;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_showerptns.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].string_id() != 0){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                std::vector&lt;int&gt; colors;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>()  &gt; 0){colors.push_back(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>()) ;}</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol() &gt; 0){colors.push_back(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol());}</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].string_id(nstr); ++nstr;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                <span class="keywordtype">bool</span> newcolor = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                <span class="keywordflow">while</span>(newcolor){</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                        newcolor = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                        <span class="comment">//checking all final particles not in a string for new color id matches...</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                        <span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>=0; <span class="keywordflow">while</span>(j&lt;HH_showerptns.num()){</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                                <span class="keywordflow">if</span>(HH_showerptns[j].string_id() != 0){++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>; <span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>=0;<a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>&lt;colors.size();++<a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>){</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                                        <span class="keywordflow">if</span>(     colors[<a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>]==HH_showerptns[j].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>()  &amp;&amp; (HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].acol()&gt;0)){</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                                                colors.push_back(HH_showerptns[j].acol()); newcolor=<span class="keyword">true</span>; HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].string_id(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].string_id()); j=-1; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                                        }</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(colors[<a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>]==HH_showerptns[j].acol() &amp;&amp; (HH_showerptns[j].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt;0)){</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                                                colors.push_back(HH_showerptns[j].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>()) ; newcolor=<span class="keyword">true</span>; HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].string_id(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].string_id()); j=-1; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                                        }</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(colors[<a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>]==HH_showerptns[j].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() || colors[<a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>]==HH_showerptns[j].acol()){HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].string_id(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].string_id()); <span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                                }</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                                ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                        }</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                        <span class="comment">/* //this code WILL be needed in the event that any input string configurations contain junctions!</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment">                        //checking all the junctions in the event to see if there are any new color id matches...</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment">                        for(int iJun=0;iJun&lt;pythia.event.sizeJunction();++iJun){</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">                                bool thisjuncolors = false;</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment">                                for(int j=0;j&lt;3;++j){for(int k=0;k&lt;colors.size();++k){if(colors[k]==pythia.event.colJunction(iJun, j)){thisjuncolors=true;}}}</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment">                                if(!thisjuncolors){continue;}</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment">                                for(int j=0;j&lt;3;++j){</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment">                                        bool addcolor = true;</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment">                                        for(int k=0;k&lt;colors.size();++k){if(colors[k]==pythia.event.colJunction(iJun,j)){addcolor = false; break;}}</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">                                        if(addcolor){colors.push_back(pythia.event.colJunction(iJun,j)); newcolor=true;}</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment">                                }</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment">                        }</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">                        */</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        }</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="comment">//now, finding all partons in string &#39;i&#39;(out of nstr-1 total strings) and reordering them</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <span class="comment">//for &quot;string&quot; i=0 final partons - these are noncolored particles that should just be written out as-is (shouldn&#39;t actually be present...)</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=1;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;nstr;++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                std::vector&lt;bool&gt; is_used; std::vector&lt;int&gt; ptns_new;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                std::vector&lt;int&gt; ptns_strnow;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>&lt;HH_showerptns.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>){<span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].string_id()==<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){ptns_strnow.push_back(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>); is_used.push_back(<span class="keyword">false</span>);}}</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                <span class="comment">//std::vector&lt;int&gt; usedJuns; for(int j=0; j&lt;NumJunctions; ++j){usedJuns.push_back(false);} int numJunsused = 0;</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                <span class="comment">//find &#39;a&#39; quark in the event, if there are none, just grab a gluon.</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                std::vector&lt;int&gt; stack;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                <span class="keywordtype">bool</span> readcolor=<span class="keyword">true</span>; <span class="keywordtype">int</span> firstcol = 0;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>&lt;ptns_strnow.size();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>){</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                        <span class="keywordflow">if</span>(!(HH_showerptns[ptns_strnow[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]].<span class="keywordtype">id</span>() == 21)){</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                                <span class="keywordflow">if</span>((HH_showerptns[ptns_strnow[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]].<span class="keywordtype">id</span>() &gt; 0 &amp;&amp; HH_showerptns[ptns_strnow[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]].<span class="keywordtype">id</span>() &lt;= 6) || (HH_showerptns[ptns_strnow[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]].id() &lt; -6)){</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                                        stack.push_back(ptns_strnow[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]); is_used[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]=<span class="keyword">true</span>; firstcol=HH_showerptns[stack[0]].acol(); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                                }</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                                <span class="keywordflow">else</span>{stack.push_back(ptns_strnow[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]); is_used[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]=<span class="keyword">true</span>; firstcol=HH_showerptns[stack[0]].col(); readcolor=<span class="keyword">false</span>; <span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                        }</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                        <span class="comment">//gluon loop catch</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>==ptns_strnow.size()-1){stack.push_back(ptns_strnow[0]); is_used[0]=<span class="keyword">true</span>; firstcol=HH_showerptns[stack[0]].acol();}</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                }</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                ptns_new.push_back(stack[0]);</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                <span class="keywordflow">while</span>(stack.size()&gt;0){</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                        <span class="comment">//catching the end of either a string/junction leg or we&#39;ve circled back on a gluon loop.</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                        <span class="keywordflow">if</span>(      readcolor &amp;&amp; (HH_showerptns[stack.back()].col()  == firstcol)){stack.pop_back(); <span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!readcolor &amp;&amp; (HH_showerptns[stack.back()].acol() == firstcol)){stack.pop_back(); <span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                        <span class="comment">//keeping track if we&#39;ve added (a) new parton(s) to the stack</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                        <span class="keywordtype">bool</span> found=<span class="keyword">false</span>;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>&lt;ptns_strnow.size();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>){</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                                <span class="keywordflow">if</span>(      readcolor &amp;&amp; !is_used[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>] &amp;&amp; (HH_showerptns[stack.back()].col()  == HH_showerptns[ptns_strnow[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]].acol())){</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                                        stack[stack.size()-1] = ptns_strnow[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]; is_used[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]=<span class="keyword">true</span>; ptns_new.push_back(stack.back()); <span class="comment">//--stack.size(); ++stack.size();</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                                        found=<span class="keyword">true</span>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                                }</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!readcolor &amp;&amp; !is_used[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>] &amp;&amp; (HH_showerptns[stack.back()].acol() == HH_showerptns[ptns_strnow[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]].col() )){</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                                        stack[stack.size()-1] = ptns_strnow[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]; is_used[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]=<span class="keyword">true</span>; ptns_new.push_back(stack.back()); <span class="comment">//--stack.size(); ++stack.size();</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                                        found=<span class="keyword">true</span>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                                }</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                        }</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                        <span class="comment">//this code WILL be needed in the event that any input string configurations contain junctions!</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      <span class="comment">/*if(!found &amp;&amp; ((pythia.event.sizeJunction() - numJunsused) &gt; 0)){</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">                                int iJun(0), iCol(0);</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">                                if(readcolor){</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">                                        for(int iJ=0;iJ&lt;pythia.event.sizeJunction();++iJ){</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment">                                                if(usedJuns[iJ]){continue;}</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">                                                for(int iC=0;iC&lt;3;++iC){if(pythia.event.colJunction(iJ,iC)==HH_showerptns[stack.back()].col() ){iJun=iJ;iCol=iC;found=true;break;}}if(found){break;}</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">                                        }</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">                                }</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment">                                else{</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">                                        for(int iJ=0;iJ&lt;pythia.event.sizeJunction();++iJ){</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment">                                                if(usedJuns[iJ]){continue;}</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">                                                for(int iC=0;iC&lt;3;++iC){if(pythia.event.colJunction(iJ,iC)==HH_showerptns[stack.back()].acol()){iJun=iJ;iCol=iC;found=true;break;}}if(found){break;}</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">                                        }</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">                                }</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">                                //find the next two partons here to add to the stack</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">                                if(found){</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">                                        usedJuns[iJun] = true; ++numJunsused;</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">                                        readcolor = !readcolor;</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment">                                        int cols[2]={0,0};</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">                                        int offset=0; for(int j=0;j&lt;3;++j){if(j==iCol){offset=1;continue;} cols[j-offset]=pythia.event.colJunction(iJun,j);}</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">                                        if(cols[0]&gt;cols[1]){int temp=cols[0]; cols[0]=cols[1]; cols[1]=temp;}</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">                                        if(readcolor){</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">                                                for(int j=0;j&lt;ptns_strnow.size();++j){if(!is_used[j] &amp;&amp; (cols[0]==HH_showerptns[ptns_strnow[j]].acol())){</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">                                                        stack[stack.size()-1] = ptns_strnow[j]; is_used[j]=true; ptns_new.push_back(stack.back()); //--stack.size(); ++stack.size();</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">                                                        break;</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment">                                                }}</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment">                                                for(int j=0;j&lt;ptns_strnow.size();++j){if(!is_used[j] &amp;&amp; (cols[1]==HH_showerptns[ptns_strnow[j]].acol())){</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment">                                                        stack.push_back(ptns_strnow[j]); is_used[j]=true; ptns_new.push_back(stack.back()); //--stack.size(); ++stack.size();</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment">                                                        break;</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment">                                                }}</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">                                        }</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">                                        else{</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">                                                for(int j=0;j&lt;ptns_strnow.size();++j){if(!is_used[j] &amp;&amp; (cols[0]==HH_showerptns[ptns_strnow[j]].col())){</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment">                                                        stack[stack.size()-1] = ptns_strnow[j]; is_used[j]=true; ptns_new.push_back(stack.back()); //--stack.size(); ++stack.size();</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment">                                                        break;</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment">                                                }}</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="comment">                                                for(int j=0;j&lt;ptns_strnow.size();++j){if(!is_used[j] &amp;&amp; (cols[1]==HH_showerptns[ptns_strnow[j]].col())){</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="comment">                                                        stack.push_back(ptns_strnow[j]); is_used[j]=true; ptns_new.push_back(stack.back()); //--stack.size(); ++stack.size();</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="comment">                                                        break;</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment">                                                }}</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="comment">                                        }</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment">                                }</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment">                        }*/</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                        <span class="keywordflow">if</span>(!found){stack.pop_back();}</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                }</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                <span class="comment">//ordering this string</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;                <span class="keywordtype">int</span> endpt = 0;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>&lt;ptns_new.size();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>){</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                        HH_showerptns[ptns_new[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]].pos_str(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>);</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;                        HH_showerptns[ptns_new[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]].endpt_id( (HH_showerptns[ptns_new[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]].<span class="keywordtype">id</span>() == 21) ? 0 : ++endpt );</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                        HH_showerptns[ptns_new[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]].is_strendpt( (HH_showerptns[ptns_new[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]].<span class="keywordtype">id</span>() == 21) ? <span class="keyword">false</span> : <span class="keyword">true</span> );</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                }</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        }</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        <span class="comment">//handling any remaining colored objects that have not had color tags set</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        <span class="comment">//these are all just thrown into a single string, which may be &#39;cut&#39; up later on in the string_prep function</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        <span class="comment">//these will not be &#39;ordered&#39; within the string nicely...</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        <span class="keywordtype">int</span> numendpoint = 0; <span class="keywordtype">int</span> num_str0 = -1;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_showerptns.num();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].string_id() != 0){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                <span class="keywordtype">int</span> iendpoint = 0;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                <span class="keywordtype">bool</span> is_endpoint = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() != 21){iendpoint = ++numendpoint; is_endpoint = <span class="keyword">true</span>;}</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].string_id(0);</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pos_str(++num_str0);</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].endpt_id(iendpoint);</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_strendpt(is_endpoint);</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        }</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        <span class="comment">//reordering HH_showerptns - based on string, and position in the string</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        <span class="comment">//isn&#39;t strictly necessary to do this here, as the critical pos_str and endpt_id variables have been set, but is &#39;nice&#39;</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        <span class="comment">//std::stable_sort(&amp;HH_showerptns[0], (&amp;HH_showerptns[HH_showerptns.num()-1])+1, strid_compare);</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        std::stable_sort(&amp;HH_showerptns[0], (&amp;HH_showerptns[HH_showerptns.num()-1])+1, [](<span class="keyword">const</span> <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a>&amp; parton1, <span class="keyword">const</span> <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a>&amp; parton2){<span class="keywordflow">return</span> (parton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9a6f4a7ec8c6446237a3114692d38319">string_id</a>() &lt; parton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9a6f4a7ec8c6446237a3114692d38319">string_id</a>());});</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        <span class="comment">//now that the list is sorted based on string id, going to sort the partons in each string based on the position of the partons in the string</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_showerptns.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                <span class="keywordtype">int</span> <a class="code" href="../../d7/dde/ctrl_8cpp.html#ada310e7f72b38fadd4b24d80ed3438ee">start</a>, prev_pos, cur_pos, lastfix;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                lastfix = 0; <span class="keywordflow">if</span>(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> == HH_showerptns.num()-1){lastfix = 1;}</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                cur_pos = HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].string_id();</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>==0){prev_pos = HH_showerptns[0].string_id(); start = 0;}</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                <span class="keywordflow">if</span>(cur_pos != prev_pos || <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> == HH_showerptns.num()-1){</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                        std::stable_sort(&amp;HH_showerptns[start],&amp;HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]+lastfix, [](<span class="keyword">const</span> <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a>&amp; parton1, <span class="keyword">const</span> <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a>&amp; parton2){<span class="keywordflow">return</span> (parton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a4b25b468609274f46868ee9eddc21160">pos_str</a>() &lt; parton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a4b25b468609274f46868ee9eddc21160">pos_str</a>());});</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                        start = <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>; prev_pos = HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pos_str();</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                }</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        }</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;}</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div>
<div class="line"><a name="l01148"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a13da107925f90e25b2dbe6e8c2723c40"> 1148</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#a13da107925f90e25b2dbe6e8c2723c40">HybridHadronization::recomb</a>(){</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <span class="comment">//parton list for treating thermal siblings for string repair</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a> Extraparton;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        <span class="comment">//declaring a few needed values (based on values in init)</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        <span class="keywordtype">double</span> hbarc2 = <a class="code" href="../../d8/da2/GubserHydro_8cc.html#a4d3af1654c1aa1f521233a74975bb76f">hbarc</a>*<a class="code" href="../../d8/da2/GubserHydro_8cc.html#a4d3af1654c1aa1f521233a74975bb76f">hbarc</a>;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        <span class="comment">//should create a new parton collection here, one with only shower quarks (inc. from gluon splitting)</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <span class="comment">//to consider for recombination - then afterwards can reform gluons and output remnants</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a> showerquarks;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        <span class="comment">//clearing remnants, in case it hasn&#39;t been done before</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        HH_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        <span class="comment">//constructing a list of all the strings in the event</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        std::vector&lt;int&gt; list_strs;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        <span class="comment">//adding the first string to the list</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        list_strs.push_back(HH_showerptns[0].string_id());</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        <span class="comment">//looping over all the partons in the event, and writing each &#39;unique&#39; string to the list</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_showerptns.num();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                <span class="keywordtype">bool</span> str_match = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>&lt;list_strs.size();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>){</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;                        <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].string_id() == list_strs[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]){str_match = <span class="keyword">true</span>;}</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                }</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                <span class="keywordflow">if</span>(!str_match){list_strs.push_back(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].string_id());}</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        }</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  <span class="comment">//*********************************************************************************************************************</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  <span class="comment">//            Splitting gluons into q-qbar pairs for recombination</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="comment">//*********************************************************************************************************************</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <span class="comment">//std::cout &lt;&lt;&quot;Below is Color information of all particles in the String (Col, Acol)&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  std::vector&lt;int*&gt; ColInfo3;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_showerptns.num(); <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++) {</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="keywordtype">int</span> colinfo3[2] = {HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].col() , HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol()};</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      ColInfo3.push_back(colinfo3);</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      <span class="comment">//std::cout &lt;&lt;&quot; ( &quot;&lt;&lt;HH_showerptns[i].string_id()&lt;&lt;&quot; , &quot;&lt;&lt;ColInfo3.at(i)[0]&lt;&lt;&quot;   &quot;&lt;&lt;ColInfo3.at(i)[1]&lt;&lt;&quot;  ) &quot;;</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  }</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <span class="comment">//std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="comment">//while running PythiaBrickTest, error{same col tags and acol tag for the different particles, somehow the cause would be in MATTER in determining the color tag} detected,</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  <span class="comment">//So, If there are problems from the initial structure, correct it based on the color flow.</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  <span class="keywordtype">int</span> temptag = 1;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; HH_showerptns.num(); <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++){</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a> = <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>+1; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; HH_showerptns.num(); <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>++){</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() != 0 &amp;&amp; HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].col() == HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].col()){ <span class="comment">//same col tag for different particles detected.</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a> = 0; <a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a> &lt; HH_showerptns.num(); <a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>++){</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;          <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == HH_showerptns[<a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>].acol()){</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            vector&lt;int&gt; Info;<span class="comment">// location of i, location of k, temp color tag will be saved in this vector.</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;            Info.push_back(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>);</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            Info.push_back(<a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>);</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;            Info.push_back(temptag);</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].col(temptag);</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            HH_showerptns[<a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>].acol(temptag); <span class="comment">//apply the change for the col, acol pair to preserve the color flow with least impact to the final result.</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;            temptag++;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            Info.clear();</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;          }</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        }</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      }</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    }</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  }</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; HH_showerptns.num(); <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++){</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a> = <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>+1; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; HH_showerptns.num(); <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>++){</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;      <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol() != 0 &amp;&amp; HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol() == HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].acol()){ <span class="comment">//same acol tag for different particles detected.</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a> = 0; <a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a> &lt; HH_showerptns.num(); <a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>++){</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;          <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol() == HH_showerptns[<a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>].col()){</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            vector&lt;int&gt; Info;<span class="comment">// location of i, location of k, temp color tag will be saved in this vector.</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            Info.push_back(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>);</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            Info.push_back(<a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>);</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            Info.push_back(temptag);</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;            HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol(temptag);</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;            HH_showerptns[<a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>].col(temptag); <span class="comment">//apply the change for the col, acol pair to preserve the color flow with least impact to the final result.</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;            temptag++;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;            Info.clear();</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;          }</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        }</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      }</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    }</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  }</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  <span class="comment">//std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <span class="comment">//std::cout &lt;&lt;&quot;Below is Color information of all particles in the Revised String (Col, Acol)&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  std::vector&lt;int*&gt; ColInfo2;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_showerptns.num(); <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++) {</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="keywordtype">int</span> colinfo2[2] = {HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].col() , HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol()};</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    ColInfo2.push_back(colinfo2);</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <span class="comment">//std::cout &lt;&lt;&quot; ( &quot;&lt;&lt;HH_showerptns[i].string_id()&lt;&lt;&quot; , &quot;&lt;&lt;ColInfo2.at(i)[0]&lt;&lt;&quot;   &quot;&lt;&lt;ColInfo2.at(i)[1]&lt;&lt;&quot;  ) &quot;;</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  }</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="comment">//std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  set_initial_parton_masses(HH_showerptns);</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        <span class="comment">//starting with shower partons</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i_pt=0; i_pt&lt;HH_showerptns.num(); ++i_pt){</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                <span class="comment">//if parton is a quark, stick it into showerquarks - and set it&#39;s parent id to the quark in the original shower</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                <span class="keywordflow">if</span>((std::abs(HH_showerptns[i_pt].<span class="keywordtype">id</span>()) &lt;= 5 ) &amp;&amp; (HH_showerptns[i_pt].PY_origid() == 0)){</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_showerptns.partons[i_pt]);</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      showerquarks[showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].par(i_pt);</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    }</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                <span class="comment">//else parton is a gluon, decay into q-qbar and stick those into the collection; set parent id appropriately for both</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>((HH_showerptns[i_pt].<span class="keywordtype">id</span>() == 21) &amp;&amp; (HH_showerptns[i_pt].PY_origid() == 0)){</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                        <span class="comment">//setting is_decayedglu; not going to set used until one of it&#39;s quarks has been used</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                        <span class="comment">//will set the status to -99 here, this will be changed to -1 after first quark, and to 1 after second</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                        HH_showerptns[i_pt].is_decayedglu(<span class="keyword">true</span>); HH_showerptns[i_pt].status(-99);</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                        <span class="comment">//choosing a gluon mass - if implemented in the future, can (should) read this from the gluon entry itself (or set if necessary)</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                        <span class="comment">//maybe discard gluon if it is under some threshold of mass (eg &lt; pion?)</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                        <span class="comment">//temporarily saving previously set mass here - here&#39;s a good place to check if this is even necessary?</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                        <span class="keywordtype">double</span> temp_glumass = HH_showerptns[i_pt].mass();</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                        <span class="keywordflow">if</span>(HH_showerptns[i_pt].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()&lt;2.*xmq+0.001){HH_showerptns[i_pt].mass(2.*xmq+0.001);}</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                        <span class="comment">//gluon decay function reads in the gluon (and the overwritten random mass), and writes the output q-qbar pair to qpair</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                        <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a> qpair;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                        gluon_decay(HH_showerptns[i_pt], qpair);</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                        <span class="comment">//swapping back original gluon mass</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;                        HH_showerptns[i_pt].mass(temp_glumass);</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                        <span class="comment">//setting the parents of the q-qbar pair to the original gluon (and other vars appropriately here)</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                        qpair[0].par(i_pt); qpair[1].par(i_pt);</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                        qpair[0].is_shower(<span class="keyword">true</span>); qpair[1].is_shower(<span class="keyword">true</span>);</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;                        qpair[0].orig( HH_showerptns[i_pt].orig() ); qpair[1].orig( HH_showerptns[i_pt].orig() );</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;                        qpair[0].string_id ( HH_showerptns[i_pt].string_id()); qpair[1].string_id ( HH_showerptns[i_pt].string_id());</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                        qpair[0].pos_str   ( HH_showerptns[i_pt].pos_str());   qpair[1].pos_str   ( HH_showerptns[i_pt].pos_str());</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;                        <span class="comment">//adding these partons to the collection</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;                        showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(qpair);</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;                        <span class="comment">//setting up the sibling relations in showerquarks</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                        showerquarks[showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].sibling( showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-2 );</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                        showerquarks[showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-2].sibling( showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1 );</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;                }</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                <span class="comment">//else it&#39;s not a quark(u,d,s,c,b) or gluon and we&#39;re skipping it.</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                        <span class="comment">//JSINFO &lt;&lt; &quot;\n\nThere is a parton that is not a quark(u,d,s,c,b) or gluon in the input shower.  Skipping parton in recombination.\n\n&quot;;</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                }</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        }</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="comment">//*********************************************************************************************************************</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  <span class="comment">//            Finished splitting gluons</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  <span class="comment">//*********************************************************************************************************************</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <span class="comment">//*********************************************************************************************************************</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  <span class="comment">//            Beginning of Recombination routine</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <span class="comment">//*********************************************************************************************************************</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        <span class="comment">//randomly permute an integer array with &#39;n&#39; entries from 1 to n (actually from 0 to n-1)</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <span class="comment">//the array will be used to access the i&#39;th element of the showerquarks collection</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        <span class="comment">//done as showerquarks[perm0_sharray[i]]</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        <span class="comment">//since we have separate shower and thermal arrays, we will force the first quark to always be from the shower</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        <span class="comment">//construct perm1 array of size showerquarks.num() and perm2 array of size showerquarks.num() + HH_thermal.num()</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        <span class="comment">//to access an element from either shower or thermal partons</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        <span class="comment">//there will be showerquarks.num() positive entries and HH_thermal.num() negative entries (going to exclude 0 in these, just -1 i&#39;s)</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        <span class="comment">//thus, perm2 = { 3, -42, -33,...} will access i=2 from showerquarks, then 41 from thermal, then 32 from thermal...</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        <span class="comment">//lastly, need to bypass scenarios where the quark has been used, or we&#39;re trying to use the same quark twice</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        <span class="comment">//to determine if we&#39;re trying to use the same quark twice, check if perm[i]=perm[j]</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <span class="comment">//if used=true OR p[i]=p[j]?, then skip this attempt (continue works well for these cases?)</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        <span class="comment">//constructing permutation arrays; shower quarks are &gt; 0, thermal are &lt; 0</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        <span class="comment">//perm2 will always access element [std::abs(perm2[i]) - 1]</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;        <span class="keywordtype">int</span> perm1[showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()], perm2[showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()+HH_thermal.num()];</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  <span class="comment">//option to either bias recombination, earlier particles attempt to recombine first</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <span class="keywordflow">if</span>(torder_reco){</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;                <span class="comment">//placeholders to sort by time</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                std::vector&lt;std::pair&lt;double,int&gt;&gt; tosort1, tosort2;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                        tosort1.push_back(std::make_pair(showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t(),<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>));</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                        tosort2.push_back(std::make_pair(showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t(),<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>+1));</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;                }</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_thermal.num();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;      tosort2.push_back({HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t(),-<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>-1});</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    }</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;                <span class="comment">//sorting</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                std::stable_sort(<a class="code" href="../../d7/d6a/namespaceparse__cmake__options.html#a96dc2e9352f5bb441b89628e674d2678">std::begin</a>(tosort1), <a class="code" href="../../d7/dde/ctrl_8cpp.html#a13455ba845bf5d4dba37be491bc6a036">std::end</a>(tosort1));</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;                std::stable_sort(<a class="code" href="../../d7/d6a/namespaceparse__cmake__options.html#a96dc2e9352f5bb441b89628e674d2678">std::begin</a>(tosort2), <a class="code" href="../../d7/dde/ctrl_8cpp.html#a13455ba845bf5d4dba37be491bc6a036">std::end</a>(tosort2));</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                <span class="comment">//saving order into permutation arrays</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;tosort1.size();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      perm1[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]=tosort1[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].second;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    }</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;tosort2.size();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      perm2[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]=tosort2[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].second;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    }</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;                <span class="comment">//prepping permutation arrays to be shuffled</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;      perm1[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]=<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    }</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_thermal.num();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      perm2[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]=(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>-HH_thermal.num());</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    }</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=HH_thermal.num();<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()+HH_thermal.num();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;      perm2[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]=(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>-HH_thermal.num()+1);</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    }</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                <span class="comment">//permuting these arrays using Fisher-Yates algorithm</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                <span class="comment">//-- To shuffle an array a of n elements (indices 0..n-1):</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                <span class="comment">//for i from 0 to n−2 do</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                <span class="comment">//  j ← random integer such that i ≤ j &lt; n</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                <span class="comment">//  exchange a[i] and a[j]</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1;++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;                        <span class="keywordtype">int</span> ranelement = <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>+floor((showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>)*<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>());</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                        <span class="keywordtype">int</span> temp = perm1[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>];</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      perm1[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = perm1[ranelement];</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      perm1[ranelement] = temp;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                }</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()+HH_thermal.num()-1;++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                        <span class="keywordtype">int</span> ranelement = <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>+floor((showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()+HH_thermal.num()-<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>)*<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>());</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;                        <span class="keywordtype">int</span> temp = perm2[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>];</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;      perm2[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = perm2[ranelement];</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;      perm2[ranelement] = temp;</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                }</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        }</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;  <span class="comment">//std::cout &lt;&lt;&quot;Below is Color information of all particles in the String (Col, Acol)&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  std::vector&lt;int*&gt; ColInfo;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_showerptns.num(); <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++) {</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    <span class="keywordtype">int</span> colinfo[2] = {HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].col() , HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol()};</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    ColInfo.push_back(colinfo);</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="comment">//std::cout &lt;&lt;&quot; ( &quot;&lt;&lt;HH_showerptns[i].string_id()&lt;&lt;&quot; , &quot;&lt;&lt;ColInfo.at(i)[0]&lt;&lt;&quot;   &quot;&lt;&lt;ColInfo.at(i)[1]&lt;&lt;&quot;  ) &quot;;</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  }</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  <span class="comment">//std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <span class="comment">// make all color tags to be indices for the matrix (so the indice represent the color tag, don&#39;t need to classify anti or not)</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  std::vector&lt;vector&lt;int&gt;&gt; IndiceForCol1; <span class="comment">// this vector will form vector of vectors(location in the string, anti or not, color tag)</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  std::vector&lt;int&gt; IndiceForCol2; <span class="comment">// this vector is one component of vector above</span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  std::vector&lt;int&gt; IndiceForColFin; <span class="comment">// this vector is final vector that&#39;ll be used for process</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iIndice=0; iIndice &lt; HH_showerptns.num(); iIndice++) {</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    IndiceForCol2.push_back(iIndice);</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    IndiceForCol2.push_back(1);</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    IndiceForCol2.push_back(HH_showerptns[iIndice].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    IndiceForCol1.push_back(IndiceForCol2);</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    IndiceForCol2.clear();</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    IndiceForCol2.push_back(iIndice);</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    IndiceForCol2.push_back(-1);</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    IndiceForCol2.push_back(HH_showerptns[iIndice].acol());</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    IndiceForCol1.push_back(IndiceForCol2);</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    IndiceForCol2.clear();</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  } <span class="comment">// As a result, two vectors with 3 component keep being added to bigger vector, now exclude same tag and zero</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;  <span class="comment">//dignostic measure</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; Below is list of all color tags &quot; &lt;&lt;endl;</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  <span class="comment">//std::cout &lt;&lt;&quot; ( &quot;;</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  <span class="comment">//for (int icheck=0; icheck &lt; IndiceForCol1.size(); icheck++) {</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    <span class="comment">//std::cout &lt;&lt; IndiceForCol1.at(icheck).at(2) &lt;&lt; &quot; , &quot;;</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <span class="comment">//}</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  <span class="comment">//std::cout &lt;&lt;&quot; ) &quot; &lt;&lt;endl;</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  vector&lt;int&gt; tempcol;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  <span class="comment">// now put all the values in ColInfo into IndiceForColFin</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icol = 0; icol &lt; IndiceForCol1.size(); icol++){</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    tempcol.push_back(IndiceForCol1.at(icol).at(2));</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  }</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  <span class="keywordflow">if</span>(tempcol.at(0) != 0){</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    IndiceForColFin.push_back(tempcol.at(0));</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  }</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  <span class="keywordflow">if</span>(tempcol.at(1) != 0){</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    IndiceForColFin.push_back(tempcol.at(1));</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  }</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iclear1 = 0; iclear1 &lt; tempcol.size(); iclear1++){</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="keywordtype">bool</span> foundsame = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iclear2 = 0; iclear2 &lt; IndiceForColFin.size(); iclear2++){</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;      <span class="keywordflow">if</span>(tempcol.at(iclear1) == IndiceForColFin.at(iclear2) || tempcol.at(iclear1) == 0){</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        foundsame = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;      }</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    }</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <span class="keywordflow">if</span>(!foundsame){</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      IndiceForColFin.push_back(tempcol.at(iclear1));</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    }</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    foundsame = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  }</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  <span class="comment">//last checking whether there is zero in the color tag list</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; IndiceForColFin.size(); <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++){</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <span class="keywordflow">if</span>(IndiceForColFin[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] == 0){</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      std::vector&lt;int&gt;::iterator i1 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), 0 );</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">distance</a> = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin() , i1);</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; zero is located at &quot;&lt;&lt;distance&lt;&lt;endl;</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      IndiceForColFin.erase(i1);</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    }</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  }</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  <span class="comment">//dignostic syntax</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="comment">/*std::cout &lt;&lt;endl&lt;&lt;&quot; Below is list of valid color tags &quot; &lt;&lt;endl;</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="comment">  std::cout &lt;&lt;&quot; ( &quot;;</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;<span class="comment">  for (int icheck=0; icheck &lt; IndiceForColFin.size(); icheck++) {</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="comment">    std::cout &lt;&lt; IndiceForColFin.at(icheck) &lt;&lt; &quot; , &quot;;</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="comment">  }</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment">  std::cout &lt;&lt;&quot; ) &quot; &lt;&lt;endl;*/</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="comment">//when we includes the partons from LBT, color tags from them are both zero in col and acol tags,</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  <span class="comment">//Therefore, based on the maximum color tag from the parton with col , acol tags, reassign the color tags for LBT partons. As a result, one fake string should be formed based on these color Tags</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  <span class="comment">//First, check the maximum color tags in the vector of valid color tags</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../dc/d3a/namespaceperf__headwind.html#a170c40c86dac1c825a139dbc2d73a6bd">limit</a>;</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="keywordtype">int</span> maxtag;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  maxtag = *max_element(IndiceForColFin.begin() , IndiceForColFin.end()); <span class="comment">//this will be so important in dealing thermal partons, beacause they get color tag incremented from this max tag</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;  limit = maxtag; <span class="comment">// save initial maxtag for the future usage{It should be used for color reconnection matrix}</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; max tag is &quot;&lt;&lt;maxtag&lt;&lt;endl;</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;  <span class="comment">// before determine the matrix, need to link color tag with the matrix indices( by color tag and trace back to the particle, then determine the probability) It&#39;s done above(IndiceForCol1)</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;  <span class="comment">// to define the probability, parameters for distance should exist. possibly, that could be the par() or string number the last</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  std::vector&lt;vector&lt;double&gt;&gt; MesonrecoMatrix1; <span class="comment">// vector of double (prob) , ,,,// in a big scheme, these two vector form a Matrix</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  std::vector&lt;double&gt; MesonrecoMatrix2; <span class="comment">// this is 1d vector of (probabilty)</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="comment">//first, Form Meson recombination Matrix</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irow=0; irow &lt; IndiceForColFin.size(); irow++){</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icol=0; icol &lt; IndiceForColFin.size(); icol++){</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;      <span class="keywordtype">double</span> Mesonfactor;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">distance</a>; <span class="comment">// distance between the color tags in string(not c++ function)</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      <span class="keywordtype">int</span> tag1 = IndiceForColFin.at(irow);</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <span class="keywordtype">int</span> tag2 = IndiceForColFin.at(icol);</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      std::vector&lt;int&gt;::iterator it1 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), tag1);</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;      std::vector&lt;int&gt;::iterator it2 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), tag2);<span class="comment">// set up for finding the location of co tag in vector that will be used to find distance</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <span class="keywordtype">int</span> pos1 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), it1); <span class="comment">//location of col tag of irow</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      <span class="keywordtype">int</span> pos2 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), it2); <span class="comment">//location of col tag of icol</span></div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;      <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;position of &quot;&lt;&lt;IndiceForColFin.at(irow)&lt;&lt;&quot; is &quot; &lt;&lt; pos1 &lt;&lt;endl;</span></div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;position of &quot;&lt;&lt;IndiceForColFin.at(icol)&lt;&lt;&quot; is &quot; &lt;&lt; pos2 &lt;&lt;endl;</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      distance = abs(pos1 - pos2);</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; At ( &quot;&lt;&lt;irow&lt;&lt;&quot;,&quot;&lt;&lt;icol&lt;&lt;&quot; ) , distance is &quot;&lt;&lt;distance&lt;&lt;endl;</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      <span class="keywordflow">if</span>(distance == 0) {</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        Mesonfactor = 1;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Temp Meson Factor is &quot;&lt;&lt;Mesonfactor&lt;&lt;endl;</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        MesonrecoMatrix2.push_back(Mesonfactor);</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      };</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <span class="keywordflow">if</span>(distance &gt; 0) {</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;        Mesonfactor = 0.111;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Temp Meson Factor is &quot;&lt;&lt;Mesonfactor&lt;&lt;endl;</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        MesonrecoMatrix2.push_back(Mesonfactor);</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      };</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    }</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    MesonrecoMatrix1.push_back(MesonrecoMatrix2);</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    MesonrecoMatrix2.clear();</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  }</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  <span class="comment">// now correct the component in MesonMatrix1 by searching through HH_showerptns{checking gluon}</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icheck1 = 0; icheck1 &lt; HH_showerptns.num(); icheck1++ ){</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    <span class="keywordflow">if</span>(HH_showerptns[icheck1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() != 0 &amp;&amp; HH_showerptns[icheck1].acol() != 0 ){<span class="comment">//finding gluon means that finding partons that can&#39;t form color singlet, but octet</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;      <span class="keywordtype">int</span> tag1 = HH_showerptns[icheck1].col();</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      <span class="keywordtype">int</span> tag2 = HH_showerptns[icheck1].acol();</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      std::vector&lt;int&gt;::iterator it1 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), tag1);</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      std::vector&lt;int&gt;::iterator it2 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), tag2);<span class="comment">// set up for finding the location of co tag in vector that will be used to find distance</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;      <span class="keywordtype">int</span> pos1 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), it1); <span class="comment">//location of col tag of irow</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;      <span class="keywordtype">int</span> pos2 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), it2); <span class="comment">//location of col tag of icol</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;      MesonrecoMatrix1.at(pos1).at(pos2) = 0;</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;      MesonrecoMatrix1.at(pos2).at(pos1) = 0;</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    }</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  }</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment">  //dignostic measure</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">  std::cout &lt;&lt;endl&lt;&lt;&quot;Meson reco Matrix is same as below&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">  for(int irow=0; irow &lt; IndiceForColFin.size(); irow++){</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="comment">    for(int icol=0; icol &lt; IndiceForColFin.size(); icol++){</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot;  &quot;&lt;&lt;MesonrecoMatrix1.at(irow).at(icol)&lt;&lt;&quot;  &quot;;</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="comment">    std::cout &lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="comment">  }</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  <span class="comment">//MesonrecoMatrix is Formed so far, Now make that of Baryon!!</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  std::vector&lt;vector&lt;vector&lt;double&gt;&gt;&gt; BaryonrecoMatrix1; <span class="comment">// vector of double (prob) , ,,,// in a big scheme, these three items form a Matrix of vector</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  std::vector&lt;vector&lt;double&gt;&gt; BaryonrecoMatrix2; <span class="comment">// this is vector of 2d vector below (probabilty, required color charge for color neutrality), ( , ) , ( , ) ...</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  std::vector&lt;double&gt; BaryonrecoMatrix3; <span class="comment">// this is 2d vector of (probabilty, required color charge for color neutrality)</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irow=0; irow &lt; IndiceForColFin.size(); irow++){</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icol=0; icol &lt; IndiceForColFin.size(); icol++){</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;      <span class="keywordtype">double</span> Baryonfactor;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;      BaryonrecoMatrix3.push_back(1./27.);<span class="comment">//1/27: probability to get singlet state</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;      BaryonrecoMatrix3.push_back(0.); <span class="comment">// now the probability factor and color(not specified yet, it&#39;ll be done with baryon formation) for neutrality are saved.</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      BaryonrecoMatrix2.push_back(BaryonrecoMatrix3);</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;      BaryonrecoMatrix3.clear();</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    }</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    BaryonrecoMatrix1.push_back(BaryonrecoMatrix2);</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    BaryonrecoMatrix2.clear();</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  }</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="comment">  //dignostic measure</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="comment">  std::cout &lt;&lt;endl&lt;&lt;&quot;Baryon reco Matrix is same as below&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="comment">  for(int irow=0; irow &lt; IndiceForColFin.size(); irow++){</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment">    for(int icol=0; icol &lt; IndiceForColFin.size(); icol++){</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot;  ( &quot;&lt;&lt;BaryonrecoMatrix1.at(irow).at(icol).at(1)&lt;&lt;&quot; )  &quot;;</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="comment">    std::cout &lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="comment">  }</span></div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="comment">  //std::cout &lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;        <span class="comment">//looping over all the quarks that we have...</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        <span class="comment">//&#39;q1&#39; loops over all quarks in the shower</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        <span class="comment">//&#39;q2&#39; loops over all quarks in the event</span></div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        <span class="comment">//&#39;q3&#39; loops over all quarks in the event, starting from &#39;q2&#39; and ending at the last quark</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;        <span class="comment">//when &#39;q2&#39; is at the last quark, we will not consider quark &#39;q3&#39; - can only make a meson at that point...</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a> considering;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d5/d71/namespacefixGDML.html#a3ceb8811bdea2af323513d9f998064f3">element</a>[3];</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> q1=0;q1&lt;showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>();++q1){</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;                <span class="comment">//accessing first considered quark</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;                <span class="comment">//set q1 variables here</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;                <span class="keywordflow">if</span>(sh_recofactor &lt; 0.0000000001){<span class="keywordflow">continue</span>;} <span class="comment">//turning off recombination in a computationally friendly way...</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;                <span class="comment">//resetting madehadron flag, now that we&#39;re going to be considering a new hadron</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;                <span class="keywordtype">bool</span> madehadron = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                <span class="comment">//taking the id from the permutation array, and turning it into quark array element</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                element[0] = perm1[q1];</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                <span class="comment">//skipping if current quark has been used or isn&#39;t a u,d,s,c,b quark or antiquark</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;                <span class="keywordflow">if</span>(showerquarks[element[0]].<a class="code" href="../../d6/d84/namespaceutils.html#ae872b751be761fb1b2f1fcfce89f3e58">status</a>() != 0 || showerquarks[element[0]].is_used()){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(showerquarks[element[0]].<span class="keywordtype">id</span>()) &gt; 5){<a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;SOMETHING OTHER THAN u,d,s,c,b WAS considered for recombination, THIS SHOULD NOT HAPPEN!&quot;</span>; <span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                <span class="comment">//assigning quark values to considering - and setting the status to -991</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                <span class="comment">//if at the end of the check, we make a hadron, we will set all -99* entries to 1, else we&#39;ll set back to 0</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                considering.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(showerquarks[element[0]]);</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                showerquarks[element[0]].status(-991);</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> q2=0;q2&lt;showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()+HH_thermal.num();++q2){</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                        <span class="comment">//set q2 variables here - if we can form a meson, then skip q3 loop</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                        <span class="comment">//also skip q3 loop if q2 is at last quark</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;      <span class="keywordtype">double</span> recofactor2 = 1./9.;</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                        <span class="comment">//accessing the second considered quark</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                        <span class="comment">//this will skip over non-quark entries in HH_thermal</span></div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                        <span class="keywordflow">if</span>(perm2[q2]&gt;0){<span class="comment">/*is shower quark*/</span> element[1] = perm2[q2] - 1;}</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                        <span class="keywordflow">else</span>{<span class="comment">/*is thermal quark*/</span> element[1] = perm2[q2] + 1;}</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;                        <span class="comment">//checking to see if quark is in shower or thermal</span></div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;                        <span class="comment">//only need to check if quark is the same as the previous quark IFF it is in the shower</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                        <span class="comment">//only need to check if quark is from the same gluon if it is from a gluon decay in the shower...</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                        <span class="comment">//want to check if we&#39;ve messed up and are accessing a gluon if it is in original shower/thermal</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;                        <span class="comment">//need to check if used for all cases...</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;                        <span class="keywordflow">if</span>(perm2[q2]&gt;0){</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                                <span class="comment">//skipping if current quark has been used</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;                                <span class="keywordflow">if</span>(showerquarks[element[1]].<a class="code" href="../../d6/d84/namespaceutils.html#ae872b751be761fb1b2f1fcfce89f3e58">status</a>() != 0 || showerquarks[element[1]].is_used()){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;                                <span class="comment">//skipping if current quark is the same as q1</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(element[0]==element[1]){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;                                <span class="comment">//skipping if the current quark is from the same gluon as q1</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>((showerquarks[element[0]].par() != -1) &amp;&amp; (showerquarks[element[0]].par() == showerquarks[element[1]].par())){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;                                <span class="comment">//skipping if the current quark is not in the same string as q1 (both are shower partons)</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;                                <span class="comment">//else if(showerquarks[element[1]].string_id() != showerquarks[element[0]].string_id()){continue;}</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;                                <span class="comment">//skipping if current quark is not a u,d,s,c,b quark</span></div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(showerquarks[element[1]].<span class="keywordtype">id</span>()) &gt; 5){<a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;SOMETHING OTHER THAN u,d,s,c,b WAS considered for recombination, THIS SHOULD NOT HAPPEN!&quot;</span>; <span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;                                considering.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(showerquarks[element[1]]);</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;                                showerquarks[element[1]].status(-992);</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;                        }</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(perm2[q2]&lt;0){</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                                <span class="comment">//skipping if current quark has been used</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;                                <span class="keywordflow">if</span>(HH_thermal[-element[1]].<a class="code" href="../../d6/d84/namespaceutils.html#ae872b751be761fb1b2f1fcfce89f3e58">status</a>() != 0 || HH_thermal[-element[1]].is_used()){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;                                <span class="comment">//skipping if current quark is not a u,d,s,c,b quark</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_thermal[-element[1]].<span class="keywordtype">id</span>()) &gt; 5){<a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;SOMETHING OTHER THAN u,d,s,c,b WAS considered for recombination, THIS SHOULD NOT HAPPEN!&quot;</span>; <span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;                                <span class="comment">//turning off recombination for thermal partons in a computationally friendly way...</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(th_recofactor &lt; 0.001){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;                                <span class="comment">//checking distance cut ONLY if this is a thermal parton - skip if dist2 &gt; dist2cut</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;                                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_ptn1 = considering[0].pos(); <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_ptn2 = HH_thermal[-element[1]].pos();</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;                                <span class="keywordtype">double</span> dt = pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>() - pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>();</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;                                <span class="keywordflow">if</span>(dt &gt; 0.){</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;                                        <span class="keywordtype">double</span> dt_E = dt/HH_thermal[-element[1]].e(); <span class="comment">// P/E * dT = dist = P*(dT/E)</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;                                        pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()+HH_thermal[-element[1]].px()*dt_E,pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()+HH_thermal[-element[1]].py()*dt_E,pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()+HH_thermal[-element[1]].pz()*dt_E,0.);</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                                }</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                                <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                                        <span class="keywordtype">double</span> dt_E = -dt/considering[0].e();</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                                        pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()+considering[0].px()*dt_E,pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()+considering[0].py()*dt_E,pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()+considering[0].pz()*dt_E, 0.);</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                                }</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                                <span class="keywordflow">if</span>(dif2(pos_ptn1,pos_ptn2) &gt; dist2cut){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                                considering.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[-element[1]]);</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                                HH_thermal[-element[1]].status(-992);</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                        }</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                        <span class="keywordflow">else</span>{<a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;SOMETHING WENT HORRIBLY WRONG - DO NOT KNOW WHERE CURRENT QUARK CAME FROM?!&quot;</span>;}</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                        <span class="comment">//now that we have two &#39;acceptable&#39; quarks to check hadron formation against,</span></div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;                        <span class="comment">//there is no reason to bother checking if we can make a baryon if we have a q-qbar at this point...</span></div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                        <span class="comment">//will skip third loop in this case - otherwise we will check if we can make a baryon...</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                        <span class="keywordflow">if</span>((considering[0].<span class="keywordtype">id</span>()*considering[1].<span class="keywordtype">id</span>() &gt; 0) &amp;&amp; (q2 &lt; showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()+HH_thermal.num()-1) &amp;&amp; (maxB_level &gt; -1)){</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> q3=q2+1;q3&lt;showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()+HH_thermal.num();++q3){</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;          <span class="keywordtype">double</span> recofactor3 = 2./27.;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                                  <span class="comment">//removing all but the first two entries in the considering collection...</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                                  <span class="comment">//this should have been done before, but have this here just in case - remove if this doesn&#39;t ever trigger</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;                                  <span class="keywordflow">while</span>(considering.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>() &gt; 2){considering.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#ae0b1b71d70ad94567da60ab34fd2b10d">partons</a>.pop_back();}</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                                  <span class="comment">//accessing the third considered quark</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                                  <span class="comment">//this will skip over non-quark entries in HH_thermal</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;                                  <span class="keywordflow">if</span>(perm2[q3]&gt;0){<span class="comment">/*is shower quark*/</span> element[2] = perm2[q3] - 1;}</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                                  <span class="keywordflow">else</span>{<span class="comment">/*is thermal quark*/</span> element[2] = perm2[q3] + 1;}</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;                                  <span class="comment">//now that we have q3, we need to check if it is valid:</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                                  <span class="comment">//q3 needs to be checked if used (all cases)</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;                                  <span class="comment">//q3 needs to be checked if it is a erroneously accessed parton (not u,d,s,c,b quark)</span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                                  <span class="comment">//q3 needs to be checked against q1 to see if it is the same, or from the same gluon</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;                                  <span class="comment">//q3 does not need to be checked against q2 to see if it is the same</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;                                  <span class="comment">//q3 does need to be checked to see if it is from the same gluon as q2</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;                                  <span class="comment">//q3 needs to be checked to make sure that it can form a baryon with q1 and q2 (checking against either is ok)</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;                                  <span class="comment">//check:  used, sameq1, sameg_q1, sameg_q2, isglu</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;                                  <span class="keywordflow">if</span>(perm2[q3]&gt;0){</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;                                        <span class="comment">//skipping if the current quark cannot make a baryon with other two quarks</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;                                        <span class="keywordflow">if</span>(showerquarks[element[2]].<span class="keywordtype">id</span>()*considering[0].<span class="keywordtype">id</span>() &lt; 0){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;                                        <span class="comment">//skipping if current quark has been used</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;                                        <span class="keywordflow">if</span>(showerquarks[element[2]].<a class="code" href="../../d6/d84/namespaceutils.html#ae872b751be761fb1b2f1fcfce89f3e58">status</a>() != 0 || showerquarks[element[2]].is_used()){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;                                        <span class="comment">//skipping if current quark is the same as q1</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(element[0]==element[2] || element[1] == element[2]){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                                        <span class="comment">//skipping if the current quark is from the same gluon as q1</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>((showerquarks[element[0]].par() != -1) &amp;&amp; (showerquarks[element[0]].par() == showerquarks[element[2]].par())){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                                        <span class="comment">//skipping if the current quark is from the same gluon as q2</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>((perm2[q2] &gt; 0) &amp;&amp; (showerquarks[element[1]].par() != -1) &amp;&amp; (showerquarks[element[1]].par() == showerquarks[element[2]].par())){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;                                        <span class="comment">//skipping if the current quark is not in the same string as q1</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;                                        <span class="comment">//(q2 MUST be in the same string as q1 if it&#39;s in the shower, and doesn&#39;t need to be checked if thermal)</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                                        <span class="comment">//else if(showerquarks[element[2]].string_id() != showerquarks[element[0]].string_id()){continue;}</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                                        <span class="comment">//skipping if current quark is not a u,d,s,c,b quark</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(showerquarks[element[2]].<span class="keywordtype">id</span>()) &gt; 5){<a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;SOMETHING OTHER THAN u,d,s,c,b WAS considered for recombination, THIS SHOULD NOT HAPPEN!&quot;</span>; <span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                                        considering.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(showerquarks[element[2]]);</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                                        showerquarks[element[2]].status(-993);</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;            <span class="comment">//TODO: Here we need to establish the probability about baryon formation. first, need to find 3sets of col tag pair are included junction info at the same time. if all 3 does, prob is 1/27, if 1 does, find other component&#39;s tag with element[2](3rd one)&#39;s in Meson Matrix!</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;            <span class="comment">//second, scan all junction lists</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;            <span class="comment">//before that, we need to evaluate temporary junction, because some junctions could be eliminated, So need to make tempjunction list. then we need to proocedure to erase the factor in the vectors!</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;            <span class="comment">//Now evaluating the Tempjunctions element first, before this, declare bool variables for the next proocedure</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;            <span class="keywordtype">bool</span> element1 = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;            <span class="keywordtype">bool</span> element2 = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;            <span class="keywordtype">bool</span> element3 = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;            <span class="keywordtype">int</span> juncnum1 = 999999999;</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;            <span class="keywordtype">int</span> juncnum2 = 999999999;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;            <span class="keywordtype">int</span> juncnum3 = 999999999;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;            <span class="keywordtype">int</span> standard = IndiceForColFin.size(); <span class="comment">// to apply the &quot;if&quot; statement, set the condition for later syntax</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;            <span class="keywordtype">int</span> tagformatrix = 999999999; <span class="comment">// if all three tags are in same junction, we need to set large number not to confuse, this will be filtered by later syntax</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;            <span class="keywordtype">int</span> loc1 = standard; <span class="comment">//location in the MesonrecoMatrix</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;            std::vector&lt;int&gt;::iterator I1;</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;            std::vector&lt;int&gt;::iterator I2;</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;            <span class="keywordtype">int</span> loc2 = standard;</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;            <span class="keywordflow">if</span>(considering[0].<span class="keywordtype">id</span>()*considering[1].<span class="keywordtype">id</span>()*considering[2].<span class="keywordtype">id</span>() &gt; 0){</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;              <span class="comment">// baryon case, and this will check whether two particles are in same junction and the other is not.</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;              <span class="comment">// and evaluate(by mesonrecomatrix) the other particle&#39;s color tag with the the color tag of 3rd particle collected to be baryon.</span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;              <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ijunc=0; ijunc &lt; Tempjunctions.size(); ijunc++){</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;                <span class="keywordflow">if</span>((considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(1).at(1)) ||</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;                  (considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(2).at(1)) ||</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;                  (considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(3).at(1)) ) {</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;                  element1 = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                  juncnum1 = ijunc;</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                }</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                <span class="keywordflow">if</span>((considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(1).at(1)) ||</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                  (considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(2).at(1)) ||</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                  (considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(3).at(1)) ) {</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                  element2 = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;                  juncnum2 = ijunc;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;                }</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                <span class="keywordflow">if</span>((considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(1).at(1)) ||</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                  (considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(2).at(1)) ||</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;                  (considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(3).at(1)) ) {</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                  element3 = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                  juncnum3 = ijunc;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;                }</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;              }</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;              <span class="keywordflow">if</span>((juncnum1 == juncnum2) &amp;&amp; (juncnum1 != juncnum3) &amp;&amp; juncnum1 != 999999999 &amp;&amp; considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() != 0){</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;                tagformatrix = Tempjunctions.at(juncnum1).at(3).at(1);</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                I2 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), considering[2].col());</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;                loc2 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I2);</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;chosen color tag1 is &quot;&lt;&lt;HH_showerptns[showerquarks[element[2]].par()].col();</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;and corresponding indice in the matrix is  &quot;&lt;&lt;loc2&lt;&lt;endl;</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;              };</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;              <span class="keywordflow">if</span>((juncnum2 == juncnum3) &amp;&amp; (juncnum2 != juncnum1) &amp;&amp; juncnum2 != 999999999 &amp;&amp; considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() != 0){</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                tagformatrix = Tempjunctions.at(juncnum2).at(1).at(1);</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;                I2 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), considering[0].col());</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;                loc2 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I2);</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;chosen color tag2 is &quot;&lt;&lt;HH_showerptns[showerquarks[element[0]].par()].col();</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;and corresponding indice in the matrix is  &quot;&lt;&lt;loc2&lt;&lt;endl;</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;              };</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;              <span class="keywordflow">if</span>((juncnum1 == juncnum3) &amp;&amp; (juncnum1 != juncnum2) &amp;&amp; juncnum3 != 999999999 &amp;&amp; considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() != 0){</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;                tagformatrix = Tempjunctions.at(juncnum3).at(2).at(1);</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                I2 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), considering[1].col());</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                loc2 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I2);</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;chosen color tag3 is &quot;&lt;&lt;HH_showerptns[showerquarks[element[1]].par()].col();</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;and corresponding indice in the matrix is  &quot;&lt;&lt;loc2&lt;&lt;endl;</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;              };</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;              I1 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), tagformatrix);</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;              loc1 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I1);</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;              <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;chosen orginal color tag is &quot;&lt;&lt;tagformatrix;</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;              <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;and corresponding indice in the matrix is  &quot;&lt;&lt;loc1&lt;&lt;endl;// now we find the locations of the color tags.</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;              <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;loc2 is given as &quot;&lt;&lt;loc2&lt;&lt;endl;</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;              <span class="comment">// now, search the mesonrecomatrix</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;              <span class="keywordflow">if</span> (tagformatrix &lt; 999999999 &amp;&amp; loc1 &lt; standard &amp;&amp; loc2 &lt; standard) { <span class="comment">// Not all the tags are in same junction so loc1,2 has always same or smaller value than the size of INdiceForColFin vector</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;                <span class="keywordflow">if</span>(MesonrecoMatrix1.at(loc1).at(loc2) == 1) {</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;                  recofactor3 = 1; <span class="comment">// one specific tag, which is located in different location from other two strings from a junction, is neighbored with the tag in the not used tag in junction</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;                }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;                  recofactor3 = 1./9.;</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;                } <span class="comment">// general case</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;              }<span class="keywordflow">else</span>{recofactor3 = 1./27.;} <span class="comment">// general case</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;              <span class="keywordflow">if</span>((juncnum1 == juncnum2) &amp;&amp; (juncnum2 == juncnum3) &amp;&amp; (tagformatrix != 999999999)){</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                recofactor3 = 1.;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;              }</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;            }</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(considering[0].<span class="keywordtype">id</span>()*considering[1].id()*considering[2].id() &lt; 0){</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;              <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ijunc=0; ijunc &lt; Tempjunctions.size(); ijunc++){</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;                <span class="keywordflow">if</span>((considering[0].acol() == Tempjunctions.at(ijunc).at(1).at(1)) ||</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;                  (considering[0].acol() == Tempjunctions.at(ijunc).at(2).at(1)) ||</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;                  (considering[0].acol() == Tempjunctions.at(ijunc).at(3).at(1)) ) {</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;                  element1 = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;                  juncnum1 = ijunc;</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;                }</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;                <span class="keywordflow">if</span>((considering[1].acol() == Tempjunctions.at(ijunc).at(1).at(1)) ||</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;                  (considering[1].acol() == Tempjunctions.at(ijunc).at(2).at(1)) ||</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;                  (considering[1].acol() == Tempjunctions.at(ijunc).at(3).at(1)) ) {</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;                  element2 = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;                  juncnum2 = ijunc;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;                }</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;                <span class="keywordflow">if</span>((considering[2].acol() == Tempjunctions.at(ijunc).at(1).at(1)) ||</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;                  (considering[2].acol() == Tempjunctions.at(ijunc).at(2).at(1)) ||</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;                  (considering[2].acol() == Tempjunctions.at(ijunc).at(3).at(1)) ) {</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;                  element3 = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;                  juncnum3 = ijunc;</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;                }</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;              }</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;              <span class="keywordflow">if</span>((juncnum1 == juncnum2) &amp;&amp; (juncnum1 != juncnum3) &amp;&amp; juncnum1 != 999999999){</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;                tagformatrix = Tempjunctions.at(juncnum1).at(3).at(1);</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;                I2 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), considering[2].acol());</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;                loc2 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I2);</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;chosen color tag1 is &quot;&lt;&lt;HH_showerptns[showerquarks[element[2]].par()].col();</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;and corresponding indice in the matrix is  &quot;&lt;&lt;loc2&lt;&lt;endl;</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;              };</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;              <span class="keywordflow">if</span>((juncnum2 == juncnum3) &amp;&amp; (juncnum2 != juncnum1) &amp;&amp; juncnum2 != 999999999){</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;                tagformatrix = Tempjunctions.at(juncnum2).at(1).at(1);</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;                I2 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), considering[0].acol());</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;                loc2 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I2);</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;chosen color tag2 is &quot;&lt;&lt;HH_showerptns[showerquarks[element[0]].par()].col();</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;and corresponding indice in the matrix is  &quot;&lt;&lt;loc2&lt;&lt;endl;</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;              };</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;              <span class="keywordflow">if</span>((juncnum1 == juncnum3) &amp;&amp; (juncnum1 != juncnum2) &amp;&amp; juncnum3 != 999999999){</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;                tagformatrix = Tempjunctions.at(juncnum3).at(2).at(1);</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;                I2 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), considering[1].acol());</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;                loc2 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I2);</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;chosen color tag3 is &quot;&lt;&lt;HH_showerptns[showerquarks[element[1]].par()].col();</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;and corresponding indice in the matrix is  &quot;&lt;&lt;loc2&lt;&lt;endl;</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;              };</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;              I1 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), tagformatrix);</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;              loc1 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I1);</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;              <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;chosen orginal color tag is &quot;&lt;&lt;tagformatrix;</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;              <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;and corresponding indice in the matrix is  &quot;&lt;&lt;loc1&lt;&lt;endl;// now we find the locations of the color tags.</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;              <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;loc2 is given as &quot;&lt;&lt;loc2&lt;&lt;endl;</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;              <span class="comment">// now, search the mesonrecomatrix</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;              <span class="keywordflow">if</span> (tagformatrix &lt; 999999999 &amp;&amp; loc1 &lt; standard &amp;&amp; loc2 &lt; standard) { <span class="comment">// Not all the tags are in same junction so loc1,2 has always same or smaller value than the size of INdiceForColFin vector</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                <span class="keywordflow">if</span>(MesonrecoMatrix1.at(loc1).at(loc2) == 1) {</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;                  recofactor3 = 1; <span class="comment">// one specific tag, which is located in different location from other two strings from a junction, is neighbored with the tag in the not used tag in junction</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;                }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;                  recofactor3 = 1./9.;</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;                } <span class="comment">// general case</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;              }</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;              <span class="keywordflow">else</span>{recofactor3 = 1./27.;} <span class="comment">// general case</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;              <span class="keywordflow">if</span>((juncnum1 == juncnum2) &amp;&amp; (juncnum2 == juncnum3) &amp;&amp; (tagformatrix != 999999999)){</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;                recofactor3 = 1.;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;              }</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;            }</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                                        <span class="comment">//recofactor3 = sh_recofactor*recofactor2;</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;                                  }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(perm2[q3]&lt;0){</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;                                        <span class="comment">//skipping if the current quark cannot make a baryon with other two quarks</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;                                        <span class="keywordflow">if</span>(HH_thermal[-element[2]].<span class="keywordtype">id</span>()*considering[0].id() &lt; 0){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;                                        <span class="comment">//skipping if current quark has been used</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;                                        <span class="keywordflow">if</span>(HH_thermal[-element[2]].<a class="code" href="../../d6/d84/namespaceutils.html#ae872b751be761fb1b2f1fcfce89f3e58">status</a>() != 0 || HH_thermal[-element[2]].is_used()){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;                                        <span class="comment">//skipping if the current quark is from the same gluon as q2</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>((perm2[q2] &lt; 0) &amp;&amp; (HH_thermal[-element[1]].par() != -1) &amp;&amp; (HH_thermal[-element[1]].par() == HH_thermal[-element[2]].par())){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;                                        <span class="comment">//skipping if current quark is not a u,d,s,c,b quark</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_thermal[-element[2]].<span class="keywordtype">id</span>()) &gt; 5){<a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;SOMETHING OTHER THAN u,d,s,c,b WAS considered for recombination, THIS SHOULD NOT HAPPEN!&quot;</span>; <span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;                                        <span class="comment">//turning off recombination for thermal partons in a computationally friendly way...</span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(th_recofactor &lt; 0.001){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;                                        <span class="comment">//checking distance cut ONLY if this is a thermal parton - skip if dist2 &gt; dist2cut</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                                        <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_ptn1 = considering[0].pos(); <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_ptn2 = considering[1].pos(); <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_ptn3 = HH_thermal[-element[2]].pos();</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;                                        <span class="keywordflow">if</span>((pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>() &gt; pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()) &amp;&amp; (pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>() &gt; pos_ptn3.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>())){</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;                                                <span class="keywordtype">double</span> dt_E2 = (pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>() - pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>())/considering[1].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>(); <span class="keywordtype">double</span> dt_E3 = (pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>() - pos_ptn3.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>())/HH_thermal[-element[2]].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>();</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;                                                pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()+considering[1].px()*dt_E2,pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()+considering[1].py()*dt_E2,pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()+considering[1].pz()*dt_E2,0.);</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;                                                pos_ptn3.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_ptn3.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()+HH_thermal[-element[2]].px()*dt_E3,pos_ptn3.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()+HH_thermal[-element[2]].py()*dt_E3,pos_ptn3.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()+HH_thermal[-element[2]].pz()*dt_E3,0.);</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;                                        }</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>((pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>() &gt; pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()) &amp;&amp; (pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>() &gt; pos_ptn3.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>())){</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                                                <span class="keywordtype">double</span> dt_E1 = (pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>() - pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>())/considering[0].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>(); <span class="keywordtype">double</span> dt_E3 = (pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>() - pos_ptn3.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>())/HH_thermal[-element[2]].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>();</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;                                                pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()+considering[0].px()*dt_E1,pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()+considering[0].py()*dt_E1,pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()+considering[0].pz()*dt_E1,0.);</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;                                                pos_ptn3.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_ptn3.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()+HH_thermal[-element[2]].px()*dt_E3,pos_ptn3.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()+HH_thermal[-element[2]].py()*dt_E3,pos_ptn3.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()+HH_thermal[-element[2]].pz()*dt_E3,0.);</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;                                        }</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;                                        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                                                <span class="keywordtype">double</span> dt_E1 = (pos_ptn3.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>() - pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>())/considering[0].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>(); <span class="keywordtype">double</span> dt_E2 = (pos_ptn3.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>() - pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>())/considering[1].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>();</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                                                pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()+considering[0].px()*dt_E1,pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()+considering[0].py()*dt_E1,pos_ptn1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()+considering[0].pz()*dt_E1,0.);</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;                                                pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()+considering[1].px()*dt_E2,pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()+considering[1].py()*dt_E2,pos_ptn2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()+considering[1].pz()*dt_E2,0.);</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;                                        }</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;                                        <span class="keywordflow">if</span>((dif2(pos_ptn3,pos_ptn1) &gt; dist2cut) || (dif2(pos_ptn3,pos_ptn2) &gt; dist2cut) || (dif2(pos_ptn1,pos_ptn2) &gt; dist2cut)){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                                        considering.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[-element[2]]);</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;                                        HH_thermal[-element[2]].status(-993);</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;                                  }<span class="keywordflow">else</span>{<a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;SOMETHING WENT HORRIBLY WRONG - DO NOT KNOW WHERE CURRENT QUARK CAME FROM?!&quot;</span>;}</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;                                  <span class="comment">//now that we *could* form a baryon, now we check if we actually do form one</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;                                  <span class="comment">//baryon momentum</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;                                  <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> Pbaryon;</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                                  Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(considering[0].px()+considering[1].px()+considering[2].px(),considering[0].py()+considering[1].py()+considering[2].py(),considering[0].pz()+considering[1].pz()+considering[2].pz(),0.);</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;                                  <span class="comment">//baryon(CM) velocity</span></div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;                                  <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> betaB; <span class="comment">//really p[i]/e below</span></div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;                                  betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()/(considering[0].e()+considering[1].e()+considering[2].e()),Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()/(considering[0].e()+considering[1].e()+considering[2].e()),Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()/(considering[0].e()+considering[1].e()+considering[2].e()),0.);</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;                                  betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),1./(sqrt(1. - (betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>() + betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>() + betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()))));</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                                  <span class="comment">//boosting into CM frame</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                                  <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_BCM[3], p_BCM[3];</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                                  pos_BCM[0] = considering[0].boost_pos(betaB); pos_BCM[1] = considering[1].boost_pos(betaB); pos_BCM[2] = considering[2].boost_pos(betaB);</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;                                    p_BCM[0] = considering[0].boost_P(betaB);     p_BCM[1] = considering[1].boost_P(betaB);     p_BCM[2] = considering[2].boost_P(betaB);</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;                                  <span class="comment">//velocities in CM frame</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;                                  <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> v_BCM[3];</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;                                  v_BCM[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(p_BCM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()/p_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_BCM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()/p_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_BCM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()/p_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),0.); <span class="comment">//these are really p[i]/e</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;                                  v_BCM[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(p_BCM[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()/p_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_BCM[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()/p_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_BCM[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()/p_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),0.);</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;                                  v_BCM[2].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(p_BCM[2].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()/p_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_BCM[2].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()/p_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_BCM[2].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()/p_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),0.);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;                                  <span class="comment">//propagating quarks until time of youngest quark</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;                                  <span class="keywordtype">double</span> curtime = std::max(std::max(pos_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(), pos_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()), pos_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>());</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;                                  <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> cur_pos[3];</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;                                  cur_pos[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_BCM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()+v_BCM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*(curtime-pos_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),pos_BCM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()+v_BCM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*(curtime-pos_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),pos_BCM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()+v_BCM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*(curtime-pos_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),curtime);</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;                                  cur_pos[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_BCM[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()+v_BCM[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*(curtime-pos_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),pos_BCM[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()+v_BCM[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*(curtime-pos_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),pos_BCM[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()+v_BCM[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*(curtime-pos_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),curtime);</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;                                  cur_pos[2].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_BCM[2].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()+v_BCM[2].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*(curtime-pos_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),pos_BCM[2].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()+v_BCM[2].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*(curtime-pos_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),pos_BCM[2].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()+v_BCM[2].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*(curtime-pos_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),curtime);</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;                                  <span class="comment">//finding position of CM at curtime</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;                                  <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_CM;</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;                                  pos_CM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;                                  (cur_pos[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+cur_pos[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+cur_pos[2].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*considering[2].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[2].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()),</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                                  (cur_pos[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+cur_pos[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+cur_pos[2].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*considering[2].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[2].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()),</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                                  (cur_pos[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+cur_pos[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+cur_pos[2].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*considering[2].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[2].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()),</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                                  curtime</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                                  );</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;                                  <span class="comment">//finding position of baryon in lab frame</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                                  betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(-betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),-betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),-betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>());</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;                                  <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_lab = HHboost(betaB, pos_CM);</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;                                  <span class="comment">//finding relative momenta of partons in CM frame</span></div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;                                  <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> k_rel_square[2];</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;                                  k_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;                                  (considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*p_BCM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()-considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*p_BCM[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()),</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;                                  (considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*p_BCM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()-considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*p_BCM[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()),</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;                                  (considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*p_BCM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()-considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*p_BCM[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()),</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;                                  0.);</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                                  k_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;                                  (considering[2].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*(p_BCM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()+p_BCM[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>())-(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())*p_BCM[2].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[2].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()),</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;                                  (considering[2].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*(p_BCM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()+p_BCM[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>())-(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())*p_BCM[2].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[2].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()),</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;                                  (considering[2].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*(p_BCM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()+p_BCM[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>())-(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())*p_BCM[2].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[2].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()),</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                                  0.);</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;                                  <span class="comment">//finding relative positions of partons in CM frame</span></div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;                                  <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_rel_square[2];</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;                                  pos_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>((cur_pos[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()-cur_pos[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()),(cur_pos[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()-cur_pos[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()),(cur_pos[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()-cur_pos[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()),0.);</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                                  pos_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                                  ((cur_pos[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+cur_pos[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())-cur_pos[2].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()),</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                                  ((cur_pos[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+cur_pos[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())-cur_pos[2].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()),</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                                  ((cur_pos[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+cur_pos[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())-cur_pos[2].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()),</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                                  0.);</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                                  <span class="keywordtype">double</span> SigRB2 = SigNucR2; <span class="keywordtype">double</span> SigLB2 = SigNucL2;</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;                                  <span class="keywordtype">int</span> sortid[3] = {std::abs(considering[0].<span class="keywordtype">id</span>()),std::abs(considering[1].<span class="keywordtype">id</span>()),std::abs(considering[2].<span class="keywordtype">id</span>())};</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                                  std::stable_sort(<a class="code" href="../../d7/d6a/namespaceparse__cmake__options.html#a96dc2e9352f5bb441b89628e674d2678">std::begin</a>(sortid), <a class="code" href="../../d7/dde/ctrl_8cpp.html#a13455ba845bf5d4dba37be491bc6a036">std::end</a>(sortid), std::greater&lt;int&gt;());</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;                                  <span class="comment">//for particles we don&#39;t want to form, setting recofactor3 to 0</span></div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;                                  <span class="keywordflow">if</span>(     sortid[0] == 3){</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;                                        <span class="keywordflow">if</span>(     sortid[1] == 3){</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;                                                <span class="keywordflow">if</span>(     sortid[2] == 3){SigRB2 = SigOmgR2;  SigLB2 = SigOmgL2;}</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;                                                <span class="keywordflow">else</span>{                   SigRB2 = SigXiR2;   SigLB2 = SigXiL2;}</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;                                        }</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;                                        <span class="keywordflow">else</span>{                       SigRB2 = SigSigR2;  SigLB2 = SigSigL2;}</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;                                  }</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;                                  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sortid[0] == 4){</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;                                        <span class="keywordflow">if</span>(     sortid[1] == 4){</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;                                                <span class="keywordflow">if</span>(     sortid[2] == 4){SigRB2 = SigOcccR2; SigLB2 = SigOcccL2;}</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;                                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sortid[2] == 3){SigRB2 = SigOccR2;  SigLB2 = SigOccL2;}</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;                                                <span class="keywordflow">else</span>{                   SigRB2 = SigXiccR2; SigLB2 = SigXiccL2;}</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;                                        }</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sortid[1] == 3){</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;                                                <span class="keywordflow">if</span>(     sortid[2] == 3){SigRB2 = SigOcR2;   SigLB2 = SigOcL2;}</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;                                                <span class="keywordflow">else</span>{                   SigRB2 = SigXicR2;  SigLB2 = SigXicL2;}</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;                                        }</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;                                        <span class="keywordflow">else</span>{                       SigRB2 = SigSigcR2; SigLB2 = SigSigcL2;}</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;                                  }</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;                                  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sortid[0] == 5){</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                                        <span class="keywordflow">if</span>(     sortid[1] == 5){</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                                                <span class="keywordflow">if</span>(     sortid[2] == 5){SigRB2 = SigObbbR2; SigLB2 = SigObbbL2; recofactor3=0.;}</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;                                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sortid[2] == 4){SigRB2 = SigObbcR2; SigLB2 = SigObbcL2; recofactor3=0.;}</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;                                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sortid[2] == 3){SigRB2 = SigObbR2;  SigLB2 = SigObbL2;  recofactor3=0.;}</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;                                                <span class="keywordflow">else</span>{                   SigRB2 = SigXibbR2; SigLB2 = SigXibbL2; recofactor3=0.;}</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                                        }</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sortid[1] == 4){</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;                                                <span class="keywordflow">if</span>(     sortid[2] == 4){SigRB2 = SigObccR2; SigLB2 = SigObccL2; recofactor3=0.;}</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;                                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sortid[2] == 3){SigRB2 = SigObcR2;  SigLB2 = SigObcL2;  recofactor3=0.;}</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;                                                <span class="keywordflow">else</span>{                   SigRB2 = SigXibcR2; SigLB2 = SigXibcL2; recofactor3=0.;}</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;                                        }</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sortid[1] == 3){</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;                                                <span class="keywordflow">if</span>(     sortid[2] == 3){SigRB2 = SigObR2;   SigLB2 = SigObL2;}</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                                                <span class="keywordflow">else</span>{                   SigRB2 = SigXibR2;  SigLB2 = SigXibL2;}</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;                                        }</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;                                        <span class="keywordflow">else</span>{                       SigRB2 = SigSigbR2; SigLB2 = SigSigbL2;}</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;                                  }</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;                                  <span class="comment">//precalc&#39;s for Wigner Wavefunction</span></div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;                                  <span class="comment">//0:x, 1:y, 2:z ::: urho:(rel. between partons 1,2), ulamb:(rel. between partons (1,2),3)</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                                  <span class="keywordtype">double</span> urho[3], ulamb[3];</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;                                  urho[0] =  0.5*(pos_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*pos_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()/SigRB2 + k_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*k_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*SigRB2/hbarc2);</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;                                  urho[1] =  0.5*(pos_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*pos_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()/SigRB2 + k_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*k_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*SigRB2/hbarc2);</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;                                  urho[2] =  0.5*(pos_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*pos_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()/SigRB2 + k_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*k_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*SigRB2/hbarc2);</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;                                  ulamb[0] = 0.5*(pos_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*pos_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()/SigLB2 + k_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*k_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*SigLB2/hbarc2);</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;                                  ulamb[1] = 0.5*(pos_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*pos_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()/SigLB2 + k_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*k_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*SigLB2/hbarc2);</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;                                  ulamb[2] = 0.5*(pos_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*pos_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()/SigLB2 + k_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*k_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*SigLB2/hbarc2);</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                                  <span class="comment">//1D GS Wig. wavefunction</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                                  <span class="keywordtype">double</span> wig0[2][3];</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                                  wig0[0][0] = std::exp(-urho[0]);  wig0[0][1] = std::exp(-urho[1]);  wig0[0][2] = std::exp(-urho[2]);</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;                                  wig0[1][0] = std::exp(-ulamb[0]); wig0[1][1] = std::exp(-ulamb[1]); wig0[1][2] = std::exp(-ulamb[2]);</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;                                  <span class="comment">//3D GS Wig. wavefunction</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;                                  <span class="keywordtype">double</span> WigB[2];</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                                  WigB[0] = wig0[0][0]*wig0[0][1]*wig0[0][2]*wig0[1][0]*wig0[1][1]*wig0[1][2];</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;                                  <span class="comment">//summing up 3D Wig. wavefunctions over nlev excited states</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;                                  WigB[1] = 0.; <span class="comment">//sumWigB;</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;                                  <span class="keywordtype">double</span> wigE[2][3];</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;                                  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;2;++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){<span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>&lt;2;++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>){wigE[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]=0.;}}</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;                                  wigE[0][0] = wig0[0][0];</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                                  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iRx=0; iRx&lt;=maxB_level; ++iRx){</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;                                        wigE[0][1] = wig0[0][1];</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;                                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iRy=0; iRy&lt;=maxB_level-iRx; ++iRy){</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;                                                wigE[0][2] = wig0[0][2];</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;                                                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iRz=0; iRz&lt;=maxB_level-iRx-iRy; ++iRz){</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;                                                        wigE[1][0] = wig0[1][0];</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;                                                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iLx=0; iLx&lt;=maxB_level-iRx-iRy-iRz; ++iLx){</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;                                                                wigE[1][1] = wig0[1][1];</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;                                                                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iLy=0; iLy&lt;=maxB_level-iRx-iRy-iRz-iLx; ++iLy){</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;                                                                        wigE[1][2] = wig0[1][2];</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;                                                                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iLz=0; iLz&lt;=maxB_level-iRx-iRy-iRz-iLx-iLy; ++iLz){</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;                                                                                WigB[1] += wigE[0][0]*wigE[0][1]*wigE[0][2]*wigE[1][0]*wigE[1][1]*wigE[1][2];</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                                                                                wigE[1][2] *= ulamb[2]/((<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(iLz))+1.);</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                                                                        }</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;                                                                        wigE[1][1] *= ulamb[1]/((<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(iLy))+1.);</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;                                                                }</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;                                                                wigE[1][0] *= ulamb[0]/((<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(iLx))+1.);</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                                                        }</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;                                                        wigE[0][2] *= urho[2]/((<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(iRz))+1.);</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;                                                }</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;                                                wigE[0][1] *= urho[1]/((<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(iRy))+1.);</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;                                        }</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;                                        wigE[0][0] *= urho[0]/((<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(iRx))+1.);</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;                                  }</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;          <span class="keywordflow">if</span>(maxB_level == -1) {</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;            WigB[0] = 0.;</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;            WigB[1] = 0.;</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;          }</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;                                  <span class="comment">//Checking if baryon is formed (either ground or excited state)</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;                                  <span class="keywordtype">double</span> rndbaryon = <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;                            <span class="keywordtype">double</span> mult = (considering[1].is_thermal() || considering[2].is_thermal()) ? th_recofactor : sh_recofactor;</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;                            <span class="keywordflow">if</span>(WigB[1]*recofactor3*mult &gt;= rndbaryon){</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;            <span class="keywordtype">int</span> junction_with_thermal_parton = 0;</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;            <span class="comment">/*std::cout &lt;&lt; &quot;Baryons&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="comment">            std::cout &lt;&lt; considering[0].id() &lt;&lt; &quot;,&quot; &lt;&lt; considering[0].col() &lt;&lt; &quot;,&quot; &lt;&lt; considering[0].acol() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;<span class="comment">            std::cout &lt;&lt; considering[1].id() &lt;&lt; &quot;,&quot; &lt;&lt; considering[1].col() &lt;&lt; &quot;,&quot; &lt;&lt; considering[1].acol() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="comment">            std::cout &lt;&lt; considering[2].id() &lt;&lt; &quot;,&quot; &lt;&lt; considering[2].col() &lt;&lt; &quot;,&quot; &lt;&lt; considering[2].acol() &lt;&lt; std::endl;*/</span></div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;                              <span class="keywordflow">if</span>(considering[0].<span class="keywordtype">id</span>() * considering[1].id() * considering[2].id() &gt; 0){</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;              <span class="comment">// baryon is to be formed, so temporary anti junction is defined</span></div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;              <span class="keywordflow">if</span>(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; 0 &amp;&amp; considering[1].col() &gt; 0 &amp;&amp; considering[2].col() &gt; 0) {</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;                IdColInfo1.push_back(-1); <span class="comment">// antijunction tag(-1)</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;                IdColInfo2.push_back(-1); <span class="comment">// means anticolor tag(negative color charge)</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;                IdColInfo2.push_back(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());<span class="comment">// {-1, anticolor tag} will be at 2nd, 3rd, 4th</span></div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;                IdColInfo3.push_back(-1);</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;                IdColInfo3.push_back(considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;                IdColInfo4.push_back(-1);</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;                IdColInfo4.push_back(considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;                IdColInfo1.clear();</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;                <span class="comment">//Since Baryon is formed, color tag for neutrality should be added, casting int into double is needed!!(ex (double) intvalue</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;                <span class="keywordtype">int</span> coltag1 = considering[0].col();</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;                <span class="keywordtype">int</span> coltag2 = considering[1].col();</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;                <span class="keywordtype">int</span> coltag3 = considering[2].col();</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;                <span class="keywordflow">if</span>(coltag1 &gt; 0 &amp;&amp; coltag2 &gt; 0 &amp;&amp; coltag3 &gt; 0 &amp;&amp; coltag1 &lt;= limit &amp;&amp; coltag2 &lt;= limit &amp;&amp; coltag3 &lt;= limit ){</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;                  <span class="keywordtype">double</span> tag1 = (<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>)coltag1;  <span class="comment">// they are casted to be inserted into the matrix(since it&#39;s vector of double</span></div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;                  <span class="keywordtype">double</span> tag2 = (<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>)coltag2;</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;                  <span class="keywordtype">double</span> tag3 = (<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>)coltag3;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;                  std::vector&lt;int&gt;::iterator I1 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), coltag1);</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;                  std::vector&lt;int&gt;::iterator I2 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), coltag2);</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;                  std::vector&lt;int&gt;::iterator I3 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), coltag3);</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;                  <span class="keywordtype">int</span> loc1 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I1);</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;                  <span class="keywordtype">int</span> loc2 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I2);</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;                  <span class="keywordtype">int</span> loc3 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I3); <span class="comment">//set up for find matrix indices corresponding to the color tags (we just found the corresponding indice in BaryonrecoMatrix1 with col tags )</span></div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;                  BaryonrecoMatrix1.at(loc1).at(loc2).at(1) = tag3;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;                  BaryonrecoMatrix1.at(loc2).at(loc1).at(1) = tag3;</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;                  BaryonrecoMatrix1.at(loc2).at(loc3).at(1) = tag1;</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;                  BaryonrecoMatrix1.at(loc3).at(loc2).at(1) = tag1;</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;                  BaryonrecoMatrix1.at(loc1).at(loc3).at(1) = tag2;</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;                  BaryonrecoMatrix1.at(loc3).at(loc1).at(1) = tag2; <span class="comment">// now the color tag info for color neutrality is saved in Matrix, also we need to consider the impact from this to Meson Formation</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;                  <span class="comment">//MesonrecoMatrix1 is modified by below</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;                  MesonrecoMatrix1.at(loc1).at(loc2) = 0;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;                  MesonrecoMatrix1.at(loc2).at(loc1) = 0;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;                  MesonrecoMatrix1.at(loc2).at(loc3) = 0;</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;                  MesonrecoMatrix1.at(loc3).at(loc2) = 0;</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;                  MesonrecoMatrix1.at(loc1).at(loc3) = 0;</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;                  MesonrecoMatrix1.at(loc3).at(loc1) = 0; <span class="comment">// since three color tags of baryon are different from each other, so that these tags can&#39;t form meson with each other.</span></div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;                }</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;                <span class="comment">/*</span></div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;<span class="comment">                //dignostic measure</span></div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;<span class="comment">                std::cout &lt;&lt;endl&lt;&lt;&quot;Meson reco Matrix revised by Baryon formation is same as below&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;<span class="comment">                for(int irow=0; irow &lt; IndiceForColFin.size(); irow++){</span></div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;<span class="comment">                  for(int icol=0; icol &lt; IndiceForColFin.size(); icol++){</span></div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;<span class="comment">                    std::cout &lt;&lt;&quot;  &quot;&lt;&lt;MesonrecoMatrix1.at(irow).at(icol)&lt;&lt;&quot;  &quot;;</span></div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;<span class="comment">                  }</span></div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="comment">                  std::cout &lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<span class="comment">                //dignostic measure</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;<span class="comment">                std::cout &lt;&lt;endl&lt;&lt;&quot;Revised Baryon reco Matrix is same as below&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;<span class="comment">                for(int irow=0; irow &lt; IndiceForColFin.size(); irow++){</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;<span class="comment">                  for(int icol=0; icol &lt; IndiceForColFin.size(); icol++){</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;<span class="comment">                    std::cout &lt;&lt;&quot;  ( &quot;&lt;&lt;BaryonrecoMatrix1.at(irow).at(icol).at(1)&lt;&lt;&quot; )  &quot;;</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;<span class="comment">                  }</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;<span class="comment">                  std::cout &lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;<span class="comment">                */</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;              }</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;              <span class="keywordflow">if</span>(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; 0 &amp;&amp; considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0 &amp;&amp; considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; 0){ <span class="comment">// MAT + Therm/LBT + MAT case</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                IdColInfo1.push_back(-1); <span class="comment">// antijunction tag(-1)</span></div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;                <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(considering[1], perm2[q2], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;                <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[1]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(maxtag);</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;                }</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc &gt; 0){showerquarks[loc - 1].acol(maxtag); }</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){HH_thermal[-loc - 1].acol(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                <span class="comment">//TODO: give thermal partons &quot;ANTI COLOR TAGS&quot; to form anti junction and conserve baryon number.</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;                IdColInfo2.push_back(-1); <span class="comment">// means anticolor tag(negative color charge)</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;                IdColInfo2.push_back(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());<span class="comment">// {-1, anticolor tag} will be at 2nd, 3rd, 4th</span></div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;                IdColInfo3.push_back(-1);</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;                IdColInfo3.push_back(maxtag);</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                IdColInfo4.push_back(-1);</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;                IdColInfo4.push_back(considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;                IdColInfo1.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;              }</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;              <span class="keywordflow">if</span>(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0 &amp;&amp; considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; 0 &amp;&amp; considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; 0){ <span class="comment">// LBT + MAT + MAT case</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;                IdColInfo1.push_back(-1); <span class="comment">// antijunction tag(-1)</span></div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;                <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(considering[0], element[0] + 1, <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;                <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[0]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(maxtag);</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;                }</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc &gt; 0){showerquarks[loc - 1].acol(maxtag); }</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){HH_thermal[-loc - 1].acol(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;                IdColInfo2.push_back(-1); <span class="comment">// means anticolor tag(negative color charge)</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;                IdColInfo2.push_back(maxtag);<span class="comment">// {-1, anticolor tag} will be at 2nd, 3rd, 4th</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;                IdColInfo3.push_back(-1);</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;                IdColInfo3.push_back(considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                IdColInfo4.push_back(-1);</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                IdColInfo4.push_back(considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                IdColInfo1.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;              }</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;              <span class="keywordflow">if</span>(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; 0 &amp;&amp; considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; 0 &amp;&amp; considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0){ <span class="comment">// MAT + MAT + Therm/LBT case</span></div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;                IdColInfo1.push_back(-1); <span class="comment">// antijunction tag(-1)</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;                <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(considering[2], perm2[q3], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;                <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[1]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(maxtag);</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;                }</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc &gt; 0){showerquarks[loc - 1].acol(maxtag); }</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){HH_thermal[-loc - 1].acol(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;                IdColInfo2.push_back(-1); <span class="comment">// means anticolor tag(negative color charge)</span></div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;                IdColInfo2.push_back(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());<span class="comment">// {-1, anticolor tag} will be at 2nd, 3rd, 4th</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;                IdColInfo3.push_back(-1);</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                IdColInfo3.push_back(considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                IdColInfo4.push_back(-1);</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                IdColInfo4.push_back(maxtag);</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;                IdColInfo1.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;              } <span class="comment">// so far, we are finished with the list with one zero component.</span></div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;              <span class="keywordflow">if</span>(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; 0 &amp;&amp; considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0 &amp;&amp; considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0){ <span class="comment">// MAT + Therm/LBT + Therm/LBT case</span></div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                IdColInfo1.push_back(-1); <span class="comment">// antijunction tag(-1)</span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                IdColInfo2.push_back(-1); <span class="comment">// means anticolor tag(negative color charge)</span></div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                IdColInfo2.push_back(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());<span class="comment">// {-1, anticolor tag} will be at 2nd, 3rd, 4th</span></div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;                <span class="keywordtype">int</span> loc1 = findcloserepl(considering[1], perm2[q2], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;                <span class="keywordflow">if</span>(loc1 == 999999999){</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[1]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(maxtag);</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;                }</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc1 &gt; 0){showerquarks[loc1 - 1].acol(maxtag); }</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc1 &lt; 0){HH_thermal[-loc1 - 1].acol(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;                IdColInfo3.push_back(-1);</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;                IdColInfo3.push_back(maxtag);</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;                <span class="keywordtype">int</span> loc2 = findcloserepl(considering[2], perm2[q3], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                <span class="keywordflow">if</span>(loc2 == 999999999){</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[1]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(maxtag);</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                }</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc2 &gt; 0){showerquarks[loc2 - 1].acol(maxtag); }</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc2 &lt; 0){HH_thermal[-loc2 - 1].acol(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                IdColInfo4.push_back(-1);</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                IdColInfo4.push_back(maxtag);</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                <span class="comment">//TODO: give thermal partons &quot;ANTI COLOR TAGS&quot; to form anti junction and conserve baryon number.</span></div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;                IdColInfo1.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;              }</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;              <span class="keywordflow">if</span>(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0 &amp;&amp; considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0 &amp;&amp; considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; 0){ <span class="comment">// Therm/LBT + Therm/LBT + MAT case</span></div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;                IdColInfo1.push_back(-1); <span class="comment">// antijunction tag(-1)</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;                <span class="keywordtype">int</span> loc1 = findcloserepl(considering[0], element[0] + 1, <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;                <span class="keywordflow">if</span>(loc1 == 999999999){</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[0]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(maxtag);</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;                }</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc1 &gt; 0){showerquarks[loc1 - 1].acol(maxtag); }</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc1 &lt; 0){HH_thermal[-loc1 - 1].acol(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;                IdColInfo3.push_back(-1);</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;                IdColInfo3.push_back(maxtag);</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;                <span class="keywordtype">int</span> loc2 = findcloserepl(considering[1], perm2[q2], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;                <span class="keywordflow">if</span>(loc2 == 999999999){</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[1]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(maxtag);</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;                }</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc2 &gt; 0){showerquarks[loc2 - 1].acol(maxtag); }</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc2 &lt; 0){HH_thermal[-loc2 - 1].acol(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;                IdColInfo4.push_back(-1);</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;                IdColInfo4.push_back(maxtag);</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;                <span class="comment">//TODO: give thermal partons &quot;ANTI COLOR TAGS&quot; to form anti junction and conserve baryon number.</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;                IdColInfo2.push_back(-1); <span class="comment">// means anticolor tag(negative color charge)</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;                IdColInfo2.push_back(considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());<span class="comment">// {-1, anticolor tag} will be at 2nd, 3rd, 4th</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;                IdColInfo1.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;              }</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;              <span class="keywordflow">if</span>(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0 &amp;&amp; considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; 0 &amp;&amp; considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0){ <span class="comment">// Therm/LBT + Therm/LBT + MAT case</span></div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;                IdColInfo1.push_back(-1); <span class="comment">// antijunction tag(-1)</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;                <span class="keywordtype">int</span> loc1 = findcloserepl(considering[0], element[0] + 1, <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;                <span class="keywordflow">if</span>(loc1 == 999999999){</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[0]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(maxtag);</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;                }</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc1 &gt; 0){showerquarks[loc1 - 1].acol(maxtag); }</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc1 &lt; 0){HH_thermal[-loc1 - 1].acol(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;                IdColInfo2.push_back(-1);</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;                IdColInfo2.push_back(maxtag);</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;                IdColInfo3.push_back(-1); <span class="comment">// means anticolor tag(negative color charge)</span></div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;                IdColInfo3.push_back(considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());<span class="comment">// {-1, anticolor tag} will be at 2nd, 3rd, 4th</span></div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;                <span class="keywordtype">int</span> loc2 = findcloserepl(considering[2], perm2[q3], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;                <span class="keywordflow">if</span>(loc2 == 999999999){</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[2]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(maxtag);</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;                }</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc2 &gt; 0){showerquarks[loc2 - 1].acol(maxtag); }</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc2 &lt; 0){HH_thermal[-loc2 - 1].acol(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;                IdColInfo4.push_back(-1);</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;                IdColInfo4.push_back(maxtag);</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;                IdColInfo1.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;              } <span class="comment">// so far, we are finished with the list with two zeros</span></div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;              <span class="keywordflow">if</span>(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0 &amp;&amp; considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0 &amp;&amp; considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0){ <span class="comment">// Therm/LBT + Therm/LBT + Therm/LBT</span></div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                IdColInfo1.push_back(-1); <span class="comment">// antijunction tag(-1)</span></div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                <span class="keywordtype">int</span> loc1 = findcloserepl(considering[0], element[0] + 1, <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                <span class="keywordflow">if</span>(loc1 == 999999999){</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[0]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(maxtag);</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;                }</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc1 &gt; 0){showerquarks[loc1 - 1].acol(maxtag); }</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc1 &lt; 0){HH_thermal[-loc1 - 1].acol(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                IdColInfo2.push_back(-1);</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;                IdColInfo2.push_back(maxtag);</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;                <span class="keywordtype">int</span> loc2 = findcloserepl(considering[1], perm2[q2], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;                <span class="keywordflow">if</span>(loc2 == 999999999){</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[1]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(maxtag);</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;                }</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc2 &gt; 0){showerquarks[loc2 - 1].acol(maxtag); }</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc2 &lt; 0){HH_thermal[-loc2 - 1].acol(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                IdColInfo3.push_back(-1);</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                IdColInfo3.push_back(maxtag);</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                <span class="keywordtype">int</span> loc3 = findcloserepl(considering[2], perm2[q3], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                <span class="keywordflow">if</span>(loc3 == 999999999){</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[2]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(maxtag);</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;                }</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc3 &gt; 0){showerquarks[loc3 - 1].acol(maxtag); }</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc3 &lt; 0){HH_thermal[-loc3 - 1].acol(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;                IdColInfo4.push_back(-1);</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;                IdColInfo4.push_back(maxtag);</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;                <span class="comment">//TODO: give thermal partons &quot;ANTI COLOR TAGS&quot; to form anti junction and conserve baryon number.</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;                IdColInfo1.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;              } <span class="comment">// so far, we are finished with the list with three zeros</span></div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;            }</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(considering[0].<span class="keywordtype">id</span>() * considering[1].<span class="keywordtype">id</span>() * considering[2].<span class="keywordtype">id</span>() &lt; 0){ <span class="comment">//anti baryon would be made so temporary junction is defined</span></div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;              <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Anti Baryon is made from &quot;&lt;&lt;&quot; ( &quot;&lt;&lt;considering[0].acol()&lt;&lt;&quot; , &quot;&lt;&lt;considering[1].acol()&lt;&lt;&quot; , &quot;&lt;&lt;considering[2].acol()&lt;&lt;&quot; ) &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;              <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Anti Baryon is made from &quot;&lt;&lt;&quot; ( &quot;&lt;&lt;HH_showerptns[showerquarks[element[0]].par()].acol()&lt;&lt;&quot; , &quot;&lt;&lt;HH_showerptns[showerquarks[element[1]].par()].acol()&lt;&lt;&quot; , &quot;&lt;&lt;HH_showerptns[showerquarks[element[2]].par()].acol()&lt;&lt;&quot; ) &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;              <span class="keywordflow">if</span>(considering[0].acol() &gt; 0 &amp;&amp; considering[1].acol() &gt; 0 &amp;&amp; considering[2].acol() &gt; 0){</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;                IdColInfo1.push_back(1); <span class="comment">// junction tag(1)</span></div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton); <span class="comment">// zero(just room for the other usage)   : {1, 0} at 1st</span></div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;                IdColInfo2.push_back(1); <span class="comment">// means color tag(positive color charge)   : { 1, color tag } at 2nd, 3rd, 4th in the vector</span></div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;                IdColInfo2.push_back(considering[0].acol());</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;                IdColInfo3.push_back(1);</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;                IdColInfo3.push_back(considering[1].acol());</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;                IdColInfo4.push_back(1);</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;                IdColInfo4.push_back(considering[2].acol());</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;                IdColInfo1.clear();</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;                <span class="comment">//Since Baryon is formed, color tag for neutrality should be added, casting int into double is needed!!(ex (double) intvalue</span></div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;                <span class="keywordtype">int</span> coltag1 = considering[0].acol();</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;                <span class="keywordtype">int</span> coltag2 = considering[1].acol();</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;                <span class="keywordtype">int</span> coltag3 = considering[2].acol();</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;                <span class="keywordflow">if</span>(coltag1 &gt; 0 &amp;&amp; coltag2 &gt; 0 &amp;&amp; coltag3 &gt; 0 &amp;&amp; coltag1 &lt;= limit  &amp;&amp; coltag2 &lt;= limit  &amp;&amp; coltag3 &lt;= limit ){</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;                  <span class="keywordtype">double</span> tag1 = (<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>)coltag1;  <span class="comment">// they are casted to be inserted into the matrix(since it&#39;s vector of double</span></div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;                  <span class="keywordtype">double</span> tag2 = (<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>)coltag2;</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;                  <span class="keywordtype">double</span> tag3 = (<a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>)coltag3;</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;                  std::vector&lt;int&gt;::iterator I1 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), coltag1);</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;                  std::vector&lt;int&gt;::iterator I2 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), coltag2);</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;                  std::vector&lt;int&gt;::iterator I3 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), coltag3);</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;                  <span class="keywordtype">int</span> loc1 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I1);</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;                  <span class="keywordtype">int</span> loc2 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I2);</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;                  <span class="keywordtype">int</span> loc3 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I3); <span class="comment">//set up for find matrix indices corresponding to the color tags (we just found the corresponding indice in BaryonrecoMatrix1 with col tags )</span></div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;                  BaryonrecoMatrix1.at(loc1).at(loc2).at(1) = tag3;</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;                  BaryonrecoMatrix1.at(loc2).at(loc1).at(1) = tag3;</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;                  BaryonrecoMatrix1.at(loc2).at(loc3).at(1) = tag1;</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;                  BaryonrecoMatrix1.at(loc3).at(loc2).at(1) = tag1;</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;                  BaryonrecoMatrix1.at(loc1).at(loc3).at(1) = tag2;</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;                  BaryonrecoMatrix1.at(loc3).at(loc1).at(1) = tag2; <span class="comment">// now the color tag info for color neutrality is saved in Matrix, also we need to consider the impact from this to Meson Formation</span></div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;                  <span class="comment">//MesonrecoMatrix1 is modified by below</span></div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;                  MesonrecoMatrix1.at(loc1).at(loc2) = 0;</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;                  MesonrecoMatrix1.at(loc2).at(loc1) = 0;</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;                  MesonrecoMatrix1.at(loc2).at(loc3) = 0;</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;                  MesonrecoMatrix1.at(loc3).at(loc2) = 0;</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;                  MesonrecoMatrix1.at(loc1).at(loc3) = 0;</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;                  MesonrecoMatrix1.at(loc3).at(loc1) = 0; <span class="comment">// since three color tags of baryon are different from each other, so that these tags can&#39;t form meson with each other.</span></div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;                }</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;              }</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;              <span class="keywordflow">if</span>(considering[0].acol() &gt; 0 &amp;&amp; considering[1].acol() == 0 &amp;&amp; considering[2].acol() &gt; 0){ <span class="comment">// MAT + Therm/LBT + MAT case</span></div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;                IdColInfo1.push_back(1); <span class="comment">// junction tag(1)</span></div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;                <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(considering[1], perm2[q2], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;                <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[1]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(maxtag);</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;                }</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc &gt; 0){showerquarks[loc - 1].col(maxtag); }</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){HH_thermal[-loc - 1].col(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;                IdColInfo2.push_back(1); <span class="comment">// color tag</span></div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;                IdColInfo2.push_back(considering[0].acol());<span class="comment">// {1, color tag} will be at 2nd, 3rd, 4th</span></div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;                IdColInfo3.push_back(1);</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;                IdColInfo3.push_back(maxtag);</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;                IdColInfo4.push_back(1);</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;                IdColInfo4.push_back(considering[2].acol());</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;                IdColInfo1.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;              }</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;              <span class="keywordflow">if</span>(considering[0].acol() == 0 &amp;&amp; considering[1].acol() &gt; 0 &amp;&amp; considering[2].acol() &gt; 0){ <span class="comment">// LBT + MAT + MAT case</span></div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;                IdColInfo1.push_back(1); <span class="comment">// junction tag(1)</span></div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;                <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(considering[0], element[0] + 1, <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;                <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[0]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(maxtag);</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;                }</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc &gt; 0){showerquarks[loc - 1].col(maxtag); }</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){HH_thermal[-loc - 1].col(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;                IdColInfo2.push_back(1); <span class="comment">// means color tag</span></div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;                IdColInfo2.push_back(maxtag);<span class="comment">// {1, color tag} will be at 2nd, 3rd, 4th</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;                IdColInfo3.push_back(1);</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;                IdColInfo3.push_back(considering[1].acol());</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;                IdColInfo4.push_back(1);</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;                IdColInfo4.push_back(considering[2].acol());</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;                IdColInfo1.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;              }</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;              <span class="keywordflow">if</span>(considering[0].acol() &gt; 0 &amp;&amp; considering[1].acol() &gt; 0 &amp;&amp; considering[2].acol() == 0){ <span class="comment">// MAT + MAT + Therm/LBT case</span></div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;                IdColInfo1.push_back(1); <span class="comment">// junction tag(1)</span></div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;                <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(considering[2], perm2[q3], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;                <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[2]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(maxtag);</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;                }</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc &gt; 0){showerquarks[loc - 1].col(maxtag); }</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){HH_thermal[-loc - 1].col(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;                IdColInfo2.push_back(1); <span class="comment">// means color tag</span></div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                IdColInfo2.push_back(considering[0].acol());<span class="comment">// {1, color tag} will be at 2nd, 3rd, 4th</span></div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;                IdColInfo3.push_back(1);</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;                IdColInfo3.push_back(considering[1].acol());</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;                IdColInfo4.push_back(1);</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;                IdColInfo4.push_back(maxtag);</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;                IdColInfo1.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;              } <span class="comment">// so far, we are finished with the list with one zero component.</span></div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;              <span class="keywordflow">if</span>(considering[0].acol() &gt; 0 &amp;&amp; considering[1].acol() == 0 &amp;&amp; considering[2].acol() == 0){ <span class="comment">// MAT + Therm/LBT + Therm/LBT case</span></div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;                IdColInfo1.push_back(1); <span class="comment">// junction tag(1)</span></div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;                IdColInfo2.push_back(1); <span class="comment">// means color tag</span></div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;                IdColInfo2.push_back(considering[0].acol());<span class="comment">// {1, color tag} will be at 2nd, 3rd, 4th</span></div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;                <span class="keywordtype">int</span> loc1 = findcloserepl(considering[1], perm2[q2], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;                <span class="keywordflow">if</span>(loc1 == 999999999){</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[1]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(maxtag);</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;                }</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc1 &gt; 0){showerquarks[loc1 - 1].col(maxtag); }</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc1 &lt; 0){HH_thermal[-loc1 - 1].col(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;                IdColInfo3.push_back(1);</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;                IdColInfo3.push_back(maxtag);</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;                <span class="keywordtype">int</span> loc2 = findcloserepl(considering[2], perm2[q3], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;                <span class="keywordflow">if</span>(loc2 == 999999999){</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[2]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(maxtag);</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;                }</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc2 &gt; 0){showerquarks[loc2 - 1].col(maxtag); }</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc2 &lt; 0){HH_thermal[-loc2 - 1].col(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;                IdColInfo4.push_back(1);</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;                IdColInfo4.push_back(maxtag);</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;                <span class="comment">//TODO: give thermal partons &quot;ANTI COLOR TAGS&quot; to form anti junction and conserve baryon number.</span></div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;                IdColInfo1.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;              }</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;              <span class="keywordflow">if</span>(considering[0].acol() == 0 &amp;&amp; considering[1].acol() == 0 &amp;&amp; considering[2].acol() &gt; 0){ <span class="comment">// Therm/LBT + Therm/LBT + MAT case</span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;                IdColInfo1.push_back(1); <span class="comment">// junction tag(1)</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;                <span class="keywordtype">int</span> loc1 = findcloserepl(considering[0], element[0] + 1, <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;                <span class="keywordflow">if</span>(loc1 == 999999999){</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[0]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(maxtag);</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;                }</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc1 &gt; 0){showerquarks[loc1 - 1].col(maxtag); }</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc1 &lt; 0){HH_thermal[-loc1 - 1].col(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;                IdColInfo2.push_back(1);</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;                IdColInfo2.push_back(maxtag);</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;                <span class="keywordtype">int</span> loc2 = findcloserepl(considering[1], perm2[q2], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;                <span class="keywordflow">if</span>(loc2 == 999999999){</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[1]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(maxtag);</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;                }</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc2 &gt; 0){showerquarks[loc2 - 1].col(maxtag); }</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc2 &lt; 0){HH_thermal[-loc2 - 1].col(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;                IdColInfo3.push_back(1);</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;                IdColInfo3.push_back(maxtag);</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;                IdColInfo4.push_back(1); <span class="comment">// means color tag</span></div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;                IdColInfo4.push_back(considering[2].acol());<span class="comment">// {1, color tag} will be at 2nd, 3rd, 4th</span></div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;                IdColInfo1.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;              }</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;              <span class="keywordflow">if</span>(considering[0].acol() == 0 &amp;&amp; considering[1].acol() &gt; 0 &amp;&amp; considering[2].acol() == 0){ <span class="comment">// Therm/LBT + Therm/LBT + MAT case</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;                IdColInfo1.push_back(1); <span class="comment">// junction tag(1)</span></div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;                <span class="keywordtype">int</span> loc1 = findcloserepl(considering[0], element[0] + 1, <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;                <span class="keywordflow">if</span>(loc1 == 999999999){</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[0]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(maxtag);</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;                }</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc1 &gt; 0){showerquarks[loc1 - 1].col(maxtag); }</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc1 &lt; 0){HH_thermal[-loc1 - 1].col(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;                IdColInfo2.push_back(1);</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;                IdColInfo2.push_back(maxtag);</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;                IdColInfo3.push_back(1); <span class="comment">// means color tag</span></div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;                IdColInfo3.push_back(considering[1].acol());<span class="comment">// {1, color tag} will be at 2nd, 3rd, 4th</span></div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;                <span class="keywordtype">int</span> loc2 = findcloserepl(considering[2], perm2[q3], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;                <span class="keywordflow">if</span>(loc2 == 999999999){</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[2]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(maxtag);</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;                }</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc2 &gt; 0){showerquarks[loc2 - 1].col(maxtag); }</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc2 &lt; 0){HH_thermal[-loc2 - 1].col(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;                IdColInfo4.push_back(1);</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;                IdColInfo4.push_back(maxtag);</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;                IdColInfo1.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;              } <span class="comment">// so far, we are finished with the list with two zeros</span></div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;              <span class="keywordflow">if</span>(considering[0].acol() == 0 &amp;&amp; considering[1].acol() == 0 &amp;&amp; considering[2].acol() == 0){ <span class="comment">// Therm/LBT + Therm/LBT + Therm/LBT</span></div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;                IdColInfo1.push_back(1); <span class="comment">// junction tag(1)</span></div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;                <span class="keywordtype">int</span> loc1 = findcloserepl(considering[0], element[0] + 1, <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;                <span class="keywordflow">if</span>(loc1 == 999999999){</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[0]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(maxtag);</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;                }</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc1 &gt; 0){showerquarks[loc1 - 1].col(maxtag); }</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc1 &lt; 0){HH_thermal[-loc1 - 1].col(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;                IdColInfo2.push_back(1);</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;                IdColInfo2.push_back(maxtag);</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;                <span class="keywordtype">int</span> loc2 = findcloserepl(considering[1], perm2[q2], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;                <span class="keywordflow">if</span>(loc2 == 999999999){</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[1]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(maxtag);</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;                }</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc2 &gt; 0){showerquarks[loc2 - 1].col(maxtag); }</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc2 &lt; 0){HH_thermal[-loc2 - 1].col(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;                IdColInfo3.push_back(1);</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;                IdColInfo3.push_back(maxtag);</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;                maxtag++;</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;                <span class="keywordtype">int</span> loc3 = findcloserepl(considering[2], perm2[q3], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;                <span class="keywordflow">if</span>(loc3 == 999999999){</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;                  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;                  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[2]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(maxtag);</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;                  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;                  Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;                  junction_with_thermal_parton = 1;</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;                  <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;                }</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc3 &gt; 0){showerquarks[loc3 - 1].col(maxtag); }</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc3 &lt; 0){HH_thermal[-loc3 - 1].col(maxtag); junction_with_thermal_parton = 1;}</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;                IdColInfo1.push_back(junction_with_thermal_parton);</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;                IdColInfo4.push_back(1);</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;                IdColInfo4.push_back(maxtag);</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;                JunctionInfo.push_back(IdColInfo1);</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;                JunctionInfo.push_back(IdColInfo2);</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;                JunctionInfo.push_back(IdColInfo3);</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;                JunctionInfo.push_back(IdColInfo4);</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;                Tempjunctions.push_back(JunctionInfo); <span class="comment">// information of tempjunction is saved so et clear subordinate vector for next entry</span></div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;                IdColInfo1.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;                IdColInfo2.clear();</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;                IdColInfo3.clear();</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;                IdColInfo4.clear();</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;                JunctionInfo.clear();</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;              } <span class="comment">// so far, we are finished with the list with three zeros</span></div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;               <span class="comment">//dignostic measure</span></div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;               <span class="comment">/*</span></div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;<span class="comment">               std::cout &lt;&lt;endl&lt;&lt;&quot;Meson reco Matrix revised by Baryon formation is same as below&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;<span class="comment">               for(int irow=0; irow &lt; IndiceForColFin.size(); irow++){</span></div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;<span class="comment">                   for(int icol=0; icol &lt; IndiceForColFin.size(); icol++){</span></div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;<span class="comment">                   std::cout &lt;&lt;&quot;  &quot;&lt;&lt;MesonrecoMatrix1.at(irow).at(icol)&lt;&lt;&quot;  &quot;;</span></div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;<span class="comment">                   }</span></div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;<span class="comment">               std::cout &lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;<span class="comment">               }</span></div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;<span class="comment">               */</span></div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;            }</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;                                        <span class="comment">//now we&#39;re forming the hadron</span></div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;                                        <a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html">HHhadron</a> formedhadron;</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;                                        <span class="comment">//setting the hadron values: is a recombined hadron, mass, and parents</span></div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;                                        formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a27dd6d3a82b77f211b08aef3f4641664">is_recohad</a>(<span class="keyword">true</span>); formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a048b35ba82d82b0c177b0968485bab3d">mass</a>( p_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>() + p_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>() + p_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>() );</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;                                        formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a471e031c8b1ed05e94a7ab075fdb4914">add_par</a>(showerquarks[element[0]].par());</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;                                        <span class="keywordflow">if</span>(perm2[q2]&gt;0){formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a471e031c8b1ed05e94a7ab075fdb4914">add_par</a>(showerquarks[element[1]].par());}<span class="keywordflow">else</span>{formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a471e031c8b1ed05e94a7ab075fdb4914">add_par</a>(element[1]);}</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;                                        <span class="keywordflow">if</span>(perm2[q3]&gt;0){formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a471e031c8b1ed05e94a7ab075fdb4914">add_par</a>(showerquarks[element[2]].par());}<span class="keywordflow">else</span>{formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a471e031c8b1ed05e94a7ab075fdb4914">add_par</a>(element[2]);}</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;                                        <span class="comment">//now setting if baryon is in excited state</span></div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;                                        <span class="keywordflow">if</span>(WigB[0]*recofactor3*mult &lt; rndbaryon){formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a224a14dbde7e93adfb3b0a303caa769a">is_excited</a>(<span class="keyword">true</span>);}</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;                                        <span class="comment">//setting if there are any thermal partons used to make the hadron (with the &#39;0&#39; thermal parent as -99999 so that it doesn&#39;t conflict with &#39;0&#39; shower parton)</span></div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;                                        <span class="keywordflow">if</span>(     perm2[q2]&gt;0 &amp;&amp; perm2[q3]&gt;0){<span class="comment">/*is sh-sh-sh*/</span> formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#aa981caef15a8cd147cf647c694c697d8">is_shsh</a>(<span class="keyword">true</span>);}</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(perm2[q2]&gt;0 &amp;&amp; perm2[q3]&lt;0){<span class="comment">/*is sh-sh-th*/</span> formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a6c7732b018f159825e653edad26d8774">is_shth</a>(<span class="keyword">true</span>); <span class="keywordflow">if</span>(element[2] == 0){formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a4fc831bb545765bba32d2558e1931bfb">parents</a>[2] = -99999;}}</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(perm2[q2]&lt;0 &amp;&amp; perm2[q3]&gt;0){<span class="comment">/*is sh-th-sh*/</span> formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a6c7732b018f159825e653edad26d8774">is_shth</a>(<span class="keyword">true</span>); <span class="keywordflow">if</span>(element[1] == 0){formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a4fc831bb545765bba32d2558e1931bfb">parents</a>[1] = -99999;}}</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(perm2[q2]&lt;0 &amp;&amp; perm2[q3]&lt;0){<span class="comment">/*is sh-th-th*/</span> formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a6c7732b018f159825e653edad26d8774">is_shth</a>(<span class="keyword">true</span>); <span class="keywordflow">if</span>(element[1] == 0){formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a4fc831bb545765bba32d2558e1931bfb">parents</a>[1] = -99999;}</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;                                                                                                                              <span class="keywordflow">if</span>(element[2] == 0){formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a4fc831bb545765bba32d2558e1931bfb">parents</a>[2] = -99999;}</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;                                        }</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;                                        <span class="comment">//setting hadron position and momentum vectors</span></div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;                                        Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),sqrt(Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>() + Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>() + Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>() + formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a048b35ba82d82b0c177b0968485bab3d">mass</a>()*formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a048b35ba82d82b0c177b0968485bab3d">mass</a>()));</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;                                        formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a7ce336bb518c8fe59fe9bc044d9f0ca6">pos</a>(pos_lab); formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a14ac05d5f4db7a690b834078050e695f">P</a>(Pbaryon);</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;                                        <span class="comment">//setting hadron color tags (for tracing colors of the constituent partons) [**]</span></div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;                                        <span class="comment">//will need to update to reflect color tags given to random (thermal/lbt) partons</span></div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;                                        formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a83abda8c8e59cb3ee02dd0d50a76b85a">add_col</a>((considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>()&gt;0)?considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>():considering[0].acol());</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;                                        formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a83abda8c8e59cb3ee02dd0d50a76b85a">add_col</a>((considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>()&gt;0)?considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>():considering[1].acol());</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;                                        formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a83abda8c8e59cb3ee02dd0d50a76b85a">add_col</a>((considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>()&gt;0)?considering[2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>():considering[2].acol());</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;                                        <span class="comment">//need to choose *what* hadron we&#39;ve formed... base this on the parton id&#39;s, mass, &amp; if excited</span></div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;                                        <span class="comment">//might want to do this differently? void f&#39;n(partoncollection, formedhadron)?</span></div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;                                        set_baryon_id(considering, formedhadron);</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;                                        <span class="comment">//need to add the hadron to the collection</span></div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;                                        HH_hadrons.add(formedhadron);</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;                                        <span class="comment">//now that we&#39;ve formed the hadron, need to set ALL (3) the &#39;considering&#39; flags to used</span></div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;                                                        showerquarks[element[0]].status(1); showerquarks[element[0]].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;                                        <span class="keywordflow">if</span>(perm2[q2]&gt;0){showerquarks[element[1]].status(1); showerquarks[element[1]].is_used(<span class="keyword">true</span>);}</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;                                        <span class="keywordflow">else</span>{            HH_thermal[-element[1]].status(1);  HH_thermal[-element[1]].is_used(<span class="keyword">true</span>);}</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;                                        <span class="keywordflow">if</span>(perm2[q3]&gt;0){showerquarks[element[2]].status(1); showerquarks[element[2]].is_used(<span class="keyword">true</span>);}</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;                                        <span class="keywordflow">else</span>{            HH_thermal[-element[2]].status(1);  HH_thermal[-element[2]].is_used(<span class="keyword">true</span>);}</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;                                        madehadron = <span class="keyword">true</span>; considering.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;                                  }</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;                                  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;                                        <span class="comment">//since we&#39;ve not formed a baryon on this try, need to revert the third quark &#39;considering&#39; used flag</span></div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;                                        <span class="keywordflow">if</span>(perm2[q3]&gt;0){showerquarks[element[2]].status(0);}</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;                                        <span class="keywordflow">else</span>{            HH_thermal[-element[2]].status(0);}</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;                                        <span class="comment">//and remove the third entry in considering</span></div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;                                        considering.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#ae0b1b71d70ad94567da60ab34fd2b10d">partons</a>.pop_back();</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;                                  }</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;                          }</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(considering[0].<span class="keywordtype">id</span>()*considering[1].<span class="keywordtype">id</span>() &lt; 0){</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;        <span class="comment">//Key point is determing recofactor2</span></div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;        <span class="keywordflow">if</span>(considering[0].<span class="keywordtype">id</span>() &gt; 0 &amp;&amp; considering[1].<span class="keywordtype">id</span>() &lt; 0){</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;          <span class="keywordtype">int</span> tag0 = considering[0].col();</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;          <span class="keywordtype">int</span> tag1 = considering[1].acol();</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;          <span class="keywordflow">if</span>(tag0 &gt; 0 &amp;&amp; tag1 &gt; 0 &amp;&amp; tag0 &lt;= limit  &amp;&amp; tag1 &lt;= limit ){</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;            std::vector&lt;int&gt;::iterator L1 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), tag0);</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;            std::vector&lt;int&gt;::iterator L2 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), tag1);</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;            <span class="keywordtype">int</span> indexMatrix1 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), L1);</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;            <span class="keywordtype">int</span> indexMatrix2 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), L2);</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;            recofactor2 = (MesonrecoMatrix1.at(indexMatrix1).at(indexMatrix2));</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;            <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; the recofactor for meson is &quot;&lt;&lt;(MesonrecoMatrix1.at(indexMatrix1).at(indexMatrix2))&lt;&lt;endl;</span></div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;          }</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;          <span class="keywordflow">else</span>{recofactor2 = 1./9.;}</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;        }</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(considering[1].<span class="keywordtype">id</span>() &gt; 0 &amp;&amp; considering[0].id() &lt; 0){</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;          <span class="keywordtype">int</span> tag0 = considering[1].col();</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;          <span class="keywordtype">int</span> tag1 = considering[0].acol();</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;          <span class="keywordflow">if</span>(tag0 &gt; 0 &amp;&amp; tag1 &gt; 0 &amp;&amp; tag0 &lt;= limit &amp;&amp; tag1 &lt;= limit){</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;            std::vector&lt;int&gt;::iterator L1 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), tag0);</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;            std::vector&lt;int&gt;::iterator L2 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), tag1);</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;            <span class="keywordtype">int</span> indexMatrix1 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), L1);</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;            <span class="keywordtype">int</span> indexMatrix2 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), L2);</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;            recofactor2 = (MesonrecoMatrix1.at(indexMatrix1).at(indexMatrix2));</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;          }</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;          <span class="keywordflow">else</span>{recofactor2 = 1./9.;}</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;          <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; the recofactor for meson is &quot;&lt;&lt;(MesonrecoMatrix1.at(indexMatrix1).at(indexMatrix2))&lt;&lt;endl;</span></div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;        }</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;                                <span class="comment">//now that we *could* form a meson, now we check if we actually do form one</span></div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;                                <span class="comment">//meson momentum</span></div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;                                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> Pmeson;</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;                                Pmeson.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(considering[0].px()+considering[1].px(),considering[0].py()+considering[1].py(),considering[0].pz()+considering[1].pz(),0.);</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;                                <span class="comment">//meson(CM) velocity</span></div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;                                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> betaM;</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;                                betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(Pmeson.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()/(considering[0].e()+considering[1].e()),Pmeson.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()/(considering[0].e()+considering[1].e()),Pmeson.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()/(considering[0].e()+considering[1].e()),0.);</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;                                betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),1./(sqrt(1.-(betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>() + betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>() + betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()))));</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;                                <span class="comment">//boosting into CM frame</span></div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;                                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_MCM[2], p_MCM[2];</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;                                pos_MCM[0] = considering[0].boost_pos(betaM); pos_MCM[1] = considering[1].boost_pos(betaM);</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;                                  p_MCM[0] = considering[0].boost_P(betaM);     p_MCM[1] = considering[1].boost_P(betaM);</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;                                <span class="comment">//velocities in CM frame</span></div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;                                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> v_MCM[2];</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;                                v_MCM[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(p_MCM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()/p_MCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_MCM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()/p_MCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_MCM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()/p_MCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),0.);</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;                                v_MCM[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(p_MCM[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()/p_MCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_MCM[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()/p_MCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_MCM[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()/p_MCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),0.);</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;                                <span class="comment">//propagating quarks until time of youngest quark</span></div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;                                <span class="comment">//is just max(pos_MCM[0].t(), pos_MCM[1].t());</span></div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;                                <span class="keywordtype">double</span> curtime = (pos_MCM[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>() &gt; pos_MCM[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()) ? pos_MCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>() : pos_MCM[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>();</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;                                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> cur_pos[2];</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;                                cur_pos[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_MCM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()+v_MCM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*(curtime-pos_MCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),pos_MCM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()+v_MCM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*(curtime-pos_MCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),pos_MCM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()+v_MCM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*(curtime-pos_MCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),curtime);</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;                                cur_pos[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_MCM[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()+v_MCM[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*(curtime-pos_MCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),pos_MCM[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()+v_MCM[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*(curtime-pos_MCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),pos_MCM[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()+v_MCM[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*(curtime-pos_MCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),curtime);</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;                                <span class="comment">//finding position of CM at curtime</span></div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;                                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_CM;</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;                                pos_CM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;                                (cur_pos[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+cur_pos[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()),</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;                                (cur_pos[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+cur_pos[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()),</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;                                (cur_pos[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+cur_pos[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>())/(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()),</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;                                curtime);</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;                                <span class="comment">//finding position of meson in lab frame</span></div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;                                betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(-betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),-betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),-betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),betaM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>());</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;                                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_lab = HHboost(betaM, pos_CM);</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;                                <span class="comment">//finding the squares of the relative momenta of partons in CM frame</span></div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;                                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> k_rel_square;</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;        <span class="keywordtype">double</span> sum_mass_square = (considering[0].mass()+considering[1].mass())*(considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()+considering[1].mass());</div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;                                k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(std::pow(considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*p_MCM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()-considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*p_MCM[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>(),2.)/sum_mass_square,std::pow(considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*p_MCM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()-considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*p_MCM[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>(),2.)/sum_mass_square,std::pow(considering[1].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*p_MCM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()-considering[0].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()*p_MCM[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>(),2.)/sum_mass_square,0.);</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;                                k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()+k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()+k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>());</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;                                <span class="comment">//finding the squares of relative positions of partons in CM frame</span></div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;                                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_rel_square;</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;                                pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>((cur_pos[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()-cur_pos[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>())*(cur_pos[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()-cur_pos[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()),(cur_pos[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()-cur_pos[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>())*(cur_pos[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()-cur_pos[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()),(cur_pos[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()-cur_pos[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>())*(cur_pos[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()-cur_pos[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()),0.);</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;                                pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()+pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()+pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>());</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;                                <span class="comment">//setting appropriate sigma...</span></div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;                                <span class="keywordtype">double</span> SigM2 = SigPi2;</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;                                <span class="keywordtype">int</span> sortid[2] = {0,0};</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;                                <span class="keywordflow">if</span>(std::abs(considering[0].<span class="keywordtype">id</span>()) &gt;= std::abs(considering[1].<span class="keywordtype">id</span>())){sortid[0] = std::abs(considering[0].<span class="keywordtype">id</span>()); sortid[1] = std::abs(considering[1].<span class="keywordtype">id</span>());}</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;                                <span class="keywordflow">else</span>{sortid[0] = std::abs(considering[1].<span class="keywordtype">id</span>()); sortid[1] = std::abs(considering[0].<span class="keywordtype">id</span>());}</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;                                <span class="keywordflow">if</span>(     sortid[0] == 3){</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;                                        <span class="keywordflow">if</span>(     sortid[1] == 3){SigM2 = SigPhi2;}</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;                                        <span class="keywordflow">else</span>{                   SigM2 = SigK2;}</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;                                }</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sortid[0] == 4){</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;                                        <span class="keywordflow">if</span>(     sortid[1] == 4){SigM2 = SigJpi2;}</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sortid[1] == 3){SigM2 = SigDs2;}</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;                                        <span class="keywordflow">else</span>{                   SigM2 = SigD2;}</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;                                }</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sortid[0] == 5){</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;                                        <span class="keywordflow">if</span>(     sortid[1] == 5){SigM2 = SigUps2;}</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sortid[1] == 4){SigM2 = SigBc2;}</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sortid[1] == 3){SigM2 = SigB2;}</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;                                        <span class="keywordflow">else</span>{                   SigM2 = SigB2;}</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;                                }</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;                                <span class="keywordtype">double</span> <a class="code" href="../../d6/df1/namespacephysmon__ckf__tracking.html#a2b8682bd0e8d7755e66f1da5e1bf21af">u</a>[4];</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;        <span class="comment">// This is the squared distance in phase space weighted with the widths</span></div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;                                u[1] = 0.5*(pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()/SigM2 + k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*SigM2/hbarc2);</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;                                u[2] = 0.5*(pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()/SigM2 + k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*SigM2/hbarc2);</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;                                u[3] = 0.5*(pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()/SigM2 + k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*SigM2/hbarc2);</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;                                u[0] = u[1] + u[2] + u[3];</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;        <span class="comment">// Ground state wave function</span></div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;        <span class="keywordtype">double</span> WigM = std::exp(-u[0]);</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;        <span class="comment">// Computing s ~ L^2 for the system</span></div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;        <span class="keywordtype">double</span> rdotr = pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>();</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;                                <span class="keywordtype">double</span> pdotp = k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>();</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;                                <span class="keywordtype">double</span> pdotr = std::sqrt(pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>())*std::sqrt(k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()) + std::sqrt(pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>())*std::sqrt(k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()) + std::sqrt(pos_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>())*std::sqrt(k_rel_square.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>());</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;                                <span class="keywordtype">double</span> <a class="code" href="../../d5/d1e/namespacephysmon__simulation.html#afe07c0feff8b9ad0d479f54ff63a1a0d">s</a> = 1/hbarc2*(pdotp*rdotr - pdotr*pdotr);</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;                                <span class="comment">// Random number for recombination dice roll</span></div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;                                <span class="keywordtype">double</span> rndmeson = <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;        <span class="comment">// Initialize quantum numbers and recombination probability</span></div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;        <span class="keywordtype">int</span> angular_qnum = -1; <span class="comment">// l</span></div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;                                <span class="keywordtype">int</span> radial_qnum = -1; <span class="comment">// k</span></div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;        <span class="keywordtype">double</span> mult1 = considering[1].is_thermal() ? th_recofactor : sh_recofactor;</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;        <span class="keywordtype">double</span> total_prob =  WigM*recofactor2*mult1;</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;        <span class="keywordflow">if</span>(total_prob &gt;= rndmeson)</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;        {</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;                                        angular_qnum = 0;</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;                                        radial_qnum = 0;</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;                                }</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;        {</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;          total_prob += WigM*u[0];</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;          <span class="keywordflow">if</span>(total_prob &gt;= rndmeson &amp;&amp; maxM_level&gt;0)</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;          {</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;                                          angular_qnum = 1;</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;                                          radial_qnum = 0;</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;                                  }</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;                                  <span class="keywordflow">else</span></div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;          {</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;            total_prob += (1./2.)*WigM*((2./3.)*std::pow(u[0],2) + (1./3.)*<a class="code" href="../../d5/d1e/namespacephysmon__simulation.html#afe07c0feff8b9ad0d479f54ff63a1a0d">s</a>);</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;            <span class="keywordflow">if</span>(total_prob &gt;= rndmeson &amp;&amp; maxM_level&gt;1)</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;            {</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;                                            angular_qnum = 2;</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;                                            radial_qnum = 0;</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;                                    }</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;                                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;            {</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;              total_prob += (1./2.)*WigM*((1./3.)*std::pow(u[0],2) - (1./3.)*<a class="code" href="../../d5/d1e/namespacephysmon__simulation.html#afe07c0feff8b9ad0d479f54ff63a1a0d">s</a>);</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;              <span class="keywordflow">if</span>(total_prob &gt;= rndmeson &amp;&amp; maxM_level&gt;1 )</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;              {</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;                                            angular_qnum = 0;</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;                                            radial_qnum = 1;</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;                                      }</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;                                      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;              {</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;                total_prob += (1./6.)*WigM*((2./5.)*std::pow(u[0],3) + (3./5.)*u[0]*<a class="code" href="../../d5/d1e/namespacephysmon__simulation.html#afe07c0feff8b9ad0d479f54ff63a1a0d">s</a>);</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;                <span class="keywordflow">if</span>(total_prob &gt;= rndmeson &amp;&amp; maxM_level&gt;2)</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;                {</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;                                                angular_qnum = 1;</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;                                                radial_qnum = 1;</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;                                        }</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;                                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;                {</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;                  total_prob += (1./6.)*WigM*((3./5.)*std::pow(u[0],3) - (3./5.)*u[0]*<a class="code" href="../../d5/d1e/namespacephysmon__simulation.html#afe07c0feff8b9ad0d479f54ff63a1a0d">s</a>);</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;                  <span class="keywordflow">if</span>(total_prob &gt;= rndmeson &amp;&amp; maxM_level&gt;2)</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;                  {</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;                                                angular_qnum = 3;</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;                                                  radial_qnum = 0;</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;                                          }</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;                  <span class="keywordflow">else</span></div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;                  {</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;                    total_prob += (1./120.)*WigM*std::pow((std::pow(u[0],2)-s),2);</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;                    <span class="keywordflow">if</span>(total_prob &gt;= rndmeson &amp;&amp; maxM_level&gt;3)</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;                    {</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;                                                angular_qnum = 0;</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;                                                    radial_qnum = 2;</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;                                            }</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;                    {</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;                      total_prob += (1./24.)*WigM*((4./7.)*std::pow(u[0],4)-(2./7.)*std::pow(u[0],2)*s-(2./7.)*std::pow(s,2));</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;                      <span class="keywordflow">if</span>(total_prob &gt;= rndmeson &amp;&amp; maxM_level&gt;3)</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;                      {</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;                                                  angular_qnum = 2;</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;                                                    radial_qnum = 1;</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;                                              }</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;                      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;                      {</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;                        total_prob += (1./24.)*WigM*((8./35.)*std::pow(u[0],4)+(24./35.)*std::pow(u[0],2)*s+(3./35.)*std::pow(s,2));</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;                        <span class="keywordflow">if</span>(total_prob &gt;= rndmeson &amp;&amp; maxM_level&gt;3)</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;                        {</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;                                                        angular_qnum = 4;</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;                                                        radial_qnum = 0;</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;                                                }</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;                      }</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;                    }</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;                  }</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;                }</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;              }</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;            }</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;          }</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;        }</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;        <span class="comment">//Habemus Recombinationem!</span></div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;        <span class="keywordflow">if</span>(angular_qnum &gt;= 0) {</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;          <span class="comment">/*std::cout &lt;&lt; &quot;Mesons&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;<span class="comment">          std::cout &lt;&lt; considering[0].id() &lt;&lt; &quot;,&quot; &lt;&lt; considering[0].col() &lt;&lt; &quot;,&quot; &lt;&lt; considering[0].acol() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;<span class="comment">          std::cout &lt;&lt; considering[1].id() &lt;&lt; &quot;,&quot; &lt;&lt; considering[1].col() &lt;&lt; &quot;,&quot; &lt;&lt; considering[1].acol() &lt;&lt; std::endl;*/</span></div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;          <span class="keywordflow">if</span>(considering[0].<span class="keywordtype">id</span>() &gt; 0 &amp;&amp; considering[1].id() &lt; 0){<span class="comment">//case of first parton is q and second is q-bar</span></div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;            <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;chosen partons are &quot;&lt;&lt; int(considering[0].id()) &lt;&lt; &quot; and &quot; &lt;&lt; int(considering[1].id()) &lt;&lt; endl &lt;&lt;endl;</span></div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;            <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;and their color tag is &quot;&lt;&lt; int(considering[0].col()) &lt;&lt; &quot; and &quot; &lt;&lt; int(considering[1].acol()) &lt;&lt; endl &lt;&lt;endl;</span></div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;            <span class="comment">//std::cout &lt;&lt;&quot;color correction implemented as Follows: &quot;&lt;&lt; considering[0].col() &lt;&lt;&quot; = &quot; &lt;&lt; considering[1].acol()&lt;&lt;endl;</span></div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;            <span class="comment">// Overwrite non-dominant colortags in tempjunctions with dominant ones</span></div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;            <span class="comment">// q-qbar case</span></div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;            <span class="keywordflow">if</span>(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() != 0 &amp;&amp; considering[1].acol() != 0){</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;              <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ijunc=0; ijunc&lt;Tempjunctions.size(); ijunc++){</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;                <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(1).at(1) == considering[1].acol()){</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;                  Tempjunctions.at(ijunc).at(1).pop_back();</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;                  Tempjunctions.at(ijunc).at(1).push_back(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;                }</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;                            <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(2).at(1) == considering[1].acol()){</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;                  Tempjunctions.at(ijunc).at(2).pop_back();</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;                  Tempjunctions.at(ijunc).at(2).push_back(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;                }</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;                            <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(3).at(1) == considering[1].acol()){</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;                  Tempjunctions.at(ijunc).at(3).pop_back();</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;                  Tempjunctions.at(ijunc).at(3).push_back(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;                }</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;              }</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;            }</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;            <span class="comment">//before changing the tags, revise the MesonrecoMatrix elements!</span></div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;            <span class="keywordtype">int</span> coltag1 = considering[0].col();</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;            <span class="keywordtype">int</span> coltag2 = considering[1].acol();</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;            <span class="keywordflow">if</span>(coltag1 &gt; 0 &amp;&amp; coltag2 &gt; 0 &amp;&amp; coltag1 &lt;= limit &amp;&amp; coltag2 &lt;= limit){</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;              std::vector&lt;int&gt;::iterator I1 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), coltag1);</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;              std::vector&lt;int&gt;::iterator I2 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), coltag2);</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;              <span class="keywordtype">int</span> loc1 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I1);</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;              <span class="keywordtype">int</span> loc2 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I2); <span class="comment">//set up for find matrix indices corresponding to the color tags</span></div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;                                            MesonrecoMatrix1.at(loc1).at(loc2) = 1;</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;              MesonrecoMatrix1.at(loc2).at(loc1) = 1; <span class="comment">//Matrix revised</span></div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;                                            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iM=0;iM&lt;MesonrecoMatrix1[0].size();++iM){</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;                <span class="keywordflow">if</span>(MesonrecoMatrix1[loc1][iM]==1){MesonrecoMatrix1[loc2][iM]=1;}</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;                                                <span class="keywordflow">if</span>(MesonrecoMatrix1[loc2][iM]==1){MesonrecoMatrix1[loc1][iM]=1;}</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;                                                <span class="keywordflow">if</span>(MesonrecoMatrix1[iM][loc1]==1){MesonrecoMatrix1[iM][loc2]=1;}</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;                                                <span class="keywordflow">if</span>(MesonrecoMatrix1[iM][loc2]==1){MesonrecoMatrix1[iM][loc1]=1;}</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;                                                <span class="keywordflow">if</span>(MesonrecoMatrix1[loc1][iM]==0){MesonrecoMatrix1[loc2][iM]=0;}</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;                                                <span class="keywordflow">if</span>(MesonrecoMatrix1[loc2][iM]==0){MesonrecoMatrix1[loc1][iM]=0;}</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;                                                <span class="keywordflow">if</span>(MesonrecoMatrix1[iM][loc1]==0){MesonrecoMatrix1[iM][loc2]=0;}</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;                                                <span class="keywordflow">if</span>(MesonrecoMatrix1[iM][loc2]==0){MesonrecoMatrix1[iM][loc1]=0;}</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;                                            }</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;              <span class="comment">/*</span></div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;<span class="comment">              std::cout &lt;&lt;endl&lt;&lt;&quot;Revised Matrix is same as below&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;<span class="comment">              for(int irow=0; irow &lt; IndiceForColFin.size(); irow++){</span></div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;<span class="comment">                for(int icol=0; icol &lt; IndiceForColFin.size(); icol++){</span></div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;<span class="comment">                  std::cout &lt;&lt;&quot;  &quot;&lt;&lt;MesonrecoMatrix1.at(irow).at(icol)&lt;&lt;&quot;  &quot;;</span></div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;<span class="comment">                std::cout &lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;<span class="comment">              }</span></div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;<span class="comment">              */</span></div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;            }</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;            <span class="comment">//possible case  MAT+LBT, MAT+THERM,</span></div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;            <span class="comment">//treatment 1 : based on distance.</span></div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;                                          <span class="keywordflow">if</span>(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; 0 &amp;&amp; considering[1].acol() &gt; 0){ <span class="comment">//MAT/lbt or therm with color tags + MAT/lbt or therm with color tags</span></div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;                                                <span class="keywordflow">if</span>(perm2[q2] &gt; 0){</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;                                                        HH_showerptns[showerquarks[element[1]].par()].acol(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());<span class="comment">//now color tags from both partons are same</span></div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;                                                        <span class="comment">//also need to set the remaining color tag in showerquarks (if present)</span></div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;                                                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ishq=0;ishq&lt;showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>();++ishq){</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;                                                                <span class="keywordflow">if</span>(!showerquarks[ishq].is_used() &amp;&amp; showerquarks[ishq].col()==considering[1].acol()){</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;                    showerquarks[ishq].col(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());<span class="comment">/*break;*/</span></div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;                  }</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;                                                        }</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;                                                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ishq=0;ishq&lt;HH_showerptns.num();++ishq){</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;                                                                <span class="keywordflow">if</span>(HH_showerptns[ishq].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>()==considering[1].acol()){</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;                    HH_showerptns[ishq].col(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());<span class="comment">/*break;*/</span></div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;                  }</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;                                                        }</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;                                                }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;                HH_thermal[-element[1]].acol(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;              }</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;                                          }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; 0){ <span class="comment">// MAT + LBT/THERM</span></div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;                                                <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(considering[1] , perm2[q2], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal); <span class="comment">// functon to find</span></div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;                                                <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;                                                        <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;                                                        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[1]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;                                                        Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;                                                        <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;                                                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;                HH_thermal[-loc-1].col(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;              }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;                showerquarks[loc-1].col(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;                                                }</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;                                          }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(considering[1].acol() &gt; 0){ <span class="comment">//LBT + MAT</span></div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;                                                <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(considering[0] , perm1[q1]+1, <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal);</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;                                                <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;                                                        <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;                                                        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[0]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(considering[1].acol());</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;                                                        Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;                                                        <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;                                                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;                HH_thermal[-loc-1].acol(considering[1].acol());</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;              }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;                showerquarks[loc-1].acol(considering[1].acol());</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;                                                }</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;                                          }</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;                                  }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(considering[0].<span class="keywordtype">id</span>() &lt; 0 &amp;&amp; considering[1].<span class="keywordtype">id</span>() &gt; 0){<span class="comment">//case of first parton is q-bar and second is q</span></div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;            <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;chosen partons are &quot;&lt;&lt; int(considering[0].id()) &lt;&lt; &quot; and &quot; &lt;&lt; int(considering[1].id()) &lt;&lt; endl &lt;&lt;endl;</span></div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;            <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;and their color tag is &quot;&lt;&lt; int(considering[0].acol()) &lt;&lt; &quot; and &quot; &lt;&lt; int(considering[1].col()) &lt;&lt; endl &lt;&lt;endl;</span></div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;            <span class="comment">//std::cout &lt;&lt;&quot;color correction implemented as Follows: &quot;&lt;&lt; considering[0].acol()&lt;&lt;&quot; = &quot;&lt;&lt;considering[1].col()&lt;&lt;endl;</span></div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;            <span class="comment">// Overwrite non-dominant colortags in tempjunctions with dominant ones</span></div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;            <span class="comment">// qbar-q case</span></div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;            <span class="keywordflow">if</span>(considering[0].acol() != 0 &amp;&amp; considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() != 0){</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;              <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ijunc=0; ijunc&lt;Tempjunctions.size(); ijunc++){</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;                <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(1).at(1) == considering[1].col()){</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;                  Tempjunctions.at(ijunc).at(1).pop_back();</div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;                  Tempjunctions.at(ijunc).at(1).push_back(considering[0].acol());</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;                }</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;                            <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(2).at(1) == considering[1].col()){</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;                  Tempjunctions.at(ijunc).at(2).pop_back();</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;                  Tempjunctions.at(ijunc).at(2).push_back(considering[0].acol());</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;                }</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;                            <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(3).at(1) == considering[1].col()){</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;                  Tempjunctions.at(ijunc).at(3).pop_back();</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;                  Tempjunctions.at(ijunc).at(3).push_back(considering[0].acol());</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;                }</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;              }</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;            }</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;            <span class="comment">//before changing the tags, revise the MesonrecoMatrix elements!</span></div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;            <span class="keywordtype">int</span> coltag1 = considering[0].acol();</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;            <span class="keywordtype">int</span> coltag2 = considering[1].col();</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;            <span class="keywordflow">if</span>(coltag1 &gt; 0 &amp;&amp; coltag2 &gt; 0 &amp;&amp; coltag1 &lt;= limit &amp;&amp; coltag2 &lt;= limit){</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;              std::vector&lt;int&gt;::iterator I1 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), coltag1);</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;              std::vector&lt;int&gt;::iterator I2 = std::find(IndiceForColFin.begin(), IndiceForColFin.end(), coltag2);</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;              <span class="keywordtype">int</span> loc1 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I1);</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;              <span class="keywordtype">int</span> loc2 = <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">std::distance</a>(IndiceForColFin.begin(), I2); <span class="comment">//set up for find matrix indices corresponding to the color tags</span></div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;                                            MesonrecoMatrix1.at(loc1).at(loc2) = 1;</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;              MesonrecoMatrix1.at(loc2).at(loc1) = 1; <span class="comment">//Matrix revised</span></div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;                                            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iM=0;iM&lt;MesonrecoMatrix1[0].size();++iM){</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;                <span class="keywordflow">if</span>(MesonrecoMatrix1[loc1][iM]==1){MesonrecoMatrix1[loc2][iM]=1;}</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;                                                <span class="keywordflow">if</span>(MesonrecoMatrix1[loc2][iM]==1){MesonrecoMatrix1[loc1][iM]=1;}</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;                                                <span class="keywordflow">if</span>(MesonrecoMatrix1[iM][loc1]==1){MesonrecoMatrix1[iM][loc2]=1;}</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;                                                <span class="keywordflow">if</span>(MesonrecoMatrix1[iM][loc2]==1){MesonrecoMatrix1[iM][loc1]=1;}</div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;                                                <span class="keywordflow">if</span>(MesonrecoMatrix1[loc1][iM]==0){MesonrecoMatrix1[loc2][iM]=0;}</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;                                                <span class="keywordflow">if</span>(MesonrecoMatrix1[loc2][iM]==0){MesonrecoMatrix1[loc1][iM]=0;}</div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;                                                <span class="keywordflow">if</span>(MesonrecoMatrix1[iM][loc1]==0){MesonrecoMatrix1[iM][loc2]=0;}</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;                                                <span class="keywordflow">if</span>(MesonrecoMatrix1[iM][loc2]==0){MesonrecoMatrix1[iM][loc1]=0;}</div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;                                            }</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;            }</div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;<span class="comment">            std::cout &lt;&lt;endl&lt;&lt;&quot;Revised Matrix is same as below&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;<span class="comment">            for(int irow=0; irow &lt; IndiceForColFin.size(); irow++){</span></div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;<span class="comment">              for(int icol=0; icol &lt; IndiceForColFin.size(); icol++){</span></div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;<span class="comment">                std::cout &lt;&lt;&quot;  &quot;&lt;&lt;MesonrecoMatrix1.at(irow).at(icol)&lt;&lt;&quot;  &quot;;</span></div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;<span class="comment">              }</span></div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;<span class="comment">              std::cout &lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;<span class="comment">            }*/</span></div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;                                          <span class="keywordflow">if</span>(considering[0].acol() &gt; 0 &amp;&amp; considering[1].col() &gt; 0){ <span class="comment">//MAT + MAT</span></div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;                                                <span class="keywordflow">if</span>(perm2[q2] &gt; 0){</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;                                                        HH_showerptns[showerquarks[element[1]].par()].col(considering[0].acol());<span class="comment">//now color tags from both partons are same</span></div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;                                                        <span class="comment">//also need to set the remaining color tag in showerquarks (if present)</span></div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;                                                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ishq=0;ishq&lt;showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>();++ishq){</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;                                                                <span class="keywordflow">if</span>(!showerquarks[ishq].is_used() &amp;&amp; showerquarks[ishq].acol()==considering[1].col()){</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;                    showerquarks[ishq].acol(considering[0].acol());<span class="comment">/*break;*/</span></div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;                  }</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;                                                        }</div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;                                                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ishq=0;ishq&lt;HH_showerptns.num();++ishq){</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;                                                                <span class="keywordflow">if</span>(HH_showerptns[ishq].acol()==considering[1].col()){</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;                    HH_showerptns[ishq].acol(considering[0].acol());<span class="comment">/*break;*/</span></div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;                  }</div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;                                                        }</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;                                                }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;                HH_thermal[-element[1]].col(considering[0].acol());</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;              }</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;                                          }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(considering[0].acol() &gt; 0){ <span class="comment">// MAT + LBT/THERM</span></div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;                                                <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(considering[1], perm2[q2], <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal );</div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;                                                <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;                                                        <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;                                                        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[1]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(considering[0].acol());</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;                                                        Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;                                                        <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;                                                }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc &gt; 0){</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;                showerquarks[loc-1].acol(considering[0].acol());</div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;              }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;                HH_thermal[-loc-1].acol(considering[0].acol());</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;              }</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;                                          }</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;                                          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; 0){ <span class="comment">//LBT + MAT</span></div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;                                                  <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(considering[0], perm1[q1]+1, <span class="keyword">true</span>, <span class="keyword">true</span>, showerquarks, HH_thermal );</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;                                                  <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;                                                        <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;Warning : extra parton used for string repair!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;                                                        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = considering[0]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;                                                        Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;                                                        <span class="comment">//somewhere, we need to make for loop to toss all partons to remnants list.</span></div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;                                                  }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc &gt; 0){</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;                showerquarks[loc-1].col(considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;              }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){</div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;                HH_thermal[-loc-1].col(considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>());</div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;              }</div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;                                        }</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;            <span class="comment">//now color tags from both partons are same</span></div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;          }</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;</div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;                                        <span class="comment">//now we&#39;re forming the hadron</span></div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;                                        <a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html">HHhadron</a> formedhadron;</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;                                        <span class="comment">//setting the hadron values: is a recombined hadron, mass, and parents - setting the par3 flag to 999999 to denote the lack of a 3rd parent parton</span></div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;                                        formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a27dd6d3a82b77f211b08aef3f4641664">is_recohad</a>(<span class="keyword">true</span>); formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a048b35ba82d82b0c177b0968485bab3d">mass</a>( p_MCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>() + p_MCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>() );</div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;                                        <span class="comment">//formedhadron.par1 = element[0]; formedhadron.par2 = element[1]; formedhadron.par3 = 999999;</span></div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;                                        formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a471e031c8b1ed05e94a7ab075fdb4914">add_par</a>(showerquarks[element[0]].par());</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;                                        <span class="keywordflow">if</span>(perm2[q2]&gt;0){formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a471e031c8b1ed05e94a7ab075fdb4914">add_par</a>(showerquarks[element[1]].par());}<span class="keywordflow">else</span>{formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a471e031c8b1ed05e94a7ab075fdb4914">add_par</a>(element[1]);}</div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;</div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;                                        <span class="comment">//now setting if meson is in excited state</span></div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;                                        <span class="keywordflow">if</span>(angular_qnum + radial_qnum &gt; 0){formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a224a14dbde7e93adfb3b0a303caa769a">is_excited</a>(<span class="keyword">true</span>);}</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;                                        <span class="comment">//setting if there are any thermal partons used to make the hadron: (setting the &#39;0&#39; thermal parent to -99999 so that it doesn&#39;t conflict with &#39;0&#39; shower parton)</span></div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;                                        <span class="keywordflow">if</span>(     perm2[q2]&gt;0){<span class="comment">/*is sh-sh*/</span> formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#aa981caef15a8cd147cf647c694c697d8">is_shsh</a>(<span class="keyword">true</span>);}</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(perm2[q2]&lt;0){<span class="comment">/*is sh-th*/</span> formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a6c7732b018f159825e653edad26d8774">is_shth</a>(<span class="keyword">true</span>); <span class="keywordflow">if</span>(element[1] == 0){formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a4fc831bb545765bba32d2558e1931bfb">parents</a>[1] = -99999;}}</div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;                                        <span class="comment">//setting hadron position and momentum vectors</span></div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;                                        Pmeson.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(Pmeson.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),Pmeson.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),Pmeson.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),sqrt(Pmeson.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*Pmeson.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>() + Pmeson.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*Pmeson.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>() + Pmeson.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*Pmeson.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>() + formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a048b35ba82d82b0c177b0968485bab3d">mass</a>()*formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a048b35ba82d82b0c177b0968485bab3d">mass</a>()));</div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;                                        formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a7ce336bb518c8fe59fe9bc044d9f0ca6">pos</a>(pos_lab); formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a14ac05d5f4db7a690b834078050e695f">P</a>(Pmeson);</div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;                                        <span class="comment">//setting hadron color tags (for tracing colors of the constituent partons)</span></div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;                                        <span class="comment">//will need to update to reflect color tags given to random (thermal/lbt) partons [**]</span></div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;                                        <span class="keywordflow">if</span>(considering[0].<span class="keywordtype">id</span>()&gt;0){formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a83abda8c8e59cb3ee02dd0d50a76b85a">add_col</a>(considering[0].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>()); formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a83abda8c8e59cb3ee02dd0d50a76b85a">add_col</a>(considering[1].acol());}</div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;                                        <span class="keywordflow">else</span>{formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a83abda8c8e59cb3ee02dd0d50a76b85a">add_col</a>(considering[1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>()); formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a83abda8c8e59cb3ee02dd0d50a76b85a">add_col</a>(considering[0].acol());}</div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;</div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;                                        <span class="comment">//need to choose *what* hadron we&#39;ve formed... base this on the parton id&#39;s, mass, &amp; if excited</span></div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;                                        set_meson_id(considering, formedhadron, angular_qnum, radial_qnum);</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;                                        <span class="comment">//need to add the hadron to the collection</span></div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;                                        HH_hadrons.add(formedhadron);</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;                                        <span class="comment">//now that we&#39;ve formed the hadron, need to set ALL (both) the &#39;considering&#39; flags to used</span></div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;                                                        showerquarks[element[0]].status(1); showerquarks[element[0]].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;                                        <span class="keywordflow">if</span>(perm2[q2]&gt;0){showerquarks[element[1]].status(1); showerquarks[element[1]].is_used(<span class="keyword">true</span>);}</div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;                                        <span class="keywordflow">else</span>{            HH_thermal[-element[1]].status(1);  HH_thermal[-element[1]].is_used(<span class="keyword">true</span>);}</div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;</div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;                                        <span class="comment">//now that we&#39;ve formed the hadron, break to first loop here!</span></div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;                                        madehadron = <span class="keyword">true</span>; considering.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;                                }</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;                        }</div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;                        <span class="comment">//if we&#39;ve formed a hadron - break to first loop</span></div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;                        <span class="keywordflow">if</span>(madehadron){<span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;                        <span class="comment">//since we CAN&#39;T form a baryon on this try, need to revert the second quark &#39;considering&#39; used flag</span></div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;                        <span class="keywordflow">if</span>(perm2[q2]&gt;0){showerquarks[element[1]].status(0);}</div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;                        <span class="keywordflow">else</span>{            HH_thermal[-element[1]].status(0);}</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;</div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;                        <span class="comment">//and remove the second entry in considering (putting in if statement in case we tried and failed to make a hadron;</span></div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;                        considering.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#ae0b1b71d70ad94567da60ab34fd2b10d">partons</a>.pop_back();</div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;                }</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;                <span class="comment">//if we&#39;ve formed a hadron - continue to next parton in first loop...</span></div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;                <span class="keywordflow">if</span>(madehadron){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;                <span class="comment">//since we&#39;ve not formed a hadron with the first quark, need to revert the first quark &#39;considering&#39; used flag</span></div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;                <span class="comment">//only need to reset these for shower quarks as the first quark cannot be a thermal quark</span></div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;                <span class="comment">//and remove the first(only) entry in considering</span></div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;                showerquarks[element[0]].status(0); considering.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#ae0b1b71d70ad94567da60ab34fd2b10d">partons</a>.pop_back();</div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;        }</div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;</div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;        <span class="comment">//all possibilities have been considered, all used quark flags for showerquarks are set appropriately</span></div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;        <span class="comment">//time for cleanup</span></div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;        <span class="comment">//set the used quarks in the original shower to reflect that they were used in reco module and that they were actually used</span></div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;        <span class="comment">//set the fully used gluons in the original shower to reflect that they were used in reco module and that they were actually used</span></div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;        <span class="comment">//set the partially used gluons in the original shower to reflect that they were used in reco module and that they were actually used</span></div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;        <span class="comment">//give used quarks and fully used gluons a status of &#39;1&#39;; give partially used gluons a status of &#39;-1&#39;</span></div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;        <span class="comment">//stick all unused quarks and &#39;completely&#39; unused gluons into remnants (make sure to set the parents to the original shower partons appropriately)</span></div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;        <span class="comment">//write updated string information into shower, so that it is set properly in remnants</span></div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;        <span class="comment">//for the thermal array, all the used flags should already be set (and have a status of &#39;1&#39;)</span></div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;        <span class="comment">//if this is used in a loop (as the original version should be doing) - those will have to be reset before reuse</span></div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;        <span class="comment">//otherwise, this is perfect for medium feedback</span></div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;        <span class="comment">//using quarks in showerquarks to set the flags appropriately for partons in shower</span></div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;                <span class="comment">//if we have a quark in the original shower</span></div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;                <span class="keywordflow">if</span>((std::abs(HH_showerptns[showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].par()].<span class="keywordtype">id</span>()) &lt;= 5) &amp;&amp; (showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used())){</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;                        HH_showerptns[showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].par()].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;      HH_showerptns[showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].par()].status(1);</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;      HH_showerptns[showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].par()].used_reco(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;                }</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;                <span class="comment">//if this quark is from a split gluon in the original shower</span></div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_showerptns[showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].par()].<span class="keywordtype">id</span>()) == 21 &amp;&amp; showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used()){</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;                        <span class="comment">//if this is the first used quark in a splitting, set the parent gluon to used, and status of -1</span></div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;                        <span class="keywordflow">if</span>(HH_showerptns[showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].par()].<a class="code" href="../../d6/d84/namespaceutils.html#ae872b751be761fb1b2f1fcfce89f3e58">status</a>() == -99){</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;                                HH_showerptns[showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].par()].status(-1);</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;        HH_showerptns[showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].par()].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;        HH_showerptns[showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].par()].used_reco(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;                        }</div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;                        <span class="comment">//if this is the second (last) used quark in a splitting, set the status to 1</span></div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(HH_showerptns[showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].par()].<a class="code" href="../../d6/d84/namespaceutils.html#ae872b751be761fb1b2f1fcfce89f3e58">status</a>() == -1){</div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;        HH_showerptns[showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].par()].status(1);</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;      }</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;                        <span class="comment">//remove this check if it never throws.</span></div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;                        <span class="keywordflow">else</span>{<a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;SOMETHING HAS GONE VERY WRONG WITH REFORMING GLUON IN POS: &quot;</span> &lt;&lt; showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].par(); <span class="keywordtype">int</span> val; showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].par(0);}</div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;                }</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;        }</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;        <span class="comment">//need to run back through shower; if there are any gluons that didn&#39;t get used at all in the shower - restore them (and output to remnants below)</span></div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_showerptns.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;    <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/d84/namespaceutils.html#ae872b751be761fb1b2f1fcfce89f3e58">status</a>() == -99){</div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;      HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_decayedglu(<span class="keyword">false</span>);</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;      HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].status(0);</div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;    }</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;  }</div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;</div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;        <span class="comment">//need to update string information in shower from showerquarks</span></div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_showerptns.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;    <span class="keywordflow">if</span>(!HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used()){</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;                  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>&lt;showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>){</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;        <span class="keywordflow">if</span>(showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].par() == <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &amp;&amp; !showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].is_used()){</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;                            HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].string_id(   showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].string_id());</div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;                            HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_strendpt( showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].is_strendpt());</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;                            HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pos_str(     showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].pos_str());</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;                            HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].endpt_id(    showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].endpt_id());</div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;                    }</div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;      }</div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;          }</div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;  }</div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;        <span class="comment">//now all the partons in shower have had flags appropriately set; the &#39;partially&#39; used gluons have a status of -1</span></div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;</div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;  <span class="comment">//TODO: here we need new function to find thermal sibling for gluon</span></div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;  <span class="comment">//sol 1 : gluon loops.</span></div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;  <span class="comment">//sol 2 : decay gluon find pairs.{concern : energy conservation violated}</span></div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;  <span class="comment">//sol 3 : find two theraml siblings for gluon. declare fincloserepl twice. first pick quark and antiquarks to the 2nd.--&gt; this is chosen</span></div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; HH_showerptns.num(); <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++){</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;                <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used()){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;                <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() == 21 &amp;&amp; HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].col() == 0 &amp;&amp; HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol() == 0){</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;                        <span class="keywordtype">int</span> sel_out[2] = { 0 , 0 };</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;                        findcloserepl_glu(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>], i+1, <span class="keyword">true</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal, sel_out);</div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;                        <span class="keywordflow">if</span>(sel_out[0] == 999999999 || sel_out[1] == 999999999){</div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;                                <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakeg = HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]; fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);  fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(++maxtag); fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(++maxtag);</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;        fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-6);</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;                                <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;                                fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;        fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;                                fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;                                fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;        fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;                                Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakeg); HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].col(fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>()); HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol(fakeg.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>());</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;                        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(sel_out[0] &gt; 0){</div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;        HH_showerptns[sel_out[0]-1].col(++maxtag);</div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;        HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol(maxtag);</div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(sel_out[0] &lt; 0){</div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;        HH_thermal[-sel_out[0]-1].col(++maxtag);</div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;        HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol(maxtag);</div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;      }</div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;</div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;                        <span class="keywordflow">if</span>(sel_out[1] &gt; 0 &amp;&amp; sel_out[1] != 999999999 &amp;&amp; sel_out[0] != 999999999){</div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;        HH_showerptns[sel_out[1]-1].acol(++maxtag);</div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;        HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].col(maxtag);</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(sel_out[1] &lt; 0 &amp;&amp; sel_out[1] != 999999999 &amp;&amp; sel_out[0] != 999999999){</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;        HH_thermal[-sel_out[1]-1].acol(++maxtag);</div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;        HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].col(maxtag);</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;      }</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() == 21 &amp;&amp; (HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0 || HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol() == 0)){ <span class="comment">//gluon that needs a single quark to fix</span></div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;                        <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0){</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;                                HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].id(1); <span class="comment">//need to temporarily pretend gluon is a quark, swap back id after...</span></div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;                                <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>], i+1, <span class="keyword">true</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal );</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;                                HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].id(21);</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;                                <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;                                        <span class="keywordtype">double</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? -1 : -2;</div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;                                        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid);  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(++maxtag);</div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;                                        <span class="keywordtype">double</span> dir = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &lt; 0.5) ? 1. : -1.; <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;                                        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;          <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;          } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;          number_p_fake++;</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;                                        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;                                        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;                                        Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;                                }</div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc &gt; 0){HH_showerptns[loc - 1].acol(++maxtag); }</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){HH_thermal[-loc - 1].acol(++maxtag); }</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;                                HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].col(maxtag);</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;                        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol() == 0){</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;                                HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].id(-1); <span class="comment">//need to temporarily pretend gluon is an antiquark, swap back id after...</span></div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;                                <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>], i+1, <span class="keyword">true</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal );</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;                                HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].id(21);</div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;                                <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;          <span class="keywordtype">double</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? 1 : 2;</div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;                                        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid);  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(++maxtag);</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;                                        <span class="keywordtype">double</span> dir = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &lt; 0.5) ? 1. : -1.; <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;                                        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;          <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;          } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;          number_p_fake++;</div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;                                        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;                                        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;                                        Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;                                }</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc &gt; 0){HH_showerptns[loc - 1].col(++maxtag); }</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){HH_thermal[-loc - 1].col(++maxtag); }</div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;</div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;                                HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol(maxtag);</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;                        }</div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() &gt; 0 &amp;&amp; HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0){</div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;                        <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>], i+1, <span class="keyword">true</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal );</div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;                        <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? -1 : -2;</div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;                                <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid);  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(++maxtag);</div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;                                <span class="keywordtype">double</span> dir = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &lt; 0.5) ? 1. : -1.; <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;                                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;        <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;        number_p_fake++;</div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;                                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;                                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;                                Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;                        }</div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc &gt; 0){HH_showerptns[loc - 1].acol(++maxtag); }</div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){HH_thermal[-loc - 1].acol(++maxtag); }</div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;</div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;                        HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].col(maxtag);</div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() &lt; 0 &amp;&amp; HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol() == 0){</div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;                        <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>], i+1, <span class="keyword">true</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal );</div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;                        <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? 1 : 2;</div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;                                <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid);  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(++maxtag);</div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;                                <span class="keywordtype">double</span> dir = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &lt; 0.5) ? 1. : -1.; <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;                                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;        <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;        number_p_fake++;</div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;                                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;                                fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;                                Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;                        }</div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc &gt; 0){HH_showerptns[loc - 1].col(++maxtag); }</div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){HH_thermal[-loc - 1].col(++maxtag); }</div>
<div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;</div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;                        HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol(maxtag);</div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;                }</div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;        }</div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;        <span class="comment">//sticking all unused partons into remnants; keeping order intact (a partially used gluon is replaced with it&#39;s unused quark)</span></div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; HH_showerptns.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;                <span class="comment">//if unused parton, write into remnants</span></div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;                <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/d84/namespaceutils.html#ae872b751be761fb1b2f1fcfce89f3e58">status</a>() == 0){</div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;      HH_remnants.add(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]);</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;      HH_remnants[HH_remnants.num() - 1].par(i);</div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;      HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_remnant(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;    }</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;                <span class="comment">//if &#39;partially&#39; used gluon, write unused daughter quark into remnants</span></div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/d84/namespaceutils.html#ae872b751be761fb1b2f1fcfce89f3e58">status</a>() == -1){</div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;                        <span class="comment">//finding the unused quark for this gluon and adding it to remnants (have to loop over as we only keep track of parents, not daughters)</span></div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>&lt;showerquarks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>){<span class="keywordflow">if</span>(showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].par() == <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &amp;&amp; !showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].is_used()){</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;        <span class="keywordflow">if</span>(showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == 0 &amp;&amp; showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].id() &gt; 0){ <span class="comment">//quark with zero col tag is left,</span></div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;          <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>], j+1, <span class="keyword">true</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal );</div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;          <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;            <span class="keywordtype">double</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? -1 : -2;</div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;            <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid);  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(++maxtag);</div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;            <span class="keywordtype">double</span> dir = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &lt; 0.5) ? 1. : -1.; <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;            <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;              fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;              fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;            } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;            number_p_fake++;</div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;            Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;          }</div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc &gt; 0){HH_showerptns[loc - 1].acol(++maxtag); }</div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){HH_thermal[-loc - 1].acol(++maxtag); }</div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;</div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;          showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].col(maxtag);</div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].acol() == 0 &amp;&amp; showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].<span class="keywordtype">id</span>() &lt; 0){ <span class="comment">//antiquark with zero col tag is left,</span></div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;          <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = findcloserepl(showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>], j+1, <span class="keyword">true</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal );</div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;          <span class="keywordflow">if</span>(loc == 999999999){</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;            <span class="keywordtype">double</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? 1 : 2;</div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;            <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid);  fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(++maxtag);</div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;            <span class="keywordtype">double</span> dir = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &lt; 0.5) ? 1. : -1.; <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;            <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;              fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;              fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;            } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;            number_p_fake++;</div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;            Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;          }</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loc &gt; 0){HH_showerptns[loc - 1].col(++maxtag); }</div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){HH_thermal[-loc - 1].col(++maxtag); }</div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;</div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;          showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].acol(maxtag);</div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;        }</div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;</div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;        HH_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(showerquarks[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>]); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;      }}</div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;                        HH_showerptns[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_remnant(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;                }</div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;        }</div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;</div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;        <span class="comment">//appending the thermal partons used in the string repair functionality into remnants</span></div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; HH_thermal.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;                <span class="comment">//if this thermal parton is ... then add it to the remnants collection</span></div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;                <span class="keywordflow">if</span>(HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used()){</div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;      HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].status(1);</div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;      HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].used_reco(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;    }</div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;                <span class="keywordflow">if</span>(HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; 0 || HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol() &gt; 0){</div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;      <span class="comment">//std::cout &lt;&lt; &quot;Thermal parton added to remnants: &quot; &lt;&lt; HH_thermal[i].id() &lt;&lt; &quot;,&quot; &lt;&lt; HH_thermal[i].col() &lt;&lt; &quot;,&quot; &lt;&lt; HH_thermal[i].acol() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;      HH_remnants.add(HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]);</div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;      HH_remnants[HH_remnants.num() - 1].par(-i-1);</div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;      HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_remnant(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;      HH_thermal[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;    }</div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;        }</div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;</div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; Extraparton.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> ){</div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;    HH_remnants.add(Extraparton[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]);</div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;    Extraparton[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used(<span class="keyword">true</span>); <span class="comment">// use the extrapartons during hadronizations of negative partons (background subtraction)</span></div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;</div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;    <span class="keywordflow">if</span>(Extraparton[i].<span class="keywordtype">id</span>() == 21){</div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;      <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep1 = Extraparton[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>];</div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;      fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(1); fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(0);</div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;      fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()/2.); fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()/2.); fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()/2.); fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;      fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()+fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()+fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()+fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;</div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;      <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep2 = Extraparton[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>];</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;      fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-1); fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(0);</div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;      fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()/2.); fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()/2.); fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()/2.); fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);</div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;      fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()+fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()+fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()+fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;      HH_recomb_extrapartons.add(fakep1);</div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;      HH_recomb_extrapartons.add(fakep2);</div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;      HH_recomb_extrapartons.add(Extraparton[i]);</div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;    }</div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;  }</div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;        <span class="comment">//hadrons have been recombined, and output to hadron collection</span></div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;        <span class="comment">//remnants have been collected, and output to remnant collection</span></div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;        <span class="comment">//shower partons have all been updated appropriately</span></div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;        <span class="comment">//thermal partons have all been updated appropriately - make sure that the thermal partons are reset before the recomb module is called again...</span></div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;</div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;  <span class="comment">//end of recombination routine</span></div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;}</div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;</div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;<span class="comment">//sets id of formed baryon based on quark content, mass of quark system, and if the baryon formed into an excited state</span></div>
<div class="line"><a name="l03764"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a45b5a0d5fd8939ed88981e8b85fa69e2"> 3764</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#a45b5a0d5fd8939ed88981e8b85fa69e2">HybridHadronization::set_baryon_id</a>(<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a>&amp; qrks, <a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html">HHhadron</a>&amp; had){</div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;</div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;        <span class="comment">//assigning quark_ids in descending order to construct baryon id</span></div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;        <span class="keywordtype">int</span> <span class="keywordtype">id</span>[3] = {qrks[0].id(), qrks[1].id(), qrks[2].id()};</div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;  <a class="code" href="../../d2/da5/namespaceActs_1_1Experimental_1_1detail_1_1BlueprintHelper.html#a308a6456db2655fc6a1a916696da20c8" title="Sort the nodes in the blueprint container node.">std::sort</a>(<span class="keywordtype">id</span>, <span class="keywordtype">id</span> + 3, [](<span class="keywordtype">int</span> <a class="code" href="../../d7/da4/namespaceKFPMath.html#a6d2496198d1982fd950acfb79033902b">a</a>, <span class="keywordtype">int</span> <a class="code" href="../../d7/da4/namespaceKFPMath.html#a1a60fb62c82cf122ca7923fc09cc1f84">b</a>) { <span class="keywordflow">return</span> std::abs(a) &gt; std::abs(b); });</div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;</div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;  <span class="comment">/*//http://pdg.lbl.gov/2017/listings/contents_listings.html</span></div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;<span class="comment">        double mdelta, msigma, mlambda, mxi, mdelE, msigmaE, mxiE, momega;</span></div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;<span class="comment">        mdelta  = 1.232;</span></div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;<span class="comment">        msigma  = 1.190;</span></div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;<span class="comment">        msigmaE = 1.382;</span></div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;<span class="comment">        mlambda = 1.115;</span></div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;<span class="comment">        mxi     = 1.315;</span></div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;<span class="comment">        mxiE    = 1.530;</span></div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;<span class="comment">        momega  = 1.672;</span></div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;<span class="comment">  //    ^^^^^ MIGHT NOT NEED MASSES BUT KEEP FOR NOW ^^^^^^</span></div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;        <span class="comment">//id and mass list:</span></div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;        <span class="comment">//ground state: (111, 222, 333 configurations prohibited...)</span></div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;        <span class="comment">//      2212, 2112 - .938  p,n</span></div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;        <span class="comment">//      3222, 3212, 3112 - 1.190   sigma;  3122 - 1.115 lambda</span></div>
<div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;        <span class="comment">//      3322, 3312 - 1.315  xi</span></div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;        <span class="comment">//excited:</span></div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;        <span class="comment">//      2224, 2214, 2114, 1114 - 1.232  delta</span></div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;        <span class="comment">//      3224, 3214, 3114 - 1.190   sigma;</span></div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;        <span class="comment">//      3324, 3314 - 1.315  xi</span></div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;        <span class="comment">//      3334 - 1.672 omega</span></div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;  <span class="comment">//    ^^^^^ MIGHT NOT NEED BUT KEEP FOR NOW ^^^^^^</span></div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;</div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;        <span class="keywordflow">if</span>(<span class="keywordtype">id</span>[0]==<span class="keywordtype">id</span>[1] &amp;&amp; <span class="keywordtype">id</span>[0]==<span class="keywordtype">id</span>[2]){had.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a8673e70390fe194d7268ac18fa3373b2">id</a>( 1000*std::abs(<span class="keywordtype">id</span>[0]) + 100*std::abs(<span class="keywordtype">id</span>[1]) + 10*std::abs(<span class="keywordtype">id</span>[2])+4 );}  <span class="comment">// J=3/2 only</span></div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<span class="keywordtype">id</span>[0]==<span class="keywordtype">id</span>[1] || <span class="keywordtype">id</span>[0]==<span class="keywordtype">id</span>[2] || <span class="keywordtype">id</span>[1]==<span class="keywordtype">id</span>[2]){</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>()&gt;0.333){had.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a8673e70390fe194d7268ac18fa3373b2">id</a>( 1000*std::abs(<span class="keywordtype">id</span>[0]) + 100*std::abs(<span class="keywordtype">id</span>[1]) + 10*std::abs(<span class="keywordtype">id</span>[2])+4 );}  <span class="comment">// J=3/2</span></div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;                <span class="keywordflow">else</span>{           had.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a8673e70390fe194d7268ac18fa3373b2">id</a>( 1000*std::abs(<span class="keywordtype">id</span>[0]) + 100*std::abs(<span class="keywordtype">id</span>[1]) + 10*std::abs(<span class="keywordtype">id</span>[2])+2 );}</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;        }</div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;                <span class="keywordtype">double</span> prb = <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;                <span class="keywordflow">if</span>(     prb&gt;0.333){had.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a8673e70390fe194d7268ac18fa3373b2">id</a>( 1000*std::abs(<span class="keywordtype">id</span>[0]) + 100*std::abs(<span class="keywordtype">id</span>[1]) + 10*std::abs(<span class="keywordtype">id</span>[2])+4 );}  <span class="comment">// J=3/2</span></div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(prb&gt;0.166){had.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a8673e70390fe194d7268ac18fa3373b2">id</a>( 1000*std::abs(<span class="keywordtype">id</span>[0]) + 100*std::abs(<span class="keywordtype">id</span>[1]) + 10*std::abs(<span class="keywordtype">id</span>[2])+2 );}  <span class="comment">// J=1/2 higher mass</span></div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;                <span class="keywordflow">else</span>{              had.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a8673e70390fe194d7268ac18fa3373b2">id</a>( 1000*std::abs(<span class="keywordtype">id</span>[0]) + 10*std::abs(<span class="keywordtype">id</span>[1]) + 100*std::abs(<span class="keywordtype">id</span>[2])+2 );}  <span class="comment">// J=1/2 lower mass</span></div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;        }       <span class="comment">// note the swap of quark index in last line</span></div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;        <span class="comment">// This would be how to make excited N, Delta and Lambda. RIGHT NOW DISABLED IN FIRST IF STATEMENT</span></div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;        <span class="comment">//there are no excited baryon codes of this form; there are only spin excited states in PYTHIA&#39;s ParticleData class</span></div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;  <span class="comment">//if(false &amp;&amp; had.is_excited){</span></div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;  <span class="comment">//    if(had.id == 2212 || had.id == 2112 || had.id == 2214 || had.id == 2114 || had.id == 2224 || had.id ==1114 || had.id == 3122){</span></div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;  <span class="comment">//            had.id += 100000;  // This needs to be adjusted to make the actual excited baryon codes</span></div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;  <span class="comment">//    }</span></div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;  <span class="comment">//}</span></div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;</div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;  had.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a8673e70390fe194d7268ac18fa3373b2">id</a>(had.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a8673e70390fe194d7268ac18fa3373b2">id</a>() * (<span class="keywordtype">id</span>[0] &lt; 0 ? -1 : 1));</div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;}</div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;<span class="comment">//sets id of formed meson based on quark content, mass of quark system, and if the meson formed into an excited state</span></div>
<div class="line"><a name="l03819"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a8146cecfad1846f815525e7ca931646d"> 3819</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#a8146cecfad1846f815525e7ca931646d">HybridHadronization::set_meson_id</a>(<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a>&amp; qrks, <a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html">HHhadron</a>&amp; had, <span class="keywordtype">int</span> l, <span class="keywordtype">int</span> <a class="code" href="../../db/d14/pythia__commons_8h.html#a7a16daa873b7e70e2e15b8e71b1fa971">k</a>){</div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;        <span class="comment">//assigning quark_ids in descending order to construct meson id</span></div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;        <span class="keywordtype">int</span> <span class="keywordtype">id</span>[2] = {qrks[0].id(), qrks[1].id()};</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;        <span class="keywordflow">if</span>(std::abs(qrks[1].<span class="keywordtype">id</span>()) &gt; std::abs(qrks[0].<span class="keywordtype">id</span>())){</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;    <a class="code" href="../../d6/db0/fjcore_8hh.html#ac71f249d840a70f8b3aaffb721843eaa">std::swap</a>(<span class="keywordtype">id</span>[0], <span class="keywordtype">id</span>[1]);</div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;  }</div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;</div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;  <span class="comment">//  Don&#39;t need the following any more</span></div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;  <span class="comment">//    double mass_pi0, mass_eta, mass_omegam, mass_etap, mass_phi; //mass_rho;</span></div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;  <span class="comment">//    mass_pi0    = 0.1349770;</span></div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;  <span class="comment">//    mass_eta    = 0.547862;</span></div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;  <span class="comment">//    mass_rho    = 0.7690;</span></div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;  <span class="comment">//    mass_omegam = 0.78265;</span></div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;  <span class="comment">//    mass_etap   = 0.95778;</span></div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;  <span class="comment">//    mass_phi    = 1.019460;</span></div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;        <span class="keywordtype">int</span> baseid = 0;</div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;  <span class="comment">// Determine spin quantum number statistically</span></div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;  <span class="keywordtype">int</span> spin_qnum = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.25) ? 1 : 0;</div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;</div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;  <span class="comment">// Determine total angular momentum statistically</span></div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;        <span class="keywordtype">int</span> j_qnum = spin_qnum;</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;        <span class="keywordflow">if</span>(l &gt; 0 &amp;&amp; spin_qnum == 1){</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;                <span class="keywordtype">double</span> random = <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;</div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;                <span class="keywordflow">if</span>((2.*l-1.)/(3.*(2.*l+1.)) &gt;= random){j_qnum = l - 1;}</div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(1./3. + (2.*l-1.)/(3.*(2.*l+1.)) &gt;= random){j_qnum = l;}</div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;                <span class="keywordflow">else</span>{j_qnum = l + 1;}</div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;        }</div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (spin_qnum == 0){j_qnum = l;}</div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;</div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;  <span class="comment">// All meson quantum numbers are now known</span></div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;</div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;  <span class="keywordtype">int</span> basesign = 1;</div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;        <span class="comment">//if isospin I3=0</span></div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;        <span class="keywordflow">if</span>(<span class="keywordtype">id</span>[0] == -<span class="keywordtype">id</span>[1]){</div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.25){       <span class="comment">//spin triplet</span></div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;                        <span class="keywordflow">if</span>(std::abs(<span class="keywordtype">id</span>[0])==5){baseid = 550;}                                   <span class="comment">// Upsilon</span></div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;                        <span class="keywordflow">if</span>(std::abs(<span class="keywordtype">id</span>[0])==4){baseid = 440;}                                   <span class="comment">// J/psi</span></div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;                        <span class="keywordflow">if</span>(std::abs(<span class="keywordtype">id</span>[0])==3){baseid = 330;}                                   <span class="comment">// phi</span></div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;                        <span class="keywordflow">if</span>((std::abs(<span class="keywordtype">id</span>[0])==1) || (std::abs(<span class="keywordtype">id</span>[0]) == 2)){</div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;                                <span class="keywordflow">if</span>(<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>()&gt;0.5){baseid = 220;} <span class="keywordflow">else</span>{baseid = 110;}</div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;                        }       <span class="comment">// omega and rho</span></div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;                }</div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;                <span class="keywordflow">else</span>{   <span class="comment">// spin singlet</span></div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;                        <span class="keywordflow">if</span>(std::abs(<span class="keywordtype">id</span>[0])==5){baseid = 550; }                                  <span class="comment">// etaB</span></div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;                        <span class="keywordflow">if</span>(std::abs(<span class="keywordtype">id</span>[0])==4){baseid = 440; }                                  <span class="comment">// etac</span></div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;                        <span class="keywordflow">if</span>(std::abs(<span class="keywordtype">id</span>[0])==3){<span class="keywordflow">if</span>(<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>()&gt;0.666){baseid = 330;} <span class="keywordflow">else</span>{baseid = 220;}}      <span class="comment">// eta&#39; and eta</span></div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;                        <span class="keywordflow">if</span>(std::abs(<span class="keywordtype">id</span>[0])&lt;3){</div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;                                <span class="keywordtype">double</span> prb = <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;                                <span class="keywordflow">if</span>(prb&gt;0.5){baseid = 110;}                                                      <span class="comment">// pi0</span></div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(prb&gt;0.333){baseid = 220;}                               <span class="comment">// eta</span></div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;                                <span class="keywordflow">else</span>{baseid = 330;}                                                                         <span class="comment">// eta&#39;</span></div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;                        }</div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;                }</div>
<div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;        }</div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;        <span class="comment">// if isospin I3 not 0</span></div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;                baseid = 100*std::abs(<span class="keywordtype">id</span>[0])+10*std::abs(<span class="keywordtype">id</span>[1]);</div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;                <span class="keywordflow">if</span>(<span class="keywordtype">id</span>[0]%2 == 0){basesign = 2*std::signbit(-<span class="keywordtype">id</span>[0])-1;}</div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;                <span class="keywordflow">else</span>{            basesign = 2*std::signbit( <span class="keywordtype">id</span>[0])-1;}</div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;        }</div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;</div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;  <span class="comment">// Put everything together: first digit (from the right)</span></div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;  <span class="keywordflow">if</span>(j_qnum &lt; 5){baseid += 2*j_qnum + 1;}</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;        <span class="keywordflow">else</span>{baseid += 8;}</div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;</div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;  <span class="comment">// 5th digit</span></div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;  <span class="keywordflow">if</span>(l &gt; 0 &amp;&amp; spin_qnum == 0){baseid += 10000;}</div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(l &gt; 0 &amp;&amp; spin_qnum == 1 &amp;&amp; l == j_qnum){baseid += 20000;}</div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(l &gt; 1 &amp;&amp; spin_qnum == 1 &amp;&amp; l == j_qnum + 1){baseid += 30000;}</div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(l == 1 &amp;&amp; spin_qnum == 1 &amp;&amp; l == j_qnum + 1){baseid += 10000;}</div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;</div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;  <span class="comment">// 6th digit</span></div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;        <span class="keywordflow">if</span>(k &lt; 10){baseid += k*100000;}</div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;        <span class="keywordflow">else</span>{baseid += 900000;}</div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;</div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;  <span class="comment">// If we don&#39;t want Goldstone bosons convert them to vector mesons here</span></div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;  <span class="keywordflow">if</span>(!goldstonereco){</div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;    <span class="keywordflow">if</span>(baseid == 211){baseid = 213;} <span class="comment">//fixed pi+- -&gt; rho+-</span></div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;          <span class="keywordflow">if</span>(baseid == 311){baseid = 313;} <span class="comment">// fixed for K+- -&gt; K*+-</span></div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;          <span class="keywordflow">if</span>(baseid == 321){baseid = 323;} <span class="comment">// fixed for K0 -&gt; K*0</span></div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;          <span class="keywordflow">if</span>(baseid == 111){baseid = 113;} <span class="comment">//fixed for pi0 -&gt; rho0</span></div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;  }</div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;  baseid *= basesign;</div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;</div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;  had.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a8673e70390fe194d7268ac18fa3373b2">id</a>( baseid );</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;}</div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;</div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;<span class="comment">//gluon decay function</span></div>
<div class="line"><a name="l03914"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#abee737ea2e514f26b11bf4826fb563fc"> 3914</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#abee737ea2e514f26b11bf4826fb563fc">HybridHadronization::gluon_decay</a>(<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a>&amp; glu, <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a>&amp; qrks){</div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;</div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> q1, q2;</div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;        <span class="comment">//these are placeholders - might want to instead use values directly from partons...</span></div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;        <span class="keywordtype">double</span> qmass, glu_e;</div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;</div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;        <span class="comment">//if set to already be not on-shell, but not initially set!</span></div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;        <span class="comment">//glu.mass = sqrt(glu.e()*glu.e() - glu.px()*glu.px() - glu.py()*glu.py() - glu.pz()*glu.pz());</span></div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;        <span class="comment">//glu_e = glu.e();</span></div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;        glu_e = sqrt(glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>() + glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>());</div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;</div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;        <span class="comment">//choosing qqbar ids (u, d, or s)</span></div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;        <span class="comment">//assuming that xms &gt;= xmq (bad things *could* happen if not...)</span></div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;        <span class="keywordflow">if</span>(glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>() &gt; 2.*xms){</div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;                <span class="comment">//******** ratio = Gamma(g-&gt;ssbar)/Gamma(g-&gt;uubar, ddbar) ******</span></div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;                <span class="keywordtype">double</span> ratio = 0.5*sqrt((glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()-4.*xms*xms)/(glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()-4.*xmq*xmq))*((glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()+2.*xms*xms)/(glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()+2.*xmq*xmq));</div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;                <span class="keywordtype">double</span> prob = <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;                <span class="keywordflow">if</span>(prob &lt;= ratio/(1.+ratio)){qmass = xms; q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(3); q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-3); q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xms); q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xms);}</div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>((prob &gt; ratio/(1.+ratio)) &amp;&amp; (prob &lt;= (0.5+ratio)/(1.+ratio))){qmass = xmq; q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(1); q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-1); q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq); q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);}</div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;                <span class="keywordflow">else</span>{ <span class="comment">/*if (prob &gt; (0.5+ratio)/(1.+ratio))*/</span> qmass = xmq; q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(2); q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-2); q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq); q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);}</div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;                <span class="keywordtype">double</span> prob = <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;                <span class="keywordflow">if</span>(prob &lt;= 0.5){qmass = xmq; q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(1); q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-1); q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq); q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);}</div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;                <span class="keywordflow">else</span>{           qmass = xmq; q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(2); q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-2); q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq); q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);}</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;        }</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;</div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;        <span class="comment">//gluon velocity</span></div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;        <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> Betag;</div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;        Betag.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(-glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()/glu_e,-glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()/glu_e,-glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()/glu_e,0.);</div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;        <span class="keywordtype">double</span> sum2 = Betag.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*Betag.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>() + Betag.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*Betag.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>() + Betag.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*Betag.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>();</div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;        <span class="keywordflow">if</span>(sum2 &lt; 1.){Betag.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(Betag.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),Betag.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),Betag.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),1./sqrt(1.-sum2));}</div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;</div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;        <span class="comment">//setting the q-qbar momenta, starting in gluon rest frame</span></div>
<div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;        <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> Pq_CM, Pq1, Pq2;</div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;        <span class="keywordtype">double</span> pq = (glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>() &gt; 2.*qmass) ? sqrt(glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()/4. - qmass*qmass) : 0.;</div>
<div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d6/d34/namespaceActsTests_1_1PropagationDatasets.html#a6bf99c39b54ef8ee8852d75bed834249">theta</a> = acos(1.-2.*<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>()); <span class="keywordtype">double</span> <a class="code" href="../../d6/d34/namespaceActsTests_1_1PropagationDatasets.html#a4722f5524134f5f139681f91e6c50038">phi</a> = 2*<a class="code" href="../../db/ddd/namespaceJetscape.html#aa3153918fc294a7c25c463fe462fd51f">pi</a>*<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;        Pq_CM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pq*sin(theta)*cos(phi),pq*sin(theta)*sin(phi),pq*cos(theta),sqrt(qmass*qmass+pq*pq));</div>
<div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;        Pq1 = HHboost(Betag,Pq_CM);</div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;        Pq_CM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(-Pq_CM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),-Pq_CM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),-Pq_CM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),Pq_CM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>());</div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;        Pq2 = HHboost(Betag,Pq_CM);</div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;        q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a54a5a56d901984aac1480e14a43d2a46">P</a>(Pq1); q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a54a5a56d901984aac1480e14a43d2a46">P</a>(Pq2);</div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;  q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>(glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>()); q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>(glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>());</div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;</div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;  <span class="comment">// propagate quarks</span></div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;  <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> position1;</div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;  <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> position2;</div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;  position1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a51d252718fbe2c74369041a231f4a186">x</a>()+(Pq1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>() / qmass)*part_prop,glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a08c82f3d9df5f16ac663f2fd1457b07d">y</a>()+(Pq1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>() / qmass)*part_prop,glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a73547d7fbba88c93bd3b20ff9ef02b4e">z</a>()+(Pq1.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>() / qmass)*part_prop,glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>()+part_prop);</div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;  position2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a51d252718fbe2c74369041a231f4a186">x</a>()+(Pq2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>() / qmass)*part_prop,glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a08c82f3d9df5f16ac663f2fd1457b07d">y</a>()+(Pq2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>() / qmass)*part_prop,glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a73547d7fbba88c93bd3b20ff9ef02b4e">z</a>()+(Pq2.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>() / qmass)*part_prop,glu.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>()+part_prop);</div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;  q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a468852aa1276452a6b45cba8f7aeafae">pos</a>(position1); q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a468852aa1276452a6b45cba8f7aeafae">pos</a>(position2);</div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;</div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;        qrks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(q1); qrks.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(q2);</div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;}</div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;</div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;<span class="comment">//finding a thermal sibling for a thermal parton in therm</span></div>
<div class="line"><a name="l03968"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a1c901f645209728c8f8ab39a5e5933aa"> 3968</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#a1c901f645209728c8f8ab39a5e5933aa">HybridHadronization::findthermalsibling</a>(<span class="keywordtype">int</span> ithm, <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a>&amp; therm){</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;        <span class="keywordflow">if</span>(!therm[therm[ithm].sibling()].is_used() &amp;&amp; (therm[therm[ithm].sibling()].string_id() &lt; 0) &amp;&amp; (ithm != therm[ithm].sibling())){<span class="keywordflow">return</span> therm[ithm].sibling();}</div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;        <span class="keywordtype">int</span> qrk_close = -1; <span class="keywordtype">double</span> dist2min = 999999999999.;</div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;therm.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;                <span class="keywordflow">if</span>((therm[ithm].<span class="keywordtype">id</span>() * therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() &gt; 0) || therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used()){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;                <span class="keywordtype">double</span> distnow = therm[ithm].posDif2(therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]) + (therm[ithm].x_t()-therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t())*(therm[ithm].x_t()-therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t());</div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;                <span class="keywordflow">if</span>(distnow &lt; dist2min){qrk_close = <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>; dist2min = distnow;}</div>
<div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;        }</div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;        <span class="keywordflow">if</span>(qrk_close == -1){qrk_close = ithm;}</div>
<div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;        <span class="keywordflow">return</span> qrk_close;</div>
<div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;}</div>
<div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;</div>
<div class="line"><a name="l03980"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#adefe97cd4fb1ea17190c14a91f2974ed"> 3980</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#adefe97cd4fb1ea17190c14a91f2974ed">HybridHadronization::findcloserepl</a>(<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> ptn, <span class="keywordtype">int</span> iptn, <span class="keywordtype">bool</span> lbt, <span class="keywordtype">bool</span> thm, <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a>&amp; sh_lbt, <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a>&amp; therm){</div>
<div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;</div>
<div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;        <span class="comment">//should not happen</span></div>
<div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;        <span class="keywordflow">if</span>(iptn == 0 || ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() == 21){<span class="keywordflow">throw</span> std::runtime_error (<span class="stringliteral">&quot;Parton index is incorrect (should not be 0 or gluon)&quot;</span>);}</div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;</div>
<div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;        <span class="comment">//if the parton is thermal, and we&#39;re only looking at thermal partons, and the sibling was already found &amp; not used, then return that.</span></div>
<div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;        <span class="keywordflow">if</span>((iptn&lt;0) &amp;&amp; thm &amp;&amp; !lbt &amp;&amp; !therm[ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac275e6686a7ab3e3797f449d14dbf0a5">sibling</a>()].is_used() &amp;&amp;</div>
<div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;          (((therm[ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac275e6686a7ab3e3797f449d14dbf0a5">sibling</a>()].id() &gt; 0) &amp;&amp; (therm[ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac275e6686a7ab3e3797f449d14dbf0a5">sibling</a>()].col() != 0)) || ((therm[ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac275e6686a7ab3e3797f449d14dbf0a5">sibling</a>()].id() &lt; 0) &amp;&amp; (therm[ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac275e6686a7ab3e3797f449d14dbf0a5">sibling</a>()].acol() != 0))) &amp;&amp;</div>
<div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;          (iptn+1 != ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac275e6686a7ab3e3797f449d14dbf0a5">sibling</a>())){<span class="keywordflow">return</span> ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac275e6686a7ab3e3797f449d14dbf0a5">sibling</a>();}</div>
<div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;</div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;        <span class="comment">//initializing vars</span></div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;        <span class="keywordtype">int</span> qrk_close = 999999999; <span class="keywordtype">double</span> dist2min = 999999999999.;</div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;        <span class="comment">//checking thermal partons for closest parton</span></div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;        <span class="keywordflow">if</span>(thm){<span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;therm.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;                <span class="comment">//if the parton&#39;s color tag is not 0, then skip (is already repairing a string)</span></div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;                <span class="keywordflow">if</span>(((therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() &gt; 0) &amp;&amp; (therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() != 0)) || ((therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].id() &lt; 0) &amp;&amp; (therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol() != 0))){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;                <span class="comment">//if the parton is not a partner (eg. both quarks/antiquarks), or is used, or is the same as the input parton, skip it.</span></div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;                <span class="keywordflow">if</span>((ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() * therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].id() &gt; 0) || therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used() || ((iptn&lt;0) &amp;&amp; (-<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> == iptn+1))){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;                <span class="keywordtype">double</span> distnow = ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a2330f1d50e69e4a192246b54b0e167dc">posDif2</a>(therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]) + (ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>()-therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t())*(ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>()-therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t());</div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;                <span class="keywordflow">if</span>(distnow &lt; dist2min){qrk_close = -i-1; dist2min = distnow;}</div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;        }}</div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;        <span class="comment">//checking lbt partons for closest parton</span></div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;        <span class="keywordflow">if</span>(lbt){<span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;sh_lbt.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;                <span class="comment">//if gluon, skip</span></div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;                <span class="keywordflow">if</span>(sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() == 21){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;                <span class="comment">//if the parton&#39;s color tag is not 0, then skip (not an lbt/martini? parton)</span></div>
<div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;                <span class="keywordflow">if</span>(((sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() &gt; 0) &amp;&amp; (sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() != 0)) || ((sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].id() &lt; 0) &amp;&amp; (sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol() != 0))){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;                <span class="comment">//if the parton is not a partner (eg. both quarks/antiquarks), or is used, or is the same as the input parton, skip it.</span></div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;                <span class="keywordflow">if</span>((ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() * sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].id() &gt; 0) || sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used() || ((iptn&gt;0) &amp;&amp; (<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> == iptn-1))){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;                <span class="keywordtype">double</span> distnow = ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a2330f1d50e69e4a192246b54b0e167dc">posDif2</a>(sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]) + (ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>()-sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t())*(ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>()-sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t());</div>
<div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;                <span class="keywordflow">if</span>(distnow &lt; dist2min){qrk_close = i+1; dist2min = distnow;}</div>
<div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;        }}</div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;</div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;        <span class="comment">//positive return values indicate an lbt parton in the shower was found (the (i-1)th parton)</span></div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;        <span class="comment">//negative return values indicate a thermal parton was found (the -(i+1)th parton)</span></div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;        <span class="keywordflow">return</span> qrk_close;</div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;}</div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;</div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;<span class="comment">//version to handle finding a q-qbar pair for lbt gluons</span></div>
<div class="line"><a name="l04019"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#ab96ad6bdc7ba813eed64fd682bc43c60"> 4019</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#ab96ad6bdc7ba813eed64fd682bc43c60">HybridHadronization::findcloserepl_glu</a>(<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> ptn, <span class="keywordtype">int</span> iptn, <span class="keywordtype">bool</span> lbt, <span class="keywordtype">bool</span> thm, <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a>&amp; sh_lbt, <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a>&amp; therm, <span class="keywordtype">int</span> sel_out[]){</div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;</div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;        <span class="comment">//should not happen</span></div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;        <span class="keywordflow">if</span>(iptn == 0 || ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() != 21){<span class="keywordflow">throw</span> std::runtime_error (<span class="stringliteral">&quot;Parton index is incorrect (should not be 0, or anything other than gluon)&quot;</span>);}</div>
<div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;        <span class="keywordflow">if</span>(ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#af3f776ba437bcde57670e1ae0621d81f">is_thermal</a>()){<span class="keywordflow">throw</span> std::runtime_error (<span class="stringliteral">&quot;Parton is thermal (should not be so)&quot;</span>);}</div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;</div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;        <span class="comment">//initializing vars</span></div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;        <span class="keywordtype">int</span> qrk_close = 999999999; <span class="keywordtype">double</span> dist2min = 999999999999.;</div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;        <span class="comment">//checking thermal partons for closest quark</span></div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;        <span class="keywordflow">if</span>(thm){<span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;therm.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;                <span class="comment">//if the parton&#39;s color tag is not 0, then skip (is already repairing a string), or skip if antiquark</span></div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;                <span class="keywordflow">if</span>(((therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() &gt; 0) &amp;&amp; (therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() != 0)) || (therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].id() &lt; 0)){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;                <span class="comment">//if the parton is not a partner (eg. both quarks/antiquarks), or is used, or is the same as the input parton, skip it.</span></div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;                <span class="keywordflow">if</span>(therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used() || ((iptn&lt;0) &amp;&amp; (-<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> == iptn+1))){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;                <span class="keywordtype">double</span> distnow = ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a2330f1d50e69e4a192246b54b0e167dc">posDif2</a>(therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]) + (ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>()-therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t())*(ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>()-therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t());</div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;                <span class="keywordflow">if</span>(distnow &lt; dist2min){qrk_close = -i-1; dist2min = distnow;}</div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;        }}</div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;        <span class="comment">//checking lbt partons for closest parton</span></div>
<div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;        <span class="keywordflow">if</span>(lbt){<span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;sh_lbt.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;                <span class="comment">//if gluon, skip</span></div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;                <span class="keywordflow">if</span>(sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() == 21){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;                <span class="comment">//if the parton&#39;s color tag is not 0, then skip (not an lbt/martini? parton), or skip if antiquark</span></div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;                <span class="keywordflow">if</span>(((sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() &gt; 0) &amp;&amp; (sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() != 0)) || (sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].id() &lt; 0)){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;                <span class="comment">//if the parton is not a partner (eg. both quarks/antiquarks), or is used, or is the same as the input parton, skip it.</span></div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;                <span class="keywordflow">if</span>(sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used() || ((iptn&gt;0) &amp;&amp; (<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> == iptn-1))){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;                <span class="keywordtype">double</span> distnow = ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a2330f1d50e69e4a192246b54b0e167dc">posDif2</a>(sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]) + (ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>()-sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t())*(ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>()-sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t());</div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;                <span class="keywordflow">if</span>(distnow &lt; dist2min){qrk_close = i+1; dist2min = distnow;}</div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;        }}</div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;</div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;        <span class="comment">//positive return values indicate an lbt parton in the shower was found (the (i-1)th parton)</span></div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;        <span class="comment">//negative return values indicate a thermal parton was found (the -(i+1)th parton)</span></div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;        sel_out[0]=qrk_close;</div>
<div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;</div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;        qrk_close = 999999999; dist2min = 999999999999.;</div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;        <span class="comment">//checking thermal partons for closest antiquark</span></div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;        <span class="keywordflow">if</span>(thm){<span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;therm.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;                <span class="comment">//if the parton&#39;s color tag is not 0, then skip (is already repairing a string), or skip if quark</span></div>
<div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;                <span class="keywordflow">if</span>((therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() &gt; 0) || ((therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].id() &lt; 0) &amp;&amp; (therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol() != 0))){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;                <span class="comment">//if the parton is not a partner (eg. both quarks/antiquarks), or is used, or is the same as the input parton, skip it.</span></div>
<div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;                <span class="keywordflow">if</span>(therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used() || ((iptn&lt;0) &amp;&amp; (-<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> == iptn+1))){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;                <span class="keywordtype">double</span> distnow = ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a2330f1d50e69e4a192246b54b0e167dc">posDif2</a>(therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]) + (ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>()-therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t())*(ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>()-therm[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t());</div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;                <span class="keywordflow">if</span>(distnow &lt; dist2min){qrk_close = -i-1; dist2min = distnow;}</div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;        }}</div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;        <span class="comment">//checking lbt partons for closest parton</span></div>
<div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;        <span class="keywordflow">if</span>(lbt){<span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;sh_lbt.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>();++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;                <span class="comment">//if gluon, skip</span></div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;                <span class="keywordflow">if</span>(sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() == 21){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;                <span class="comment">//if the parton&#39;s color tag is not 0, then skip (not an lbt/martini? parton), or skip if quark</span></div>
<div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;                <span class="keywordflow">if</span>((sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>() &gt; 0) || ((sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].id() &lt; 0) &amp;&amp; (sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol() != 0))){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;                <span class="comment">//if the parton is not a partner (eg. both quarks/antiquarks), or is used, or is the same as the input parton, skip it.</span></div>
<div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;                <span class="keywordflow">if</span>(sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_used() || ((iptn&gt;0) &amp;&amp; (<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> == iptn-1))){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;                <span class="keywordtype">double</span> distnow = ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a2330f1d50e69e4a192246b54b0e167dc">posDif2</a>(sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]) + (ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>()-sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t())*(ptn.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a23c25c6651f44093daba38e6e9cf1e5b">x_t</a>()-sh_lbt[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t());</div>
<div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;                <span class="keywordflow">if</span>(distnow &lt; dist2min){qrk_close = i+1; dist2min = distnow;}</div>
<div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;        }}</div>
<div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;</div>
<div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;        <span class="comment">//positive return values indicate an lbt parton in the shower was found (the (i-1)th parton)</span></div>
<div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;        <span class="comment">//negative return values indicate a thermal parton was found (the -(i+1)th parton)</span></div>
<div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;        sel_out[1]=qrk_close;</div>
<div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;}</div>
<div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;</div>
<div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;<span class="comment">//prepares remnant partons/strings for PYTHIA string hadronization</span></div>
<div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;<span class="comment">//sorts strings, ensures strings are in &#39;valid&#39; configurations, assigns color/anticolor tags</span></div>
<div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;<span class="comment">//TODO: this might be where to use thermal partons to enforce color neutrality</span></div>
<div class="line"><a name="l04082"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#ac94d37fd8210ac8dc2e4d883024f64d4"> 4082</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#ac94d37fd8210ac8dc2e4d883024f64d4">HybridHadronization::stringprep</a>(<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a>&amp; SP_remnants, <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a>&amp; SP_prepremn, <span class="keywordtype">bool</span> cutstr){</div>
<div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;  <span class="comment">//dignostic measure</span></div>
<div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;  <span class="comment">/*std::cout &lt;&lt;endl&lt;&lt;&quot;below is all the colors in the Tempjunction lists&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;<span class="comment">  for(int ijunc=0; ijunc&lt;Tempjunctions.size(); ijunc++){</span></div>
<div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot; { &quot;&lt;&lt;Tempjunctions.at(ijunc).at(0).at(0)&lt;&lt;&quot; , &quot;&lt;&lt;Tempjunctions.at(ijunc).at(1).at(1)&lt;&lt;&quot; , &quot;&lt;&lt;Tempjunctions.at(ijunc).at(2).at(1)&lt;&lt;&quot; , &quot;&lt;&lt;Tempjunctions.at(ijunc).at(3).at(1)&lt;&lt;&quot; } &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot;col/acol: (&quot; &lt;&lt; Tempjunctions.at(ijunc).at(1).at(0) &lt;&lt; &quot;,&quot; &lt;&lt; Tempjunctions.at(ijunc).at(2).at(0) &lt;&lt; &quot;,&quot; &lt;&lt; Tempjunctions.at(ijunc).at(3).at(0) &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;  <span class="comment">//Declare essential vectors for string repair</span></div>
<div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;  vector&lt;vector&lt;vector&lt;HHparton&gt;&gt;&gt; JuncStructure;</div>
<div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;  vector&lt;vector&lt;HHparton&gt;&gt; JuncLegs; <span class="comment">// vector of all junction ( Junction Num, Leg1, Leg2, Leg3)</span></div>
<div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;  vector&lt;HHparton&gt; Leg1; <span class="comment">// partons in the legs for juncion formation</span></div>
<div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;  vector&lt;HHparton&gt; Leg2;</div>
<div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;  vector&lt;HHparton&gt; Leg3;</div>
<div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;  vector&lt;int&gt; Legconsidering;<span class="comment">//address of partons in SP_remnants</span></div>
<div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;  vector&lt;vector&lt;vector&lt;int&gt;&gt;&gt; IMStructure1; <span class="comment">//Intermediate structure for saving the indices in Tempjunction and Corresponding Leg Number, this will be used for cutting string for appending info to PYTHIA</span></div>
<div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;  vector&lt;vector&lt;int&gt;&gt; IMStructure2; <span class="comment">// this will contain Tempjunction Indice and -+1 and leg numbers</span></div>
<div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;  <span class="comment">//ex. 2nd lef in 3rd temp anti junction is same as 1st leg 2nd tempjunction. 3,-1,0,0   3,1,2,0 would be saved in the vectorIMS1</span></div>
<div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;  vector&lt;int&gt; IMStructure3; <span class="comment">// 4 element vector of Tempjunction order, kind and leg address in JuncStructure vector</span></div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;  vector&lt;vector&lt;HHparton&gt;&gt; Recombearly1; <span class="comment">//these partons are in the junction with three or two shared legs with others , and they will be recombined into baryon to cut? or arrange the string for PYTHIA to understand input come from this code</span></div>
<div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;  vector&lt;HHparton&gt; Recombearly2;</div>
<div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;  vector&lt;vector&lt;vector&lt;HHparton&gt;&gt;&gt; Dijunction1; <span class="comment">// these partons are in the junction with two legs shared legs!</span></div>
<div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;  vector&lt;vector&lt;HHparton&gt;&gt; Dijunction2;</div>
<div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;  <span class="comment">//Vector of Indices for Dijunction1 vector to be ordered for invoking Pythia</span></div>
<div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;  vector&lt;vector&lt;int&gt;&gt; DijunctionInfo1;</div>
<div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;  vector&lt;int&gt; DijunctionInfo2; <span class="comment">//  { -1: antiJ, +1 : J , 0 : shared leg}</span></div>
<div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;  <span class="comment">//these tags should be assigned to corresponding legs in Dijunction1 vector! so DijunctionInfo2 has five elements{since, dijunction structure has five legs!}</span></div>
<div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;</div>
<div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;</div>
<div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;  vector&lt;vector&lt;vector&lt;HHparton&gt;&gt;&gt; Singlejunction1; <span class="comment">// easiest case! just single string</span></div>
<div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;  vector&lt;vector&lt;HHparton&gt;&gt; Singlejunction2;</div>
<div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;  vector&lt;vector&lt;HHparton&gt;&gt; Tailoredstring1; <span class="comment">// when there are the junction with two shared legs, it also should be recombined into baryon and one string will remain after, which would be saved in this vector</span></div>
<div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;  vector&lt;HHparton&gt; Tailoredstring2;</div>
<div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;  vector&lt;int&gt; realjuncindice; <span class="comment">// vector to save the indice of Tempjunction when real junction is formed by three initiating particle</span></div>
<div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;</div>
<div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;  vector&lt;HHparton&gt; finalstring; <span class="comment">// final space for all of the remnant particles being corrected by fake parton addition</span></div>
<div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;</div>
<div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;  <span class="comment">/*JSINFO &lt;&lt; &quot;SP_remnants before stringprep:&quot;;</span></div>
<div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;<span class="comment">  for(int irem=0; irem &lt; SP_remnants.num(); ++irem) {</span></div>
<div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;<span class="comment">    std::cout &lt;&lt; SP_remnants[irem].id() &lt;&lt; &quot;,&quot; &lt;&lt; SP_remnants[irem].col() &lt;&lt; &quot;,&quot; &lt;&lt; SP_remnants[irem].acol() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;</div>
<div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;  <span class="comment">// Tempjunctions missing partons? Add thermal or fake</span></div>
<div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;  <span class="comment">// find the maximum (anti-)color tag in the remnants list and the tempjunctions</span></div>
<div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;  <span class="keywordtype">int</span> maxtag = 0;</div>
<div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irem=0; irem &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++irem) {</div>
<div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;    <span class="keywordflow">if</span>(SP_remnants[irem].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() &gt; maxtag) {</div>
<div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;      maxtag = SP_remnants[irem].col();</div>
<div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;    }</div>
<div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;    <span class="keywordflow">if</span>(SP_remnants[irem].acol() &gt; maxtag) {</div>
<div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;      maxtag = SP_remnants[irem].acol();</div>
<div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;    }</div>
<div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;  }</div>
<div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ijunc=0; ijunc &lt; Tempjunctions.size(); ++ijunc) {</div>
<div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;    <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(1).at(1) &gt; maxtag) {</div>
<div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;      maxtag = Tempjunctions.at(ijunc).at(1).at(1);</div>
<div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;    }</div>
<div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;    <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(2).at(1) &gt; maxtag) {</div>
<div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;      maxtag = Tempjunctions.at(ijunc).at(2).at(1);</div>
<div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;    }</div>
<div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;    <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(3).at(1) &gt; maxtag) {</div>
<div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;      maxtag = Tempjunctions.at(ijunc).at(3).at(1);</div>
<div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;    }</div>
<div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;  }</div>
<div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;</div>
<div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> tempparton1;</div>
<div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> tempparton2;</div>
<div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;  <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> tempparton3;</div>
<div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ijunc=0; ijunc &lt; Tempjunctions.size(); ++ijunc) {</div>
<div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;    <span class="keywordtype">int</span> i1 = 0; <span class="keywordtype">int</span> i2 = 0; <span class="keywordtype">int</span> i3 = 0;</div>
<div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;</div>
<div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;    <span class="comment">// First try to match to remant parton color/anticolor tags and write matching parton index into tag</span></div>
<div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irem=0; irem &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++irem) {</div>
<div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;      <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == -1) {</div>
<div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;        <span class="keywordflow">if</span>(SP_remnants[irem].acol() == Tempjunctions.at(ijunc).at(1).at(1) &amp;&amp; Tempjunctions.at(ijunc).at(1).at(1) != 0) {i1 = irem+1;}</div>
<div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;        <span class="keywordflow">if</span>(SP_remnants[irem].acol() == Tempjunctions.at(ijunc).at(2).at(1) &amp;&amp; Tempjunctions.at(ijunc).at(2).at(1) != 0) {i2 = irem+1;}</div>
<div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;        <span class="keywordflow">if</span>(SP_remnants[irem].acol() == Tempjunctions.at(ijunc).at(3).at(1) &amp;&amp; Tempjunctions.at(ijunc).at(3).at(1) != 0) {i3 = irem+1;}</div>
<div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == 1) {</div>
<div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;        <span class="keywordflow">if</span>(SP_remnants[irem].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(1).at(1) &amp;&amp; Tempjunctions.at(ijunc).at(1).at(1) != 0) {i1 = irem+1;}</div>
<div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;        <span class="keywordflow">if</span>(SP_remnants[irem].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(2).at(1) &amp;&amp; Tempjunctions.at(ijunc).at(2).at(1) != 0) {i2 = irem+1;}</div>
<div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;        <span class="keywordflow">if</span>(SP_remnants[irem].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(3).at(1) &amp;&amp; Tempjunctions.at(ijunc).at(3).at(1) != 0) {i3 = irem+1;}</div>
<div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;      }</div>
<div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;    }</div>
<div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;</div>
<div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;    <span class="comment">// Now try to find partners in another temp junction, store junction and leg number as a negative tag</span></div>
<div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ijunc2=ijunc+1; ijunc2 &lt; Tempjunctions.size(); ++ijunc2) {</div>
<div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;      <span class="keywordflow">if</span>((Tempjunctions.at(ijunc).at(0).at(0) == -1 &amp;&amp; Tempjunctions.at(ijunc2).at(0).at(0) == 1) || (Tempjunctions.at(ijunc).at(0).at(0) == 1 &amp;&amp; Tempjunctions.at(ijunc2).at(0).at(0) == -1)) {</div>
<div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ileg=1; ileg &lt;= 3; ++ileg) {</div>
<div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;          <span class="keywordflow">if</span>(Tempjunctions.at(ijunc2).at(ileg).at(1) == Tempjunctions.at(ijunc).at(1).at(1) &amp;&amp; Tempjunctions.at(ijunc).at(1).at(1) != 0) {i1 = -ijunc2*10-ileg;}</div>
<div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;          <span class="keywordflow">if</span>(Tempjunctions.at(ijunc2).at(ileg).at(1) == Tempjunctions.at(ijunc).at(2).at(1) &amp;&amp; Tempjunctions.at(ijunc).at(2).at(1) != 0) {i2 = -ijunc2*10-ileg;}</div>
<div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;          <span class="keywordflow">if</span>(Tempjunctions.at(ijunc2).at(ileg).at(1) == Tempjunctions.at(ijunc).at(3).at(1) &amp;&amp; Tempjunctions.at(ijunc).at(3).at(1) != 0) {i3 = -ijunc2*10-ileg;}</div>
<div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;        }</div>
<div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;      }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;        <span class="keywordtype">bool</span> warning = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ileg=1; ileg &lt;= 3; ++ileg) {</div>
<div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jleg=1; jleg &lt;= 3; ++jleg) {</div>
<div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;            <span class="keywordflow">if</span> (Tempjunctions.at(ijunc).at(ileg).at(1) == Tempjunctions.at(ijunc2).at(jleg).at(1)) {</div>
<div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;              warning = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;            }</div>
<div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;          }</div>
<div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;        }</div>
<div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;        <span class="keywordflow">if</span>(warning) {</div>
<div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;          <a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;There is a junction pair which is not junction-antijunction, but junction-junction or antijunction-antijunction. This should not happen!&quot;</span>;</div>
<div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;        }</div>
<div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;      }</div>
<div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;    }</div>
<div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;</div>
<div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;    <span class="comment">// define temporary parton to be used in findclosereplica</span></div>
<div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;    <span class="keywordflow">if</span>(i1 &lt;= 0) {</div>
<div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;      <span class="keywordflow">if</span>(i2 &gt; 0){</div>
<div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;        tempparton1 = SP_remnants[i2-1];</div>
<div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;        <span class="keywordflow">if</span>(std::abs(tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6){ <span class="comment">// no change of colors here, they are not important in findclosereplica</span></div>
<div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;          tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());</div>
<div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;        }</div>
<div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(i3 &gt; 0){</div>
<div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;        tempparton1 = SP_remnants[i3-1];</div>
<div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;        <span class="keywordflow">if</span>(std::abs(tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6){</div>
<div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;          tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());</div>
<div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;        }</div>
<div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;      }<span class="keywordflow">else</span>{ <span class="comment">// should be very rare: junction with 3 ghost legs</span></div>
<div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;        tempparton1 = SP_remnants[0];</div>
<div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == -1 &amp;&amp; std::abs(tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6 &amp;&amp; tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() &lt; 0){</div>
<div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;          tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());</div>
<div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == 1 &amp;&amp; std::abs(tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6 &amp;&amp; tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() &gt; 0){</div>
<div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;          tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());</div>
<div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;        }</div>
<div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;      }</div>
<div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;    }</div>
<div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;    <span class="keywordflow">if</span>(i2 &lt;= 0) {</div>
<div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;      <span class="keywordflow">if</span>(i1 &gt; 0){</div>
<div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;        tempparton2 = SP_remnants[i1-1];</div>
<div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;        <span class="keywordflow">if</span>(std::abs(tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6){ <span class="comment">// no change of colors here, they are not important in findclosereplica</span></div>
<div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;          tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());</div>
<div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;        }</div>
<div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(i3 &gt; 0){</div>
<div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;        tempparton2 = SP_remnants[i3-1];</div>
<div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;        <span class="keywordflow">if</span>(std::abs(tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6){</div>
<div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;          tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());</div>
<div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;        }</div>
<div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;      }<span class="keywordflow">else</span>{ <span class="comment">// should be very rare: junction with 3 ghost legs</span></div>
<div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;        tempparton2 = SP_remnants[0];</div>
<div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == -1 &amp;&amp; std::abs(tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6 &amp;&amp; tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() &lt; 0){</div>
<div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;          tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());</div>
<div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == 1 &amp;&amp; std::abs(tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6 &amp;&amp; tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() &gt; 0){</div>
<div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;          tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());</div>
<div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;        }</div>
<div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;      }</div>
<div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;    }</div>
<div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;    <span class="keywordflow">if</span>(i3 &lt;= 0) {</div>
<div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;      <span class="keywordflow">if</span>(i1 &gt; 0){</div>
<div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;        tempparton3 = SP_remnants[i1-1];</div>
<div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;        <span class="keywordflow">if</span>(std::abs(tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6){ <span class="comment">// no change of colors here, they are not important in findclosereplica</span></div>
<div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;          tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());</div>
<div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;        }</div>
<div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(i2 &gt; 0){</div>
<div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;        tempparton3 = SP_remnants[i2-1];</div>
<div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;        <span class="keywordflow">if</span>(std::abs(tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6){</div>
<div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;          tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());</div>
<div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;        }</div>
<div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;      }<span class="keywordflow">else</span>{ <span class="comment">// should be very rare: junction with 3 ghost legs</span></div>
<div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;        tempparton3 = SP_remnants[0];</div>
<div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == -1 &amp;&amp; std::abs(tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6 &amp;&amp; tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() &lt; 0){</div>
<div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;          tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());</div>
<div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == 1 &amp;&amp; std::abs(tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6 &amp;&amp; tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() &gt; 0){</div>
<div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;          tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>());</div>
<div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;        }</div>
<div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;      }</div>
<div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;    }</div>
<div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;</div>
<div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;    <span class="keywordflow">if</span>(i1 == 0 || i2 == 0 || i3 == 0){</div>
<div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;      Tempjunctions.at(ijunc).at(0).at(1) = 1; <span class="comment">// at least one thermal parton in (anti-)junction</span></div>
<div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;    }</div>
<div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;</div>
<div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;    <span class="comment">// Now find partons to add to missing junction legs; either thermal or fake</span></div>
<div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;    <span class="keywordflow">if</span>(i1 == 0 &amp;&amp; Tempjunctions.at(ijunc).at(0).at(0) == -1) {</div>
<div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = 0;</div>
<div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;      <span class="keywordflow">if</span>(tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() == 21) {</div>
<div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;        tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(1);</div>
<div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;        loc = findcloserepl(tempparton1,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);</div>
<div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;        tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;      }<span class="keywordflow">else</span>{loc = findcloserepl(tempparton1,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);}</div>
<div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;      <span class="keywordflow">if</span>(loc == 999999999 || loc &gt; 0) {</div>
<div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;            <span class="keywordtype">int</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.33333333) ? ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? -1 : -2) : -3);</div>
<div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton1; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid); fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(0);</div>
<div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(1).at(1) != 0) {</div>
<div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(Tempjunctions.at(ijunc).at(1).at(1));</div>
<div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(++maxtag);</div>
<div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;          Tempjunctions.at(ijunc).at(1).at(1) = maxtag;</div>
<div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;        }</div>
<div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;        <span class="keywordflow">if</span>(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 3) {</div>
<div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);</div>
<div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xms);}</div>
<div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;        <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;        <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;        number_p_fake++;</div>
<div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0) {</div>
<div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(1).at(1) != 0) {</div>
<div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;          HH_thermal[-loc-1].acol(Tempjunctions.at(ijunc).at(1).at(1));</div>
<div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;          HH_thermal[-loc-1].acol(++maxtag);</div>
<div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;          Tempjunctions.at(ijunc).at(1).at(1) = maxtag;</div>
<div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;        }</div>
<div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;        HH_thermal[-loc-1].col(0);</div>
<div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;        HH_thermal[-loc-1].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;        HH_thermal[-loc-1].is_remnant(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;        SP_remnants[SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].par(-loc-1);</div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;      }</div>
<div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;    }</div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;</div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;    <span class="keywordflow">if</span>(i2 == 0 &amp;&amp; Tempjunctions.at(ijunc).at(0).at(0) == -1 ) {</div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = 0;</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;      <span class="keywordflow">if</span>(tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() == 21) {</div>
<div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;        tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(1);</div>
<div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;        loc = findcloserepl(tempparton2,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);</div>
<div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;        tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;      }<span class="keywordflow">else</span>{loc = findcloserepl(tempparton2,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);}</div>
<div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;      <span class="keywordflow">if</span>(loc == 999999999 || loc &gt; 0) {</div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;              <span class="keywordtype">int</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.33333333) ? ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? -1 : -2) : -3);</div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton2; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid); fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(0);</div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(2).at(1) != 0) {</div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(Tempjunctions.at(ijunc).at(2).at(1));</div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(++maxtag);</div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;          Tempjunctions.at(ijunc).at(2).at(1) = maxtag;</div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;        }</div>
<div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;        <span class="keywordflow">if</span>(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 3) {</div>
<div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);</div>
<div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xms);}</div>
<div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;        <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;        <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;        number_p_fake++;</div>
<div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0) {</div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(2).at(1) != 0) {</div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;          HH_thermal[-loc-1].acol(Tempjunctions.at(ijunc).at(2).at(1));</div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;          HH_thermal[-loc-1].acol(++maxtag);</div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;          Tempjunctions.at(ijunc).at(2).at(1) = maxtag;</div>
<div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;        }</div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;        HH_thermal[-loc-1].col(0);</div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;        HH_thermal[-loc-1].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;        HH_thermal[-loc-1].is_remnant(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;        SP_remnants[SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].par(-loc-1);</div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;      }</div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;    }</div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;</div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;    <span class="keywordflow">if</span>(i3 == 0 &amp;&amp; Tempjunctions.at(ijunc).at(0).at(0) == -1) {</div>
<div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = 0;</div>
<div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;      <span class="keywordflow">if</span>(tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() == 21) {</div>
<div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;        tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(1);</div>
<div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;        loc = findcloserepl(tempparton3,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);</div>
<div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;        tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;      }<span class="keywordflow">else</span>{loc = findcloserepl(tempparton3,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);}</div>
<div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;      <span class="keywordflow">if</span>(loc == 999999999 || loc &gt; 0) {</div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;              <span class="keywordtype">int</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.33333333) ? ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? -1 : -2) : -3);</div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton3; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid); fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(0);</div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(3).at(1) != 0) {</div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(Tempjunctions.at(ijunc).at(3).at(1));</div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(++maxtag);</div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;          Tempjunctions.at(ijunc).at(3).at(1) = maxtag;</div>
<div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;        }</div>
<div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;        <span class="keywordflow">if</span>(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 3) {</div>
<div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);</div>
<div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xms);}</div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;        <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;        <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;        number_p_fake++;</div>
<div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0) {</div>
<div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(3).at(1) != 0) {</div>
<div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;          HH_thermal[-loc-1].acol(Tempjunctions.at(ijunc).at(3).at(1));</div>
<div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;          HH_thermal[-loc-1].acol(++maxtag);</div>
<div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;          Tempjunctions.at(ijunc).at(3).at(1) = maxtag;</div>
<div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;        }</div>
<div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;        HH_thermal[-loc-1].col(0);</div>
<div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;        HH_thermal[-loc-1].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;        HH_thermal[-loc-1].is_remnant(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;        SP_remnants[SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].par(-loc-1);</div>
<div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;      }</div>
<div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;    }</div>
<div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;</div>
<div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;    <span class="keywordflow">if</span>(i1 == 0 &amp;&amp; Tempjunctions.at(ijunc).at(0).at(0) == 1) {</div>
<div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = 0;</div>
<div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;      <span class="keywordflow">if</span>(tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() == 21) {</div>
<div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;        tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-1);</div>
<div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;        loc = findcloserepl(tempparton1,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);</div>
<div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;        tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;      }<span class="keywordflow">else</span>{loc = findcloserepl(tempparton1,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);}</div>
<div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;      <span class="keywordflow">if</span>(loc == 999999999 || loc &gt; 0) {</div>
<div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;              <span class="keywordtype">int</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.33333333) ? ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? 1 : 2) : 3);</div>
<div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton1; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid);</div>
<div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;        fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(0);</div>
<div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(1).at(1) != 0) {</div>
<div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(Tempjunctions.at(ijunc).at(1).at(1));</div>
<div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(++maxtag);</div>
<div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;          Tempjunctions.at(ijunc).at(1).at(1) = maxtag;</div>
<div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;        }</div>
<div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;        <span class="keywordflow">if</span>(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 3) {</div>
<div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);</div>
<div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xms);}</div>
<div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;        <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;        <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;        number_p_fake++;</div>
<div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0) {</div>
<div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(1).at(1) != 0) {</div>
<div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;          HH_thermal[-loc-1].col(Tempjunctions.at(ijunc).at(1).at(1));</div>
<div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;          HH_thermal[-loc-1].col(++maxtag);</div>
<div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;          Tempjunctions.at(ijunc).at(1).at(1) = maxtag;</div>
<div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;        }</div>
<div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;        HH_thermal[-loc-1].acol(0);</div>
<div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;        HH_thermal[-loc-1].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;        HH_thermal[-loc-1].is_remnant(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;        SP_remnants[SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].par(-loc-1);</div>
<div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;      }</div>
<div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;    }</div>
<div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;</div>
<div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;    <span class="keywordflow">if</span>(i2 == 0 &amp;&amp; Tempjunctions.at(ijunc).at(0).at(0) == 1) {</div>
<div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = 0;</div>
<div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;      <span class="keywordflow">if</span>(tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() == 21) {</div>
<div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;        tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-1);</div>
<div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;        loc = findcloserepl(tempparton2,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);</div>
<div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;        tempparton2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;      }<span class="keywordflow">else</span>{loc = findcloserepl(tempparton2,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);}</div>
<div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;      <span class="keywordflow">if</span>(loc == 999999999 || loc &gt; 0) {</div>
<div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;              <span class="keywordtype">int</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.33333333) ? ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? 1 : 2) : 3);</div>
<div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton2; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid);</div>
<div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;        fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(0);</div>
<div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(2).at(1) != 0) {</div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(Tempjunctions.at(ijunc).at(2).at(1));</div>
<div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(++maxtag);</div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;          Tempjunctions.at(ijunc).at(2).at(1) = maxtag;</div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;        }</div>
<div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;        <span class="keywordflow">if</span>(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 3) {</div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);</div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xms);}</div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;        <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;        <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;        number_p_fake++;</div>
<div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0) {</div>
<div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(2).at(1) != 0) {</div>
<div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;          HH_thermal[-loc-1].col(Tempjunctions.at(ijunc).at(2).at(1));</div>
<div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;          HH_thermal[-loc-1].col(++maxtag);</div>
<div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;          Tempjunctions.at(ijunc).at(2).at(1) = maxtag;</div>
<div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;        }</div>
<div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;        HH_thermal[-loc-1].acol(0);</div>
<div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;        HH_thermal[-loc-1].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;        HH_thermal[-loc-1].is_remnant(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;        SP_remnants[SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].par(-loc-1);</div>
<div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;      }</div>
<div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;    }</div>
<div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;</div>
<div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;    <span class="keywordflow">if</span>(i3 == 0 &amp;&amp; Tempjunctions.at(ijunc).at(0).at(0) == 1) {</div>
<div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = 0;</div>
<div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;      <span class="keywordflow">if</span>(tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() == 21) {</div>
<div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;        tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-1);</div>
<div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;        loc = findcloserepl(tempparton3,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);</div>
<div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;        tempparton3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;      }<span class="keywordflow">else</span>{loc = findcloserepl(tempparton3,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);}</div>
<div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;      <span class="keywordflow">if</span>(loc == 999999999 || loc &gt; 0) {</div>
<div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;              <span class="keywordtype">int</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.33333333) ? ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? 1 : 2) : 3);</div>
<div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton3; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid);</div>
<div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;        fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(0);</div>
<div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(3).at(1) != 0) {</div>
<div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(Tempjunctions.at(ijunc).at(3).at(1));</div>
<div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(++maxtag);</div>
<div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;          Tempjunctions.at(ijunc).at(3).at(1) = maxtag;</div>
<div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;        }</div>
<div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;        <span class="keywordflow">if</span>(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 3) {</div>
<div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);</div>
<div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xms);}</div>
<div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;        <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;        <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;        number_p_fake++;</div>
<div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0) {</div>
<div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(3).at(1) != 0) {</div>
<div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;          HH_thermal[-loc-1].col(Tempjunctions.at(ijunc).at(3).at(1));</div>
<div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;          HH_thermal[-loc-1].col(++maxtag);</div>
<div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;          Tempjunctions.at(ijunc).at(3).at(1) = maxtag;</div>
<div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;        }</div>
<div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;        HH_thermal[-loc-1].acol(0);</div>
<div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;        HH_thermal[-loc-1].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;        HH_thermal[-loc-1].is_remnant(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;        SP_remnants[SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].par(-loc-1);</div>
<div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;      }</div>
<div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;    }</div>
<div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;</div>
<div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;    <span class="comment">// Add fake gluons (no beam energies) between junctions with empty connecting legs [handling could be improved later]</span></div>
<div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;    <span class="keywordflow">if</span>(i1 &lt; 0 &amp;&amp; Tempjunctions.at(ijunc).at(0).at(0) == -1 ) {</div>
<div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;      <span class="keywordtype">int</span> jleg = ((-i1) % 10);</div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;      <span class="keywordtype">int</span> jjunc = ((-i1)-jleg)/10;</div>
<div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;      <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton1; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;      fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(++maxtag);</div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;      fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(Tempjunctions.at(ijunc).at(1).at(1));</div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-2); <span class="comment">// 10 MeV &quot;accuracy&quot;</span></div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;      Tempjunctions.at(jjunc).at(jleg).at(1) = maxtag;</div>
<div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;      <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;      SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;    }</div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;</div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;    <span class="keywordflow">if</span>(i2 &lt; 0 &amp;&amp; Tempjunctions.at(ijunc).at(0).at(0) == -1 ) {</div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;      <span class="keywordtype">int</span> jleg = ((-i2) % 10);</div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;      <span class="keywordtype">int</span> jjunc = ((-i2)-jleg)/10;</div>
<div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;      <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton2; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;      fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(++maxtag);</div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;      fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(Tempjunctions.at(ijunc).at(2).at(1));</div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-2);</div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;      Tempjunctions.at(jjunc).at(jleg).at(1) = maxtag;</div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;      <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;      SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;    }</div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;</div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;    <span class="keywordflow">if</span>(i3 &lt; 0 &amp;&amp; Tempjunctions.at(ijunc).at(0).at(0) == -1 ) {</div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;      <span class="keywordtype">int</span> jleg = ((-i3) % 10);</div>
<div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;      <span class="keywordtype">int</span> jjunc = ((-i3)-jleg)/10;</div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;      <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton3; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;      fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(++maxtag);</div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;      fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(Tempjunctions.at(ijunc).at(3).at(1));</div>
<div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-2);</div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;      Tempjunctions.at(jjunc).at(jleg).at(1) = maxtag;</div>
<div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;      <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;      SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;    }</div>
<div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;</div>
<div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;    <span class="keywordflow">if</span>(i1 &lt; 0 &amp;&amp; Tempjunctions.at(ijunc).at(0).at(0) == 1 ) {</div>
<div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;      <span class="keywordtype">int</span> jleg = ((-i1) % 10);</div>
<div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;      <span class="keywordtype">int</span> jjunc = ((-i1)-jleg)/10;</div>
<div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;      <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton1; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;      fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(++maxtag);</div>
<div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;      fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(Tempjunctions.at(ijunc).at(1).at(1));</div>
<div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-2);</div>
<div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;      Tempjunctions.at(jjunc).at(jleg).at(1) = maxtag;</div>
<div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;      <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;      SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;    }</div>
<div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;</div>
<div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;    <span class="keywordflow">if</span>(i2 &lt; 0 &amp;&amp; Tempjunctions.at(ijunc).at(0).at(0) == 1 ) {</div>
<div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;      <span class="keywordtype">int</span> jleg = ((-i2) % 10);</div>
<div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;      <span class="keywordtype">int</span> jjunc = ((-i2)-jleg)/10;</div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;      <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton2; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;      fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(++maxtag);</div>
<div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;      fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(Tempjunctions.at(ijunc).at(2).at(1));</div>
<div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-2);</div>
<div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;      Tempjunctions.at(jjunc).at(jleg).at(1) = maxtag;</div>
<div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;      <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;      SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;    }</div>
<div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;</div>
<div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;    <span class="keywordflow">if</span>(i3 &lt; 0 &amp;&amp; Tempjunctions.at(ijunc).at(0).at(0) == 1 ) {</div>
<div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;      <span class="keywordtype">int</span> jleg = ((-i3) % 10);</div>
<div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;      <span class="keywordtype">int</span> jjunc = ((-i3)-jleg)/10;</div>
<div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;      <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton3; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;      fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(++maxtag);</div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;      fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(Tempjunctions.at(ijunc).at(3).at(1));</div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-2);</div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;      Tempjunctions.at(jjunc).at(jleg).at(1) = maxtag;</div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;      <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;      fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;      SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;    }</div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;  }</div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;</div>
<div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;  <span class="comment">// repair all strings (add missing partons)</span></div>
<div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ptn1 = 0; ptn1 &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ptn1++) {</div>
<div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;    <span class="keywordtype">bool</span> colors_match = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;    <span class="keywordtype">bool</span> anti_colors_match = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;    <span class="keywordtype">int</span> ptn1_col = SP_remnants[ptn1].col();</div>
<div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;    <span class="keywordtype">int</span> ptn1_acol = SP_remnants[ptn1].acol();</div>
<div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ptn2 = 0; ptn2 &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ptn2++) {</div>
<div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;      <span class="keywordtype">int</span> ptn2_acol = SP_remnants[ptn2].acol();</div>
<div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;      <span class="keywordtype">int</span> ptn2_col = SP_remnants[ptn2].col();</div>
<div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;      <span class="keywordflow">if</span>(ptn1_col == ptn2_acol) {colors_match = <span class="keyword">true</span>;}</div>
<div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;      <span class="keywordflow">if</span>(ptn1_acol == ptn2_col) {anti_colors_match = <span class="keyword">true</span>;}</div>
<div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;    }</div>
<div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;    <span class="keywordflow">if</span>(!colors_match || !anti_colors_match) {</div>
<div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ijunc = 0; ijunc &lt; Tempjunctions.size(); ijunc++) {</div>
<div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == 1 &amp;&amp; (ptn1_col == Tempjunctions.at(ijunc).at(1).at(1) || ptn1_col == Tempjunctions.at(ijunc).at(2).at(1) || ptn1_col == Tempjunctions.at(ijunc).at(3).at(1))) {</div>
<div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;          colors_match = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;        }</div>
<div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;        <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == -1 &amp;&amp; (ptn1_acol == Tempjunctions.at(ijunc).at(1).at(1) || ptn1_acol == Tempjunctions.at(ijunc).at(2).at(1) || ptn1_acol == Tempjunctions.at(ijunc).at(3).at(1))) {</div>
<div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;          anti_colors_match = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;        }</div>
<div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;      }</div>
<div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;    }</div>
<div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;    <span class="keywordflow">if</span>(!colors_match &amp;&amp; SP_remnants[ptn1].<span class="keywordtype">id</span>() &gt; 0) {</div>
<div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = 0;</div>
<div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;      <span class="keywordflow">if</span>(SP_remnants[ptn1].<span class="keywordtype">id</span>() == 21){</div>
<div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;        SP_remnants[ptn1].id(1);</div>
<div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;        loc = findcloserepl(SP_remnants[ptn1], ptn1+1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);</div>
<div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;        SP_remnants[ptn1].id(21);</div>
<div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;      }<span class="keywordflow">else</span>{loc = findcloserepl(SP_remnants[ptn1], ptn1+1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);}</div>
<div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;</div>
<div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;      <span class="keywordflow">if</span>(loc == 999999999 || loc &gt; 0){</div>
<div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;              <span class="keywordtype">int</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.33333333) ? ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? -1 : -2) : -3;</div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = SP_remnants[ptn1]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid); fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(0); fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(ptn1_col);</div>
<div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;        <span class="keywordflow">if</span>(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 3) {</div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);</div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xms);}</div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;        <span class="keywordtype">double</span> dir = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &lt; 0.5) ? 1. : -1.; <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;        <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;        number_p_fake++;</div>
<div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){</div>
<div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;        HH_thermal[-loc-1].acol(ptn1_col);</div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;        HH_thermal[-loc-1].col(0);</div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;        HH_thermal[-loc-1].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;        HH_thermal[-loc-1].is_remnant(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;        SP_remnants[SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].par(-loc-1);</div>
<div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;      }</div>
<div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;    }</div>
<div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;    <span class="keywordflow">if</span>(!anti_colors_match &amp;&amp; (SP_remnants[ptn1].<span class="keywordtype">id</span>() &lt; 0 || SP_remnants[ptn1].<span class="keywordtype">id</span>() == 21)) {</div>
<div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = 0;</div>
<div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;      <span class="keywordflow">if</span>(SP_remnants[ptn1].<span class="keywordtype">id</span>() == 21){</div>
<div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;        SP_remnants[ptn1].id(-1);</div>
<div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;        loc = findcloserepl(SP_remnants[ptn1], ptn1+1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);</div>
<div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;        SP_remnants[ptn1].id(21);</div>
<div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;      }<span class="keywordflow">else</span>{loc = findcloserepl(SP_remnants[ptn1], ptn1+1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);}</div>
<div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;</div>
<div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;      <span class="keywordflow">if</span>(loc == 999999999 || loc &gt; 0){</div>
<div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;              <span class="keywordtype">int</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.33333333) ? ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? 1 : 2) : 3;</div>
<div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = SP_remnants[ptn1]; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid); fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(ptn1_acol); fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(0);</div>
<div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;        <span class="keywordflow">if</span>(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 3) {</div>
<div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);</div>
<div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xms);}</div>
<div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;        <span class="keywordtype">double</span> dir = (<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &lt; 0.5) ? 1. : -1.; <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;        <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;        } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;        number_p_fake++;</div>
<div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;        fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0){</div>
<div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;        HH_thermal[-loc-1].col(ptn1_acol);</div>
<div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;        HH_thermal[-loc-1].acol(0);</div>
<div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;        HH_thermal[-loc-1].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;        HH_thermal[-loc-1].is_remnant(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;        SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;        SP_remnants[SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].par(-loc-1);</div>
<div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;      }</div>
<div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;    }</div>
<div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;  }</div>
<div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;</div>
<div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;  set_initial_parton_masses(SP_remnants);</div>
<div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;</div>
<div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ijunc=0; ijunc &lt; Tempjunctions.size(); ++ijunc) { <span class="comment">//Let&#39;s make Legs for Final string by verifying Tempjunctions! starting from the kind of junction(-1 or +1)</span></div>
<div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;    <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;endl&lt;&lt;&quot;  Let&#39;s see candidates for (anti)junction  &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;    <span class="comment">//std::cout &lt;&lt;&quot; Candidate &quot; &lt;&lt; ijunc+1 &lt;&lt;endl;</span></div>
<div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;    <span class="comment">//std::cout &lt;&lt;&quot; [ (  &quot; &lt;&lt; Tempjunctions.at(ijunc).at(0).at(0) &lt;&lt;&quot; , &quot; &lt;&lt; Tempjunctions.at(ijunc).at(0).at(1) &lt;&lt;&quot; ), &quot; ;</span></div>
<div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;    <span class="comment">//std::cout &lt;&lt;&quot;  (  &quot; &lt;&lt; Tempjunctions.at(ijunc).at(1).at(0) &lt;&lt;&quot; , &quot; &lt;&lt; Tempjunctions.at(ijunc).at(1).at(1) &lt;&lt;&quot; ), &quot; ;</span></div>
<div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;    <span class="comment">//std::cout &lt;&lt;&quot;  (  &quot; &lt;&lt; Tempjunctions.at(ijunc).at(2).at(0) &lt;&lt;&quot; , &quot; &lt;&lt; Tempjunctions.at(ijunc).at(2).at(1) &lt;&lt;&quot; ), &quot; ;</span></div>
<div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;    <span class="comment">//std::cout &lt;&lt;&quot;  (  &quot; &lt;&lt; Tempjunctions.at(ijunc).at(3).at(0) &lt;&lt;&quot; , &quot; &lt;&lt; Tempjunctions.at(ijunc).at(3).at(1) &lt;&lt;&quot; ), &quot; ;</span></div>
<div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;    <span class="comment">//std::cout &lt;&lt;&quot; ] &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;</div>
<div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;    <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; I&#39;m Working !! from line 2027&quot; &lt;&lt;endl;</span></div>
<div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;    vector&lt;int&gt; correction; <span class="comment">// for the case of 1 or 2 initiating particles, we need to remember the partons and get the used_junction tag to the original</span></div>
<div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;    <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == -1) { <span class="comment">// check anti-color tags in SP_remnants partons!! to form anti-junction</span></div>
<div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irem=0; irem &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++irem) { <span class="comment">// searching through all remnant particles</span></div>
<div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;        <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; Let&#39;s see &quot; &lt;&lt; irem+1 &lt;&lt;&quot;th remnant particle with &quot;&lt;&lt; &quot;pid : &quot; &lt;&lt; SP_remnants[irem].pid() &lt;&lt;&quot; color : &quot;&lt;&lt; SP_remnants[irem].col()&lt;&lt; &quot; anti-color : &quot; &lt;&lt; SP_remnants[irem].acol() &lt;&lt;endl;</span></div>
<div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;        <span class="keywordflow">if</span>(SP_remnants[irem].acol() == Tempjunctions.at(ijunc).at(1).at(1)){</div>
<div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;          Leg1.push_back(SP_remnants[irem]);</div>
<div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;          correction.push_back(irem);</div>
<div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;          SP_remnants[irem].used_junction(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;          <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; Leg 1 has initiating particle &quot; &lt;&lt;&quot; and the pID is &quot;&lt;&lt; SP_remnants[irem].pid()&lt;&lt;&quot; and the color tag : &quot;&lt;&lt;SP_remnants[irem].acol()&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;          Legconsidering.push_back(irem);</div>
<div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;        }</div>
<div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;        <span class="keywordflow">if</span>(SP_remnants[irem].acol() == Tempjunctions.at(ijunc).at(2).at(1)){</div>
<div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;          Leg2.push_back(SP_remnants[irem]);</div>
<div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;          correction.push_back(irem);</div>
<div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;          SP_remnants[irem].used_junction(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;          <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; Leg 2 has initiating particle &quot; &lt;&lt;&quot; and the pID is &quot;&lt;&lt; SP_remnants[irem].pid()&lt;&lt;&quot; and the color tag : &quot;&lt;&lt;SP_remnants[irem].acol()&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;          Legconsidering.push_back(irem);</div>
<div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;        }</div>
<div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;        <span class="keywordflow">if</span>(SP_remnants[irem].acol() == Tempjunctions.at(ijunc).at(3).at(1)){</div>
<div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;          Leg3.push_back(SP_remnants[irem]);</div>
<div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;          correction.push_back(irem);</div>
<div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;          SP_remnants[irem].used_junction(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;          <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; Leg 3 has initiating particle &quot; &lt;&lt;&quot; and the pID is &quot;&lt;&lt; SP_remnants[irem].pid()&lt;&lt;&quot; and the color tag : &quot;&lt;&lt;SP_remnants[irem].acol()&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;          Legconsidering.push_back(irem);</div>
<div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;        }</div>
<div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;        <span class="keywordflow">if</span>(Legconsidering.size() !=3 ){<span class="comment">// if only one or two particles found in remnants, we need to set the tag to the original</span></div>
<div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icor = 0; icor &lt; correction.size(); icor++){</div>
<div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;            SP_remnants[correction.at(icor)].used_junction(<span class="keyword">false</span>);</div>
<div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;            <span class="comment">//dignostic measure</span></div>
<div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;            <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;the &quot;&lt;&lt;icor&lt;&lt;&quot; th particle with color tag of &quot;&lt;&lt;SP_remnants[icor].col()&lt;&lt;&quot; , &quot;&lt;&lt;SP_remnants[icor].acol()&lt;&lt;&quot; are turned into unused particle&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;          }</div>
<div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;          correction.clear();</div>
<div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;        }</div>
<div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;      }</div>
<div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == 1) { <span class="comment">// check color tags in SP_remnants partons!! to form junction</span></div>
<div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irem=0; irem &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++irem) { <span class="comment">// searching through all remnant particles</span></div>
<div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;        <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; Let&#39;s see &quot; &lt;&lt; irem+1 &lt;&lt;&quot;th remnant particle with &quot;&lt;&lt; &quot;pid : &quot; &lt;&lt; SP_remnants[irem].pid() &lt;&lt;&quot; color : &quot;&lt;&lt; SP_remnants[irem].col()&lt;&lt; &quot; anti-color : &quot; &lt;&lt; SP_remnants[irem].acol() &lt;&lt;endl;</span></div>
<div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;        <span class="keywordflow">if</span>(SP_remnants[irem].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(1).at(1)){</div>
<div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;        Leg1.push_back(SP_remnants[irem]);</div>
<div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;        correction.push_back(irem);</div>
<div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;        SP_remnants[irem].used_junction(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;        Legconsidering.push_back(irem);</div>
<div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;        <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; Leg 1 has initiating particle &quot;&lt;&lt;&quot; and the pID is &quot;&lt;&lt; SP_remnants[irem].pid()&lt;&lt;&quot; and the color tag : &quot;&lt;&lt;SP_remnants[irem].col()&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;        }</div>
<div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;        <span class="keywordflow">if</span>(SP_remnants[irem].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(2).at(1)){</div>
<div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;          Leg2.push_back(SP_remnants[irem]);</div>
<div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;          correction.push_back(irem);</div>
<div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;          SP_remnants[irem].used_junction(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;          <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; Leg 2 has initiating particle &quot; &lt;&lt;&quot; and the pID is &quot;&lt;&lt; SP_remnants[irem].pid()&lt;&lt;&quot; and the color tag : &quot;&lt;&lt;SP_remnants[irem].col()&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;          Legconsidering.push_back(irem);</div>
<div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;        }</div>
<div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;        <span class="keywordflow">if</span>(SP_remnants[irem].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == Tempjunctions.at(ijunc).at(3).at(1)){</div>
<div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;          Leg3.push_back(SP_remnants[irem]);</div>
<div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;          correction.push_back(irem);</div>
<div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;          SP_remnants[irem].used_junction(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;          <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; Leg 3 has initiating particle &quot; &lt;&lt;&quot; and the pID is &quot;&lt;&lt; SP_remnants[irem].pid()&lt;&lt;&quot; and the color tag : &quot;&lt;&lt;SP_remnants[irem].col()&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;          Legconsidering.push_back(irem);</div>
<div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;        }</div>
<div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;        <span class="keywordflow">if</span>(Legconsidering.size() !=3 ){</div>
<div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icor = 0; icor &lt; correction.size(); icor++){</div>
<div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;            SP_remnants[correction.at(icor)].used_junction(<span class="keyword">false</span>);</div>
<div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;            <span class="comment">//dignostic measure</span></div>
<div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;            <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;the &quot;&lt;&lt;icor&lt;&lt;&quot; th particle with color tag of &quot;&lt;&lt;SP_remnants[icor].col()&lt;&lt;&quot; , &quot;&lt;&lt;SP_remnants[icor].acol()&lt;&lt;&quot; are turned into unused particle&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;          }</div>
<div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;          correction.clear();</div>
<div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;        }</div>
<div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;      }</div>
<div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;    }</div>
<div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;</div>
<div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;    <span class="keywordflow">if</span>(Legconsidering.size() == 3) {</div>
<div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;      realjuncindice.push_back(ijunc);</div>
<div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;      <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;the indice added for string repair : &quot;&lt;&lt;ijunc&lt;&lt;endl;</span></div>
<div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;      <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == -1 &amp;&amp; Leg1.at(0).col() != 0 &amp;&amp; Leg1.at(0).acol() != 0){ <span class="comment">// starting to form the Leg1 for anti_junction by Color Tag Tracing. If first particle is (anti)quark, no need to trace</span></div>
<div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop=0; iloop &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); iloop++){</div>
<div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icf = 0; icf &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++icf) {</div>
<div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;            <span class="keywordflow">if</span>( (Leg1.back().col() != 0) &amp;&amp; (Leg1.back().col() == SP_remnants[icf].acol()) ){</div>
<div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;              <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;particle added to Leg 1 with color tag  ( &quot;&lt;&lt;SP_remnants[icf].col() &lt;&lt;&quot; and &quot;&lt;&lt;SP_remnants[icf].acol()&lt;&lt;&quot; ) &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;              Leg1.push_back(SP_remnants[icf]);</div>
<div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;              SP_remnants[icf].used_junction(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;            }</div>
<div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;            <span class="keywordflow">if</span>( Leg1.back().col() == 0 || Leg1.back().acol() == 0 ){ <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;          }</div>
<div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;        }</div>
<div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == 1 &amp;&amp; Leg1.at(0).col() != 0 &amp;&amp; Leg1.at(0).acol() != 0){ <span class="comment">// starting to form the Leg1 junction by Color Tag Tracing. If first particle is quark, no need to trace</span></div>
<div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop=0; iloop &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); iloop++){</div>
<div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icf = 0; icf &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++icf) {</div>
<div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;            <span class="keywordflow">if</span>( (Leg1.back().acol() != 0) &amp;&amp; (Leg1.back().acol() == SP_remnants[icf].col()) ){</div>
<div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;              <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;particle added to Leg 1 with color tag ( &quot;&lt;&lt;SP_remnants[icf].col() &lt;&lt;&quot; and &quot;&lt;&lt;SP_remnants[icf].acol()&lt;&lt;&quot; ) &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;              Leg1.push_back(SP_remnants[icf]);</div>
<div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;              SP_remnants[icf].used_junction(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;            }</div>
<div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;            <span class="keywordflow">if</span>(Leg1.back().col() == 0 || Leg1.back().acol() == 0){<span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;          }</div>
<div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;        }</div>
<div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;      }</div>
<div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;</div>
<div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;      <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == -1 &amp;&amp; Leg2.at(0).col() != 0 &amp;&amp; Leg2.at(0).acol() != 0){ <span class="comment">// starting to form the Leg2 for anti_junction by Color Tag Tracing. If first particle is (anti)quark, no need to trace</span></div>
<div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop=0; iloop &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); iloop++){</div>
<div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icf = 0; icf &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++icf) {</div>
<div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;            <span class="keywordflow">if</span>(  ( Leg2.back().col() != 0 )  &amp;&amp; (Leg2.back().col() == SP_remnants[icf].acol()) ){</div>
<div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;              <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;particle added to Leg 2 with color tag ( &quot;&lt;&lt;SP_remnants[icf].col() &lt;&lt;&quot; and &quot;&lt;&lt;SP_remnants[icf].acol()&lt;&lt;&quot; ) &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;              Leg2.push_back(SP_remnants[icf]);</div>
<div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;              SP_remnants[icf].used_junction(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;            }</div>
<div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;            <span class="keywordflow">if</span>( Leg2.back().col() == 0 || Leg2.back().acol() == 0){<span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;          }</div>
<div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;        }</div>
<div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == 1 &amp;&amp; Leg2.at(0).col() != 0 &amp;&amp; Leg2.at(0).acol() != 0){ <span class="comment">// starting to form the Leg2 junction by Color Tag Tracing. If first particle is quark, no need to trace</span></div>
<div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop=0; iloop &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); iloop++){</div>
<div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icf = 0; icf &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++icf) {</div>
<div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;            <span class="keywordflow">if</span>(   (Leg2.back().acol() != 0) &amp;&amp; (Leg2.back().acol() == SP_remnants[icf].col())  ){</div>
<div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;              <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;particle added to Leg 2 with color tag ( &quot;&lt;&lt;SP_remnants[icf].col() &lt;&lt;&quot; and &quot;&lt;&lt;SP_remnants[icf].acol()&lt;&lt;&quot; ) &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;              Leg2.push_back(SP_remnants[icf]);</div>
<div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;              SP_remnants[icf].used_junction(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;            }</div>
<div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;            <span class="keywordflow">if</span>( Leg2.back().col() == 0 || Leg2.back().acol() == 0){<span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;          }</div>
<div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;        }</div>
<div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;      }</div>
<div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;</div>
<div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;      <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == -1 &amp;&amp; Leg3.at(0).col() != 0 &amp;&amp; Leg3.at(0).acol() != 0){ <span class="comment">// starting to form the Leg3 for anti_junction by Color Tag Tracing. If first particle is (anti)quark, no need to trace</span></div>
<div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop=0; iloop &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); iloop++){</div>
<div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icf = 0; icf &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++icf) {</div>
<div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;            <span class="keywordflow">if</span>(  (Leg3.back().col() != 0) &amp;&amp; (Leg3.back().col() == SP_remnants[icf].acol()) ){</div>
<div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;              <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;particle added to Leg 3 with color tag ( &quot;&lt;&lt;SP_remnants[icf].col() &lt;&lt;&quot; and &quot;&lt;&lt;SP_remnants[icf].acol()&lt;&lt;&quot; ) &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;              Leg3.push_back(SP_remnants[icf]);</div>
<div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;              SP_remnants[icf].used_junction(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;            }</div>
<div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;            <span class="keywordflow">if</span>( Leg3.back().col() == 0 || Leg3.back().acol() == 0){<span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;          }</div>
<div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;        }</div>
<div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(Tempjunctions.at(ijunc).at(0).at(0) == 1 &amp;&amp; Leg3.at(0).col() != 0 &amp;&amp; Leg3.at(0).acol() != 0){ <span class="comment">// starting to form the Leg3 junction by Color Tag Tracing. If first particle is quark, no need to trace</span></div>
<div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop=0; iloop &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); iloop++){</div>
<div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icf = 0; icf &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++icf) {</div>
<div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;            <span class="comment">//std::cout &lt;&lt;&quot;candidate particle is &quot;&lt;&lt;SP_remnants[icf].pid()&lt;&lt;&quot; , &quot;&lt;&lt;SP_remnants[icf].col()&lt;&lt;&quot; , &quot;&lt;&lt;SP_remnants[icf].acol()&lt;&lt;&quot; , &quot;&lt;&lt;SP_remnants[icf].used_junction()&lt;&lt;endl;</span></div>
<div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;            <span class="comment">//std::cout &lt;&lt;&quot;and standard particle is &quot;&lt;&lt;Leg3.back().pid()&lt;&lt;&quot; , &quot;&lt;&lt;Leg3.back().col()&lt;&lt;&quot; , &quot;&lt;&lt;Leg3.back().acol()&lt;&lt;&quot; , &quot;&lt;&lt;Leg3.back().used_junction()&lt;&lt;endl;</span></div>
<div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;            <span class="keywordflow">if</span>( (Leg3.back().acol() != 0) &amp;&amp; (Leg3.back().acol() == SP_remnants[icf].col()) ){</div>
<div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;              <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;particle added to Leg 3 with color tag ( &quot;&lt;&lt;SP_remnants[icf].col() &lt;&lt;&quot; and &quot;&lt;&lt;SP_remnants[icf].acol()&lt;&lt;&quot; ) &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;              Leg3.push_back(SP_remnants[icf]);</div>
<div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;              SP_remnants[icf].used_junction(<span class="keyword">true</span>);</div>
<div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;            }</div>
<div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;            <span class="keywordflow">if</span>( Leg3.back().col() == 0 || Leg3.back().acol() == 0 ){<span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;          }</div>
<div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;        }</div>
<div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;      }</div>
<div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;         JuncLegs.push_back(Leg1);</div>
<div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;         JuncLegs.push_back(Leg2);</div>
<div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;         JuncLegs.push_back(Leg3);</div>
<div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;         JuncStructure.push_back(JuncLegs); <span class="comment">// now junction structure with three complete legs is saved, so clear previous infos for considering next junction candidate.</span></div>
<div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;    }</div>
<div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;    JuncLegs.clear();</div>
<div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;    Leg1.clear();</div>
<div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;    Leg2.clear();</div>
<div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;    Leg3.clear();</div>
<div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;    Legconsidering.clear();</div>
<div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;  }</div>
<div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;</div>
<div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;  <span class="comment">//So far, all the information for (Anti)Junction and Legs are formed by color tag tracing. Let&#39;s Check this out</span></div>
<div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;  <span class="comment">//dignostic measure</span></div>
<div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;  <span class="comment">/*for(int ijuncstr=0; ijuncstr &lt; JuncStructure.size(); ++ijuncstr) {</span></div>
<div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;<span class="comment">    std::cout &lt;&lt;endl&lt;&lt;endl&lt;&lt;&quot;  Let&#39;s see Temporary junction structure   &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot; Temp Junction :&quot; &lt;&lt; ijuncstr+1 &lt;&lt;endl;</span></div>
<div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot;Leg 1 : [ &quot;;</span></div>
<div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;<span class="comment">    for(int ileg1=0; ileg1 &lt; JuncStructure.at(ijuncstr).at(0).size(); ++ileg1){</span></div>
<div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; (  &quot; &lt;&lt; JuncStructure.at(ijuncstr).at(0)[ileg1].col() &lt;&lt;&quot; , &quot; &lt;&lt; JuncStructure.at(ijuncstr).at(0)[ileg1].acol() &lt;&lt;&quot; ), &quot; ;</span></div>
<div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot; ] &quot; &lt;&lt;endl;</span></div>
<div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot;Leg 2 : [ &quot;;</span></div>
<div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;<span class="comment">    for(int ileg2=0; ileg2 &lt; JuncStructure.at(ijuncstr).at(1).size(); ++ileg2){</span></div>
<div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; (  &quot; &lt;&lt; JuncStructure.at(ijuncstr).at(1)[ileg2].col() &lt;&lt;&quot; , &quot; &lt;&lt; JuncStructure.at(ijuncstr).at(1)[ileg2].acol() &lt;&lt;&quot; ), &quot; ;</span></div>
<div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot; ] &quot; &lt;&lt;endl;</span></div>
<div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot;Leg 3 : [ &quot;;</span></div>
<div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;<span class="comment">    for(int ileg3=0; ileg3 &lt; JuncStructure.at(ijuncstr).at(2).size(); ++ileg3){</span></div>
<div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; (  &quot; &lt;&lt; JuncStructure.at(ijuncstr).at(2)[ileg3].col() &lt;&lt;&quot; , &quot; &lt;&lt; JuncStructure.at(ijuncstr).at(2)[ileg3].acol() &lt;&lt;&quot; ), &quot; ;</span></div>
<div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot; ] &quot; &lt;&lt;endl;</span></div>
<div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;</div>
<div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;  <span class="comment">// Now, we will find the shared legs and sorting them into the corresponding vectors, the information from JuncStructure vector and realjuncindice vector work together here.</span></div>
<div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;  <span class="comment">// if the tags of first particle in a string and end particle in another string are same, they are shared Leg!!</span></div>
<div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irep1 = 0; irep1 &lt; JuncStructure.size(); irep1++){</div>
<div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;    IMStructure3.push_back(realjuncindice.at(irep1));</div>
<div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;    IMStructure3.push_back(Tempjunctions.at(realjuncindice.at(irep1)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(0).at(0));</div>
<div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;    IMStructure3.push_back(irep1);<span class="comment">// room for other usage</span></div>
<div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;    IMStructure3.push_back(0); <span class="comment">// tag 1: dijinction, tag0: other cases</span></div>
<div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;    IMStructure2.push_back(IMStructure3);</div>
<div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;    IMStructure3.clear();</div>
<div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irep2 = 0; irep2 &lt; 3; irep2++){</div>
<div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irep3 = 0; irep3 &lt; JuncStructure.size(); irep3++){</div>
<div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irep4 = 0;  irep4 &lt; 3; irep4++){</div>
<div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;          <span class="keywordflow">if</span>( (irep1 != irep3) &amp;&amp; (JuncStructure.at(irep1).at(irep2).at(0).col() == JuncStructure.at(irep3).at(irep4).back().col()) &amp;&amp;</div>
<div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;            (JuncStructure.at(irep1).at(irep2).at(0).acol() == JuncStructure.at(irep3).at(irep4).back().acol())){</div>
<div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;            IMStructure3.push_back(irep1);</div>
<div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;            IMStructure3.push_back(irep2);</div>
<div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;            IMStructure3.push_back(irep3);</div>
<div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;            IMStructure3.push_back(irep4); <span class="comment">// the first pair means irep2_th Leg in irep1_th junction is linked with irep4_th Leg in irep3_th Tempjunction</span></div>
<div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;            IMStructure2.push_back(IMStructure3);</div>
<div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;            IMStructure3.clear();</div>
<div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;          }</div>
<div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;        }</div>
<div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;      }</div>
<div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;    }</div>
<div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;    IMStructure1.push_back(IMStructure2);</div>
<div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;    IMStructure2.clear();</div>
<div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;  }</div>
<div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;</div>
<div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;  <span class="comment">//dignostic measure!</span></div>
<div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;  <span class="comment">/*JSINFO &lt;&lt; &quot;First IMStructure printout&quot;;</span></div>
<div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;<span class="comment">  std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;<span class="comment">  for(int icheck1 = 0; icheck1 &lt; IMStructure1.size(); icheck1++){</span></div>
<div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;<span class="comment">    for(int icheck2 = 0; icheck2 &lt; IMStructure1.at(icheck1).size(); icheck2++){</span></div>
<div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; ( &quot;;</span></div>
<div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;<span class="comment">      for(int icheck3 = 0; icheck3 &lt; IMStructure1.at(icheck1).at(icheck2).size(); icheck3++){</span></div>
<div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;<span class="comment">        std::cout &lt;&lt;IMStructure1.at(icheck1).at(icheck2).at(icheck3)&lt;&lt;&quot; , &quot;;</span></div>
<div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;<span class="comment">      }</span></div>
<div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; ) &quot;;</span></div>
<div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;<span class="comment">    std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;</div>
<div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;  <span class="comment">// create a vector containing 0 if the (anti-)junction contains only shower partons, 1 if at least one thermal</span></div>
<div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;  <span class="comment">// this is only for the ones in Recombearly1</span></div>
<div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;  std::vector&lt;int&gt; thermal_parton_junction;</div>
<div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;</div>
<div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;  <span class="comment">//since the relation between junctions is defined, Let&#39;s sorting Junctions based on shared legs</span></div>
<div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop1 = 0; iloop1 &lt; IMStructure1.size(); iloop1++){</div>
<div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;    <span class="comment">//structure for 3-shared particles find shared legs and tossing them into the baryon formation</span></div>
<div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;    <span class="keywordflow">if</span>(IMStructure1.at(iloop1).size() == 4){</div>
<div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop2 = 1; iloop2 &lt; IMStructure1.at(iloop1).size(); iloop2++){</div>
<div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop3 = 0; iloop3 &lt; IMStructure1.size(); iloop3++){</div>
<div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop4 = 1; iloop4 &lt; IMStructure1.at(iloop3).size(); iloop4++){</div>
<div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;            <span class="keywordflow">if</span>( (IMStructure1.at(iloop1).at(iloop2).at(2) == IMStructure1.at(iloop3).at(iloop4).at(0)) &amp;&amp;</div>
<div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;              (IMStructure1.at(iloop1).at(iloop2).at(3) == IMStructure1.at(iloop3).at(iloop4).at(1))  ){</div>
<div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;              vector&lt;int&gt; testing;</div>
<div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;              testing.push_back(IMStructure1.at(iloop1).at(iloop2).at(2));</div>
<div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;              testing.push_back(IMStructure1.at(iloop1).at(iloop2).at(3));</div>
<div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;              testing.push_back(IMStructure1.at(iloop1).at(iloop2).at(0));</div>
<div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;              testing.push_back(IMStructure1.at(iloop1).at(iloop2).at(1)); <span class="comment">//now temporary vector is created by this procedure.</span></div>
<div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;              std::vector&lt;vector&lt;int&gt;&gt;::iterator <a class="code" href="../../d5/d0b/changehitformat_8cc.html#a592a0cf34c13b7b53e37c2791a6a982e">it</a> = std::find(IMStructure1.at(iloop3).begin(), IMStructure1.at(iloop3).end(), testing);</div>
<div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;              IMStructure1.at(iloop3).erase(it);</div>
<div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;              testing.clear(); <span class="comment">//now the one of the leg is eliminated in the list, so there is no overlapped leg to be tossed into baryon formation list.</span></div>
<div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;            }</div>
<div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;            <span class="keywordflow">if</span>((JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(0)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(1)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(0).col() != 0) &amp;&amp;</div>
<div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;               (JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(0)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(1)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(0).acol() != 0) &amp;&amp;</div>
<div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;               (JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(3)).back().col() != 0) &amp;&amp;</div>
<div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;               (JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(3)).back().acol() != 0)) {</div>
<div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;              <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a> tempqpair;</div>
<div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;              gluon_decay(JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(0)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(1)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(0), tempqpair ); <span class="comment">// the first particle has col tag and the second had acol tag</span></div>
<div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;              <span class="comment">//std::vector&lt;HHparton&gt;::iterator tempit1 = JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(0)).at(IMStructure1.at(iloop1).at(iloop2).at(1)).begin();</span></div>
<div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;              <span class="comment">//JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(0)).at(IMStructure1.at(iloop1).at(iloop2).at(1)).erase(tempit1);</span></div>
<div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;              <span class="keywordflow">if</span>(IMStructure1.at(iloop1).at(0).at(1) == -1){</div>
<div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;                Recombearly2.push_back(tempqpair[1]); <span class="comment">//add anti-particle to form anti baryon</span></div>
<div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; the particle with tags { &quot;&lt;&lt; JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).at(IMStructure1.at(iloop1).at(iloop2).at(3)).back().col()&lt;&lt;&quot; , &quot;</span></div>
<div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;                <span class="comment">//&lt;&lt;JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).at(IMStructure1.at(iloop1).at(iloop2).at(3)).back().acol()&lt;&lt;&quot; } is changed into &quot;;</span></div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;                JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(3)).pop_back();</div>
<div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;                JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(3)).push_back(tempqpair[0]); <span class="comment">// add remain parton to the original leg</span></div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;                <span class="comment">//std::cout &lt;&lt;&quot; { &quot; &lt;&lt; tempqpair[0].col()&lt;&lt;&quot; , &quot;&lt;&lt; tempqpair[0].acol()&lt;&lt;&quot; }&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;                <span class="comment">//std::cout &lt;&lt;&quot; and &quot;&lt;&lt;&quot; { &quot; &lt;&lt; tempqpair[1].col()&lt;&lt;&quot; , &quot;&lt;&lt; tempqpair[1].acol()&lt;&lt;&quot; } &quot;&lt;&lt;&quot; is gone to be recombined&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;              }</div>
<div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;              <span class="keywordflow">if</span>(IMStructure1.at(iloop1).at(0).at(1) == 1){</div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;                Recombearly2.push_back(tempqpair[0]); <span class="comment">//add particle to form baryon</span></div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; the particle with tags { &quot;&lt;&lt; JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).at(IMStructure1.at(iloop1).at(iloop2).at(3)).back().col()&lt;&lt;&quot; , &quot;</span></div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;                <span class="comment">//&lt;&lt;JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).at(IMStructure1.at(iloop1).at(iloop2).at(3)).back().acol()&lt;&lt;&quot; } is changed into &quot;;</span></div>
<div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;                JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(3)).pop_back();</div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;                JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(3)).push_back(tempqpair[1]); <span class="comment">// add remain parton to the original leg</span></div>
<div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;                <span class="comment">//std::cout &lt;&lt;&quot; { &quot; &lt;&lt; tempqpair[0].col()&lt;&lt;&quot; , &quot;&lt;&lt; tempqpair[0].acol()&lt;&lt;&quot; }&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;                <span class="comment">//std::cout &lt;&lt;&quot; and &quot;&lt;&lt;&quot; { &quot; &lt;&lt; tempqpair[1].col()&lt;&lt;&quot; , &quot;&lt;&lt; tempqpair[1].acol()&lt;&lt;&quot; } &quot;&lt;&lt;&quot; is gone to be recombined&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;              }</div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;              tempqpair.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;            }</div>
<div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;          }</div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;        }</div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;      }</div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;      thermal_parton_junction.push_back(Tempjunctions.at(IMStructure1.at(iloop1).at(0).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(0).at(1));</div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;      IMStructure1.erase(IMStructure1.begin()+iloop1); <span class="comment">// erase the junction with three shared legs from the IMStructure</span></div>
<div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;      iloop1--;</div>
<div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;      Recombearly1.push_back(Recombearly2);</div>
<div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;      Recombearly2.clear();</div>
<div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;    }</div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;  }</div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;</div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;  <span class="comment">//One thing to remind : JuncStructure has information of parton class, and IMStructure has informations about these partons or junctions with same indice with JuncStructure</span></div>
<div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop1 = 0; iloop1 &lt; IMStructure1.size(); iloop1++){</div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;    <span class="keywordflow">if</span>(IMStructure1.at(iloop1).size() == 3){ <span class="comment">// 2-shared leg case {basic info, shared leg1&#39;s info, shared leg2&#39;s info}</span></div>
<div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;      <span class="comment">// loop for pop out the unshared leg in the junction structure.</span></div>
<div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;      <span class="keywordtype">int</span> leftleg; <span class="comment">// indice of unshared leg which will remain after the Early recombinaton</span></div>
<div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;      <span class="keywordtype">int</span> SI = 0; <span class="comment">// Sum of the Indice of Leg{if 1 = 0+1, Leg3 is not shared, if 3 = 1+2, Leg 0 is not shared}</span></div>
<div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itail = 1; itail &lt; IMStructure1.at(iloop1).size(); itail++){</div>
<div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;        SI = SI + IMStructure1.at(iloop1).at(itail).at(1);</div>
<div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;      }</div>
<div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;      <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;SI = &quot;&lt;&lt;SI&lt;&lt;endl;</span></div>
<div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;      vector&lt;int&gt; indicevec; <span class="comment">// vector for indice, we could use if statement, but when if and for statement are repeated, possibly forced execution occurs regardless of if statement, so take most defensive measure.</span></div>
<div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;      indicevec.push_back(2);</div>
<div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;      indicevec.push_back(1);</div>
<div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;      indicevec.push_back(0);</div>
<div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;      leftleg = indicevec[SI-1];</div>
<div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;      <span class="comment">//below was tested, but showed forced execution{that is all of the Three statements executed so that left leg was always 0}</span></div>
<div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;      <span class="comment">//if(SI = 1 ){ leftleg = 2; SI = 0;}</span></div>
<div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;      <span class="comment">//if(SI = 2 ){ leftleg = 1; SI = 0;}</span></div>
<div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;      <span class="comment">//if(SI = 3 ){ leftleg = 0; SI = 0;}</span></div>
<div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;      <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;leftleg number is &quot;&lt;&lt;leftleg&lt;&lt;endl;</span></div>
<div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;</div>
<div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;      <span class="keywordtype">int</span> jidentity = IMStructure1.at(iloop1).at(0).at(1); <span class="comment">//junction identity 1 or -1 {junction or anti juncttion}</span></div>
<div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;      <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;junction identity is &quot;&lt;&lt;jidentity&lt;&lt;endl;</span></div>
<div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;      <span class="keywordtype">int</span> juncnum = IMStructure1.at(iloop1).at(0).at(0); <span class="comment">//junction number to be dealt with</span></div>
<div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;      vector&lt;HHparton&gt; tempstring = JuncStructure.at(juncnum).at(leftleg); <span class="comment">//declare the unshared leg.</span></div>
<div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;      <span class="keywordflow">if</span>(jidentity == 1 &amp;&amp; tempstring.at(0).col() != 0 &amp;&amp; tempstring.at(0).acol() != 0){</div>
<div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;        <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a> tempqpair;</div>
<div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;        gluon_decay( tempstring.at(0), tempqpair);</div>
<div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;        tempstring.erase(tempstring.begin());</div>
<div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;        tempstring.insert(tempstring.begin() , tempqpair[1] );</div>
<div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;        Tailoredstring1.push_back(tempstring);</div>
<div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;        Recombearly2.push_back(tempqpair[0]);</div>
<div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(jidentity == -1 &amp;&amp; tempstring.at(0).col() != 0 &amp;&amp; tempstring.at(0).acol() != 0){</div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;        <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a> tempqpair;</div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;        gluon_decay( tempstring.at(0), tempqpair);</div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;        tempstring.erase(tempstring.begin());</div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;        tempstring.insert(tempstring.begin() , tempqpair[0] );</div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;        Tailoredstring1.push_back(tempstring);</div>
<div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;        Recombearly2.push_back(tempqpair[1]);</div>
<div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;      }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;        Recombearly2.push_back(tempstring.at(0));</div>
<div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;      }</div>
<div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;      indicevec.clear();</div>
<div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;</div>
<div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop2 = 1; iloop2 &lt; IMStructure1.at(iloop1).size(); iloop2++){</div>
<div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop3 = 0; iloop3 &lt; IMStructure1.size(); iloop3++){</div>
<div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop4 = 1; iloop4 &lt; IMStructure1.at(iloop3).size(); iloop4++){</div>
<div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;            <span class="keywordflow">if</span>( (IMStructure1.at(iloop1).at(iloop2).at(2) == IMStructure1.at(iloop3).at(iloop4).at(0)) &amp;&amp;</div>
<div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;              (IMStructure1.at(iloop1).at(iloop2).at(3) == IMStructure1.at(iloop3).at(iloop4).at(1))  ){</div>
<div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;              vector&lt;int&gt; testing;</div>
<div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;              testing.push_back(IMStructure1.at(iloop1).at(iloop2).at(2));</div>
<div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;              testing.push_back(IMStructure1.at(iloop1).at(iloop2).at(3));</div>
<div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;              testing.push_back(IMStructure1.at(iloop1).at(iloop2).at(0));</div>
<div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;              testing.push_back(IMStructure1.at(iloop1).at(iloop2).at(1)); <span class="comment">//now temporary vector is created by this procedure.</span></div>
<div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;              std::vector&lt;vector&lt;int&gt;&gt;::iterator <a class="code" href="../../d5/d0b/changehitformat_8cc.html#a592a0cf34c13b7b53e37c2791a6a982e">it</a> = std::find(IMStructure1.at(iloop3).begin(), IMStructure1.at(iloop3).end(), testing);</div>
<div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;              IMStructure1.at(iloop3).erase(it);</div>
<div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;              testing.clear(); <span class="comment">//now the one of the leg is eliminated in the list, so there is no overlapped leg to be tossed into baryon formation list.</span></div>
<div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;            }</div>
<div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;            <span class="keywordflow">if</span>((JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(0)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(1)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(0).col() != 0) &amp;&amp;</div>
<div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;               (JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(0)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(1)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(0).acol() != 0) &amp;&amp;</div>
<div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;               (JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(3)).back().col() != 0) &amp;&amp;</div>
<div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;               (JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(3)).back().acol() != 0)) {</div>
<div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;              <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a> tempqpair;</div>
<div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;              gluon_decay(JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(0)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(1)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(0), tempqpair ); <span class="comment">// the first particle has col tag and the second had acol tag</span></div>
<div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;              <span class="comment">//std::vector&lt;HHparton&gt;::iterator tempit1 = JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(0)).at(IMStructure1.at(iloop1).at(iloop2).at(1)).begin();</span></div>
<div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;              <span class="comment">//JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(0)).at(IMStructure1.at(iloop1).at(iloop2).at(1)).erase(tempit1);</span></div>
<div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;              <span class="keywordflow">if</span>(IMStructure1.at(iloop1).at(0).at(1) == -1){</div>
<div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;                Recombearly2.push_back(tempqpair[1]); <span class="comment">//add anti-particle to form anti baryon</span></div>
<div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; the particle with tags { &quot;&lt;&lt; JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).at(IMStructure1.at(iloop1).at(iloop2).at(3)).back().col()&lt;&lt;&quot; , &quot;</span></div>
<div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;                <span class="comment">//&lt;&lt;JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).at(IMStructure1.at(iloop1).at(iloop2).at(3)).back().acol()&lt;&lt;&quot; } is changed into &quot;;</span></div>
<div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;                JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(3)).pop_back();</div>
<div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;                JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(3)).push_back(tempqpair[0]); <span class="comment">// add remain parton to the original leg</span></div>
<div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;                <span class="comment">//std::cout &lt;&lt;&quot; { &quot; &lt;&lt; tempqpair[0].col()&lt;&lt;&quot; , &quot;&lt;&lt; tempqpair[0].acol()&lt;&lt;&quot; }&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;                <span class="comment">//std::cout &lt;&lt;&quot; and &quot;&lt;&lt;&quot; { &quot; &lt;&lt; tempqpair[1].col()&lt;&lt;&quot; , &quot;&lt;&lt; tempqpair[1].acol()&lt;&lt;&quot; } &quot;&lt;&lt;&quot; is gone to be recombined&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;              }</div>
<div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;              <span class="keywordflow">if</span>(IMStructure1.at(iloop1).at(0).at(1) == 1){</div>
<div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;                Recombearly2.push_back(tempqpair[0]); <span class="comment">//add particle to form baryon</span></div>
<div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;                <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot; the particle with tags { &quot;&lt;&lt; JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).at(IMStructure1.at(iloop1).at(iloop2).at(3)).back().col()&lt;&lt;&quot; , &quot;</span></div>
<div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;                <span class="comment">//&lt;&lt;JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).at(IMStructure1.at(iloop1).at(iloop2).at(3)).back().acol()&lt;&lt;&quot; } is changed into &quot;;</span></div>
<div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;                JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(3)).pop_back();</div>
<div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;                JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(IMStructure1.at(iloop1).at(iloop2).at(3)).push_back(tempqpair[1]); <span class="comment">// add remain parton to the original leg</span></div>
<div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;                <span class="comment">//std::cout &lt;&lt;&quot; { &quot; &lt;&lt; tempqpair[0].col()&lt;&lt;&quot; , &quot;&lt;&lt; tempqpair[0].acol()&lt;&lt;&quot; }&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;                <span class="comment">//std::cout &lt;&lt;&quot; and &quot;&lt;&lt;&quot; { &quot; &lt;&lt; tempqpair[1].col()&lt;&lt;&quot; , &quot;&lt;&lt; tempqpair[1].acol()&lt;&lt;&quot; } &quot;&lt;&lt;&quot; is gone to be recombined&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;              }</div>
<div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;            }</div>
<div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;          }</div>
<div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;        }</div>
<div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;      }</div>
<div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;      thermal_parton_junction.push_back(Tempjunctions.at(IMStructure1.at(iloop1).at(0).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(0).at(1));</div>
<div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;      IMStructure1.erase(IMStructure1.begin()+iloop1); <span class="comment">// erase the junction with three shared legs from the IMStructure</span></div>
<div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;      iloop1--;</div>
<div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;      Recombearly1.push_back(Recombearly2);</div>
<div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;      Recombearly2.clear();</div>
<div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;    }</div>
<div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;  }</div>
<div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;</div>
<div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;  <span class="comment">/*std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;<span class="comment">  std::cout &lt;&lt;&quot; number of early recombined baryons 1: &quot;&lt;&lt;Recombearly1.size()&lt;&lt;endl;</span></div>
<div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;<span class="comment">  for(int ibary1 = 0; ibary1 &lt; Recombearly1.size(); ibary1++){</span></div>
<div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot;the &quot;&lt;&lt; ibary1 &lt;&lt;&quot; st baryon is made of &quot;;</span></div>
<div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;<span class="comment">    for(int ibary2 = 0; ibary2 &lt; Recombearly1.at(ibary1).size(); ibary2++){</span></div>
<div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; { &quot;&lt;&lt;Recombearly1.at(ibary1).at(ibary2).col()&lt;&lt;&quot; , &quot;&lt;&lt; Recombearly1.at(ibary1).at(ibary2).acol()  &lt;&lt;&quot; } , &quot;;</span></div>
<div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;<span class="comment">    std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;</div>
<div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;  <span class="comment">//dignostic measure{IMStructure1}</span></div>
<div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;  <span class="comment">/*JSINFO &lt;&lt; &quot;1.5 IMStructure printout&quot;;</span></div>
<div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;<span class="comment">  std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;<span class="comment">  for(int icheck1 = 0; icheck1 &lt; IMStructure1.size(); icheck1++){</span></div>
<div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;<span class="comment">    for(int icheck2 = 0; icheck2 &lt; IMStructure1.at(icheck1).size(); icheck2++){</span></div>
<div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; ( &quot;;</span></div>
<div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;<span class="comment">      for(int icheck3 = 0; icheck3 &lt; IMStructure1.at(icheck1).at(icheck2).size(); icheck3++){</span></div>
<div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;<span class="comment">        std::cout &lt;&lt;IMStructure1.at(icheck1).at(icheck2).at(icheck3)&lt;&lt;&quot; , &quot;;</span></div>
<div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;<span class="comment">      }</span></div>
<div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; ) &quot;;</span></div>
<div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;<span class="comment">    std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;</div>
<div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop1 = 0; iloop1 &lt; IMStructure1.size(); iloop1++){</div>
<div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;    <span class="keywordflow">if</span>(IMStructure1.at(iloop1).size() == 2 &amp;&amp; IMStructure1.at(iloop1).at(0).at(3) == 0){ <span class="comment">// Dijunction Structure</span></div>
<div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop2 = 1; iloop2&lt; IMStructure1.at(iloop1).size(); iloop2++){</div>
<div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop3 = 0; iloop3 &lt; IMStructure1.size(); iloop3++){</div>
<div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloop4 = 1; iloop4 &lt; IMStructure1.at(iloop3).size(); iloop4++){</div>
<div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;            <span class="keywordflow">if</span>( (IMStructure1.at(iloop1).at(iloop2).at(2) == IMStructure1.at(iloop3).at(iloop4).at(0)) &amp;&amp;</div>
<div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;              (IMStructure1.at(iloop1).at(iloop2).at(3) == IMStructure1.at(iloop3).at(iloop4).at(1))  ){ <span class="comment">// the case where we found the shared legs pair.</span></div>
<div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;              <span class="keywordflow">if</span>(IMStructure1.at(iloop1).at(0).at(3) == 0) {</div>
<div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idijunc1 = 0; idijunc1 &lt; 3; idijunc1++){ <span class="comment">// first, put three legs of first junction</span></div>
<div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;                  Dijunction2.push_back(JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(0)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(idijunc1));</div>
<div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;                }</div>
<div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idijunc2 = 0; idijunc2 &lt; 3; idijunc2++){ <span class="comment">// second, exclude shared leg in second junction to be merged</span></div>
<div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;                  <span class="keywordflow">if</span>( idijunc2 != IMStructure1.at(iloop1).at(iloop2).at(3)){</div>
<div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;                    Dijunction2.push_back(JuncStructure.at(IMStructure1.at(iloop1).at(iloop2).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(idijunc2));</div>
<div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;                  }</div>
<div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;                }</div>
<div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;              }</div>
<div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;              Dijunction1.push_back(Dijunction2); <span class="comment">//finally, five legs are added in the vector to form dijunction structure.</span></div>
<div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;              Dijunction2.clear(); <span class="comment">// clear temp vector for next procedure.</span></div>
<div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;              IMStructure1.at(iloop1).at(0).pop_back();</div>
<div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;              IMStructure1.at(iloop1).at(0).push_back(1); <span class="comment">// tag representing dijunction structure.</span></div>
<div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;              IMStructure1.at(iloop3).at(0).pop_back();</div>
<div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;              IMStructure1.at(iloop3).at(0).push_back(1); <span class="comment">// tag representing dijunction structure.</span></div>
<div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;</div>
<div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;              vector&lt;int&gt; testing;</div>
<div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;              testing.push_back(IMStructure1.at(iloop1).at(iloop2).at(2));</div>
<div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;              testing.push_back(IMStructure1.at(iloop1).at(iloop2).at(3));</div>
<div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;              testing.push_back(IMStructure1.at(iloop1).at(iloop2).at(0));</div>
<div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;              testing.push_back(IMStructure1.at(iloop1).at(iloop2).at(1)); <span class="comment">//now temporary vector is created by this procedure.</span></div>
<div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;              std::vector&lt;vector&lt;int&gt;&gt;::iterator <a class="code" href="../../d5/d0b/changehitformat_8cc.html#a592a0cf34c13b7b53e37c2791a6a982e">it</a> = std::find(IMStructure1.at(iloop3).begin(), IMStructure1.at(iloop3).end(), testing);</div>
<div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;              IMStructure1.at(iloop3).erase(it);</div>
<div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;              testing.clear();</div>
<div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;              <span class="comment">//now the one of the leg is eliminated in the list, so there is no overlapped leg to be tossed into baryon formation list.</span></div>
<div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;            }</div>
<div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;          }</div>
<div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;        }</div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;      }</div>
<div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;    }</div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;  }</div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;</div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;  <span class="comment">//dignostic measure{IMStructure1}</span></div>
<div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;  <span class="comment">/*JSINFO &lt;&lt; &quot;1.75 IMStructure printout&quot;;</span></div>
<div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;<span class="comment">  std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;<span class="comment">  for(int icheck1 = 0; icheck1 &lt; IMStructure1.size(); icheck1++){</span></div>
<div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;<span class="comment">    for(int icheck2 = 0; icheck2 &lt; IMStructure1.at(icheck1).size(); icheck2++){</span></div>
<div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; ( &quot;;</span></div>
<div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;<span class="comment">      for(int icheck3 = 0; icheck3 &lt; IMStructure1.at(icheck1).at(icheck2).size(); icheck3++){</span></div>
<div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;<span class="comment">        std::cout &lt;&lt;IMStructure1.at(icheck1).at(icheck2).at(icheck3)&lt;&lt;&quot; , &quot;;</span></div>
<div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;<span class="comment">      }</span></div>
<div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; ) &quot;;</span></div>
<div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;<span class="comment">    std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;</div>
<div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irepair = 0; irepair &lt; IMStructure1.size(); irepair++) {</div>
<div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;    <span class="keywordflow">if</span>(IMStructure1.at(irepair).size() == 1 &amp;&amp; IMStructure1.at(irepair).at(0).at(3) == 0  ){ <span class="comment">// size one means there are no shared legs to the junction, so put them directly to the single junction vector</span></div>
<div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;      Singlejunction2.push_back(JuncStructure.at(IMStructure1.at(irepair).at(0).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(0));</div>
<div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;      Singlejunction2.push_back(JuncStructure.at(IMStructure1.at(irepair).at(0).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(1));</div>
<div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;      Singlejunction2.push_back(JuncStructure.at(IMStructure1.at(irepair).at(0).at(2)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(2));</div>
<div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;      Singlejunction1.push_back(Singlejunction2);</div>
<div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;      Singlejunction2.clear();</div>
<div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;    }<span class="comment">//After all, all these vectors of junction legs will be tossed into PYTHIA to be hadronized. before that we need to set Mother Daughter tag for PYTHIA</span></div>
<div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;  } <span class="comment">// collecting all single junctions</span></div>
<div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;</div>
<div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;  <span class="comment">//dignostic measure{IMStructure1}</span></div>
<div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;  <span class="comment">/*JSINFO &lt;&lt; &quot;Second IMStructure printout&quot;;</span></div>
<div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;<span class="comment">  std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;<span class="comment">  for(int icheck1 = 0; icheck1 &lt; IMStructure1.size(); icheck1++){</span></div>
<div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;<span class="comment">    for(int icheck2 = 0; icheck2 &lt; IMStructure1.at(icheck1).size(); icheck2++){</span></div>
<div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; ( &quot;;</span></div>
<div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;<span class="comment">      for(int icheck3 = 0; icheck3 &lt; IMStructure1.at(icheck1).at(icheck2).size(); icheck3++){</span></div>
<div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;<span class="comment">        std::cout &lt;&lt;IMStructure1.at(icheck1).at(icheck2).at(icheck3)&lt;&lt;&quot; , &quot;;</span></div>
<div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;<span class="comment">      }</span></div>
<div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; ) &quot;;</span></div>
<div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;<span class="comment">    std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;</div>
<div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;  <span class="comment">//now we need to form fake partons and baryons for appending particles to PYTHIA{for Dijunction Structure}</span></div>
<div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;  <span class="comment">//declaration of required Variables</span></div>
<div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#abc4f62a83ef45919eae805f79fe6bd86">J</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;  <span class="keywordtype">bool</span> antiJ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;  <span class="keywordtype">bool</span> bothJ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idj1 = 0; idj1 &lt; Dijunction1.size(); idj1++){ <span class="comment">//searching dijunction</span></div>
<div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idj2 = 0; idj2 &lt; Dijunction1.at(idj1).size(); idj2++){ <span class="comment">//searching dijunction&#39;s leg</span></div>
<div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;      <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;let&#39;s check these particles &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;      <span class="comment">//std::cout &lt;&lt;&quot; { &quot;&lt;&lt;Dijunction1.at(idj1).at(idj2).at(0).col()&lt;&lt;&quot; , &quot;&lt;&lt;Dijunction1.at(idj1).at(idj2).at(0).acol()&lt;&lt;&quot; } &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;      <span class="comment">//std::cout &lt;&lt;&quot; { &quot;&lt;&lt;Dijunction1.at(idj1).at(idj2).back().col()&lt;&lt;&quot; , &quot;&lt;&lt;Dijunction1.at(idj1).at(idj2).back().acol()&lt;&lt;&quot; } &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itpj1 = 0; itpj1 &lt; IMStructure1.size(); itpj1++){ <span class="comment">//searching Tempjunction</span></div>
<div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itpj2 = 1; itpj2 &lt; Tempjunctions.at(itpj1).size(); itpj2++){ <span class="comment">//searching color tags in tempjunction{ {_+1, 0 }, {_+1, tag1}, {_+1, tag2}, {_+1, tag3} }</span></div>
<div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;          <span class="keywordflow">if</span>(Dijunction1.at(idj1).at(idj2).at(0).col() == Tempjunctions.at(IMStructure1.at(itpj1).at(0).at(0)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(itpj2).at(1) || <span class="comment">//check whether first or last particle has correponding color tags for J</span></div>
<div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;            Dijunction1.at(idj1).at(idj2).back().col() == Tempjunctions.at(IMStructure1.at(itpj1).at(0).at(0)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(itpj2).at(1) ){</div>
<div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;            J = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;          }</div>
<div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;          <span class="keywordflow">if</span>(Dijunction1.at(idj1).at(idj2).at(0).acol() == Tempjunctions.at(IMStructure1.at(itpj1).at(0).at(0)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(itpj2).at(1) || <span class="comment">//check whether first or last particle has correponding color tags for J</span></div>
<div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;            Dijunction1.at(idj1).at(idj2).back().acol() == Tempjunctions.at(IMStructure1.at(itpj1).at(0).at(0)).<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a6c8403cf1f00f8d2746f9fe1da683802">at</a>(itpj2).at(1) ){</div>
<div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;            antiJ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;          }</div>
<div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;        }</div>
<div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;      }</div>
<div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;      <span class="keywordflow">if</span>(J == <span class="keyword">true</span> &amp;&amp; antiJ == <span class="keyword">false</span>){ <span class="comment">// this leg is a part of junction</span></div>
<div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;        DijunctionInfo2.push_back(1);</div>
<div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;      }</div>
<div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;      <span class="keywordflow">if</span>(J == <span class="keyword">false</span> &amp;&amp; antiJ == <span class="keyword">true</span>){ <span class="comment">// this leg is a part of junction</span></div>
<div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;        DijunctionInfo2.push_back(-1);</div>
<div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;      }</div>
<div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;      <span class="keywordflow">if</span>(J == <span class="keyword">true</span> &amp;&amp; antiJ == <span class="keyword">true</span>){</div>
<div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;        bothJ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;      }</div>
<div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;      <span class="keywordflow">if</span>(bothJ){ <span class="comment">//this leg is shared leg, so that fake parton shoud be added after all</span></div>
<div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;        DijunctionInfo2.push_back(0);</div>
<div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;      }</div>
<div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;      J = <span class="keyword">false</span>; <span class="comment">//reseting variables to check other legs in Dijunction structure</span></div>
<div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;      antiJ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;      bothJ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;    }</div>
<div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;    DijunctionInfo1.push_back(DijunctionInfo2);</div>
<div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;    DijunctionInfo2.clear();</div>
<div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;  }<span class="comment">//so far, vector about the information of dijunction structure is formed,{ so, we could put identity 1-leg first, and put identity-0 leg and -1 leg}</span></div>
<div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;  <span class="comment">//based on the information above, we need to add fake partons, which are used for telling pythia about the color flow{fake particle id is ignored, since we&#39;ll set</span></div>
<div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;  <span class="comment">// negative status flag}, with this color flow information, PYTHIA can detect J and anti-J</span></div>
<div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;</div>
<div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;  <span class="comment">//additional proceudre to change the configuration of shared leg by searching through dijunction1 and dijunction1info vectors</span></div>
<div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;  <span class="comment">// make sure that the shared leg is ordered from junction to antijunction, used later</span></div>
<div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ileg1 = 0 ; ileg1 &lt; Dijunction1.size(); ileg1++){</div>
<div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ileg2 = 0; ileg2 &lt; Dijunction1.at(ileg1).size(); ileg2++){</div>
<div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;      <span class="keywordtype">bool</span> needflip = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;      <span class="keywordflow">if</span>((DijunctionInfo1.at(ileg1).at(ileg2) == 0 &amp;&amp; Dijunction1.at(ileg1).at(ileg2).size() != 1) &amp;&amp;</div>
<div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;        (Dijunction1.at(ileg1).at(ileg2).at(0).col() == Dijunction1.at(ileg1).at(ileg2).at(1).acol()) ){ <span class="comment">// In this case, we need to flip the order of the partons in this shared leg</span></div>
<div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;        needflip = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;      }</div>
<div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;      <span class="keywordflow">if</span>(needflip){</div>
<div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;        std::reverse(Dijunction1.at(ileg1).at(ileg2).begin() , Dijunction1.at(ileg1).at(ileg2).end() );</div>
<div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;      }</div>
<div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;      needflip = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;    }</div>
<div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;  }</div>
<div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;</div>
<div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;  <span class="comment">//dignostic measure{DijunctionInfo1}</span></div>
<div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;  <span class="comment">/*std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;<span class="comment">  std::cout &lt;&lt;&quot; DijunctionInfo Checking&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;<span class="comment">  for(int icheck1 = 0; icheck1 &lt; DijunctionInfo1.size(); icheck1++){</span></div>
<div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot; Let&#39;s Check all the elements! : &quot;;</span></div>
<div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;<span class="comment">    for(int icheck2 = 0; icheck2 &lt; DijunctionInfo1.at(icheck1).size(); icheck2++){</span></div>
<div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;<span class="comment">      std::cout &lt;&lt;DijunctionInfo1.at(icheck1).at(icheck2)&lt;&lt;&quot; , &quot;;</span></div>
<div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;<span class="comment">    std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;</div>
<div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;  <span class="comment">//dignostic measure{Dijunction1}</span></div>
<div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;  <span class="comment">/*std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;<span class="comment">  std::cout &lt;&lt;&quot; List of Dijunction Structure&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;<span class="comment">  for(int icheck1 = 0; icheck1 &lt; Dijunction1.size(); icheck1++){</span></div>
<div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot; Dijunction : &quot;&lt;&lt;icheck1&lt;&lt;endl;</span></div>
<div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;<span class="comment">    for(int icheck2 = 0 ; icheck2 &lt; Dijunction1.at(icheck1).size(); icheck2++){</span></div>
<div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; Leg &quot;&lt;&lt;icheck2&lt;&lt;&quot; : &quot;&lt;&lt;&quot;{ identity : &quot;&lt;&lt; DijunctionInfo1.at(icheck1).at(icheck2)&lt;&lt;&quot; }  &quot;;</span></div>
<div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;<span class="comment">      for(int icheck3 = 0; icheck3 &lt; Dijunction1.at(icheck1).at(icheck2).size(); icheck3++){</span></div>
<div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;<span class="comment">        std::cout &lt;&lt;&quot; ( &quot;&lt;&lt;Dijunction1.at(icheck1).at(icheck2).at(icheck3).col()&lt;&lt;&quot; , &quot;&lt;&lt;Dijunction1.at(icheck1).at(icheck2).at(icheck3).acol()&lt;&lt; &quot; )  &quot;;</span></div>
<div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;<span class="comment">      }</span></div>
<div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;<span class="comment">      std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;</div>
<div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;  <span class="comment">//dignostic measure{Singlejunction1}</span></div>
<div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;  <span class="comment">/*std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;<span class="comment">  std::cout &lt;&lt;&quot; List of Single Junction Structure&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;<span class="comment">  for(int icheck1 = 0; icheck1 &lt; Singlejunction1.size(); icheck1++){</span></div>
<div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot; Single junction : &quot;&lt;&lt;icheck1&lt;&lt;endl;</span></div>
<div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;<span class="comment">    for(int icheck2 = 0 ; icheck2 &lt; Singlejunction1.at(icheck1).size(); icheck2++){</span></div>
<div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; Leg &quot;&lt;&lt;icheck2&lt;&lt;&quot; : &quot;;</span></div>
<div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;<span class="comment">      for(int icheck3 = 0; icheck3 &lt; Singlejunction1.at(icheck1).at(icheck2).size(); icheck3++){</span></div>
<div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;<span class="comment">        std::cout &lt;&lt;&quot; ( &quot;&lt;&lt;Singlejunction1.at(icheck1).at(icheck2).at(icheck3).col()&lt;&lt;&quot; , &quot;&lt;&lt;Singlejunction1.at(icheck1).at(icheck2).at(icheck3).acol()&lt;&lt; &quot; )  &quot;;</span></div>
<div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;<span class="comment">      }</span></div>
<div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;<span class="comment">      std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;</div>
<div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;  <span class="comment">//For the validity with PYTHIA running, each Leg in Single or Dijunction Structure should have q or q-bar as endpoint particle, so checking whether the gluon is located at the endpoint of the Leg</span></div>
<div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;  <span class="comment">//Starting from Leg&#39;s in single junction.</span></div>
<div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> is1 = 0; is1 &lt; Singlejunction1.size(); is1++){</div>
<div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;    <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> p1 = Singlejunction1.at(is1).at(0).back(); <span class="comment">//endpoint particle of first leg in is1_st Singlejunction1</span></div>
<div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;    <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> p2 = Singlejunction1.at(is1).at(1).back(); <span class="comment">//endpoint particle of second leg in is1_st Singlejunction1</span></div>
<div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;    <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> p3 = Singlejunction1.at(is1).at(2).back(); <span class="comment">//endpoint particle of third leg in is1_st Singlejunction1</span></div>
<div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;</div>
<div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;    <span class="comment">// basically, assume the junction. but check the id&#39;s of them and change identity of the condition for antijunction is meeted</span></div>
<div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;    <span class="keywordtype">bool</span> ajunction = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;</div>
<div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;    <span class="keywordflow">if</span>( p1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() &lt; 0 || p2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() &lt; 0 || p3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() &lt; 0){</div>
<div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;      ajunction = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;    }</div>
<div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;</div>
<div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> is2 = 0; is2 &lt; Singlejunction1.at(is1).size(); is2++){</div>
<div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;      <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> endpoint = Singlejunction1.at(is1).at(is2).back();</div>
<div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;</div>
<div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;      <span class="keywordflow">if</span>(endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>() != 0 &amp;&amp; endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>() != 0 &amp;&amp; ajunction){</div>
<div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = 0;</div>
<div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> tempparton1 = endpoint;</div>
<div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;        <span class="keywordflow">if</span>(tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() == 21) {</div>
<div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;          tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(1);</div>
<div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;          loc = findcloserepl(tempparton1,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);</div>
<div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;          tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;        }<span class="keywordflow">else</span>{loc = findcloserepl(tempparton1,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);}</div>
<div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;        <span class="keywordflow">if</span>(loc == 999999999 || loc &gt; 0) {</div>
<div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;              <span class="keywordtype">int</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.33333333) ? ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? -1 : -2) : -3);</div>
<div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;          <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton1; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid); fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(0);</div>
<div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>());</div>
<div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;          <span class="keywordflow">if</span>(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 3) {</div>
<div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);</div>
<div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;          } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xms);}</div>
<div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;          <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;          <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;          } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;          number_p_fake++;</div>
<div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;          SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;          Singlejunction1.at(is1).at(is2).push_back(fakep);</div>
<div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0) {</div>
<div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;          HH_thermal[-loc-1].acol(endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>());</div>
<div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;          HH_thermal[-loc-1].col(0);</div>
<div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;          HH_thermal[-loc-1].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;          HH_thermal[-loc-1].is_remnant(<span class="keyword">true</span>); SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;          SP_remnants[SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].par(-loc-1);</div>
<div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;          Singlejunction1.at(is1).at(is2).push_back(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;        }</div>
<div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;      }</div>
<div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;    }</div>
<div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;</div>
<div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> is3 = 0; is3 &lt; Singlejunction1.at(is1).size(); is3++){</div>
<div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;      <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> endpoint = Singlejunction1.at(is1).at(is3).back();</div>
<div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;</div>
<div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;      <span class="keywordflow">if</span>(endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>() != 0 &amp;&amp; endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>() != 0 &amp;&amp; !ajunction){</div>
<div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = 0;</div>
<div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> tempparton1 = endpoint;</div>
<div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;        <span class="keywordflow">if</span>(tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() == 21) {</div>
<div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;          tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-1);</div>
<div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;          loc = findcloserepl(tempparton1,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);</div>
<div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;          tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;        }<span class="keywordflow">else</span>{loc = findcloserepl(tempparton1,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);}</div>
<div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;        <span class="keywordflow">if</span>(loc == 999999999 || loc &gt; 0) {</div>
<div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;              <span class="keywordtype">int</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.33333333) ? ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? 1 : 2) : 3);</div>
<div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;          <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton1; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid); fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>());</div>
<div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(0);</div>
<div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;          <span class="keywordflow">if</span>(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 3) {</div>
<div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);</div>
<div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;          } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xms);}</div>
<div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;          <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;          <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;          } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;          number_p_fake++;</div>
<div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;          SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;          Singlejunction1.at(is1).at(is3).push_back(fakep);</div>
<div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0) {</div>
<div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;          HH_thermal[-loc-1].col(endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>());</div>
<div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;          HH_thermal[-loc-1].acol(0);</div>
<div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;          HH_thermal[-loc-1].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;          HH_thermal[-loc-1].is_remnant(<span class="keyword">true</span>); SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;          SP_remnants[SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].par(-loc-1);</div>
<div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;          Singlejunction1.at(is1).at(is3).push_back(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;        }</div>
<div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;      }</div>
<div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;    }</div>
<div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;    ajunction = <span class="keyword">false</span>; <span class="comment">//resetting the variable.</span></div>
<div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;  }</div>
<div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;</div>
<div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;  <span class="comment">//Working for Leg&#39;s in dijunction structure.</span></div>
<div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idj1 = 0; idj1 &lt; Dijunction1.size(); idj1++){</div>
<div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idj2 = 0; idj2 &lt; Dijunction1.at(idj1).size(); idj2++){</div>
<div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;      <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> endpoint = Dijunction1.at(idj1).at(idj2).back();</div>
<div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;</div>
<div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;      <span class="keywordflow">if</span>(DijunctionInfo1.at(idj1).at(idj2) == -1 &amp;&amp; endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>() != 0 &amp;&amp; endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>() != 0){</div>
<div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = 0;</div>
<div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> tempparton1 = endpoint;</div>
<div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;        <span class="keywordflow">if</span>(tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() == 21) {</div>
<div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;          tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(1);</div>
<div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;          loc = findcloserepl(tempparton1,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);</div>
<div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;          tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;        }<span class="keywordflow">else</span>{loc = findcloserepl(tempparton1,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);}</div>
<div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;        <span class="keywordflow">if</span>(loc == 999999999 || loc &gt; 0) {</div>
<div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;              <span class="keywordtype">int</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.33333333) ? ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? -1 : -2) : -3);</div>
<div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;          <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton1; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid); fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(0);</div>
<div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>());</div>
<div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;          <span class="keywordflow">if</span>(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 3) {</div>
<div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);</div>
<div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;          } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xms);}</div>
<div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;          <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;          <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;          } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;          number_p_fake++;</div>
<div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;          SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;          Dijunction1.at(idj1).at(idj2).push_back(fakep);</div>
<div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0) {</div>
<div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;          HH_thermal[-loc-1].acol(endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>());</div>
<div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;          HH_thermal[-loc-1].col(0);</div>
<div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;          HH_thermal[-loc-1].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;          HH_thermal[-loc-1].is_remnant(<span class="keyword">true</span>); SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;          SP_remnants[SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].par(-loc-1);</div>
<div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;          Dijunction1.at(idj1).at(idj2).push_back(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;        }</div>
<div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;      }</div>
<div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;    }</div>
<div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;</div>
<div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idj3 = 0; idj3 &lt; Dijunction1.at(idj1).size(); idj3++){</div>
<div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;      <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> endpoint = Dijunction1.at(idj1).at(idj3).back();</div>
<div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;</div>
<div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;      <span class="keywordflow">if</span>(DijunctionInfo1.at(idj1).at(idj3) == 1 &amp;&amp; endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>() != 0 &amp;&amp; endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>() != 0){</div>
<div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="../../d2/d51/usm_8C.html#aef1c56d2c342eb820980b683b8c35965">loc</a> = 0;</div>
<div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> tempparton1 = endpoint;</div>
<div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;        <span class="keywordflow">if</span>(tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() == 21) {</div>
<div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;          tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-1);</div>
<div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;          loc = findcloserepl(tempparton1,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);</div>
<div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;          tempparton1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(21);</div>
<div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;        }<span class="keywordflow">else</span>{loc = findcloserepl(tempparton1,1, <span class="keyword">false</span>, <span class="keyword">true</span>, HH_showerptns, HH_thermal);}</div>
<div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;        <span class="keywordflow">if</span>(loc == 999999999 || loc &gt; 0) {</div>
<div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;              <span class="keywordtype">int</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#ae9011d40c6f13e68e6f07156e0da7c5d">fid</a> = ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.33333333) ? ((<a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>() &gt; 0.5) ? 1 : 2) : 3);</div>
<div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;          <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakep = tempparton1; fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(fid); fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>());</div>
<div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;          fakep.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(0);</div>
<div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;          <span class="keywordflow">if</span>(std::abs(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 3) {</div>
<div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq);</div>
<div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;          } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xms);}</div>
<div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;          <span class="keywordtype">double</span> fake_pT = (p_fake &gt;= 1.) ? 0.282842712474619 : 0.; <span class="keywordtype">double</span> fake_phi = 2. * 3.14159265358979 * <a class="code" href="../../da/d19/example__1_8f.html#af1c2729d53ff48a074c57e20c2d85980">ran</a>();</div>
<div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(fake_pT * cos(fake_phi)); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(fake_pT * sin(fake_phi));</div>
<div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;          <span class="keywordflow">if</span> (number_p_fake == 0 || number_p_fake == 2){</div>
<div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(-p_fake);</div>
<div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (number_p_fake == 1 || number_p_fake == 3) {</div>
<div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;            fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(p_fake);</div>
<div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;          } <span class="keywordflow">else</span> {fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);}</div>
<div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;          number_p_fake++;</div>
<div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1); fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6f67e402b5c525d4bf21263c7a4b8521">is_remnant</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;          fakep.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a94f51fb887c913bf2021e1701f7cf9cd">is_fakeparton</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;          SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(fakep);</div>
<div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;          Dijunction1.at(idj1).at(idj3).push_back(fakep);</div>
<div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(loc &lt; 0) {</div>
<div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;          HH_thermal[-loc-1].col(endpoint.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>());</div>
<div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;          HH_thermal[-loc-1].acol(0);</div>
<div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;          HH_thermal[-loc-1].is_used(<span class="keyword">true</span>);</div>
<div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;          HH_thermal[-loc-1].is_remnant(<span class="keyword">true</span>); SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;          SP_remnants[SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()-1].par(-loc-1);</div>
<div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;          Dijunction1.at(idj1).at(idj3).push_back(HH_thermal[-loc-1]);</div>
<div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;        }</div>
<div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;      }</div>
<div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160;    }</div>
<div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;  }</div>
<div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;</div>
<div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;  <span class="comment">//since the repeating is needed for completing the junction structure, It is inevitable that there are repeated particle in Recombeary1, It&#39;s complicated to explain, and useless to focus on.</span></div>
<div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;  <span class="comment">// so that just delete repeated particles by check color Tags</span></div>
<div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irb1 = 0; irb1 &lt; Recombearly1.size(); irb1++){ <span class="comment">// pick one baryon</span></div>
<div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irb2 = 0; irb2 &lt; Recombearly1.at(irb1).size(); irb2++){ <span class="comment">// pick one particle in baryon</span></div>
<div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irb3 = irb2+1; irb3 &lt; Recombearly1.at(irb1).size(); irb3++){ <span class="comment">// checking through all particles in baryon</span></div>
<div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;        <span class="keywordflow">if</span>( (Recombearly1.at(irb1).at(irb2).col() == Recombearly1.at(irb1).at(irb3).col()) &amp;&amp;</div>
<div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160;          Recombearly1.at(irb1).at(irb2).acol() == Recombearly1.at(irb1).at(irb3).acol()){</div>
<div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;          Recombearly1.at(irb1).erase(Recombearly1.at(irb1).begin()+irb3);</div>
<div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;          irb3--;</div>
<div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;        }</div>
<div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;      }</div>
<div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;    }</div>
<div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160;  }</div>
<div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;</div>
<div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;  <span class="comment">//dignositic measure{early recombined baryon}</span></div>
<div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;  <span class="comment">/*std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;<span class="comment">  std::cout &lt;&lt;&quot; number of early recombined baryons : &quot;&lt;&lt;Recombearly1.size()&lt;&lt;endl;</span></div>
<div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;<span class="comment">  for(int ibary1 = 0; ibary1 &lt; Recombearly1.size(); ibary1++){</span></div>
<div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot;the &quot;&lt;&lt; ibary1 &lt;&lt;&quot; st baryon is made of &quot;;</span></div>
<div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;<span class="comment">    for(int ibary2 = 0; ibary2 &lt; Recombearly1.at(ibary1).size(); ibary2++){</span></div>
<div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; { &quot;&lt;&lt;Recombearly1.at(ibary1).at(ibary2).col()&lt;&lt;&quot; , &quot;&lt;&lt; Recombearly1.at(ibary1).at(ibary2).acol()&lt;&lt;&quot; , &quot;&lt;&lt; Recombearly1.at(ibary1).at(ibary2).id()&lt;&lt;&quot; , &quot;&lt;&lt; Recombearly1.at(ibary1).at(ibary2).e()  &lt;&lt;&quot; } , &quot;;</span></div>
<div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;<span class="comment">    std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;</div>
<div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;  <span class="comment">// force recombine baryons in Recombearly1</span></div>
<div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irb = 0; irb &lt; Recombearly1.size(); irb++){</div>
<div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;    <span class="keywordtype">double</span> hbac2 = <a class="code" href="../../d8/da2/GubserHydro_8cc.html#a4d3af1654c1aa1f521233a74975bb76f">hbarc</a>*<a class="code" href="../../d8/da2/GubserHydro_8cc.html#a4d3af1654c1aa1f521233a74975bb76f">hbarc</a>;</div>
<div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;</div>
<div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;    <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> Pbaryon;</div>
<div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;    Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;      Recombearly1.at(irb)[0].px()+Recombearly1.at(irb)[1].px()+Recombearly1.at(irb)[2].px(),</div>
<div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;      Recombearly1.at(irb)[0].py()+Recombearly1.at(irb)[1].py()+Recombearly1.at(irb)[2].py(),</div>
<div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;      Recombearly1.at(irb)[0].pz()+Recombearly1.at(irb)[1].pz()+Recombearly1.at(irb)[2].pz(),</div>
<div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;      0.);</div>
<div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;</div>
<div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;    <span class="comment">//baryon(CM) velocity</span></div>
<div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;    <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> betaB; <span class="comment">//really p[i]/e below</span></div>
<div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;    betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;      Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()/(Recombearly1.at(irb)[0].e()+Recombearly1.at(irb)[1].e()+Recombearly1.at(irb)[2].e()),</div>
<div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;      Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()/(Recombearly1.at(irb)[0].e()+Recombearly1.at(irb)[1].e()+Recombearly1.at(irb)[2].e()),</div>
<div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;      Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()/(Recombearly1.at(irb)[0].e()+Recombearly1.at(irb)[1].e()+Recombearly1.at(irb)[2].e()),</div>
<div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;      0.);</div>
<div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;    betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;      betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),</div>
<div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;      betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),</div>
<div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;      betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),</div>
<div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;      1./(sqrt(1. - (betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>() + betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>() + betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()))));</div>
<div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;</div>
<div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;    <span class="comment">//boosting into CM frame</span></div>
<div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;    <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_BCM[3], p_BCM[3];</div>
<div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;    pos_BCM[0] = Recombearly1.at(irb)[0].boost_pos(betaB);</div>
<div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;    pos_BCM[1] = Recombearly1.at(irb)[1].boost_pos(betaB);</div>
<div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;    pos_BCM[2] = Recombearly1.at(irb)[2].boost_pos(betaB);</div>
<div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;    p_BCM[0] = Recombearly1.at(irb)[0].boost_P(betaB);</div>
<div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;    p_BCM[1] = Recombearly1.at(irb)[1].boost_P(betaB);</div>
<div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;    p_BCM[2] = Recombearly1.at(irb)[2].boost_P(betaB);</div>
<div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;</div>
<div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;    <span class="comment">//velocities in CM frame</span></div>
<div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;    <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> v_BCM[3];</div>
<div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;    v_BCM[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(p_BCM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()/p_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_BCM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()/p_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_BCM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()/p_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),0.); <span class="comment">//these are really p[i]/e</span></div>
<div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;    v_BCM[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(p_BCM[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()/p_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_BCM[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()/p_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_BCM[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()/p_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),0.);</div>
<div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;    v_BCM[2].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(p_BCM[2].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()/p_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_BCM[2].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()/p_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),p_BCM[2].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()/p_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(),0.);</div>
<div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;</div>
<div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;    <span class="comment">//propagating quarks until time of youngest quark</span></div>
<div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;    <span class="keywordtype">double</span> curtime = std::max(std::max(pos_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>(), pos_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()), pos_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>());</div>
<div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;    <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> cur_pos[3];</div>
<div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;    cur_pos[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;      pos_BCM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()+v_BCM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*(curtime-pos_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),</div>
<div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;      pos_BCM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()+v_BCM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*(curtime-pos_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),</div>
<div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;      pos_BCM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()+v_BCM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*(curtime-pos_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),</div>
<div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;      curtime);</div>
<div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;    cur_pos[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;      pos_BCM[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()+v_BCM[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*(curtime-pos_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),</div>
<div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;      pos_BCM[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()+v_BCM[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*(curtime-pos_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),</div>
<div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;      pos_BCM[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()+v_BCM[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*(curtime-pos_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),</div>
<div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;      curtime);</div>
<div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;    cur_pos[2].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;      pos_BCM[2].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()+v_BCM[2].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*(curtime-pos_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),</div>
<div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;      pos_BCM[2].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()+v_BCM[2].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*(curtime-pos_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),</div>
<div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;      pos_BCM[2].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()+v_BCM[2].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*(curtime-pos_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>()),</div>
<div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;      curtime);</div>
<div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;</div>
<div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;    <span class="comment">//finding position of CM at curtime</span></div>
<div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;    <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_CM;</div>
<div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;    pos_CM.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;      (cur_pos[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*Recombearly1.at(irb)[0].mass()+cur_pos[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*Recombearly1.at(irb)[1].mass()+cur_pos[2].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*Recombearly1.at(irb)[2].mass())/(Recombearly1.at(irb)[0].mass()+Recombearly1.at(irb)[1].mass()+Recombearly1.at(irb)[2].mass()),</div>
<div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;      (cur_pos[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*Recombearly1.at(irb)[0].mass()+cur_pos[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*Recombearly1.at(irb)[1].mass()+cur_pos[2].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*Recombearly1.at(irb)[2].mass())/(Recombearly1.at(irb)[0].mass()+Recombearly1.at(irb)[1].mass()+Recombearly1.at(irb)[2].mass()),</div>
<div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;      (cur_pos[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*Recombearly1.at(irb)[0].mass()+cur_pos[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*Recombearly1.at(irb)[1].mass()+cur_pos[2].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*Recombearly1.at(irb)[2].mass())/(Recombearly1.at(irb)[0].mass()+Recombearly1.at(irb)[1].mass()+Recombearly1.at(irb)[2].mass()),</div>
<div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;      curtime);</div>
<div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;</div>
<div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;    <span class="comment">//finding position of baryon in lab frame</span></div>
<div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;    betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(-betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),-betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),-betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),betaB.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>());</div>
<div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;    <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_lab = HHboost(betaB, pos_CM);</div>
<div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;</div>
<div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;    <span class="comment">//finding relative positions of partons in CM frame</span></div>
<div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;    <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_rel_square[2];</div>
<div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;    pos_rel_square[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;      (cur_pos[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()-cur_pos[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>())/sqrt(2.),</div>
<div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;      (cur_pos[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()-cur_pos[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>())/sqrt(2.),</div>
<div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;      (cur_pos[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()-cur_pos[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>())/sqrt(2.),</div>
<div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;      0.);</div>
<div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;    pos_rel_square[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;      ((cur_pos[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*Recombearly1.at(irb)[0].mass()+cur_pos[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*Recombearly1.at(irb)[1].mass())/(Recombearly1.at(irb)[0].mass()+Recombearly1.at(irb)[1].mass())-cur_pos[2].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>())*sqrt(2./3.),</div>
<div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;      ((cur_pos[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*Recombearly1.at(irb)[0].mass()+cur_pos[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*Recombearly1.at(irb)[1].mass())/(Recombearly1.at(irb)[0].mass()+Recombearly1.at(irb)[1].mass())-cur_pos[2].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>())*sqrt(2./3.),</div>
<div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;      ((cur_pos[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*Recombearly1.at(irb)[0].mass()+cur_pos[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*Recombearly1.at(irb)[1].mass())/(Recombearly1.at(irb)[0].mass()+Recombearly1.at(irb)[1].mass())-cur_pos[2].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>())*sqrt(2./3.),</div>
<div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;      0.);</div>
<div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;</div>
<div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;    <span class="comment">//so far, values to form a baryon are set, now make hadron objects based on this information</span></div>
<div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;    <span class="comment">//now we&#39;re forming the hadron</span></div>
<div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160;    <a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html">HHhadron</a> formedhadron;</div>
<div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;    <span class="comment">//setting the hadron values: is a recombined hadron, mass, and parents</span></div>
<div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160;    formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a27dd6d3a82b77f211b08aef3f4641664">is_recohad</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;    formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a048b35ba82d82b0c177b0968485bab3d">mass</a>( p_BCM[0].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>() + p_BCM[1].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>() + p_BCM[2].<a class="code" href="../../dc/d42/TrackContainerComplianceTests_8cpp.html#a8a7cbf6a93d9b19a5c0bf724a90abbe4">t</a>() );</div>
<div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;</div>
<div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160;    <span class="comment">//setting hadron position and momentum vectors</span></div>
<div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;    Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;      Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),</div>
<div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;      Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),</div>
<div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;      Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),</div>
<div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160;      sqrt(Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>() + Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>() + Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*Pbaryon.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>() + formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a048b35ba82d82b0c177b0968485bab3d">mass</a>()*formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a048b35ba82d82b0c177b0968485bab3d">mass</a>()));</div>
<div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160;    formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a7ce336bb518c8fe59fe9bc044d9f0ca6">pos</a>(pos_lab);</div>
<div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160;    formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a14ac05d5f4db7a690b834078050e695f">P</a>(Pbaryon);</div>
<div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;</div>
<div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160;    <span class="comment">//need to choose *what* hadron we&#39;ve formed... base this on the parton id&#39;s, mass, &amp; if excited</span></div>
<div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;    <span class="comment">//might want to do this differently? void f&#39;n(partoncollection, formedhadron)?</span></div>
<div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;    <span class="comment">//since set_baryon_id function works with object of parton_colection class, make temporary parton_collection</span></div>
<div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;    <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a> tempobject; <span class="comment">//since the generator resets all components, don&#39;t need to reset the vactors in it</span></div>
<div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160;    tempobject.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(Recombearly1.at(irb)[0]);</div>
<div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160;    tempobject.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(Recombearly1.at(irb)[1]);</div>
<div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;    tempobject.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(Recombearly1.at(irb)[2]);</div>
<div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;</div>
<div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;    set_baryon_id(tempobject, formedhadron);</div>
<div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160;</div>
<div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;    formedhadron.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a6c7732b018f159825e653edad26d8774">is_shth</a>(thermal_parton_junction[irb]);</div>
<div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160;</div>
<div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;    <span class="comment">//need to add the hadron to the collection</span></div>
<div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;    HH_hadrons.add(formedhadron);</div>
<div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;  }</div>
<div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;</div>
<div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;  <span class="comment">//from now we need re indexing a of the particles in SP_remnants by comparing color tag in Juncstructure component.</span></div>
<div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;  <span class="comment">//Maybe there would not be a problem in the used_junction value, but take most defensive measure for the possible error.</span></div>
<div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;  std::vector&lt;int&gt; checking;</div>
<div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;  <span class="keywordtype">bool</span> indicecheck = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> irem = 0; irem &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); irem++){</div>
<div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ijs1 = 0; ijs1 &lt; JuncStructure.size(); ijs1++){</div>
<div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ijs2 = 0; ijs2 &lt; JuncStructure.at(ijs1).size(); ijs2++){</div>
<div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ijs3 = 0; ijs3 &lt; JuncStructure.at(ijs1).at(ijs2).size(); ijs3++){</div>
<div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;          <span class="keywordflow">if</span>( (SP_remnants[irem].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == JuncStructure.at(ijs1).at(ijs2).at(ijs3).col()) &amp;&amp;</div>
<div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;            (SP_remnants[irem].acol() == JuncStructure.at(ijs1).at(ijs2).at(ijs3).acol()) ){</div>
<div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;            SP_remnants[irem].used_junction(<span class="keyword">true</span>);</div>
<div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;            checking.push_back(irem);</div>
<div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;          }</div>
<div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;        }</div>
<div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;      }</div>
<div class="line"><a name="l05659"></a><span class="lineno"> 5659</span>&#160;    }</div>
<div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160;  }</div>
<div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> irem = 0; irem &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); irem++){</div>
<div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icheck = 0; icheck &lt; checking.size(); icheck++){</div>
<div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;      <span class="keywordflow">if</span>(irem == checking.at(icheck)){ indicecheck = <span class="keyword">true</span>; }</div>
<div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;    }</div>
<div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;    <span class="keywordflow">if</span>(indicecheck = <span class="keyword">false</span>){</div>
<div class="line"><a name="l05666"></a><span class="lineno"> 5666</span>&#160;      SP_remnants[irem].used_junction(<span class="keyword">false</span>);</div>
<div class="line"><a name="l05667"></a><span class="lineno"> 5667</span>&#160;    }</div>
<div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160;  }</div>
<div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;  <span class="comment">// Now set up for junction is done, let&#39;s check the left partons to establish string structure</span></div>
<div class="line"><a name="l05670"></a><span class="lineno"> 5670</span>&#160;</div>
<div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;</div>
<div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;let&#39;s check left particles!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160;  <span class="comment">/*for(int irp = 0 ; irp &lt; SP_remnants.num(); irp++) {</span></div>
<div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;<span class="comment">    if(SP_remnants[irp].used_junction() == false){</span></div>
<div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160;<span class="comment">      std::cout &lt;&lt; &quot;( &quot;&lt;&lt;SP_remnants[irp].id()&lt;&lt;&quot; , &quot;&lt;&lt;SP_remnants[irp].col()&lt;&lt;&quot; , &quot;&lt;&lt;SP_remnants[irp].acol()&lt;&lt;&quot; ) &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l05677"></a><span class="lineno"> 5677</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;</div>
<div class="line"><a name="l05679"></a><span class="lineno"> 5679</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ileft = 0; ileft &lt; SP_remnants.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ileft++){</div>
<div class="line"><a name="l05680"></a><span class="lineno"> 5680</span>&#160;    <span class="keywordflow">if</span>(SP_remnants[ileft].used_junction() == <span class="keyword">false</span>){</div>
<div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;      finalstring.push_back(SP_remnants[ileft]);</div>
<div class="line"><a name="l05682"></a><span class="lineno"> 5682</span>&#160;    }</div>
<div class="line"><a name="l05683"></a><span class="lineno"> 5683</span>&#160;  }</div>
<div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;</div>
<div class="line"><a name="l05685"></a><span class="lineno"> 5685</span>&#160;  <span class="comment">// contains the chopped off legs of junctions</span></div>
<div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itail1 = 0; itail1 &lt; Tailoredstring1.size(); itail1++ ){</div>
<div class="line"><a name="l05687"></a><span class="lineno"> 5687</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itail2 = 0; itail2 &lt; Tailoredstring1.at(itail1).size(); itail2++){</div>
<div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;      finalstring.push_back(Tailoredstring1.at(itail1).at(itail2));</div>
<div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160;    }</div>
<div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160;  }</div>
<div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;</div>
<div class="line"><a name="l05692"></a><span class="lineno"> 5692</span>&#160;  <span class="comment">//std::cout &lt;&lt;endl&lt;&lt;&quot;check final particles!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;  <span class="comment">/*for(int ifin = 0; ifin &lt; finalstring.size(); ifin++){</span></div>
<div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;<span class="comment">    std::cout &lt;&lt; finalstring.at(ifin).id() &lt;&lt; &quot;,&quot; &lt;&lt; finalstring.at(ifin).col() &lt;&lt; &quot;,&quot; &lt;&lt; finalstring.at(ifin).acol() &lt;&lt;endl;</span></div>
<div class="line"><a name="l05695"></a><span class="lineno"> 5695</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;</div>
<div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160;  <span class="comment">/*std::cout &lt;&lt;endl&lt;&lt;&quot;check final particles!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;<span class="comment">  for(int ifin = 0; ifin &lt; finalstring.size(); ifin++){</span></div>
<div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot; { &quot;&lt;&lt; finalstring.at(ifin).col() &lt;&lt; &quot; , &quot; &lt;&lt; finalstring.at(ifin).acol() &lt;&lt; &quot; } &quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05701"></a><span class="lineno"> 5701</span>&#160;</div>
<div class="line"><a name="l05702"></a><span class="lineno"> 5702</span>&#160;  <span class="comment">//so far, particles in finalstring are ready for being transfered into PYTHIA, since we don&#39;t need to set mother, daughter tag.</span></div>
<div class="line"><a name="l05703"></a><span class="lineno"> 5703</span>&#160;  <span class="comment">//but, still need to care about single junction and dijunction system, especially for the mother daughter tag!</span></div>
<div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;  <span class="comment">// mother, daughter tags are working with the execution order{= order of being declared in pythia} so before tossing the datum to PYTHIA, rearrange order in the vector</span></div>
<div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;  <span class="comment">// declare the transit space for these particles, while moving onto vector to vector, partons are assigned mother, daughter tag tor PYTHIA running{definition of that tags are given well in main21.cc file in   /installed pythia folder/bin/example/ }</span></div>
<div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;  vector&lt;vector&lt;HHparton&gt;&gt; Transitdijunction1;</div>
<div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160;  vector&lt;HHparton&gt; Transitdijunction2; <span class="comment">// two fake mother B, B-bar and fake q,qbar added and give mother daughter tags!</span></div>
<div class="line"><a name="l05708"></a><span class="lineno"> 5708</span>&#160;  vector&lt;vector&lt;vector&lt;HHparton&gt;&gt;&gt; Tempsorting1; <span class="comment">// vectors for rearranging legs in dijunction{Desired arrangement : identity 1, 1, 0 , -1, -1}</span></div>
<div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;  vector&lt;vector&lt;HHparton&gt;&gt; Tempsorting2;</div>
<div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;  vector&lt;vector&lt;HHparton&gt;&gt; Transitsinglejunction1;</div>
<div class="line"><a name="l05711"></a><span class="lineno"> 5711</span>&#160;  vector&lt;HHparton&gt; Transitsinglejunction2;</div>
<div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;  vector&lt;HHparton&gt; WaitingLineforPY; <span class="comment">// final list of partons with complete M,D tag and col tags</span></div>
<div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160;</div>
<div class="line"><a name="l05714"></a><span class="lineno"> 5714</span>&#160;  <span class="comment">//set the value for incrementation in mother daughter tag.</span></div>
<div class="line"><a name="l05715"></a><span class="lineno"> 5715</span>&#160;  <span class="comment">//and start from dijunction, first, check the identity{1: junction leg, -1: anti_junction leg, 0:shared leg}, since we&#39;ll read col tag first, consider identity=1 leg first and then 0, -1</span></div>
<div class="line"><a name="l05716"></a><span class="lineno"> 5716</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> dijuncfin1 = 0; dijuncfin1 &lt; Dijunction1.size(); dijuncfin1++){ <span class="comment">// Going to find shared leg and attach fake partons to the begin and the end of the leg</span></div>
<div class="line"><a name="l05717"></a><span class="lineno"> 5717</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> dijuncfin2= 0; dijuncfin2 &lt; 5; dijuncfin2++){ <span class="comment">//inspect through five legs</span></div>
<div class="line"><a name="l05718"></a><span class="lineno"> 5718</span>&#160;      <span class="keywordflow">if</span>(DijunctionInfo1.at(dijuncfin1).at(dijuncfin2) == 0){ <span class="comment">//check whether it&#39;s shared leg{identity =0} and add fakepartons to the first and second posittion in the vector</span></div>
<div class="line"><a name="l05719"></a><span class="lineno"> 5719</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakeq;</div>
<div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakeqbar;</div>
<div class="line"><a name="l05721"></a><span class="lineno"> 5721</span>&#160;        fakeq.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(1); fakeq.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a3d00a4935a40a5484fba671c5556b597" title="sets the color of the parton">set_color</a>(Dijunction1.at(dijuncfin1).at(dijuncfin2).at(0).col());</div>
<div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;        fakeq.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ace16a654254150de3f645310cbb27755">PY_stat</a>(-21); fakeq.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq); fakeq.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(xmq); fakeq.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1);</div>
<div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160;        fakeq.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakeq.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakeq.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;        <span class="keywordtype">int</span> endpoint = Dijunction1.at(dijuncfin1).at(dijuncfin2).size() - 1;</div>
<div class="line"><a name="l05725"></a><span class="lineno"> 5725</span>&#160;        fakeqbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(-1); fakeqbar.<a class="code" href="../../da/df6/classJetscape_1_1Parton.html#a5aa4d591cfb1f4438cd40ec62acd60f7" title="sets anti-color of the parton">set_anti_color</a>(Dijunction1.at(dijuncfin1).at(dijuncfin2).at(endpoint).acol());</div>
<div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160;        fakeqbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ace16a654254150de3f645310cbb27755">PY_stat</a>(-21); fakeqbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(xmq); fakeqbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(xmq); fakeqbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ab6539a8639d0676f5100303f4d019e41">orig</a>(-1);</div>
<div class="line"><a name="l05727"></a><span class="lineno"> 5727</span>&#160;        fakeqbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakeqbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakeqbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l05728"></a><span class="lineno"> 5728</span>&#160;        std::vector&lt;HHparton&gt;::iterator it2 = Dijunction1.at(dijuncfin1).at(dijuncfin2).begin();</div>
<div class="line"><a name="l05729"></a><span class="lineno"> 5729</span>&#160;        Dijunction1.at(dijuncfin1).at(dijuncfin2).insert(it2, fakeqbar);</div>
<div class="line"><a name="l05730"></a><span class="lineno"> 5730</span>&#160;        std::vector&lt;HHparton&gt;::iterator it1 = Dijunction1.at(dijuncfin1).at(dijuncfin2).begin();</div>
<div class="line"><a name="l05731"></a><span class="lineno"> 5731</span>&#160;        Dijunction1.at(dijuncfin1).at(dijuncfin2).insert(it1, fakeq);</div>
<div class="line"><a name="l05732"></a><span class="lineno"> 5732</span>&#160;      }</div>
<div class="line"><a name="l05733"></a><span class="lineno"> 5733</span>&#160;    }</div>
<div class="line"><a name="l05734"></a><span class="lineno"> 5734</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> isort1 = 0; isort1 &lt; 5; isort1++){</div>
<div class="line"><a name="l05735"></a><span class="lineno"> 5735</span>&#160;      <span class="keywordflow">if</span>(DijunctionInfo1.at(dijuncfin1).at(isort1) == 1){</div>
<div class="line"><a name="l05736"></a><span class="lineno"> 5736</span>&#160;        Tempsorting2.push_back(Dijunction1.at(dijuncfin1).at(isort1));</div>
<div class="line"><a name="l05737"></a><span class="lineno"> 5737</span>&#160;      }</div>
<div class="line"><a name="l05738"></a><span class="lineno"> 5738</span>&#160;    }</div>
<div class="line"><a name="l05739"></a><span class="lineno"> 5739</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> isort1 = 0; isort1 &lt; 5; isort1++){</div>
<div class="line"><a name="l05740"></a><span class="lineno"> 5740</span>&#160;      <span class="keywordflow">if</span>(DijunctionInfo1.at(dijuncfin1).at(isort1) == 0){</div>
<div class="line"><a name="l05741"></a><span class="lineno"> 5741</span>&#160;        Tempsorting2.push_back(Dijunction1.at(dijuncfin1).at(isort1));</div>
<div class="line"><a name="l05742"></a><span class="lineno"> 5742</span>&#160;      }</div>
<div class="line"><a name="l05743"></a><span class="lineno"> 5743</span>&#160;    }</div>
<div class="line"><a name="l05744"></a><span class="lineno"> 5744</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> isort1 = 0; isort1 &lt; 5; isort1++){</div>
<div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;      <span class="keywordflow">if</span>(DijunctionInfo1.at(dijuncfin1).at(isort1) == -1){</div>
<div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160;        Tempsorting2.push_back(Dijunction1.at(dijuncfin1).at(isort1));</div>
<div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;      }</div>
<div class="line"><a name="l05748"></a><span class="lineno"> 5748</span>&#160;    }</div>
<div class="line"><a name="l05749"></a><span class="lineno"> 5749</span>&#160;    Tempsorting1.push_back(Tempsorting2);</div>
<div class="line"><a name="l05750"></a><span class="lineno"> 5750</span>&#160;    Tempsorting2.clear();</div>
<div class="line"><a name="l05751"></a><span class="lineno"> 5751</span>&#160;  } <span class="comment">//first looping to add fake partons is Finished, now sort the order of the legs to be identity 1,1,0,-1,-1</span></div>
<div class="line"><a name="l05752"></a><span class="lineno"> 5752</span>&#160;</div>
<div class="line"><a name="l05753"></a><span class="lineno"> 5753</span>&#160;  <span class="comment">//dignostic measure{Dijunction1}</span></div>
<div class="line"><a name="l05754"></a><span class="lineno"> 5754</span>&#160;  <span class="comment">/*std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05755"></a><span class="lineno"> 5755</span>&#160;<span class="comment">  std::cout &lt;&lt;&quot; List of Dijunction Structure&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05756"></a><span class="lineno"> 5756</span>&#160;<span class="comment">  for(int icheck1 = 0; icheck1 &lt; Dijunction1.size(); icheck1++){</span></div>
<div class="line"><a name="l05757"></a><span class="lineno"> 5757</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot; Dijunction : &quot;&lt;&lt;icheck1&lt;&lt;endl;</span></div>
<div class="line"><a name="l05758"></a><span class="lineno"> 5758</span>&#160;<span class="comment">    for(int icheck2 = 0 ; icheck2 &lt; Dijunction1.at(icheck1).size(); icheck2++){</span></div>
<div class="line"><a name="l05759"></a><span class="lineno"> 5759</span>&#160;<span class="comment">      std::cout &lt;&lt;&quot; Leg &quot;&lt;&lt;icheck2&lt;&lt;&quot; : &quot;&lt;&lt;&quot;{ identity : &quot;&lt;&lt; DijunctionInfo1.at(icheck1).at(icheck2)&lt;&lt;&quot; }  &quot;;</span></div>
<div class="line"><a name="l05760"></a><span class="lineno"> 5760</span>&#160;<span class="comment">      for(int icheck3 = 0; icheck3 &lt; Dijunction1.at(icheck1).at(icheck2).size(); icheck3++){</span></div>
<div class="line"><a name="l05761"></a><span class="lineno"> 5761</span>&#160;<span class="comment">        std::cout &lt;&lt;&quot; ( &quot;&lt;&lt;Dijunction1.at(icheck1).at(icheck2).at(icheck3).col()&lt;&lt;&quot; , &quot;&lt;&lt;Dijunction1.at(icheck1).at(icheck2).at(icheck3).acol()&lt;&lt; &quot; )  &quot;;</span></div>
<div class="line"><a name="l05762"></a><span class="lineno"> 5762</span>&#160;<span class="comment">      }</span></div>
<div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;<span class="comment">      std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;</div>
<div class="line"><a name="l05767"></a><span class="lineno"> 5767</span>&#160;  <span class="comment">//dignostic measure{Tempsorting}</span></div>
<div class="line"><a name="l05768"></a><span class="lineno"> 5768</span>&#160;  <span class="comment">/*std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05769"></a><span class="lineno"> 5769</span>&#160;<span class="comment">  std::cout &lt;&lt;&quot; List of Dijunction Structure&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05770"></a><span class="lineno"> 5770</span>&#160;<span class="comment">  for(int icheck1 = 0; icheck1 &lt; Tempsorting1.size(); icheck1++){</span></div>
<div class="line"><a name="l05771"></a><span class="lineno"> 5771</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot; Tempsorted Dijunction1 : &quot;&lt;&lt;icheck1&lt;&lt;endl;</span></div>
<div class="line"><a name="l05772"></a><span class="lineno"> 5772</span>&#160;<span class="comment">    for(int icheck2 = 0 ; icheck2 &lt; Tempsorting1.at(icheck1).size(); icheck2++){</span></div>
<div class="line"><a name="l05773"></a><span class="lineno"> 5773</span>&#160;<span class="comment">      for(int icheck3 = 0; icheck3 &lt; Tempsorting1.at(icheck1).at(icheck2).size(); icheck3++){</span></div>
<div class="line"><a name="l05774"></a><span class="lineno"> 5774</span>&#160;<span class="comment">        std::cout &lt;&lt;&quot; ( &quot;&lt;&lt;Tempsorting1.at(icheck1).at(icheck2).at(icheck3).col()&lt;&lt;&quot; , &quot;&lt;&lt;Tempsorting1.at(icheck1).at(icheck2).at(icheck3).acol()&lt;&lt; &quot; )  &quot;&lt;&lt;&quot; , &quot;&lt;&lt;Tempsorting1.at(icheck1).at(icheck2).at(icheck3).x_t();</span></div>
<div class="line"><a name="l05775"></a><span class="lineno"> 5775</span>&#160;<span class="comment">      }</span></div>
<div class="line"><a name="l05776"></a><span class="lineno"> 5776</span>&#160;<span class="comment">      std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05777"></a><span class="lineno"> 5777</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l05778"></a><span class="lineno"> 5778</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05779"></a><span class="lineno"> 5779</span>&#160;</div>
<div class="line"><a name="l05780"></a><span class="lineno"> 5780</span>&#160;  <span class="comment">// adding fake partons and sorting them with right order{Junctionleg1,2 shared leg, antijunctionleg1,2} is finished so far, Now form a fake mothers to prepare for PYTHIA</span></div>
<div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itag1 = 0; itag1 &lt; Tempsorting1.size(); itag1++){ </div>
<div class="line"><a name="l05782"></a><span class="lineno"> 5782</span>&#160;    <span class="comment">//First, put fake B,Bbar into 1st and 2nd position of Transitdijunction2</span></div>
<div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160;    <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a> FakeBaryonElements; <span class="comment">// array of quarks in fake B</span></div>
<div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;    <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a> FakeAntibaryonElements; <span class="comment">// array of anti quarks in fake Bbar</span></div>
<div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;</div>
<div class="line"><a name="l05786"></a><span class="lineno"> 5786</span>&#160;    FakeBaryonElements.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(Tempsorting1.at(itag1).at(0).back()); <span class="comment">// quarks to form fake FakeBaryon</span></div>
<div class="line"><a name="l05787"></a><span class="lineno"> 5787</span>&#160;    FakeBaryonElements.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(Tempsorting1.at(itag1).at(1).back());</div>
<div class="line"><a name="l05788"></a><span class="lineno"> 5788</span>&#160;    FakeBaryonElements.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(Tempsorting1.at(itag1).at(2).at(0));</div>
<div class="line"><a name="l05789"></a><span class="lineno"> 5789</span>&#160;    <span class="comment">// for the corrspondence with pdg particle id, sorting the these ids based on absolute value.</span></div>
<div class="line"><a name="l05790"></a><span class="lineno"> 5790</span>&#160;</div>
<div class="line"><a name="l05791"></a><span class="lineno"> 5791</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iswap = 0; iswap &lt; 3; iswap++){</div>
<div class="line"><a name="l05792"></a><span class="lineno"> 5792</span>&#160;      <span class="keywordflow">if</span>(abs(FakeBaryonElements[2].<span class="keywordtype">id</span>()) &gt; abs(FakeBaryonElements[1].<span class="keywordtype">id</span>())){ <a class="code" href="../../d6/db0/fjcore_8hh.html#ac71f249d840a70f8b3aaffb721843eaa">std::swap</a>(FakeBaryonElements[2], FakeBaryonElements[1]) ; }</div>
<div class="line"><a name="l05793"></a><span class="lineno"> 5793</span>&#160;      <span class="keywordflow">if</span>(abs(FakeBaryonElements[1].<span class="keywordtype">id</span>()) &gt; abs(FakeBaryonElements[0].<span class="keywordtype">id</span>())){ <a class="code" href="../../d6/db0/fjcore_8hh.html#ac71f249d840a70f8b3aaffb721843eaa">std::swap</a>(FakeBaryonElements[1], FakeBaryonElements[0]) ; }</div>
<div class="line"><a name="l05794"></a><span class="lineno"> 5794</span>&#160;      <span class="keywordflow">if</span>(abs(FakeBaryonElements[2].<span class="keywordtype">id</span>()) &gt; abs(FakeBaryonElements[0].<span class="keywordtype">id</span>())){ <a class="code" href="../../d6/db0/fjcore_8hh.html#ac71f249d840a70f8b3aaffb721843eaa">std::swap</a>(FakeBaryonElements[2], FakeBaryonElements[0]) ; }</div>
<div class="line"><a name="l05795"></a><span class="lineno"> 5795</span>&#160;    }</div>
<div class="line"><a name="l05796"></a><span class="lineno"> 5796</span>&#160;</div>
<div class="line"><a name="l05797"></a><span class="lineno"> 5797</span>&#160;    FakeAntibaryonElements.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(Tempsorting1.at(itag1).at(2).at(1)); <span class="comment">//anti quarks to form FakeAntiBaryon</span></div>
<div class="line"><a name="l05798"></a><span class="lineno"> 5798</span>&#160;    FakeAntibaryonElements.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(Tempsorting1.at(itag1).at(3).back());</div>
<div class="line"><a name="l05799"></a><span class="lineno"> 5799</span>&#160;    FakeAntibaryonElements.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(Tempsorting1.at(itag1).at(4).back());</div>
<div class="line"><a name="l05800"></a><span class="lineno"> 5800</span>&#160;</div>
<div class="line"><a name="l05801"></a><span class="lineno"> 5801</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iswap = 0; iswap &lt; 3; iswap++){</div>
<div class="line"><a name="l05802"></a><span class="lineno"> 5802</span>&#160;      <span class="keywordflow">if</span>(abs(FakeAntibaryonElements[2].<span class="keywordtype">id</span>()) &gt; abs(FakeAntibaryonElements[1].<span class="keywordtype">id</span>())){ <a class="code" href="../../d6/db0/fjcore_8hh.html#ac71f249d840a70f8b3aaffb721843eaa">std::swap</a>(FakeAntibaryonElements[2], FakeAntibaryonElements[1]) ; }</div>
<div class="line"><a name="l05803"></a><span class="lineno"> 5803</span>&#160;      <span class="keywordflow">if</span>(abs(FakeAntibaryonElements[1].<span class="keywordtype">id</span>()) &gt; abs(FakeAntibaryonElements[0].<span class="keywordtype">id</span>())){ <a class="code" href="../../d6/db0/fjcore_8hh.html#ac71f249d840a70f8b3aaffb721843eaa">std::swap</a>(FakeAntibaryonElements[1], FakeAntibaryonElements[0]) ; }</div>
<div class="line"><a name="l05804"></a><span class="lineno"> 5804</span>&#160;      <span class="keywordflow">if</span>(abs(FakeAntibaryonElements[2].<span class="keywordtype">id</span>()) &gt; abs(FakeAntibaryonElements[0].<span class="keywordtype">id</span>())){ <a class="code" href="../../d6/db0/fjcore_8hh.html#ac71f249d840a70f8b3aaffb721843eaa">std::swap</a>(FakeAntibaryonElements[2], FakeAntibaryonElements[0]) ; }</div>
<div class="line"><a name="l05805"></a><span class="lineno"> 5805</span>&#160;    }</div>
<div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160;</div>
<div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;    <a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html">HHhadron</a> store_id_hadron1;</div>
<div class="line"><a name="l05808"></a><span class="lineno"> 5808</span>&#160;    set_baryon_id(FakeBaryonElements, store_id_hadron1);</div>
<div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160;    <a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html">HHhadron</a> store_id_hadron2;</div>
<div class="line"><a name="l05810"></a><span class="lineno"> 5810</span>&#160;    set_baryon_id(FakeAntibaryonElements, store_id_hadron2);</div>
<div class="line"><a name="l05811"></a><span class="lineno"> 5811</span>&#160;</div>
<div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160;    FakeBaryonElements.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l05813"></a><span class="lineno"> 5813</span>&#160;    FakeAntibaryonElements.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#aa2bacd220dcbca4c4d7258b764b16ce8">clear</a>();</div>
<div class="line"><a name="l05814"></a><span class="lineno"> 5814</span>&#160;</div>
<div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160;    <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakeB;</div>
<div class="line"><a name="l05816"></a><span class="lineno"> 5816</span>&#160;    <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakeBbar;</div>
<div class="line"><a name="l05817"></a><span class="lineno"> 5817</span>&#160;    fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(store_id_hadron1.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a8673e70390fe194d7268ac18fa3373b2">id</a>());</div>
<div class="line"><a name="l05818"></a><span class="lineno"> 5818</span>&#160;    fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ace16a654254150de3f645310cbb27755">PY_stat</a>(-11);</div>
<div class="line"><a name="l05819"></a><span class="lineno"> 5819</span>&#160;    fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(3*xmq);</div>
<div class="line"><a name="l05820"></a><span class="lineno"> 5820</span>&#160;    fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(3*xmq);</div>
<div class="line"><a name="l05821"></a><span class="lineno"> 5821</span>&#160;    fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.);</div>
<div class="line"><a name="l05822"></a><span class="lineno"> 5822</span>&#160;    fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.);</div>
<div class="line"><a name="l05823"></a><span class="lineno"> 5823</span>&#160;    fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l05824"></a><span class="lineno"> 5824</span>&#160;</div>
<div class="line"><a name="l05825"></a><span class="lineno"> 5825</span>&#160;    fakeBbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(store_id_hadron2.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a8673e70390fe194d7268ac18fa3373b2">id</a>());</div>
<div class="line"><a name="l05826"></a><span class="lineno"> 5826</span>&#160;    fakeBbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ace16a654254150de3f645310cbb27755">PY_stat</a>(-11);</div>
<div class="line"><a name="l05827"></a><span class="lineno"> 5827</span>&#160;    fakeBbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(3*xmq);</div>
<div class="line"><a name="l05828"></a><span class="lineno"> 5828</span>&#160;    fakeBbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(3*xmq);</div>
<div class="line"><a name="l05829"></a><span class="lineno"> 5829</span>&#160;    fakeBbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.);</div>
<div class="line"><a name="l05830"></a><span class="lineno"> 5830</span>&#160;    fakeBbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.);</div>
<div class="line"><a name="l05831"></a><span class="lineno"> 5831</span>&#160;    fakeBbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160;</div>
<div class="line"><a name="l05833"></a><span class="lineno"> 5833</span>&#160;    fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#af990fbb3513f7edfa35ce1656cfd12bd">PY_tag1</a>(Tempsorting1.at(itag1).at(0).back().col());</div>
<div class="line"><a name="l05834"></a><span class="lineno"> 5834</span>&#160;          fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a519996bf56a96522350b651d4e3769a7">PY_tag2</a>(Tempsorting1.at(itag1).at(1).back().col());</div>
<div class="line"><a name="l05835"></a><span class="lineno"> 5835</span>&#160;          fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a8612c23c63136e3e941beb24a472728b">PY_tag3</a>(Tempsorting1.at(itag1).at(2).at(0).col());</div>
<div class="line"><a name="l05836"></a><span class="lineno"> 5836</span>&#160;</div>
<div class="line"><a name="l05837"></a><span class="lineno"> 5837</span>&#160;    fakeBbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#af990fbb3513f7edfa35ce1656cfd12bd">PY_tag1</a>(Tempsorting1.at(itag1).at(2).at(1).acol());</div>
<div class="line"><a name="l05838"></a><span class="lineno"> 5838</span>&#160;          fakeBbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a519996bf56a96522350b651d4e3769a7">PY_tag2</a>(Tempsorting1.at(itag1).at(3).back().acol());</div>
<div class="line"><a name="l05839"></a><span class="lineno"> 5839</span>&#160;          fakeBbar.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a8612c23c63136e3e941beb24a472728b">PY_tag3</a>(Tempsorting1.at(itag1).at(4).back().acol());</div>
<div class="line"><a name="l05840"></a><span class="lineno"> 5840</span>&#160;</div>
<div class="line"><a name="l05841"></a><span class="lineno"> 5841</span>&#160;    <span class="comment">//so far, we formed two fake partons, which would be at the center of Junction and Antijunction, Now put them 0th and 1st position of Transirdijunction1 vector</span></div>
<div class="line"><a name="l05842"></a><span class="lineno"> 5842</span>&#160;    Transitdijunction2.push_back(fakeB);</div>
<div class="line"><a name="l05843"></a><span class="lineno"> 5843</span>&#160;    Transitdijunction2.push_back(fakeBbar);</div>
<div class="line"><a name="l05844"></a><span class="lineno"> 5844</span>&#160;    Transitdijunction1.push_back(Transitdijunction2);</div>
<div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;    Transitdijunction2.clear();</div>
<div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160;  }</div>
<div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160;</div>
<div class="line"><a name="l05848"></a><span class="lineno"> 5848</span>&#160;  <span class="comment">//the next step is to set M,D Tags</span></div>
<div class="line"><a name="l05849"></a><span class="lineno"> 5849</span>&#160;  <span class="keywordtype">int</span> Intag = 0; <span class="comment">// tag for internal M,D tagging process</span></div>
<div class="line"><a name="l05850"></a><span class="lineno"> 5850</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iMD1 = 0; iMD1 &lt; Tempsorting1.size(); iMD1++){ <span class="comment">//after working in these Legs, we will return the partons to Transitdijunction1,</span></div>
<div class="line"><a name="l05851"></a><span class="lineno"> 5851</span>&#160;    <span class="comment">// so far, the order in the vectors{Dijunction1, DijunctionInfo1, Tempsorting, Transitdijunction1} are unified, but the difference is the value in each vectors</span></div>
<div class="line"><a name="l05852"></a><span class="lineno"> 5852</span>&#160;    vector&lt;HHparton&gt; Leg1 = Tempsorting1.at(iMD1).at(0); <span class="comment">// for convenience, reassigning legs in sorted dijunction structure.{identity 1,1,0,-1,-1}</span></div>
<div class="line"><a name="l05853"></a><span class="lineno"> 5853</span>&#160;    vector&lt;HHparton&gt; Leg2 = Tempsorting1.at(iMD1).at(1);</div>
<div class="line"><a name="l05854"></a><span class="lineno"> 5854</span>&#160;    vector&lt;HHparton&gt; Leg3 = Tempsorting1.at(iMD1).at(2);</div>
<div class="line"><a name="l05855"></a><span class="lineno"> 5855</span>&#160;    vector&lt;HHparton&gt; Leg4 = Tempsorting1.at(iMD1).at(3);</div>
<div class="line"><a name="l05856"></a><span class="lineno"> 5856</span>&#160;    vector&lt;HHparton&gt; Leg5 = Tempsorting1.at(iMD1).at(4);</div>
<div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160;    <span class="comment">//starting from Leg1{identity1}</span></div>
<div class="line"><a name="l05858"></a><span class="lineno"> 5858</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ileg1 = 0; ileg1 &lt; Leg1.size(); ileg1++){</div>
<div class="line"><a name="l05859"></a><span class="lineno"> 5859</span>&#160;      Leg1.at(ileg1).PY_par1(0);  <span class="comment">// the mother of first leg1, 2 should be first fakebaryon{located 1st in the Transitdijunction2 vector!}</span></div>
<div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160;      Leg1.at(ileg1).PY_par2(0);</div>
<div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160;      Transitdijunction1.at(iMD1).push_back(Leg1.at(ileg1)); <span class="comment">//toss Leg1 to the Transirdijunction1.at{iMD}, which would be the last step before WaitingLineforPY</span></div>
<div class="line"><a name="l05862"></a><span class="lineno"> 5862</span>&#160;    }</div>
<div class="line"><a name="l05863"></a><span class="lineno"> 5863</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ileg2 = 0; ileg2 &lt; Leg2.size(); ileg2++){</div>
<div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;      Leg2.at(ileg2).PY_par1(0); <span class="comment">// the mother of first leg1, 2 should be first fakebaryon{located 1st in the Transitdijunction2 vector!}</span></div>
<div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;      Leg2.at(ileg2).PY_par2(0);</div>
<div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;      Transitdijunction1.at(iMD1).push_back(Leg2.at(ileg2));</div>
<div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160;    }</div>
<div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;    <span class="comment">//for leg3, because of first and end fake particles, it goes differently from other legs</span></div>
<div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160;    Intag = 2 + Leg1.size() + Leg2.size(); <span class="comment">// Previous tag + two fakemothers + Leg1 + Leg2</span></div>
<div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160;    <span class="comment">//First of all, fake parton pairs are located for the convenience of MD tagging</span></div>
<div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;    Leg3.at(0).PY_par1(0);<span class="comment">//daughter of fakeB</span></div>
<div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160;    Leg3.at(0).PY_par2(0);</div>
<div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;    Leg3.at(0).PY_dau1(Intag + Leg4.size() + Leg5.size() + 2); <span class="comment">// daughter tags for gluons between two fake qqbar</span></div>
<div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;    Leg3.at(0).PY_dau2(Intag + Leg4.size() + Leg5.size() + Leg3.size()- 1); <span class="comment">// since</span></div>
<div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160;    Leg3.at(1).PY_par1(1);<span class="comment">//daughter of fakeBbar</span></div>
<div class="line"><a name="l05876"></a><span class="lineno"> 5876</span>&#160;    Leg3.at(1).PY_par2(1);</div>
<div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;    Leg3.at(1).PY_dau1(Intag + Leg4.size() + Leg5.size() + 2);</div>
<div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160;    Leg3.at(1).PY_dau2(Intag + Leg4.size() + Leg5.size() + Leg3.size()- 1);</div>
<div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160;</div>
<div class="line"><a name="l05880"></a><span class="lineno"> 5880</span>&#160;    Transitdijunction1.at(iMD1).push_back(Leg3.at(0));</div>
<div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;    Transitdijunction1.at(iMD1).push_back(Leg3.at(1)); <span class="comment">// push first two fake partons and append remnants at the last, this is for convenience</span></div>
<div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;</div>
<div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160;    Transitdijunction1.at(iMD1).at(0).PY_dau1(2); <span class="comment">// correcting daughter tags of fake B located at 0</span></div>
<div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;    Transitdijunction1.at(iMD1).at(0).PY_dau2(Intag);</div>
<div class="line"><a name="l05885"></a><span class="lineno"> 5885</span>&#160;    Transitdijunction1.at(iMD1).at(1).PY_dau1(Intag + 1); <span class="comment">//setting starting daughter tag of fakeBbar located at 1</span></div>
<div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160;    Transitdijunction1.at(iMD1).at(1).PY_dau2(Intag + 1 + Leg4.size() + Leg5.size() );</div>
<div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;</div>
<div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ileg4 = 0 ; ileg4 &lt; Leg4.size(); ileg4++){</div>
<div class="line"><a name="l05889"></a><span class="lineno"> 5889</span>&#160;      Leg4.at(ileg4).PY_par1(1);</div>
<div class="line"><a name="l05890"></a><span class="lineno"> 5890</span>&#160;      Leg4.at(ileg4).PY_par2(1);</div>
<div class="line"><a name="l05891"></a><span class="lineno"> 5891</span>&#160;      Transitdijunction1.at(iMD1).push_back(Leg4.at(ileg4));</div>
<div class="line"><a name="l05892"></a><span class="lineno"> 5892</span>&#160;    }</div>
<div class="line"><a name="l05893"></a><span class="lineno"> 5893</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ileg5 = 0 ; ileg5 &lt; Leg5.size(); ileg5++){</div>
<div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160;      Leg5.at(ileg5).PY_par1(1);</div>
<div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;      Leg5.at(ileg5).PY_par2(1);</div>
<div class="line"><a name="l05896"></a><span class="lineno"> 5896</span>&#160;      Transitdijunction1.at(iMD1).push_back(Leg5.at(ileg5));</div>
<div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160;    }</div>
<div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ileg3 = 2; ileg3 &lt; Leg3.size(); ileg3++){ <span class="comment">// mother tags for the gluons between two fake qqbar pair</span></div>
<div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;      Leg3.at(ileg3).PY_par1(Intag);</div>
<div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;      Leg3.at(ileg3).PY_par2(Intag + 1);</div>
<div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160;      Transitdijunction1.at(iMD1).push_back(Leg3.at(ileg3));</div>
<div class="line"><a name="l05902"></a><span class="lineno"> 5902</span>&#160;    }</div>
<div class="line"><a name="l05903"></a><span class="lineno"> 5903</span>&#160;  } <span class="comment">// Inner tagging loop is finished for dijunction system,{That is, Information in Tempsorting1 is transfered to Transitdijunction1}</span></div>
<div class="line"><a name="l05904"></a><span class="lineno"> 5904</span>&#160;</div>
<div class="line"><a name="l05905"></a><span class="lineno"> 5905</span>&#160;  <span class="comment">//dignostic measure{Transitdijunction1}</span></div>
<div class="line"><a name="l05906"></a><span class="lineno"> 5906</span>&#160;  <span class="comment">/*std::cout &lt;&lt;endl&lt;&lt; &quot; the order of data is eNum &gt;&gt; id &gt;&gt; stat &gt;&gt; par1 &gt;&gt; par2 &gt;&gt; dau1 &gt;&gt; dau2 &quot;&lt;&lt; endl;</span></div>
<div class="line"><a name="l05907"></a><span class="lineno"> 5907</span>&#160;<span class="comment">  for(int icheck1 = 0; icheck1 &lt;  Transitdijunction1.size(); icheck1++ ){</span></div>
<div class="line"><a name="l05908"></a><span class="lineno"> 5908</span>&#160;<span class="comment">    for(int i = 0; i &lt;  Transitdijunction1.at(icheck1).size(); i++){</span></div>
<div class="line"><a name="l05909"></a><span class="lineno"> 5909</span>&#160;<span class="comment">      vector&lt;HHparton&gt; temp = Transitdijunction1.at(icheck1);</span></div>
<div class="line"><a name="l05910"></a><span class="lineno"> 5910</span>&#160;<span class="comment">      std::cout  &lt;&lt; i &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).id() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_stat() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_par1() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_par2() &lt;&lt;&quot;   &quot;</span></div>
<div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160;<span class="comment">      &lt;&lt; temp.at(i).PY_dau1() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_dau2() &lt;&lt; &quot;  ( &quot;&lt;&lt;  temp.at(i).col()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).acol() &lt;&lt; &quot; ) &quot; &lt;&lt;endl;</span></div>
<div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l05913"></a><span class="lineno"> 5913</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;</div>
<div class="line"><a name="l05915"></a><span class="lineno"> 5915</span>&#160;  <span class="comment">//Now,start working on Single Junction System.</span></div>
<div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iSJ = 0; iSJ &lt; Singlejunction1.size(); iSJ++){ <span class="comment">// this process is for trasferring information from Singlejunction1 into Transitsinglejunction1, and finally they will be located at WaitingLineforPY</span></div>
<div class="line"><a name="l05917"></a><span class="lineno"> 5917</span>&#160;    <span class="comment">//based on the partons at the end of each Leg, add fake mother baryon first.</span></div>
<div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;    <a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a> FakeBaryonElements; <span class="comment">// array of quarks in fake mother</span></div>
<div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;</div>
<div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;    <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> q1 = Singlejunction1.at(iSJ).at(0).back();</div>
<div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160;    <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> q2 = Singlejunction1.at(iSJ).at(1).back();</div>
<div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;    <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> q3 = Singlejunction1.at(iSJ).at(2).back();</div>
<div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;</div>
<div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;    <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> q1fin = q1;</div>
<div class="line"><a name="l05925"></a><span class="lineno"> 5925</span>&#160;    <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> q2fin = q2;</div>
<div class="line"><a name="l05926"></a><span class="lineno"> 5926</span>&#160;    <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> q3fin = q3;</div>
<div class="line"><a name="l05927"></a><span class="lineno"> 5927</span>&#160;</div>
<div class="line"><a name="l05928"></a><span class="lineno"> 5928</span>&#160;    FakeBaryonElements.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(q1fin); <span class="comment">//add first particle in 1st leg in iSJ_st singlejunction</span></div>
<div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;    FakeBaryonElements.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(q2fin); <span class="comment">//add first particle in 2nd leg in iSJ_st singlejunction</span></div>
<div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160;    FakeBaryonElements.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(q3fin); <span class="comment">//add first particle in 3rd leg in iSJ_st singlejunction</span></div>
<div class="line"><a name="l05931"></a><span class="lineno"> 5931</span>&#160;</div>
<div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160;    <span class="comment">// for the corrspondence with pdg particle id, sorting the these ids based on absolute value</span></div>
<div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iswap = 0; iswap &lt; 3; iswap++){</div>
<div class="line"><a name="l05934"></a><span class="lineno"> 5934</span>&#160;      <span class="keywordflow">if</span>(abs(FakeBaryonElements[2].<span class="keywordtype">id</span>()) &gt; abs(FakeBaryonElements[1].<span class="keywordtype">id</span>())){ <a class="code" href="../../d6/db0/fjcore_8hh.html#ac71f249d840a70f8b3aaffb721843eaa">std::swap</a>(FakeBaryonElements[2], FakeBaryonElements[1]) ; }</div>
<div class="line"><a name="l05935"></a><span class="lineno"> 5935</span>&#160;      <span class="keywordflow">if</span>(abs(FakeBaryonElements[1].<span class="keywordtype">id</span>()) &gt; abs(FakeBaryonElements[0].<span class="keywordtype">id</span>())){ <a class="code" href="../../d6/db0/fjcore_8hh.html#ac71f249d840a70f8b3aaffb721843eaa">std::swap</a>(FakeBaryonElements[1], FakeBaryonElements[0]) ; }</div>
<div class="line"><a name="l05936"></a><span class="lineno"> 5936</span>&#160;      <span class="keywordflow">if</span>(abs(FakeBaryonElements[2].<span class="keywordtype">id</span>()) &gt; abs(FakeBaryonElements[0].<span class="keywordtype">id</span>())){ <a class="code" href="../../d6/db0/fjcore_8hh.html#ac71f249d840a70f8b3aaffb721843eaa">std::swap</a>(FakeBaryonElements[2], FakeBaryonElements[0]) ; }</div>
<div class="line"><a name="l05937"></a><span class="lineno"> 5937</span>&#160;    }</div>
<div class="line"><a name="l05938"></a><span class="lineno"> 5938</span>&#160;</div>
<div class="line"><a name="l05939"></a><span class="lineno"> 5939</span>&#160;    <a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html">HHhadron</a> store_id_hadron1;</div>
<div class="line"><a name="l05940"></a><span class="lineno"> 5940</span>&#160;    set_baryon_id(FakeBaryonElements, store_id_hadron1);</div>
<div class="line"><a name="l05941"></a><span class="lineno"> 5941</span>&#160;</div>
<div class="line"><a name="l05942"></a><span class="lineno"> 5942</span>&#160;    <span class="keywordtype">int</span> m_id = store_id_hadron1.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a8673e70390fe194d7268ac18fa3373b2">id</a>();</div>
<div class="line"><a name="l05943"></a><span class="lineno"> 5943</span>&#160;    <span class="keywordflow">if</span>((q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() &lt; 0 &amp;&amp; m_id &gt; 0) || (q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() &gt; 0 &amp;&amp; m_id &lt; 0)){</div>
<div class="line"><a name="l05944"></a><span class="lineno"> 5944</span>&#160;      m_id *= -1;</div>
<div class="line"><a name="l05945"></a><span class="lineno"> 5945</span>&#160;    }</div>
<div class="line"><a name="l05946"></a><span class="lineno"> 5946</span>&#160;</div>
<div class="line"><a name="l05947"></a><span class="lineno"> 5947</span>&#160;    <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> fakeB;</div>
<div class="line"><a name="l05948"></a><span class="lineno"> 5948</span>&#160;    fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>(m_id); fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ace16a654254150de3f645310cbb27755">PY_stat</a>(-11); fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(3*xmq); fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(3*xmq);</div>
<div class="line"><a name="l05949"></a><span class="lineno"> 5949</span>&#160;    fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>(0.); fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>(0.); fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>(0.);</div>
<div class="line"><a name="l05950"></a><span class="lineno"> 5950</span>&#160;    <span class="keywordflow">if</span>(q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() &gt; 0){fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#af990fbb3513f7edfa35ce1656cfd12bd">PY_tag1</a>(q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>()); fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a519996bf56a96522350b651d4e3769a7">PY_tag2</a>(q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>()); fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a8612c23c63136e3e941beb24a472728b">PY_tag3</a>(q3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ac320cef716ef9e05cbc103cb24695568">col</a>());}</div>
<div class="line"><a name="l05951"></a><span class="lineno"> 5951</span>&#160;    <span class="keywordflow">else</span>{fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#af990fbb3513f7edfa35ce1656cfd12bd">PY_tag1</a>(q1.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>()); fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a519996bf56a96522350b651d4e3769a7">PY_tag2</a>(q2.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>()); fakeB.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a8612c23c63136e3e941beb24a472728b">PY_tag3</a>(q3.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ae7fc7ef0924523bda5d7877834efc363">acol</a>());}</div>
<div class="line"><a name="l05952"></a><span class="lineno"> 5952</span>&#160;    Transitsinglejunction2.push_back(fakeB);</div>
<div class="line"><a name="l05953"></a><span class="lineno"> 5953</span>&#160;    Transitsinglejunction1.push_back(Transitsinglejunction2);</div>
<div class="line"><a name="l05954"></a><span class="lineno"> 5954</span>&#160;    Transitsinglejunction2.clear();</div>
<div class="line"><a name="l05955"></a><span class="lineno"> 5955</span>&#160;  } <span class="comment">// so farfake mother is added to all single junction vectors{vectors of partons}, so we need to remember all execution number is incremented by one because of this fake baryons</span></div>
<div class="line"><a name="l05956"></a><span class="lineno"> 5956</span>&#160;</div>
<div class="line"><a name="l05957"></a><span class="lineno"> 5957</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iSJ = 0; iSJ &lt; Singlejunction1.size(); iSJ++){</div>
<div class="line"><a name="l05958"></a><span class="lineno"> 5958</span>&#160;    vector&lt;HHparton&gt; Leg1 = Singlejunction1.at(iSJ).at(0);</div>
<div class="line"><a name="l05959"></a><span class="lineno"> 5959</span>&#160;    vector&lt;HHparton&gt; Leg2 = Singlejunction1.at(iSJ).at(1);</div>
<div class="line"><a name="l05960"></a><span class="lineno"> 5960</span>&#160;    vector&lt;HHparton&gt; Leg3 = Singlejunction1.at(iSJ).at(2);</div>
<div class="line"><a name="l05961"></a><span class="lineno"> 5961</span>&#160;</div>
<div class="line"><a name="l05962"></a><span class="lineno"> 5962</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ileg1 = 0; ileg1 &lt; Leg1.size(); ileg1++ ){</div>
<div class="line"><a name="l05963"></a><span class="lineno"> 5963</span>&#160;      Leg1.at(ileg1).PY_par1(0); <span class="comment">// setting the mother tag as zero, which indicates the first particle in the Transit</span></div>
<div class="line"><a name="l05964"></a><span class="lineno"> 5964</span>&#160;      Leg1.at(ileg1).PY_par2(0);</div>
<div class="line"><a name="l05965"></a><span class="lineno"> 5965</span>&#160;      Transitsinglejunction1.at(iSJ).push_back(Leg1.at(ileg1));</div>
<div class="line"><a name="l05966"></a><span class="lineno"> 5966</span>&#160;    }</div>
<div class="line"><a name="l05967"></a><span class="lineno"> 5967</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ileg2 = 0; ileg2 &lt; Leg2.size(); ileg2++ ){</div>
<div class="line"><a name="l05968"></a><span class="lineno"> 5968</span>&#160;      Leg2.at(ileg2).PY_par1(0); <span class="comment">// setting the mother tag as zero, which indicates the first particle in the Transit</span></div>
<div class="line"><a name="l05969"></a><span class="lineno"> 5969</span>&#160;      Leg2.at(ileg2).PY_par2(0);</div>
<div class="line"><a name="l05970"></a><span class="lineno"> 5970</span>&#160;      Transitsinglejunction1.at(iSJ).push_back(Leg2.at(ileg2));</div>
<div class="line"><a name="l05971"></a><span class="lineno"> 5971</span>&#160;    }</div>
<div class="line"><a name="l05972"></a><span class="lineno"> 5972</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ileg3 = 0; ileg3 &lt; Leg3.size(); ileg3++ ){</div>
<div class="line"><a name="l05973"></a><span class="lineno"> 5973</span>&#160;      Leg3.at(ileg3).PY_par1(0); <span class="comment">// setting the mother tag as zero, which indicates the first particle in the Transit</span></div>
<div class="line"><a name="l05974"></a><span class="lineno"> 5974</span>&#160;      Leg3.at(ileg3).PY_par2(0);</div>
<div class="line"><a name="l05975"></a><span class="lineno"> 5975</span>&#160;      Transitsinglejunction1.at(iSJ).push_back(Leg3.at(ileg3));</div>
<div class="line"><a name="l05976"></a><span class="lineno"> 5976</span>&#160;    }</div>
<div class="line"><a name="l05977"></a><span class="lineno"> 5977</span>&#160;    Transitsinglejunction1.at(iSJ).at(0).PY_dau1(1);<span class="comment">//dau tag starting from 1 {after zero, which means fake mother baryon}</span></div>
<div class="line"><a name="l05978"></a><span class="lineno"> 5978</span>&#160;    Transitsinglejunction1.at(iSJ).at(0).PY_dau2(Leg1.size() + Leg2.size() + Leg3.size());<span class="comment">//dau tag starting from 1 {after zero, which means fake mother baryon}</span></div>
<div class="line"><a name="l05979"></a><span class="lineno"> 5979</span>&#160;  }<span class="comment">// At last, iSJ_st Singlejunction1 partons are moved to  iSJ_st vector component in Transitsinglejunction1</span></div>
<div class="line"><a name="l05980"></a><span class="lineno"> 5980</span>&#160;</div>
<div class="line"><a name="l05981"></a><span class="lineno"> 5981</span>&#160;  <span class="comment">//dignostic measure{Transitsinglejunction1}</span></div>
<div class="line"><a name="l05982"></a><span class="lineno"> 5982</span>&#160;  <span class="comment">/*std::cout &lt;&lt;endl&lt;&lt; &quot; the order of data is eNum &gt;&gt; id &gt;&gt; stat &gt;&gt; par1 &gt;&gt; par2 &gt;&gt; dau1 &gt;&gt; dau2 &quot;&lt;&lt; endl;</span></div>
<div class="line"><a name="l05983"></a><span class="lineno"> 5983</span>&#160;<span class="comment">  for(int icheck1 = 0; icheck1 &lt;  Transitsinglejunction1.size(); icheck1++ ){</span></div>
<div class="line"><a name="l05984"></a><span class="lineno"> 5984</span>&#160;<span class="comment">    std::cout &lt;&lt;endl&lt;&lt;&quot;SingleJunction : &quot;&lt;&lt;icheck1&lt;&lt;endl;</span></div>
<div class="line"><a name="l05985"></a><span class="lineno"> 5985</span>&#160;<span class="comment">    for(int i = 0; i &lt;  Transitsinglejunction1.at(icheck1).size(); i++){</span></div>
<div class="line"><a name="l05986"></a><span class="lineno"> 5986</span>&#160;<span class="comment">      vector&lt;HHparton&gt; temp = Transitsinglejunction1.at(icheck1);</span></div>
<div class="line"><a name="l05987"></a><span class="lineno"> 5987</span>&#160;<span class="comment">      std::cout  &lt;&lt; i &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).id() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_stat() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_par1() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_par2() &lt;&lt;&quot;   &quot;</span></div>
<div class="line"><a name="l05988"></a><span class="lineno"> 5988</span>&#160;<span class="comment">      &lt;&lt; temp.at(i).PY_dau1() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_dau2() &lt;&lt; &quot;  ( &quot;&lt;&lt;  temp.at(i).col()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).acol() &lt;&lt; &quot; ) &quot; &lt;&lt;endl;</span></div>
<div class="line"><a name="l05989"></a><span class="lineno"> 5989</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l05990"></a><span class="lineno"> 5990</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l05991"></a><span class="lineno"> 5991</span>&#160;</div>
<div class="line"><a name="l05992"></a><span class="lineno"> 5992</span>&#160;  <span class="comment">//dignostic measure{Dijunction1}</span></div>
<div class="line"><a name="l05993"></a><span class="lineno"> 5993</span>&#160;  <span class="comment">/*std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l05994"></a><span class="lineno"> 5994</span>&#160;<span class="comment">  std::cout &lt;&lt;&quot; List of Tempsorting for Dijunction&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l05995"></a><span class="lineno"> 5995</span>&#160;<span class="comment">  for(int icheck1 = 0; icheck1 &lt; Tempsorting1.size(); icheck1++){</span></div>
<div class="line"><a name="l05996"></a><span class="lineno"> 5996</span>&#160;<span class="comment">    std::cout &lt;&lt;&quot; Sorted Leg : &quot;&lt;&lt;icheck1&lt;&lt;endl;</span></div>
<div class="line"><a name="l05997"></a><span class="lineno"> 5997</span>&#160;<span class="comment">    for(int icheck2 = 0 ; icheck2 &lt; Tempsorting1.at(icheck1).size(); icheck2++){</span></div>
<div class="line"><a name="l05998"></a><span class="lineno"> 5998</span>&#160;<span class="comment">        std::cout &lt;&lt;&quot; ( &quot;&lt;&lt;Tempsorting1.at(icheck1).at(icheck2).col()&lt;&lt;&quot; , &quot;&lt;&lt;Tempsorting1.at(icheck1).at(icheck2).acol()&lt;&lt; &quot; )  &quot;;</span></div>
<div class="line"><a name="l05999"></a><span class="lineno"> 5999</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l06000"></a><span class="lineno"> 6000</span>&#160;<span class="comment">    std::cout &lt;&lt;endl;</span></div>
<div class="line"><a name="l06001"></a><span class="lineno"> 6001</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l06002"></a><span class="lineno"> 6002</span>&#160;</div>
<div class="line"><a name="l06003"></a><span class="lineno"> 6003</span>&#160;  <span class="comment">//So far, M,D tags for each junction and dijunction structure are designated. and EP_conservation checking will be done through Transitdijunction1 and Transitsinglejunction1 vectors</span></div>
<div class="line"><a name="l06004"></a><span class="lineno"> 6004</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itd1 = 0; itd1 &lt; Transitdijunction1.size(); itd1++){</div>
<div class="line"><a name="l06005"></a><span class="lineno"> 6005</span>&#160;    <span class="comment">/*JSINFO &lt;&lt; &quot;This is dijunction &quot; &lt;&lt; itd1+1 &lt;&lt; &quot; before:&quot;;</span></div>
<div class="line"><a name="l06006"></a><span class="lineno"> 6006</span>&#160;<span class="comment">    for(int i = 0; i &lt;  Transitdijunction1.at(itd1).size(); i++){</span></div>
<div class="line"><a name="l06007"></a><span class="lineno"> 6007</span>&#160;<span class="comment">      vector&lt;HHparton&gt; temp = Transitdijunction1.at(itd1);</span></div>
<div class="line"><a name="l06008"></a><span class="lineno"> 6008</span>&#160;<span class="comment">      std::cout  &lt;&lt; i &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).id() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_stat() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_par1() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_par2() &lt;&lt;&quot;   &quot;</span></div>
<div class="line"><a name="l06009"></a><span class="lineno"> 6009</span>&#160;<span class="comment">      &lt;&lt; temp.at(i).PY_dau1() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_dau2() &lt;&lt; &quot;  ( &quot;&lt;&lt;  temp.at(i).col()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).acol() &lt;&lt; &quot; ) &quot;</span></div>
<div class="line"><a name="l06010"></a><span class="lineno"> 6010</span>&#160;<span class="comment">      &lt;&lt; &quot;  ( &quot;&lt;&lt;  temp.at(i).e()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).px()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).py()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).pz() &lt;&lt; &quot; ) &quot;</span></div>
<div class="line"><a name="l06011"></a><span class="lineno"> 6011</span>&#160;<span class="comment">      &lt;&lt; &quot;  ( &quot;&lt;&lt;  temp.at(i).t()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).x()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).y()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).z() &lt;&lt; &quot; ) &quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l06012"></a><span class="lineno"> 6012</span>&#160;<span class="comment">    }*/</span></div>
<div class="line"><a name="l06013"></a><span class="lineno"> 6013</span>&#160;    <span class="keywordtype">bool</span> EP_conserved = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06014"></a><span class="lineno"> 6014</span>&#160;    <span class="keywordflow">while</span>(!EP_conserved){</div>
<div class="line"><a name="l06015"></a><span class="lineno"> 6015</span>&#160;      EP_conserved = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06016"></a><span class="lineno"> 6016</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;Transitdijunction1.at(itd1).size(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l06017"></a><span class="lineno"> 6017</span>&#160;        <span class="keywordflow">if</span>(Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_stat() &gt;= 0 &amp;&amp; std::abs(Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>()) &lt; 1000){</div>
<div class="line"><a name="l06018"></a><span class="lineno"> 6018</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06019"></a><span class="lineno"> 6019</span>&#160;        }</div>
<div class="line"><a name="l06020"></a><span class="lineno"> 6020</span>&#160;        <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> P_new(0.,0.,0.,0.);</div>
<div class="line"><a name="l06021"></a><span class="lineno"> 6021</span>&#160;        <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_new(0.,0.,0.,0.);</div>
<div class="line"><a name="l06022"></a><span class="lineno"> 6022</span>&#160;        <span class="keywordtype">int</span> jmax = (Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau2() &gt; Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau1()) ? Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau2() : Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau1();</div>
<div class="line"><a name="l06023"></a><span class="lineno"> 6023</span>&#160;        <span class="comment">//JSINFO &lt;&lt; &quot;jmax = &quot; &lt;&lt; jmax;</span></div>
<div class="line"><a name="l06024"></a><span class="lineno"> 6024</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>=Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau1(); <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>&lt;jmax+1; ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>){</div>
<div class="line"><a name="l06025"></a><span class="lineno"> 6025</span>&#160;          <span class="keywordtype">double</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#aff454a14d9dc8148930abb4b532e211d">n</a> = <a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>-Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau1())+1.;</div>
<div class="line"><a name="l06026"></a><span class="lineno"> 6026</span>&#160;          <span class="comment">//JSINFO &lt;&lt; &quot;n = &quot; &lt;&lt; n;</span></div>
<div class="line"><a name="l06027"></a><span class="lineno"> 6027</span>&#160;          <span class="comment">//JSINFO &lt;&lt; &quot;transdijunct.x_t = &quot;&lt;&lt;Transitdijunction1[itd1][j].x_t();</span></div>
<div class="line"><a name="l06028"></a><span class="lineno"> 6028</span>&#160;          <span class="comment">//JSINFO &lt;&lt; pos_new.t()+(Transitdijunction1[itd1][j].x_t()-pos_new.t())/n;</span></div>
<div class="line"><a name="l06029"></a><span class="lineno"> 6029</span>&#160;          P_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l06030"></a><span class="lineno"> 6030</span>&#160;            P_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()+Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].px(),</div>
<div class="line"><a name="l06031"></a><span class="lineno"> 6031</span>&#160;            P_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()+Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].py(),</div>
<div class="line"><a name="l06032"></a><span class="lineno"> 6032</span>&#160;            P_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()+Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].pz(),</div>
<div class="line"><a name="l06033"></a><span class="lineno"> 6033</span>&#160;            P_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()+Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].e());</div>
<div class="line"><a name="l06034"></a><span class="lineno"> 6034</span>&#160;          pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(</div>
<div class="line"><a name="l06035"></a><span class="lineno"> 6035</span>&#160;            pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()+(Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].x()-pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>())/n,</div>
<div class="line"><a name="l06036"></a><span class="lineno"> 6036</span>&#160;            pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()+(Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].y()-pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>())/n,</div>
<div class="line"><a name="l06037"></a><span class="lineno"> 6037</span>&#160;            pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()+(Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].z()-pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>())/n,</div>
<div class="line"><a name="l06038"></a><span class="lineno"> 6038</span>&#160;            pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()+(Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].x_t()-pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>())/n);</div>
<div class="line"><a name="l06039"></a><span class="lineno"> 6039</span>&#160;        }</div>
<div class="line"><a name="l06040"></a><span class="lineno"> 6040</span>&#160;        <span class="comment">//JSINFO &lt;&lt; &quot;p = (&quot; &lt;&lt; P_new.t() &lt;&lt; &quot;, &quot; &lt;&lt; P_new.y() &lt;&lt; &quot;, &quot; &lt;&lt; P_new.y() &lt;&lt; &quot;, &quot; &lt;&lt; P_new.z() &lt;&lt; &quot;)&quot;;</span></div>
<div class="line"><a name="l06041"></a><span class="lineno"> 6041</span>&#160;        <span class="comment">//JSINFO &lt;&lt; &quot;x = (&quot; &lt;&lt; pos_new.t() &lt;&lt; &quot;, &quot; &lt;&lt; pos_new.y() &lt;&lt; &quot;, &quot; &lt;&lt; pos_new.y() &lt;&lt; &quot;, &quot; &lt;&lt; pos_new.z() &lt;&lt; &quot;)&quot;;</span></div>
<div class="line"><a name="l06042"></a><span class="lineno"> 6042</span>&#160;        <span class="keywordflow">if</span>((dif2(P_new,Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dc5/KFPTrackVector_8h.html#a39a53a622c6abde5e888e4ad46fb04af" title="Returns momentum of the track with index &quot;n&quot;.">P</a>())+(P_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()-Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e())*(P_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()-Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e()) &gt; 0.00000001<span class="comment">/*0.0001^2*/</span>) ||</div>
<div class="line"><a name="l06043"></a><span class="lineno"> 6043</span>&#160;          (dif2(pos_new,Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a182617618c30f1ba6a9c7540ae655340">pos</a>())+(pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()-Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t())*(pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()-Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t()) &gt; 0.00000001)){</div>
<div class="line"><a name="l06044"></a><span class="lineno"> 6044</span>&#160;          Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].P(P_new);</div>
<div class="line"><a name="l06045"></a><span class="lineno"> 6045</span>&#160;          Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pos(pos_new);</div>
<div class="line"><a name="l06046"></a><span class="lineno"> 6046</span>&#160;          Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].mass(</div>
<div class="line"><a name="l06047"></a><span class="lineno"> 6047</span>&#160;            Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>()*Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>()</div>
<div class="line"><a name="l06048"></a><span class="lineno"> 6048</span>&#160;            - Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px()*Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px()</div>
<div class="line"><a name="l06049"></a><span class="lineno"> 6049</span>&#160;            - Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py()*Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py()</div>
<div class="line"><a name="l06050"></a><span class="lineno"> 6050</span>&#160;            - Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz()*Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz());</div>
<div class="line"><a name="l06051"></a><span class="lineno"> 6051</span>&#160;          Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].mass( (Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>() &gt;= 0.) ? sqrt(Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()) : -sqrt(-Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()) ); <span class="comment">//don&#39;t need mass &gt;0 for reco now</span></div>
<div class="line"><a name="l06052"></a><span class="lineno"> 6052</span>&#160;          EP_conserved = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06053"></a><span class="lineno"> 6053</span>&#160;        }</div>
<div class="line"><a name="l06054"></a><span class="lineno"> 6054</span>&#160;      }</div>
<div class="line"><a name="l06055"></a><span class="lineno"> 6055</span>&#160;    }</div>
<div class="line"><a name="l06056"></a><span class="lineno"> 6056</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;Transitdijunction1.at(itd1).size(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l06057"></a><span class="lineno"> 6057</span>&#160;      <span class="keywordflow">if</span>((Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_stat() == -21)){<span class="comment">// &amp;&amp; (Transitdijunction1[itd1][i].PY_dau2() &gt; Transitdijunction1[itd1][i].PY_dau1())){</span></div>
<div class="line"><a name="l06058"></a><span class="lineno"> 6058</span>&#160;        Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px(Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px()/2.);</div>
<div class="line"><a name="l06059"></a><span class="lineno"> 6059</span>&#160;        Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py(Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py()/2.);</div>
<div class="line"><a name="l06060"></a><span class="lineno"> 6060</span>&#160;        Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz(Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz()/2.);</div>
<div class="line"><a name="l06061"></a><span class="lineno"> 6061</span>&#160;        Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e( Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() /2.);</div>
<div class="line"><a name="l06062"></a><span class="lineno"> 6062</span>&#160;        Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].mass(Transitdijunction1[itd1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()/2.);</div>
<div class="line"><a name="l06063"></a><span class="lineno"> 6063</span>&#160;      }</div>
<div class="line"><a name="l06064"></a><span class="lineno"> 6064</span>&#160;    }</div>
<div class="line"><a name="l06065"></a><span class="lineno"> 6065</span>&#160;</div>
<div class="line"><a name="l06066"></a><span class="lineno"> 6066</span>&#160;    <span class="comment">/*JSINFO &lt;&lt; &quot;This is dijunction &quot; &lt;&lt; itd1+1 &lt;&lt; &quot; after:&quot;;</span></div>
<div class="line"><a name="l06067"></a><span class="lineno"> 6067</span>&#160;<span class="comment">    for(int i = 0; i &lt;  Transitdijunction1.at(itd1).size(); i++){</span></div>
<div class="line"><a name="l06068"></a><span class="lineno"> 6068</span>&#160;<span class="comment">      vector&lt;HHparton&gt; temp = Transitdijunction1.at(itd1);</span></div>
<div class="line"><a name="l06069"></a><span class="lineno"> 6069</span>&#160;<span class="comment">      std::cout  &lt;&lt; i &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).id() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_stat() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_par1() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_par2() &lt;&lt;&quot;   &quot;</span></div>
<div class="line"><a name="l06070"></a><span class="lineno"> 6070</span>&#160;<span class="comment">      &lt;&lt; temp.at(i).PY_dau1() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_dau2() &lt;&lt; &quot;  ( &quot;&lt;&lt;  temp.at(i).col()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).acol() &lt;&lt; &quot; ) &quot;</span></div>
<div class="line"><a name="l06071"></a><span class="lineno"> 6071</span>&#160;<span class="comment">      &lt;&lt; &quot;  ( &quot;&lt;&lt;  temp.at(i).e()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).px()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).py()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).pz() &lt;&lt; &quot; ) &quot;</span></div>
<div class="line"><a name="l06072"></a><span class="lineno"> 6072</span>&#160;<span class="comment">      &lt;&lt; &quot;  ( &quot;&lt;&lt;  temp.at(i).t()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).x()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).y()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).z() &lt;&lt; &quot; ) &quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l06073"></a><span class="lineno"> 6073</span>&#160;<span class="comment">    }*/</span></div>
<div class="line"><a name="l06074"></a><span class="lineno"> 6074</span>&#160;  }</div>
<div class="line"><a name="l06075"></a><span class="lineno"> 6075</span>&#160;</div>
<div class="line"><a name="l06076"></a><span class="lineno"> 6076</span>&#160;  <span class="comment">//for transitsinglejunction1</span></div>
<div class="line"><a name="l06077"></a><span class="lineno"> 6077</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> its1 = 0; its1 &lt; Transitsinglejunction1.size(); its1++){</div>
<div class="line"><a name="l06078"></a><span class="lineno"> 6078</span>&#160;    <span class="keywordtype">bool</span> EP_conserved = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06079"></a><span class="lineno"> 6079</span>&#160;    <span class="keywordflow">while</span>(!EP_conserved){</div>
<div class="line"><a name="l06080"></a><span class="lineno"> 6080</span>&#160;      EP_conserved = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06081"></a><span class="lineno"> 6081</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;Transitsinglejunction1.at(its1).size(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l06082"></a><span class="lineno"> 6082</span>&#160;        <span class="keywordflow">if</span>(Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_stat() &gt;= 0 &amp;&amp; std::abs(Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>()) &lt; 1000){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l06083"></a><span class="lineno"> 6083</span>&#160;        <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> P_new(0.,0.,0.,0.); <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> pos_new(0.,0.,0.,0.);</div>
<div class="line"><a name="l06084"></a><span class="lineno"> 6084</span>&#160;        <span class="keywordtype">int</span> jmax = (Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau2() &gt; Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau1()) ? Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau2() : Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau1();</div>
<div class="line"><a name="l06085"></a><span class="lineno"> 6085</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>=Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau1(); <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>&lt;jmax+1; ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>){</div>
<div class="line"><a name="l06086"></a><span class="lineno"> 6086</span>&#160;          <span class="keywordtype">double</span> <a class="code" href="../../da/de5/ThicknessScan_8m.html#aff454a14d9dc8148930abb4b532e211d">n</a> = <a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>-Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau1())+1.;</div>
<div class="line"><a name="l06087"></a><span class="lineno"> 6087</span>&#160;          P_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(P_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()+Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].px(),P_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()+Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].py(),P_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()+Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].pz(),P_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()+Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].e());</div>
<div class="line"><a name="l06088"></a><span class="lineno"> 6088</span>&#160;          pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()+(Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].x()-pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>())/n,pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()+(Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].y()-pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>())/n,pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()+(Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].z()-pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>())/n,pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()+(Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>].x_t()-pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>())/n);</div>
<div class="line"><a name="l06089"></a><span class="lineno"> 6089</span>&#160;        }</div>
<div class="line"><a name="l06090"></a><span class="lineno"> 6090</span>&#160;        <span class="keywordflow">if</span>((dif2(P_new,Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dc5/KFPTrackVector_8h.html#a39a53a622c6abde5e888e4ad46fb04af" title="Returns momentum of the track with index &quot;n&quot;.">P</a>())+(P_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()-Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e())*(P_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()-Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e()) &gt; 0.00000001<span class="comment">/*0.0001^2*/</span>) ||</div>
<div class="line"><a name="l06091"></a><span class="lineno"> 6091</span>&#160;          (dif2(pos_new,Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dd/d7e/namespaceActs_1_1Test.html#a182617618c30f1ba6a9c7540ae655340">pos</a>())+(pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()-Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t())*(pos_new.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>()-Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t()) &gt; 0.00000001)){</div>
<div class="line"><a name="l06092"></a><span class="lineno"> 6092</span>&#160;          Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].P(P_new); Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pos(pos_new);</div>
<div class="line"><a name="l06093"></a><span class="lineno"> 6093</span>&#160;          Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].mass( Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>()*Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>()</div>
<div class="line"><a name="l06094"></a><span class="lineno"> 6094</span>&#160;            - Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px()*Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px() - Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py()*Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py() - Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz()*Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz() );</div>
<div class="line"><a name="l06095"></a><span class="lineno"> 6095</span>&#160;          Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].mass( (Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>() &gt;= 0.) ? sqrt(Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()) : -sqrt(-Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()) ); <span class="comment">//don&#39;t need mass &gt;0 for reco now</span></div>
<div class="line"><a name="l06096"></a><span class="lineno"> 6096</span>&#160;          EP_conserved = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06097"></a><span class="lineno"> 6097</span>&#160;        }</div>
<div class="line"><a name="l06098"></a><span class="lineno"> 6098</span>&#160;      }</div>
<div class="line"><a name="l06099"></a><span class="lineno"> 6099</span>&#160;    }</div>
<div class="line"><a name="l06100"></a><span class="lineno"> 6100</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;Transitsinglejunction1.at(its1).size(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l06101"></a><span class="lineno"> 6101</span>&#160;      <span class="keywordflow">if</span>((Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_stat() == -21)){<span class="comment">// &amp;&amp; (Transitsinglejunction1[its1][i].PY_dau2() &gt; Transitsinglejunction1[its1][i].PY_dau1())){</span></div>
<div class="line"><a name="l06102"></a><span class="lineno"> 6102</span>&#160;        Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px(Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px()/2.);</div>
<div class="line"><a name="l06103"></a><span class="lineno"> 6103</span>&#160;        Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py(Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py()/2.);</div>
<div class="line"><a name="l06104"></a><span class="lineno"> 6104</span>&#160;        Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz(Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz()/2.);</div>
<div class="line"><a name="l06105"></a><span class="lineno"> 6105</span>&#160;        Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e( Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() /2.);</div>
<div class="line"><a name="l06106"></a><span class="lineno"> 6106</span>&#160;        Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].mass(Transitsinglejunction1[its1][<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>()/2.);</div>
<div class="line"><a name="l06107"></a><span class="lineno"> 6107</span>&#160;      }</div>
<div class="line"><a name="l06108"></a><span class="lineno"> 6108</span>&#160;    }</div>
<div class="line"><a name="l06109"></a><span class="lineno"> 6109</span>&#160;  }</div>
<div class="line"><a name="l06110"></a><span class="lineno"> 6110</span>&#160;</div>
<div class="line"><a name="l06111"></a><span class="lineno"> 6111</span>&#160;  <span class="comment">// make sure that there is enough energy in the system, such that the dijunctions can be hadronized</span></div>
<div class="line"><a name="l06112"></a><span class="lineno"> 6112</span>&#160;  <span class="comment">// this is a rare case</span></div>
<div class="line"><a name="l06113"></a><span class="lineno"> 6113</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itagdij1 = 0; itagdij1 &lt; Transitdijunction1.size(); itagdij1++ ){</div>
<div class="line"><a name="l06114"></a><span class="lineno"> 6114</span>&#160;    <span class="keywordtype">double</span> baryon_mass_scaling = 1.25;</div>
<div class="line"><a name="l06115"></a><span class="lineno"> 6115</span>&#160;    <span class="keywordtype">double</span> mass_baryons = Transitdijunction1.at(itagdij1).at(0).mass() + Transitdijunction1.at(itagdij1).at(1).mass();</div>
<div class="line"><a name="l06116"></a><span class="lineno"> 6116</span>&#160;    <span class="keywordtype">double</span> m1 = pythia.particleData.m0(std::abs(Transitdijunction1.at(itagdij1).at(0).id()));</div>
<div class="line"><a name="l06117"></a><span class="lineno"> 6117</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a> = pythia.particleData.m0(std::abs(Transitdijunction1.at(itagdij1).at(1).id()));</div>
<div class="line"><a name="l06118"></a><span class="lineno"> 6118</span>&#160;    <span class="keywordflow">if</span>(mass_baryons &lt; baryon_mass_scaling*(m1+m2)){</div>
<div class="line"><a name="l06119"></a><span class="lineno"> 6119</span>&#160;      <span class="comment">//find fake gluon</span></div>
<div class="line"><a name="l06120"></a><span class="lineno"> 6120</span>&#160;      <span class="keywordtype">double</span> new_gluon_mass = 2.*xmq;</div>
<div class="line"><a name="l06121"></a><span class="lineno"> 6121</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itagdij2 = 0; itagdij2 &lt; Transitdijunction1.at(itagdij1).size(); itagdij2++){</div>
<div class="line"><a name="l06122"></a><span class="lineno"> 6122</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> <a class="code" href="../../dc/d78/namespacemerge__hashes.html#a63313c3a4f2b0cb6f7cea830c9ff269d">p</a> = Transitdijunction1.at(itagdij1).at(itagdij2);</div>
<div class="line"><a name="l06123"></a><span class="lineno"> 6123</span>&#160;        <span class="keywordflow">if</span>(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() == 21){</div>
<div class="line"><a name="l06124"></a><span class="lineno"> 6124</span>&#160;          new_gluon_mass = p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()+baryon_mass_scaling*(m1+<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a>)-mass_baryons;</div>
<div class="line"><a name="l06125"></a><span class="lineno"> 6125</span>&#160;          p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(new_gluon_mass);</div>
<div class="line"><a name="l06126"></a><span class="lineno"> 6126</span>&#160;          <span class="keywordtype">double</span> energy_new = std::sqrt(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l06127"></a><span class="lineno"> 6127</span>&#160;          p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(energy_new);</div>
<div class="line"><a name="l06128"></a><span class="lineno"> 6128</span>&#160;          Transitdijunction1.at(itagdij1).at(itagdij2).mass(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l06129"></a><span class="lineno"> 6129</span>&#160;          Transitdijunction1.at(itagdij1).at(itagdij2).e(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>());</div>
<div class="line"><a name="l06130"></a><span class="lineno"> 6130</span>&#160;        }</div>
<div class="line"><a name="l06131"></a><span class="lineno"> 6131</span>&#160;      }</div>
<div class="line"><a name="l06132"></a><span class="lineno"> 6132</span>&#160;      <span class="comment">//find fake (anti-)quarks</span></div>
<div class="line"><a name="l06133"></a><span class="lineno"> 6133</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itagdij2 = 0; itagdij2 &lt; Transitdijunction1.at(itagdij1).size(); itagdij2++){</div>
<div class="line"><a name="l06134"></a><span class="lineno"> 6134</span>&#160;        <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> <a class="code" href="../../dc/d78/namespacemerge__hashes.html#a63313c3a4f2b0cb6f7cea830c9ff269d">p</a> = Transitdijunction1.at(itagdij1).at(itagdij2);</div>
<div class="line"><a name="l06135"></a><span class="lineno"> 6135</span>&#160;        <span class="keywordflow">if</span>(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ace16a654254150de3f645310cbb27755">PY_stat</a>() == -21 &amp;&amp; std::abs(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6){</div>
<div class="line"><a name="l06136"></a><span class="lineno"> 6136</span>&#160;          p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(new_gluon_mass/2.);</div>
<div class="line"><a name="l06137"></a><span class="lineno"> 6137</span>&#160;          <span class="keywordtype">double</span> energy_new = std::sqrt(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l06138"></a><span class="lineno"> 6138</span>&#160;          p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(energy_new);</div>
<div class="line"><a name="l06139"></a><span class="lineno"> 6139</span>&#160;        }</div>
<div class="line"><a name="l06140"></a><span class="lineno"> 6140</span>&#160;        <span class="keywordflow">if</span>(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#ace16a654254150de3f645310cbb27755">PY_stat</a>() == -11 &amp;&amp; std::abs(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &gt; 1000){</div>
<div class="line"><a name="l06141"></a><span class="lineno"> 6141</span>&#160;          p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()+(baryon_mass_scaling*(m1+<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a>)-mass_baryons)/2.);</div>
<div class="line"><a name="l06142"></a><span class="lineno"> 6142</span>&#160;          <span class="keywordtype">double</span> energy_new = std::sqrt(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l06143"></a><span class="lineno"> 6143</span>&#160;          p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(energy_new);</div>
<div class="line"><a name="l06144"></a><span class="lineno"> 6144</span>&#160;        }</div>
<div class="line"><a name="l06145"></a><span class="lineno"> 6145</span>&#160;      }</div>
<div class="line"><a name="l06146"></a><span class="lineno"> 6146</span>&#160;    }</div>
<div class="line"><a name="l06147"></a><span class="lineno"> 6147</span>&#160;  }</div>
<div class="line"><a name="l06148"></a><span class="lineno"> 6148</span>&#160;</div>
<div class="line"><a name="l06149"></a><span class="lineno"> 6149</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itagdij1 = 0; itagdij1 &lt; Transitdijunction1.size(); itagdij1++ ){</div>
<div class="line"><a name="l06150"></a><span class="lineno"> 6150</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itagdij2 = 0; itagdij2 &lt; Transitdijunction1.at(itagdij1).size(); itagdij2++){</div>
<div class="line"><a name="l06151"></a><span class="lineno"> 6151</span>&#160;      WaitingLineforPY.push_back(Transitdijunction1.at(itagdij1).at(itagdij2));</div>
<div class="line"><a name="l06152"></a><span class="lineno"> 6152</span>&#160;    }</div>
<div class="line"><a name="l06153"></a><span class="lineno"> 6153</span>&#160;  }</div>
<div class="line"><a name="l06154"></a><span class="lineno"> 6154</span>&#160;</div>
<div class="line"><a name="l06155"></a><span class="lineno"> 6155</span>&#160;  <span class="comment">//dignostic measure{Transitdijunction1}</span></div>
<div class="line"><a name="l06156"></a><span class="lineno"> 6156</span>&#160;  <span class="comment">/*int icheck2 = 0;</span></div>
<div class="line"><a name="l06157"></a><span class="lineno"> 6157</span>&#160;<span class="comment">  std::cout &lt;&lt;endl&lt;&lt; &quot; the order of data is eNum &gt;&gt; id &gt;&gt; stat &gt;&gt; par1 &gt;&gt; par2 &gt;&gt; dau1 &gt;&gt; dau2 &quot;&lt;&lt; endl;</span></div>
<div class="line"><a name="l06158"></a><span class="lineno"> 6158</span>&#160;<span class="comment">  for(int icheck1 = 0; icheck1 &lt;  Transitdijunction1.size(); icheck1++ ){</span></div>
<div class="line"><a name="l06159"></a><span class="lineno"> 6159</span>&#160;<span class="comment">    for(int i = 0; i &lt;  Transitdijunction1.at(icheck1).size(); i++){</span></div>
<div class="line"><a name="l06160"></a><span class="lineno"> 6160</span>&#160;<span class="comment">      vector&lt;HHparton&gt; temp = Transitdijunction1.at(icheck1);</span></div>
<div class="line"><a name="l06161"></a><span class="lineno"> 6161</span>&#160;<span class="comment">      std::cout  &lt;&lt; icheck2 &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).id() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_stat() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_par1() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_par2() &lt;&lt;&quot;   &quot;</span></div>
<div class="line"><a name="l06162"></a><span class="lineno"> 6162</span>&#160;<span class="comment">      &lt;&lt; temp.at(i).PY_dau1() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(i).PY_dau2() &lt;&lt; &quot;  ( &quot;&lt;&lt;  temp.at(i).col()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(i).acol() &lt;&lt; &quot; ) &quot; &lt;&lt;endl;</span></div>
<div class="line"><a name="l06163"></a><span class="lineno"> 6163</span>&#160;<span class="comment">      icheck2++;</span></div>
<div class="line"><a name="l06164"></a><span class="lineno"> 6164</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l06165"></a><span class="lineno"> 6165</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l06166"></a><span class="lineno"> 6166</span>&#160;</div>
<div class="line"><a name="l06167"></a><span class="lineno"> 6167</span>&#160;  <span class="comment">// make sure that there is enough energy in the system, such that the junctions can be hadronized</span></div>
<div class="line"><a name="l06168"></a><span class="lineno"> 6168</span>&#160;  <span class="comment">// this is a rare case</span></div>
<div class="line"><a name="l06169"></a><span class="lineno"> 6169</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itagsj1 = 0; itagsj1 &lt; Transitsinglejunction1.size(); itagsj1++ ){</div>
<div class="line"><a name="l06170"></a><span class="lineno"> 6170</span>&#160;    <span class="keywordtype">double</span> baryon_mass_scaling = 1.15;</div>
<div class="line"><a name="l06171"></a><span class="lineno"> 6171</span>&#160;    <span class="keywordtype">double</span> mass_baryon = Transitsinglejunction1.at(itagsj1).at(0).mass();</div>
<div class="line"><a name="l06172"></a><span class="lineno"> 6172</span>&#160;    <span class="keywordtype">double</span> m1 = pythia.particleData.m0(std::abs(Transitsinglejunction1.at(itagsj1).at(0).id()));</div>
<div class="line"><a name="l06173"></a><span class="lineno"> 6173</span>&#160;</div>
<div class="line"><a name="l06174"></a><span class="lineno"> 6174</span>&#160;    <span class="keywordflow">if</span>(mass_baryon &lt; baryon_mass_scaling*m1){</div>
<div class="line"><a name="l06175"></a><span class="lineno"> 6175</span>&#160;      <span class="keywordtype">double</span> baryon_mass_correction = baryon_mass_scaling*m1-mass_baryon;</div>
<div class="line"><a name="l06176"></a><span class="lineno"> 6176</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itagsj2 = 0; itagsj2 &lt; Transitsinglejunction1.at(itagsj1).size(); itagsj2++){</div>
<div class="line"><a name="l06177"></a><span class="lineno"> 6177</span>&#160;        <span class="keywordflow">if</span>(std::abs(Transitsinglejunction1.at(itagsj1).at(itagsj2).id()) &lt; 6){</div>
<div class="line"><a name="l06178"></a><span class="lineno"> 6178</span>&#160;          <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> <a class="code" href="../../dc/d78/namespacemerge__hashes.html#a63313c3a4f2b0cb6f7cea830c9ff269d">p</a> = Transitsinglejunction1.at(itagsj1).at(itagsj2);</div>
<div class="line"><a name="l06179"></a><span class="lineno"> 6179</span>&#160;          p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()+baryon_mass_correction/3.);</div>
<div class="line"><a name="l06180"></a><span class="lineno"> 6180</span>&#160;          <span class="keywordtype">double</span> energy_new = std::sqrt(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l06181"></a><span class="lineno"> 6181</span>&#160;          p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(energy_new);</div>
<div class="line"><a name="l06182"></a><span class="lineno"> 6182</span>&#160;          Transitsinglejunction1.at(itagsj1).at(itagsj2).mass(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l06183"></a><span class="lineno"> 6183</span>&#160;          Transitsinglejunction1.at(itagsj1).at(itagsj2).e(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>());</div>
<div class="line"><a name="l06184"></a><span class="lineno"> 6184</span>&#160;        }</div>
<div class="line"><a name="l06185"></a><span class="lineno"> 6185</span>&#160;      }</div>
<div class="line"><a name="l06186"></a><span class="lineno"> 6186</span>&#160;</div>
<div class="line"><a name="l06187"></a><span class="lineno"> 6187</span>&#160;      <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> <a class="code" href="../../dc/d78/namespacemerge__hashes.html#a63313c3a4f2b0cb6f7cea830c9ff269d">p</a> = Transitsinglejunction1.at(itagsj1).at(0);</div>
<div class="line"><a name="l06188"></a><span class="lineno"> 6188</span>&#160;      p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(baryon_mass_scaling*m1);</div>
<div class="line"><a name="l06189"></a><span class="lineno"> 6189</span>&#160;      <span class="keywordtype">double</span> energy_new = std::sqrt(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l06190"></a><span class="lineno"> 6190</span>&#160;      p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(energy_new);</div>
<div class="line"><a name="l06191"></a><span class="lineno"> 6191</span>&#160;      Transitsinglejunction1.at(itagsj1).at(0).mass(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>());</div>
<div class="line"><a name="l06192"></a><span class="lineno"> 6192</span>&#160;      Transitsinglejunction1.at(itagsj1).at(0).e(p.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>());</div>
<div class="line"><a name="l06193"></a><span class="lineno"> 6193</span>&#160;    }</div>
<div class="line"><a name="l06194"></a><span class="lineno"> 6194</span>&#160;  }</div>
<div class="line"><a name="l06195"></a><span class="lineno"> 6195</span>&#160;</div>
<div class="line"><a name="l06196"></a><span class="lineno"> 6196</span>&#160;</div>
<div class="line"><a name="l06197"></a><span class="lineno"> 6197</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itagsj1 = 0; itagsj1 &lt; Transitsinglejunction1.size(); itagsj1++ ){</div>
<div class="line"><a name="l06198"></a><span class="lineno"> 6198</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itagsj2 = 0; itagsj2 &lt; Transitsinglejunction1.at(itagsj1).size(); itagsj2++){</div>
<div class="line"><a name="l06199"></a><span class="lineno"> 6199</span>&#160;      WaitingLineforPY.push_back(Transitsinglejunction1.at(itagsj1).at(itagsj2));</div>
<div class="line"><a name="l06200"></a><span class="lineno"> 6200</span>&#160;    }</div>
<div class="line"><a name="l06201"></a><span class="lineno"> 6201</span>&#160;  }</div>
<div class="line"><a name="l06202"></a><span class="lineno"> 6202</span>&#160;</div>
<div class="line"><a name="l06203"></a><span class="lineno"> 6203</span>&#160;  <span class="comment">/*for(int i=0; i&lt;WaitingLineforPY.size(); i++) {</span></div>
<div class="line"><a name="l06204"></a><span class="lineno"> 6204</span>&#160;<span class="comment">    std::cout &lt;&lt; WaitingLineforPY[i].id() &lt;&lt; &quot;,&quot; &lt;&lt; WaitingLineforPY[i].col() &lt;&lt; &quot;,&quot; &lt;&lt; WaitingLineforPY[i].acol() &lt;&lt; &quot;,&quot; &lt;&lt; WaitingLineforPY[i].PY_par1() &lt;&lt; &quot;,&quot; &lt;&lt; WaitingLineforPY[i].PY_par2() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l06205"></a><span class="lineno"> 6205</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l06206"></a><span class="lineno"> 6206</span>&#160;</div>
<div class="line"><a name="l06207"></a><span class="lineno"> 6207</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ifins = 0; ifins &lt; finalstring.size(); ifins++){</div>
<div class="line"><a name="l06208"></a><span class="lineno"> 6208</span>&#160;    WaitingLineforPY.push_back(finalstring.at(ifins));</div>
<div class="line"><a name="l06209"></a><span class="lineno"> 6209</span>&#160;  }</div>
<div class="line"><a name="l06210"></a><span class="lineno"> 6210</span>&#160;</div>
<div class="line"><a name="l06211"></a><span class="lineno"> 6211</span>&#160;  <span class="comment">/*std::cout &lt;&lt;endl&lt;&lt;&quot; Let&#39;s check final entry before PY!!&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l06212"></a><span class="lineno"> 6212</span>&#160;<span class="comment">  std::cout &lt;&lt;endl&lt;&lt; &quot; the order of data is eNum &gt;&gt; id &gt;&gt; stat &gt;&gt; par1 &gt;&gt; par2 &gt;&gt; dau1 &gt;&gt; dau2 &gt;&gt; (col, acol) &gt;&gt; x_t&quot;&lt;&lt; endl;</span></div>
<div class="line"><a name="l06213"></a><span class="lineno"> 6213</span>&#160;<span class="comment">  for(int fincheck = 0; fincheck &lt; WaitingLineforPY.size(); fincheck++){</span></div>
<div class="line"><a name="l06214"></a><span class="lineno"> 6214</span>&#160;<span class="comment">    vector&lt;HHparton&gt; temp = WaitingLineforPY;</span></div>
<div class="line"><a name="l06215"></a><span class="lineno"> 6215</span>&#160;<span class="comment">    std::cout  &lt;&lt; fincheck &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(fincheck).id() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(fincheck).PY_stat() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(fincheck).PY_par1() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(fincheck).PY_par2() &lt;&lt;&quot;   &quot;</span></div>
<div class="line"><a name="l06216"></a><span class="lineno"> 6216</span>&#160;<span class="comment">    &lt;&lt; temp.at(fincheck).PY_dau1() &lt;&lt;&quot;   &quot;&lt;&lt; temp.at(fincheck).PY_dau2() &lt;&lt; &quot;  ( &quot;&lt;&lt;  temp.at(fincheck).col()&lt;&lt; &quot; , &quot; &lt;&lt; temp.at(fincheck).acol() &lt;&lt; &quot; )   &quot; &lt;&lt; temp.at(fincheck).x_t()&lt;&lt;endl;</span></div>
<div class="line"><a name="l06217"></a><span class="lineno"> 6217</span>&#160;<span class="comment">  }*/</span></div>
<div class="line"><a name="l06218"></a><span class="lineno"> 6218</span>&#160;</div>
<div class="line"><a name="l06219"></a><span class="lineno"> 6219</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ifin = 0; ifin &lt; WaitingLineforPY.size(); ifin++){</div>
<div class="line"><a name="l06220"></a><span class="lineno"> 6220</span>&#160;    SP_prepremn.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#a851c0bd3a1a31aa1b49f40d226d48eb5">add</a>(WaitingLineforPY[ifin]);</div>
<div class="line"><a name="l06221"></a><span class="lineno"> 6221</span>&#160;  }</div>
<div class="line"><a name="l06222"></a><span class="lineno"> 6222</span>&#160;</div>
<div class="line"><a name="l06223"></a><span class="lineno"> 6223</span>&#160;  Tempjunctions.clear(); <span class="comment">// clear these informations for next running</span></div>
<div class="line"><a name="l06224"></a><span class="lineno"> 6224</span>&#160;  JuncStructure.clear();</div>
<div class="line"><a name="l06225"></a><span class="lineno"> 6225</span>&#160;  realjuncindice.clear();</div>
<div class="line"><a name="l06226"></a><span class="lineno"> 6226</span>&#160;  IMStructure1.clear();</div>
<div class="line"><a name="l06227"></a><span class="lineno"> 6227</span>&#160;  Dijunction1.clear();</div>
<div class="line"><a name="l06228"></a><span class="lineno"> 6228</span>&#160;  DijunctionInfo1.clear();</div>
<div class="line"><a name="l06229"></a><span class="lineno"> 6229</span>&#160;  Recombearly1.clear();</div>
<div class="line"><a name="l06230"></a><span class="lineno"> 6230</span>&#160;  Tailoredstring1.clear();</div>
<div class="line"><a name="l06231"></a><span class="lineno"> 6231</span>&#160;  finalstring.clear();</div>
<div class="line"><a name="l06232"></a><span class="lineno"> 6232</span>&#160;  Transitdijunction1.clear();</div>
<div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;  Transitsinglejunction1.clear();</div>
<div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;  WaitingLineforPY.clear();</div>
<div class="line"><a name="l06235"></a><span class="lineno"> 6235</span>&#160;  Tempsorting1.clear();</div>
<div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160;}</div>
<div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;</div>
<div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160;<span class="comment">//function to hand partons/strings and hadron resonances (and various other color neutral and colored objects) to Pythia8</span></div>
<div class="line"><a name="l06239"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a2d4ed86a8823d3fd880417bef48b1c61"> 6239</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#a2d4ed86a8823d3fd880417bef48b1c61">HybridHadronization::invoke_py</a>(){</div>
<div class="line"><a name="l06240"></a><span class="lineno"> 6240</span>&#160;</div>
<div class="line"><a name="l06241"></a><span class="lineno"> 6241</span>&#160;        <a class="code" href="../../d5/da5/classEvent.html">Event</a>&amp; <span class="keyword">event</span> = pythia.event;</div>
<div class="line"><a name="l06242"></a><span class="lineno"> 6242</span>&#160;</div>
<div class="line"><a name="l06243"></a><span class="lineno"> 6243</span>&#160;        <span class="comment">//should have been checked before call, but if there are no partons/hadrons to deal with, just exit without invoking pythia</span></div>
<div class="line"><a name="l06244"></a><span class="lineno"> 6244</span>&#160;        <span class="keywordflow">if</span>(HH_pyremn.num() + HH_hadrons.num() == 0){<span class="keywordflow">return</span> <span class="keyword">true</span>;}</div>
<div class="line"><a name="l06245"></a><span class="lineno"> 6245</span>&#160;</div>
<div class="line"><a name="l06246"></a><span class="lineno"> 6246</span>&#160;        <span class="comment">//first things first, need to reindex py_remn; just need to increment ALL by one</span></div>
<div class="line"><a name="l06247"></a><span class="lineno"> 6247</span>&#160;        <span class="comment">//also restoring original id for color octet particles (or other &#39;odd&#39; colored particles)</span></div>
<div class="line"><a name="l06248"></a><span class="lineno"> 6248</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_pyremn.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l06249"></a><span class="lineno"> 6249</span>&#160;                HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_par1(HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_par1()+1); HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_par2(HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_par2()+1);</div>
<div class="line"><a name="l06250"></a><span class="lineno"> 6250</span>&#160;                HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau1(HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau1()+1); HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau2(HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau2()+1);</div>
<div class="line"><a name="l06251"></a><span class="lineno"> 6251</span>&#160;                <span class="keywordflow">if</span>(HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_origid() != 0) {HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].id( HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_origid());}</div>
<div class="line"><a name="l06252"></a><span class="lineno"> 6252</span>&#160;        }</div>
<div class="line"><a name="l06253"></a><span class="lineno"> 6253</span>&#160;</div>
<div class="line"><a name="l06254"></a><span class="lineno"> 6254</span>&#160;        <span class="keywordtype">bool</span> need_hadronization = <span class="keyword">true</span>; <span class="keywordtype">bool</span> success = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06255"></a><span class="lineno"> 6255</span>&#160;        <span class="keywordtype">int</span> attempt = 0;</div>
<div class="line"><a name="l06256"></a><span class="lineno"> 6256</span>&#160;        <span class="keywordflow">while</span>(need_hadronization){</div>
<div class="line"><a name="l06257"></a><span class="lineno"> 6257</span>&#160;                <span class="comment">//incrementing attempt number</span></div>
<div class="line"><a name="l06258"></a><span class="lineno"> 6258</span>&#160;                ++attempt;</div>
<div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160;</div>
<div class="line"><a name="l06260"></a><span class="lineno"> 6260</span>&#160;                <span class="comment">//resetting PYTHIA event record, so that this event can be filled</span></div>
<div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160;                <span class="keyword">event</span>.reset();</div>
<div class="line"><a name="l06262"></a><span class="lineno"> 6262</span>&#160;    HH_pythia_hadrons.clear();</div>
<div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;</div>
<div class="line"><a name="l06264"></a><span class="lineno"> 6264</span>&#160;                <span class="comment">//number of partons/hadrons/particles handed to pythia</span></div>
<div class="line"><a name="l06265"></a><span class="lineno"> 6265</span>&#160;                <span class="keywordtype">int</span> size_input = 0;</div>
<div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;</div>
<div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;                <span class="comment">//keeping track of partons from py_remn and hadrons into the event</span></div>
<div class="line"><a name="l06268"></a><span class="lineno"> 6268</span>&#160;                std::vector&lt;int&gt; eve_to_had; eve_to_had.push_back(0);</div>
<div class="line"><a name="l06269"></a><span class="lineno"> 6269</span>&#160;</div>
<div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160;                <span class="comment">//filling PYTHIA event record with the partons from this event</span></div>
<div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160;    <span class="keywordtype">int</span> dijuncflag = 0;</div>
<div class="line"><a name="l06272"></a><span class="lineno"> 6272</span>&#160;    <span class="keywordtype">bool</span> case1 = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;    <span class="keywordtype">bool</span> case2 = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06274"></a><span class="lineno"> 6274</span>&#160;    <span class="keywordtype">bool</span> case3 = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160;    <span class="keywordtype">bool</span> case4 = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;    <span class="keywordtype">bool</span> case5 = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06277"></a><span class="lineno"> 6277</span>&#160;    <span class="keywordtype">bool</span> case6 = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06278"></a><span class="lineno"> 6278</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_pyremn.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l06279"></a><span class="lineno"> 6279</span>&#160;      <span class="comment">// code part to hadronize junctions and dijunctions separately</span></div>
<div class="line"><a name="l06280"></a><span class="lineno"> 6280</span>&#160;      <span class="comment">// if fake pythia baryon (=junction or anti-junction) increment by one</span></div>
<div class="line"><a name="l06281"></a><span class="lineno"> 6281</span>&#160;      <span class="keywordflow">if</span>(abs(HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>()) &gt; 1112 &amp;&amp; HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_tag1() !=0 &amp;&amp; HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_tag2() !=0 &amp;&amp; HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_tag3() !=0) {</div>
<div class="line"><a name="l06282"></a><span class="lineno"> 6282</span>&#160;        dijuncflag++;</div>
<div class="line"><a name="l06283"></a><span class="lineno"> 6283</span>&#160;      }</div>
<div class="line"><a name="l06284"></a><span class="lineno"> 6284</span>&#160;      <span class="comment">// this first part is for the hadronization of junctions/anti-junctions</span></div>
<div class="line"><a name="l06285"></a><span class="lineno"> 6285</span>&#160;      <span class="keywordflow">if</span>((dijuncflag == 1 &amp;&amp; abs(HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>())&lt;100 &amp;&amp; HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_par1() == 0 &amp;&amp; HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_par2() == 0)</div>
<div class="line"><a name="l06286"></a><span class="lineno"> 6286</span>&#160;        || (dijuncflag == 2 &amp;&amp; abs(HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>-1].<span class="keywordtype">id</span>()) &lt; 100)) {</div>
<div class="line"><a name="l06287"></a><span class="lineno"> 6287</span>&#160;        size_input = <span class="keyword">event</span>.size()-1;</div>
<div class="line"><a name="l06288"></a><span class="lineno"> 6288</span>&#160;        <span class="comment">//event.listJunctions();</span></div>
<div class="line"><a name="l06289"></a><span class="lineno"> 6289</span>&#160;        <span class="comment">//event.list();</span></div>
<div class="line"><a name="l06290"></a><span class="lineno"> 6290</span>&#160;        case1 &amp;= pythia.next();</div>
<div class="line"><a name="l06291"></a><span class="lineno"> 6291</span>&#160;        <span class="comment">//event.list();</span></div>
<div class="line"><a name="l06292"></a><span class="lineno"> 6292</span>&#160;        set_spacetime_for_pythia_hadrons(<a class="code" href="../../d1/d15/ntuple__variables_8C.html#abfce3740898f7fbb327ff7ff8b780a20">event</a>,size_input,eve_to_had,attempt,case1,<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l06293"></a><span class="lineno"> 6293</span>&#160;        <span class="keyword">event</span>.reset();</div>
<div class="line"><a name="l06294"></a><span class="lineno"> 6294</span>&#160;        eve_to_had.clear();</div>
<div class="line"><a name="l06295"></a><span class="lineno"> 6295</span>&#160;        <span class="keywordflow">if</span>(dijuncflag == 1){dijuncflag=0;}</div>
<div class="line"><a name="l06296"></a><span class="lineno"> 6296</span>&#160;        <span class="keywordflow">if</span>(dijuncflag == 2){dijuncflag=1;}</div>
<div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160;      }</div>
<div class="line"><a name="l06298"></a><span class="lineno"> 6298</span>&#160;      <span class="comment">// if we are past two junctions, check if they are back-to-back;</span></div>
<div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;      <span class="keywordflow">if</span>(dijuncflag == 2) {</div>
<div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;        <span class="keywordflow">if</span>(abs(HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>-1].<span class="keywordtype">id</span>())&gt;1112){dijuncflag=3;}  <span class="comment">// if yes, increment to 3; we are now inside a dijunction</span></div>
<div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160;        <span class="keywordflow">else</span>{dijuncflag = 1;}  <span class="comment">// no dijunction, must be a single one, step back to counter 1</span></div>
<div class="line"><a name="l06302"></a><span class="lineno"> 6302</span>&#160;      }</div>
<div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160;      <span class="comment">// code red: we only reach this if we have reached the end of a dijunction; it&#39;s either another fake baryon or something without mother or daughter tags</span></div>
<div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160;      <span class="comment">// this second part is for the hadronization of di-junctions</span></div>
<div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160;      <span class="keywordflow">if</span>(dijuncflag == 4 || (HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_par1() == 0 &amp;&amp; HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_par2() == 0 &amp;&amp; HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau1() == 0 &amp;&amp; HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau2() == 0 &amp;&amp; dijuncflag == 3)) {</div>
<div class="line"><a name="l06306"></a><span class="lineno"> 6306</span>&#160;        <span class="comment">// hadronize event here (which is only one dijunction); need to copy all the code that calls pythia AND refers to event.xxx up here</span></div>
<div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;        size_input = <span class="keyword">event</span>.size()-1;</div>
<div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160;        <span class="comment">//event.listJunctions();</span></div>
<div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;        <span class="comment">//event.list();</span></div>
<div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;        case2 &amp;= pythia.next();</div>
<div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;        <span class="comment">//event.list();</span></div>
<div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;        set_spacetime_for_pythia_hadrons(<a class="code" href="../../d1/d15/ntuple__variables_8C.html#abfce3740898f7fbb327ff7ff8b780a20">event</a>,size_input,eve_to_had,attempt,case2,<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;        <span class="keyword">event</span>.reset();</div>
<div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;        eve_to_had.clear();</div>
<div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;        <span class="keywordflow">if</span>(dijuncflag == 4){dijuncflag=1;}<span class="keywordflow">else</span>{dijuncflag=0;}</div>
<div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160;      }</div>
<div class="line"><a name="l06317"></a><span class="lineno"> 6317</span>&#160;</div>
<div class="line"><a name="l06318"></a><span class="lineno"> 6318</span>&#160;                        <span class="comment">//append( id, status, mother1, mother2, daughter1, daughter2, col, acol, px, py, pz, e, m)</span></div>
<div class="line"><a name="l06319"></a><span class="lineno"> 6319</span>&#160;                        <span class="keyword">event</span>.append(HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>(),HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_stat(),HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_par1(),HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_par2(),HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau1(),HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_dau2(),</div>
<div class="line"><a name="l06320"></a><span class="lineno"> 6320</span>&#160;                        HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>(),HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].acol(),HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px(),HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py(),HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz(),HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>(),HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>());</div>
<div class="line"><a name="l06321"></a><span class="lineno"> 6321</span>&#160;      <span class="comment">//JSINFO &lt;&lt; HH_pyremn[i].id()&lt;&lt;&quot;,&quot;&lt;&lt;HH_pyremn[i].PY_stat()&lt;&lt;&quot;,&quot;&lt;&lt;HH_pyremn[i].PY_par1()&lt;&lt;&quot;,&quot;&lt;&lt;HH_pyremn[i].PY_par2()&lt;&lt;&quot;,&quot;&lt;&lt;HH_pyremn[i].PY_dau1()&lt;&lt;&quot;,&quot;&lt;&lt;HH_pyremn[i].PY_dau2()&lt;&lt;&quot;,&quot;&lt;&lt;</span></div>
<div class="line"><a name="l06322"></a><span class="lineno"> 6322</span>&#160;                        <span class="comment">//  HH_pyremn[i].col()&lt;&lt;&quot;,&quot;&lt;&lt;HH_pyremn[i].acol()&lt;&lt;&quot;,&quot;&lt;&lt;HH_pyremn[i].px()&lt;&lt;&quot;,&quot;&lt;&lt;HH_pyremn[i].py()&lt;&lt;&quot;,&quot;&lt;&lt;HH_pyremn[i].pz()&lt;&lt;&quot;,&quot;&lt;&lt;HH_pyremn[i].e()&lt;&lt;&quot;,&quot;&lt;&lt;HH_pyremn[i].mass();</span></div>
<div class="line"><a name="l06323"></a><span class="lineno"> 6323</span>&#160;                        <span class="keyword">event</span>[<span class="keyword">event</span>.size()-1].vProd(HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>(), HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>(), HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>(), HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t());</div>
<div class="line"><a name="l06324"></a><span class="lineno"> 6324</span>&#160;                        <span class="comment">//for junction mother, adding junction to list manually for color tracing appendJunction(int kind, int col0, int col1, int col2);</span></div>
<div class="line"><a name="l06325"></a><span class="lineno"> 6325</span>&#160;                        <span class="keywordflow">if</span>(std::abs(<a class="code" href="../../d1/d15/ntuple__variables_8C.html#abfce3740898f7fbb327ff7ff8b780a20">event</a>[<a class="code" href="../../d1/d15/ntuple__variables_8C.html#abfce3740898f7fbb327ff7ff8b780a20">event</a>.size()-1].id()) &gt; 1112){</div>
<div class="line"><a name="l06326"></a><span class="lineno"> 6326</span>&#160;                                <span class="keyword">event</span>.appendJunction(((<a class="code" href="../../d1/d15/ntuple__variables_8C.html#abfce3740898f7fbb327ff7ff8b780a20">event</a>[<a class="code" href="../../d1/d15/ntuple__variables_8C.html#abfce3740898f7fbb327ff7ff8b780a20">event</a>.size()-1].id()&gt;0) ? 1 : 2), HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_tag1(), HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_tag2(), HH_pyremn[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].PY_tag3());</div>
<div class="line"><a name="l06327"></a><span class="lineno"> 6327</span>&#160;                        }</div>
<div class="line"><a name="l06328"></a><span class="lineno"> 6328</span>&#160;                        eve_to_had.push_back(-<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>-1);</div>
<div class="line"><a name="l06329"></a><span class="lineno"> 6329</span>&#160;                }</div>
<div class="line"><a name="l06330"></a><span class="lineno"> 6330</span>&#160;</div>
<div class="line"><a name="l06331"></a><span class="lineno"> 6331</span>&#160;    size_input = <span class="keyword">event</span>.size()-1;</div>
<div class="line"><a name="l06332"></a><span class="lineno"> 6332</span>&#160;                <span class="comment">//make PYTHIA hadronize this event, if it fails then retry N=10 times... (PYTHIA can and will rarely fail, without concern)</span></div>
<div class="line"><a name="l06333"></a><span class="lineno"> 6333</span>&#160;                <span class="comment">//if this fails more than 10 times, we may retry this event starting back before recombination (some number of times)</span></div>
<div class="line"><a name="l06334"></a><span class="lineno"> 6334</span>&#160;    <span class="comment">//event.listJunctions();</span></div>
<div class="line"><a name="l06335"></a><span class="lineno"> 6335</span>&#160;    <span class="comment">//event.list();</span></div>
<div class="line"><a name="l06336"></a><span class="lineno"> 6336</span>&#160;    case3 &amp;= pythia.next();</div>
<div class="line"><a name="l06337"></a><span class="lineno"> 6337</span>&#160;    <span class="comment">//event.list();</span></div>
<div class="line"><a name="l06338"></a><span class="lineno"> 6338</span>&#160;    set_spacetime_for_pythia_hadrons(<a class="code" href="../../d1/d15/ntuple__variables_8C.html#abfce3740898f7fbb327ff7ff8b780a20">event</a>,size_input,eve_to_had,attempt,case3,<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l06339"></a><span class="lineno"> 6339</span>&#160;    <span class="keyword">event</span>.reset();</div>
<div class="line"><a name="l06340"></a><span class="lineno"> 6340</span>&#160;    eve_to_had.clear();</div>
<div class="line"><a name="l06341"></a><span class="lineno"> 6341</span>&#160;</div>
<div class="line"><a name="l06342"></a><span class="lineno"> 6342</span>&#160;    <span class="comment">//if we want to decay particles in pythia we have to do it separately for hadrons from recombination, otherwise the</span></div>
<div class="line"><a name="l06343"></a><span class="lineno"> 6343</span>&#160;    <span class="comment">//information about the origin is lost</span></div>
<div class="line"><a name="l06344"></a><span class="lineno"> 6344</span>&#160;    <span class="comment">//adding in hadrons/leptons/other colorless particles too...</span></div>
<div class="line"><a name="l06345"></a><span class="lineno"> 6345</span>&#160;    <span class="keywordflow">if</span>(reco_hadrons_pythia){</div>
<div class="line"><a name="l06346"></a><span class="lineno"> 6346</span>&#160;      <span class="comment">//reco hadrons</span></div>
<div class="line"><a name="l06347"></a><span class="lineno"> 6347</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_hadrons.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l06348"></a><span class="lineno"> 6348</span>&#160;        <span class="keywordflow">if</span>(HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_final() &amp;&amp; HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_recohad() &amp;&amp; HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_shsh()){</div>
<div class="line"><a name="l06349"></a><span class="lineno"> 6349</span>&#160;                            <span class="comment">//to make sure mass is set appropriately</span></div>
<div class="line"><a name="l06350"></a><span class="lineno"> 6350</span>&#160;                            <span class="keywordtype">double</span> massnow = HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e() -</div>
<div class="line"><a name="l06351"></a><span class="lineno"> 6351</span>&#160;                                            (HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px() + HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py() + HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz());</div>
<div class="line"><a name="l06352"></a><span class="lineno"> 6352</span>&#160;                            massnow = (massnow &gt;= 0.) ? sqrt(massnow) : -sqrt(-massnow);</div>
<div class="line"><a name="l06353"></a><span class="lineno"> 6353</span>&#160;                            <span class="keyword">event</span>.append(HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>(),81,0,0,HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px(),HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py(),HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz(),HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>(),massnow);</div>
<div class="line"><a name="l06354"></a><span class="lineno"> 6354</span>&#160;                            <span class="keyword">event</span>[<span class="keyword">event</span>.size()-1].vProd(HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>(), HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>(), HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>(), HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t());</div>
<div class="line"><a name="l06355"></a><span class="lineno"> 6355</span>&#160;                            eve_to_had.push_back(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>+1);</div>
<div class="line"><a name="l06356"></a><span class="lineno"> 6356</span>&#160;                    }</div>
<div class="line"><a name="l06357"></a><span class="lineno"> 6357</span>&#160;      }</div>
<div class="line"><a name="l06358"></a><span class="lineno"> 6358</span>&#160;      case4 &amp;= pythia.next();</div>
<div class="line"><a name="l06359"></a><span class="lineno"> 6359</span>&#160;      set_spacetime_for_pythia_hadrons(<a class="code" href="../../d1/d15/ntuple__variables_8C.html#abfce3740898f7fbb327ff7ff8b780a20">event</a>,size_input,eve_to_had,attempt,case4,<span class="keyword">true</span>,<span class="keyword">true</span>);</div>
<div class="line"><a name="l06360"></a><span class="lineno"> 6360</span>&#160;      <span class="keyword">event</span>.reset();</div>
<div class="line"><a name="l06361"></a><span class="lineno"> 6361</span>&#160;      eve_to_had.clear();</div>
<div class="line"><a name="l06362"></a><span class="lineno"> 6362</span>&#160;</div>
<div class="line"><a name="l06363"></a><span class="lineno"> 6363</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_hadrons.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l06364"></a><span class="lineno"> 6364</span>&#160;        <span class="keywordflow">if</span>(HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_final() &amp;&amp; HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_recohad() &amp;&amp; HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_shth()){</div>
<div class="line"><a name="l06365"></a><span class="lineno"> 6365</span>&#160;                            <span class="comment">//to make sure mass is set appropriately</span></div>
<div class="line"><a name="l06366"></a><span class="lineno"> 6366</span>&#160;                            <span class="keywordtype">double</span> massnow = HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e() -</div>
<div class="line"><a name="l06367"></a><span class="lineno"> 6367</span>&#160;                                            (HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px() + HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py() + HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz());</div>
<div class="line"><a name="l06368"></a><span class="lineno"> 6368</span>&#160;                            massnow = (massnow &gt;= 0.) ? sqrt(massnow) : -sqrt(-massnow);</div>
<div class="line"><a name="l06369"></a><span class="lineno"> 6369</span>&#160;                            <span class="keyword">event</span>.append(HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>(),81,0,0,HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px(),HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py(),HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz(),HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>(),massnow);</div>
<div class="line"><a name="l06370"></a><span class="lineno"> 6370</span>&#160;                            <span class="keyword">event</span>[<span class="keyword">event</span>.size()-1].vProd(HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>(), HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>(), HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>(), HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t());</div>
<div class="line"><a name="l06371"></a><span class="lineno"> 6371</span>&#160;                            eve_to_had.push_back(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>+1);</div>
<div class="line"><a name="l06372"></a><span class="lineno"> 6372</span>&#160;                    }</div>
<div class="line"><a name="l06373"></a><span class="lineno"> 6373</span>&#160;      }</div>
<div class="line"><a name="l06374"></a><span class="lineno"> 6374</span>&#160;      case5 &amp;= pythia.next();</div>
<div class="line"><a name="l06375"></a><span class="lineno"> 6375</span>&#160;      set_spacetime_for_pythia_hadrons(<a class="code" href="../../d1/d15/ntuple__variables_8C.html#abfce3740898f7fbb327ff7ff8b780a20">event</a>,size_input,eve_to_had,attempt,case5,<span class="keyword">true</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l06376"></a><span class="lineno"> 6376</span>&#160;      <span class="keyword">event</span>.reset();</div>
<div class="line"><a name="l06377"></a><span class="lineno"> 6377</span>&#160;      eve_to_had.clear();</div>
<div class="line"><a name="l06378"></a><span class="lineno"> 6378</span>&#160;</div>
<div class="line"><a name="l06379"></a><span class="lineno"> 6379</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;HH_hadrons.num(); ++<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>){</div>
<div class="line"><a name="l06380"></a><span class="lineno"> 6380</span>&#160;        <span class="keywordflow">if</span>(HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_final() &amp;&amp; !HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].is_recohad()){</div>
<div class="line"><a name="l06381"></a><span class="lineno"> 6381</span>&#160;                            <span class="comment">//to make sure mass is set appropriately</span></div>
<div class="line"><a name="l06382"></a><span class="lineno"> 6382</span>&#160;                            <span class="keywordtype">double</span> massnow = HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].e() -</div>
<div class="line"><a name="l06383"></a><span class="lineno"> 6383</span>&#160;                                            (HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px() + HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py() + HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz()*HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz());</div>
<div class="line"><a name="l06384"></a><span class="lineno"> 6384</span>&#160;                            massnow = (massnow &gt;= 0.) ? sqrt(massnow) : -sqrt(-massnow);</div>
<div class="line"><a name="l06385"></a><span class="lineno"> 6385</span>&#160;                            <span class="keyword">event</span>.append(HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<span class="keywordtype">id</span>(),81,0,0,HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].px(),HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].py(),HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].pz(),HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>(),massnow);</div>
<div class="line"><a name="l06386"></a><span class="lineno"> 6386</span>&#160;                            <span class="keyword">event</span>[<span class="keyword">event</span>.size()-1].vProd(HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>(), HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>(), HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>(), HH_hadrons[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].x_t());</div>
<div class="line"><a name="l06387"></a><span class="lineno"> 6387</span>&#160;                            eve_to_had.push_back(<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>+1);</div>
<div class="line"><a name="l06388"></a><span class="lineno"> 6388</span>&#160;                    }</div>
<div class="line"><a name="l06389"></a><span class="lineno"> 6389</span>&#160;      }</div>
<div class="line"><a name="l06390"></a><span class="lineno"> 6390</span>&#160;      case6 &amp;= pythia.next();</div>
<div class="line"><a name="l06391"></a><span class="lineno"> 6391</span>&#160;      set_spacetime_for_pythia_hadrons(<a class="code" href="../../d1/d15/ntuple__variables_8C.html#abfce3740898f7fbb327ff7ff8b780a20">event</a>,size_input,eve_to_had,attempt,case6,<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l06392"></a><span class="lineno"> 6392</span>&#160;      <span class="keyword">event</span>.reset();</div>
<div class="line"><a name="l06393"></a><span class="lineno"> 6393</span>&#160;      eve_to_had.clear();</div>
<div class="line"><a name="l06394"></a><span class="lineno"> 6394</span>&#160;    }</div>
<div class="line"><a name="l06395"></a><span class="lineno"> 6395</span>&#160;</div>
<div class="line"><a name="l06396"></a><span class="lineno"> 6396</span>&#160;                <span class="keywordflow">if</span>(!case1 || !case2 || !case3 || !case4 || !case5 || !case6){</div>
<div class="line"><a name="l06397"></a><span class="lineno"> 6397</span>&#160;                  <span class="keywordflow">if</span>(attempt &gt; 4){need_hadronization = <span class="keyword">false</span>; success = <span class="keyword">false</span>; <span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l06398"></a><span class="lineno"> 6398</span>&#160;                  <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06399"></a><span class="lineno"> 6399</span>&#160;                }</div>
<div class="line"><a name="l06400"></a><span class="lineno"> 6400</span>&#160;                <span class="comment">//this event has been successfully hadronized (hopefully), put all final state particles into HH_pythia_hadrons; set is_final=true for these</span></div>
<div class="line"><a name="l06401"></a><span class="lineno"> 6401</span>&#160;    <span class="comment">//this is done in set_spacetime_for_pythia_hadrons() and in DoHadronization all these Hadrons are written to HH_hadrons</span></div>
<div class="line"><a name="l06402"></a><span class="lineno"> 6402</span>&#160;                need_hadronization = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06403"></a><span class="lineno"> 6403</span>&#160;  }</div>
<div class="line"><a name="l06404"></a><span class="lineno"> 6404</span>&#160;        <span class="keywordflow">return</span> success;</div>
<div class="line"><a name="l06405"></a><span class="lineno"> 6405</span>&#160;}</div>
<div class="line"><a name="l06406"></a><span class="lineno"> 6406</span>&#160;</div>
<div class="line"><a name="l06407"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a2a159d441cbd8f1a13d82b9831c0a7b7"> 6407</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#a2a159d441cbd8f1a13d82b9831c0a7b7">HybridHadronization::set_spacetime_for_pythia_hadrons</a>(Pythia8::Event &amp;<a class="code" href="../../d1/d15/ntuple__variables_8C.html#abfce3740898f7fbb327ff7ff8b780a20">event</a>, <span class="keywordtype">int</span> &amp;size_input, std::vector&lt;int&gt; &amp;eve_to_had, <span class="keywordtype">int</span> pythia_attempt, <span class="keywordtype">bool</span> find_positions, <span class="keywordtype">bool</span> is_recohadron, <span class="keywordtype">bool</span> recohadron_shsh) {</div>
<div class="line"><a name="l06408"></a><span class="lineno"> 6408</span>&#160;  <span class="comment">// directly return if hadronization in pythia failed, such that nothing is added to HH_pythia_hadrons</span></div>
<div class="line"><a name="l06409"></a><span class="lineno"> 6409</span>&#160;  <span class="keywordflow">if</span>(!find_positions) {</div>
<div class="line"><a name="l06410"></a><span class="lineno"> 6410</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06411"></a><span class="lineno"> 6411</span>&#160;  }</div>
<div class="line"><a name="l06412"></a><span class="lineno"> 6412</span>&#160;</div>
<div class="line"><a name="l06413"></a><span class="lineno"> 6413</span>&#160;  vector&lt;HHhadron&gt; final_hadrons_from_pythia; <span class="comment">// hadrons with preliminary set positions (average positions along string segment)</span></div>
<div class="line"><a name="l06414"></a><span class="lineno"> 6414</span>&#160;</div>
<div class="line"><a name="l06415"></a><span class="lineno"> 6415</span>&#160;  vector&lt;int&gt; Case1_hadron_idx; <span class="comment">// index of the hadron from case 1 below</span></div>
<div class="line"><a name="l06416"></a><span class="lineno"> 6416</span>&#160;  vector&lt;int&gt; Case1_parton1_idx; <span class="comment">// index of the parton1 from case 1 below</span></div>
<div class="line"><a name="l06417"></a><span class="lineno"> 6417</span>&#160;  vector&lt;int&gt; Case1_parton2_idx; <span class="comment">// index of the parton2 from case 1 below</span></div>
<div class="line"><a name="l06418"></a><span class="lineno"> 6418</span>&#160;</div>
<div class="line"><a name="l06419"></a><span class="lineno"> 6419</span>&#160;  vector&lt;int&gt; Case2_hadron_idx; <span class="comment">// index of the hadron from case 2 below</span></div>
<div class="line"><a name="l06420"></a><span class="lineno"> 6420</span>&#160;  vector&lt;int&gt; Case2_parton1_idx; <span class="comment">// index of the parton1 from case 2 below</span></div>
<div class="line"><a name="l06421"></a><span class="lineno"> 6421</span>&#160;  vector&lt;int&gt; Case2_parton2_idx; <span class="comment">// index of the parton2 from case 2 below</span></div>
<div class="line"><a name="l06422"></a><span class="lineno"> 6422</span>&#160;  vector&lt;int&gt; Case2_parton3_idx; <span class="comment">// index of the parton3 from case 2 below</span></div>
<div class="line"><a name="l06423"></a><span class="lineno"> 6423</span>&#160;  vector&lt;double&gt; Case2_junction_center; <span class="comment">// store the center position of the junction in element 0=t,1=x,2=y,3=z</span></div>
<div class="line"><a name="l06424"></a><span class="lineno"> 6424</span>&#160;  <span class="comment">// this works only for the current implementation, where the junctions are handed over to pythia one after the other</span></div>
<div class="line"><a name="l06425"></a><span class="lineno"> 6425</span>&#160;</div>
<div class="line"><a name="l06426"></a><span class="lineno"> 6426</span>&#160;</div>
<div class="line"><a name="l06427"></a><span class="lineno"> 6427</span>&#160;  vector&lt;int&gt; Case3_hadron_idx; <span class="comment">// index of the hadron from case 3 below</span></div>
<div class="line"><a name="l06428"></a><span class="lineno"> 6428</span>&#160;  vector&lt;int&gt; Case3_parton1_idx; <span class="comment">// index of the parton1 from case 3 below</span></div>
<div class="line"><a name="l06429"></a><span class="lineno"> 6429</span>&#160;  vector&lt;int&gt; Case3_parton2_idx; <span class="comment">// index of the parton2 from case 3 below</span></div>
<div class="line"><a name="l06430"></a><span class="lineno"> 6430</span>&#160;  vector&lt;double&gt; Case3_partons_center; <span class="comment">// store the center position of the partons</span></div>
<div class="line"><a name="l06431"></a><span class="lineno"> 6431</span>&#160;</div>
<div class="line"><a name="l06432"></a><span class="lineno"> 6432</span>&#160;  <span class="keywordtype">bool</span> compute_more_precise_positions = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06433"></a><span class="lineno"> 6433</span>&#160;  <span class="keywordtype">bool</span> warn_could_not_find_positions = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06434"></a><span class="lineno"> 6434</span>&#160;</div>
<div class="line"><a name="l06435"></a><span class="lineno"> 6435</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> hadron_idx = 1; hadron_idx &lt; <span class="keyword">event</span>.size(); hadron_idx++) {</div>
<div class="line"><a name="l06436"></a><span class="lineno"> 6436</span>&#160;    <span class="keywordflow">if</span>(event[hadron_idx].isFinal()) { <span class="comment">//take only final hadrons from pythia</span></div>
<div class="line"><a name="l06437"></a><span class="lineno"> 6437</span>&#160;      <span class="comment">//convert pythia hadron to HHhadron</span></div>
<div class="line"><a name="l06438"></a><span class="lineno"> 6438</span>&#160;      <a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html">HHhadron</a> hadron_out; <span class="comment">//a number of other tags need to be set from the parent (either hadron or string)</span></div>
<div class="line"><a name="l06439"></a><span class="lineno"> 6439</span>&#160;      hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a300138ab1c54aa8c3e21c9b8ba38cd79">is_final</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l06440"></a><span class="lineno"> 6440</span>&#160;      hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a8673e70390fe194d7268ac18fa3373b2">id</a>(event[hadron_idx].<span class="keywordtype">id</span>());</div>
<div class="line"><a name="l06441"></a><span class="lineno"> 6441</span>&#160;      hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a048b35ba82d82b0c177b0968485bab3d">mass</a>(event[hadron_idx].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#aa0b5dd062eddcdda72af1809b341ab0f">m</a>());</div>
<div class="line"><a name="l06442"></a><span class="lineno"> 6442</span>&#160;      hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#adf52004eb7b573d4fdd988145675ecf3">px</a>(event[hadron_idx].px());</div>
<div class="line"><a name="l06443"></a><span class="lineno"> 6443</span>&#160;      hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ae31c445f0a520e46180f06f41983baa7">py</a>(event[hadron_idx].py());</div>
<div class="line"><a name="l06444"></a><span class="lineno"> 6444</span>&#160;      hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ac2dac67112497e7e118010c59b1a64f0">pz</a>(event[hadron_idx].pz());</div>
<div class="line"><a name="l06445"></a><span class="lineno"> 6445</span>&#160;      hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a5293e518444b410e68788975b3d6cab8">e</a>(event[hadron_idx].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>());</div>
<div class="line"><a name="l06446"></a><span class="lineno"> 6446</span>&#160;</div>
<div class="line"><a name="l06447"></a><span class="lineno"> 6447</span>&#160;      <span class="comment">//since using inbuilt pythia mother/daughter functions will segfault &#39;occasionally&#39;, going to code it in by hand.</span></div>
<div class="line"><a name="l06448"></a><span class="lineno"> 6448</span>&#160;                        <span class="comment">//this could probably be done more efficiently, but it&#39;s good enough for now...</span></div>
<div class="line"><a name="l06449"></a><span class="lineno"> 6449</span>&#160;      std::vector&lt;int&gt; mothers;</div>
<div class="line"><a name="l06450"></a><span class="lineno"> 6450</span>&#160;      <span class="comment">//using a stack system to fill mothers</span></div>
<div class="line"><a name="l06451"></a><span class="lineno"> 6451</span>&#160;                        std::vector&lt;int&gt; stack;</div>
<div class="line"><a name="l06452"></a><span class="lineno"> 6452</span>&#160;      <span class="comment">//filling stack with initial mothers</span></div>
<div class="line"><a name="l06453"></a><span class="lineno"> 6453</span>&#160;      <span class="keywordflow">if</span>((event[hadron_idx].mother1() &lt; event[hadron_idx].mother2()) &amp;&amp; (event[hadron_idx].mother1() &gt; 0)</div>
<div class="line"><a name="l06454"></a><span class="lineno"> 6454</span>&#160;        &amp;&amp; (std::abs(event[hadron_idx].<a class="code" href="../../d6/d84/namespaceutils.html#ae872b751be761fb1b2f1fcfce89f3e58">status</a>()) &gt;= 81) &amp;&amp; (std::abs(event[hadron_idx].<a class="code" href="../../d6/d84/namespaceutils.html#ae872b751be761fb1b2f1fcfce89f3e58">status</a>()) &lt;= 86)){</div>
<div class="line"><a name="l06455"></a><span class="lineno"> 6455</span>&#160;                          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> hadron_parent = event[hadron_idx].mother1(); hadron_parent &lt;= <span class="keyword">event</span>[hadron_idx].mother2(); ++hadron_parent) {</div>
<div class="line"><a name="l06456"></a><span class="lineno"> 6456</span>&#160;          stack.push_back(hadron_parent);</div>
<div class="line"><a name="l06457"></a><span class="lineno"> 6457</span>&#160;        }</div>
<div class="line"><a name="l06458"></a><span class="lineno"> 6458</span>&#160;                        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>((event[hadron_idx].mother2() &gt; 0) &amp;&amp; (event[hadron_idx].mother1() != event[hadron_idx].mother2())) {</div>
<div class="line"><a name="l06459"></a><span class="lineno"> 6459</span>&#160;                          stack.push_back(event[hadron_idx].mother1());</div>
<div class="line"><a name="l06460"></a><span class="lineno"> 6460</span>&#160;        stack.push_back(event[hadron_idx].mother2());</div>
<div class="line"><a name="l06461"></a><span class="lineno"> 6461</span>&#160;                  }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(event[hadron_idx].mother1() &gt; 0) {</div>
<div class="line"><a name="l06462"></a><span class="lineno"> 6462</span>&#160;                          stack.push_back(event[hadron_idx].mother1());</div>
<div class="line"><a name="l06463"></a><span class="lineno"> 6463</span>&#160;                  }<span class="keywordflow">else</span>{mothers.push_back(hadron_idx);} <span class="comment">//setting it as its own mother if there are no mothers (pythia didn&#39;t decay a directly input hadron...)</span></div>
<div class="line"><a name="l06464"></a><span class="lineno"> 6464</span>&#160;</div>
<div class="line"><a name="l06465"></a><span class="lineno"> 6465</span>&#160;      <span class="comment">//filling the stack with any valid mothers of the &#39;current&#39; stack element</span></div>
<div class="line"><a name="l06466"></a><span class="lineno"> 6466</span>&#160;                        <span class="comment">//then we check the &#39;current&#39; stack element to see if it&#39;s a valid mother (0&lt;element&lt;=n_input), if so, we write it to mothers</span></div>
<div class="line"><a name="l06467"></a><span class="lineno"> 6467</span>&#160;                        <span class="keywordflow">while</span>(stack.size() &gt; 0){</div>
<div class="line"><a name="l06468"></a><span class="lineno"> 6468</span>&#160;                          <span class="keywordtype">int</span> current = stack.back();</div>
<div class="line"><a name="l06469"></a><span class="lineno"> 6469</span>&#160;        stack.pop_back();</div>
<div class="line"><a name="l06470"></a><span class="lineno"> 6470</span>&#160;                          <span class="keywordflow">if</span>((event[current].mother1() &lt; event[current].mother2()) &amp;&amp; (event[current].mother1() &gt; 0) &amp;&amp;</div>
<div class="line"><a name="l06471"></a><span class="lineno"> 6471</span>&#160;                            (std::abs(event[current].<a class="code" href="../../d6/d84/namespaceutils.html#ae872b751be761fb1b2f1fcfce89f3e58">status</a>()) &gt;= 81) &amp;&amp; (std::abs(event[current].<a class="code" href="../../d6/d84/namespaceutils.html#ae872b751be761fb1b2f1fcfce89f3e58">status</a>()) &lt;= 86)) {</div>
<div class="line"><a name="l06472"></a><span class="lineno"> 6472</span>&#160;                                  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> hadron_parent = event[current].mother1(); hadron_parent &lt;= <span class="keyword">event</span>[current].mother2(); ++hadron_parent) {</div>
<div class="line"><a name="l06473"></a><span class="lineno"> 6473</span>&#160;            stack.push_back(hadron_parent);</div>
<div class="line"><a name="l06474"></a><span class="lineno"> 6474</span>&#160;          }</div>
<div class="line"><a name="l06475"></a><span class="lineno"> 6475</span>&#160;                                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>((event[current].mother2() &gt; 0) &amp;&amp; (event[current].mother1() != event[current].mother2())) {</div>
<div class="line"><a name="l06476"></a><span class="lineno"> 6476</span>&#160;                                  stack.push_back(event[current].mother1());</div>
<div class="line"><a name="l06477"></a><span class="lineno"> 6477</span>&#160;          stack.push_back(event[current].mother2());</div>
<div class="line"><a name="l06478"></a><span class="lineno"> 6478</span>&#160;                                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(event[current].mother1() &gt; 0) {</div>
<div class="line"><a name="l06479"></a><span class="lineno"> 6479</span>&#160;                                        stack.push_back(event[current].mother1());</div>
<div class="line"><a name="l06480"></a><span class="lineno"> 6480</span>&#160;                                }</div>
<div class="line"><a name="l06481"></a><span class="lineno"> 6481</span>&#160;                          <span class="keywordflow">if</span>((current &gt; 0) &amp;&amp; (current &lt;= size_input)) {mothers.push_back(current);}</div>
<div class="line"><a name="l06482"></a><span class="lineno"> 6482</span>&#160;                        }</div>
<div class="line"><a name="l06483"></a><span class="lineno"> 6483</span>&#160;</div>
<div class="line"><a name="l06484"></a><span class="lineno"> 6484</span>&#160;      <span class="comment">//just in case...</span></div>
<div class="line"><a name="l06485"></a><span class="lineno"> 6485</span>&#160;                        <span class="keywordflow">if</span>(mothers.size() == 0) {mothers.push_back(hadron_idx);}</div>
<div class="line"><a name="l06486"></a><span class="lineno"> 6486</span>&#160;</div>
<div class="line"><a name="l06487"></a><span class="lineno"> 6487</span>&#160;      <span class="comment">//sorting and removing duplicate entries</span></div>
<div class="line"><a name="l06488"></a><span class="lineno"> 6488</span>&#160;                        <a class="code" href="../../d2/da5/namespaceActs_1_1Experimental_1_1detail_1_1BlueprintHelper.html#a308a6456db2655fc6a1a916696da20c8" title="Sort the nodes in the blueprint container node.">std::sort</a>(mothers.begin(), mothers.end());</div>
<div class="line"><a name="l06489"></a><span class="lineno"> 6489</span>&#160;      mothers.erase(std::unique(mothers.begin(), mothers.end()), mothers.end());</div>
<div class="line"><a name="l06490"></a><span class="lineno"> 6490</span>&#160;</div>
<div class="line"><a name="l06491"></a><span class="lineno"> 6491</span>&#160;      <span class="comment">//first, using mothers to determine if this hadron was formed via recombination, or by string fragmentation</span></div>
<div class="line"><a name="l06492"></a><span class="lineno"> 6492</span>&#160;                        <span class="keywordflow">if</span>(mothers[0] &lt;= HH_pyremn.num()){</div>
<div class="line"><a name="l06493"></a><span class="lineno"> 6493</span>&#160;        hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#aded647006df7a835521147beb06d81c1">is_strhad</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l06494"></a><span class="lineno"> 6494</span>&#160;      }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l06495"></a><span class="lineno"> 6495</span>&#160;        hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a27dd6d3a82b77f211b08aef3f4641664">is_recohad</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l06496"></a><span class="lineno"> 6496</span>&#160;      }</div>
<div class="line"><a name="l06497"></a><span class="lineno"> 6497</span>&#160;</div>
<div class="line"><a name="l06498"></a><span class="lineno"> 6498</span>&#160;      <span class="comment">//lastly, using mothers (except fake) in original input to determine if this is a shower-shower or shower-thermal hadron</span></div>
<div class="line"><a name="l06499"></a><span class="lineno"> 6499</span>&#160;                        <span class="keywordtype">bool</span> is_therm(<span class="keyword">false</span>);</div>
<div class="line"><a name="l06500"></a><span class="lineno"> 6500</span>&#160;                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> hadron_parent = 0; hadron_parent &lt; mothers.size(); ++hadron_parent) {</div>
<div class="line"><a name="l06501"></a><span class="lineno"> 6501</span>&#160;                          <span class="keywordflow">if</span>(mothers[hadron_parent] &lt;= HH_pyremn.num()) {</div>
<div class="line"><a name="l06502"></a><span class="lineno"> 6502</span>&#160;                                  <span class="keywordflow">if</span>(HH_pyremn[mothers[hadron_parent]-1].orig() != -1) {</div>
<div class="line"><a name="l06503"></a><span class="lineno"> 6503</span>&#160;            hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a471e031c8b1ed05e94a7ab075fdb4914">add_par</a>(mothers[hadron_parent]-1);</div>
<div class="line"><a name="l06504"></a><span class="lineno"> 6504</span>&#160;            <span class="keywordflow">if</span>(HH_pyremn[mothers[hadron_parent]-1].is_thermal()) {is_therm = <span class="keyword">true</span>;}</div>
<div class="line"><a name="l06505"></a><span class="lineno"> 6505</span>&#160;          }</div>
<div class="line"><a name="l06506"></a><span class="lineno"> 6506</span>&#160;                                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(mothers[hadron_parent] &lt; size_input){ <span class="comment">//shouldn&#39;t actually need to check, but doing so just in case.</span></div>
<div class="line"><a name="l06507"></a><span class="lineno"> 6507</span>&#160;                                        hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#adfb03eb77291b4757c037bbb6a9fceee">parh</a>(eve_to_had[mothers[hadron_parent]]-1);</div>
<div class="line"><a name="l06508"></a><span class="lineno"> 6508</span>&#160;          <span class="keywordflow">if</span>(HH_hadrons[hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#adfb03eb77291b4757c037bbb6a9fceee">parh</a>()].is_shth()) {is_therm = <span class="keyword">true</span>;}</div>
<div class="line"><a name="l06509"></a><span class="lineno"> 6509</span>&#160;                                }</div>
<div class="line"><a name="l06510"></a><span class="lineno"> 6510</span>&#160;                        }</div>
<div class="line"><a name="l06511"></a><span class="lineno"> 6511</span>&#160;                        <span class="keywordflow">if</span>(is_therm) {</div>
<div class="line"><a name="l06512"></a><span class="lineno"> 6512</span>&#160;        hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a6c7732b018f159825e653edad26d8774">is_shth</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l06513"></a><span class="lineno"> 6513</span>&#160;      }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l06514"></a><span class="lineno"> 6514</span>&#160;        hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#aa981caef15a8cd147cf647c694c697d8">is_shsh</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l06515"></a><span class="lineno"> 6515</span>&#160;      }</div>
<div class="line"><a name="l06516"></a><span class="lineno"> 6516</span>&#160;</div>
<div class="line"><a name="l06517"></a><span class="lineno"> 6517</span>&#160;      <span class="keywordflow">if</span>(is_recohadron &amp;&amp; recohadron_shsh){</div>
<div class="line"><a name="l06518"></a><span class="lineno"> 6518</span>&#160;        hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a27dd6d3a82b77f211b08aef3f4641664">is_recohad</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l06519"></a><span class="lineno"> 6519</span>&#160;        hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#aa981caef15a8cd147cf647c694c697d8">is_shsh</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l06520"></a><span class="lineno"> 6520</span>&#160;        hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a6c7732b018f159825e653edad26d8774">is_shth</a>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l06521"></a><span class="lineno"> 6521</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(is_recohadron &amp;&amp; !recohadron_shsh){</div>
<div class="line"><a name="l06522"></a><span class="lineno"> 6522</span>&#160;        hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a27dd6d3a82b77f211b08aef3f4641664">is_recohad</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l06523"></a><span class="lineno"> 6523</span>&#160;        hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#aa981caef15a8cd147cf647c694c697d8">is_shsh</a>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l06524"></a><span class="lineno"> 6524</span>&#160;        hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a6c7732b018f159825e653edad26d8774">is_shth</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l06525"></a><span class="lineno"> 6525</span>&#160;      }</div>
<div class="line"><a name="l06526"></a><span class="lineno"> 6526</span>&#160;</div>
<div class="line"><a name="l06527"></a><span class="lineno"> 6527</span>&#160;      <span class="keywordtype">int</span> hadron_col = <span class="keyword">event</span>[hadron_idx].col();</div>
<div class="line"><a name="l06528"></a><span class="lineno"> 6528</span>&#160;      <span class="keywordtype">int</span> hadron_acol = <span class="keyword">event</span>[hadron_idx].acol();</div>
<div class="line"><a name="l06529"></a><span class="lineno"> 6529</span>&#160;      <span class="keywordtype">bool</span> info_found = <span class="keyword">false</span>; <span class="keywordtype">bool</span> col_known = <span class="keyword">false</span>; <span class="keywordtype">bool</span> acol_known = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06530"></a><span class="lineno"> 6530</span>&#160;</div>
<div class="line"><a name="l06531"></a><span class="lineno"> 6531</span>&#160;      <span class="comment">//3 main cases: col!=acol, col==acol!=0, col==acol==0</span></div>
<div class="line"><a name="l06532"></a><span class="lineno"> 6532</span>&#160;      <span class="keywordflow">if</span>(hadron_col != hadron_acol) { <span class="comment">//col!=acol -&gt; this hadron should trace back to a single gluon; find it and grab its spacetime info</span></div>
<div class="line"><a name="l06533"></a><span class="lineno"> 6533</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irem = 0; irem &lt; HH_pyremn.num(); ++irem) {</div>
<div class="line"><a name="l06534"></a><span class="lineno"> 6534</span>&#160;                                        <span class="keywordflow">if</span>(((HH_pyremn[irem].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == hadron_col) &amp;&amp; (HH_pyremn[irem].acol() == hadron_acol))</div>
<div class="line"><a name="l06535"></a><span class="lineno"> 6535</span>&#160;            || ((HH_pyremn[irem].col() == hadron_acol) &amp;&amp; (HH_pyremn[irem].acol() == hadron_col))) {<span class="comment">//alter for glu loops</span></div>
<div class="line"><a name="l06536"></a><span class="lineno"> 6536</span>&#160;                                                <span class="keywordflow">if</span>(HH_pyremn[irem].PY_stat()&lt;=0) {<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l06537"></a><span class="lineno"> 6537</span>&#160;                                                hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ad237f03867b0deac0f3a803ae65a2c21">x</a>(HH_pyremn[irem].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>());</div>
<div class="line"><a name="l06538"></a><span class="lineno"> 6538</span>&#160;            hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ae61e425ad622bfadcd6f769b310ed755">y</a>(HH_pyremn[irem].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>());</div>
<div class="line"><a name="l06539"></a><span class="lineno"> 6539</span>&#160;            hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a2582756531f04746fa90d875fa07068a">z</a>(HH_pyremn[irem].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>());</div>
<div class="line"><a name="l06540"></a><span class="lineno"> 6540</span>&#160;            hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ad0a9084d8569e7d32b3d34ccf82a7e6a">x_t</a>(HH_pyremn[irem].x_t());</div>
<div class="line"><a name="l06541"></a><span class="lineno"> 6541</span>&#160;                                                info_found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06542"></a><span class="lineno"> 6542</span>&#160;                                        }</div>
<div class="line"><a name="l06543"></a><span class="lineno"> 6543</span>&#160;                                }</div>
<div class="line"><a name="l06544"></a><span class="lineno"> 6544</span>&#160;        <span class="keywordflow">if</span>(!info_found) {</div>
<div class="line"><a name="l06545"></a><span class="lineno"> 6545</span>&#160;          <span class="comment">//this is bad; could either be a hadron from *multiple* segments, or still from a single gluon under color reconnections - OR BOTH!</span></div>
<div class="line"><a name="l06546"></a><span class="lineno"> 6546</span>&#160;                                  <span class="comment">//this is a first-order handling to find all the intermediate partons using the input partons -</span></div>
<div class="line"><a name="l06547"></a><span class="lineno"> 6547</span>&#160;                                        <span class="comment">//it really should be done using pythia&#39;s history, but should suffice for most cases, for now...</span></div>
<div class="line"><a name="l06548"></a><span class="lineno"> 6548</span>&#160;                                        <span class="comment">//will apply Dijkstra to the partons in the current string to find the shortest path from hadron_col to hadron_acol</span></div>
<div class="line"><a name="l06549"></a><span class="lineno"> 6549</span>&#160;</div>
<div class="line"><a name="l06550"></a><span class="lineno"> 6550</span>&#160;          <span class="comment">//start by finding the partons with the col/acol tags</span></div>
<div class="line"><a name="l06551"></a><span class="lineno"> 6551</span>&#160;                                        <span class="keywordtype">int</span> ptn1 = -1; <span class="keywordtype">int</span> ptn2 = -1;</div>
<div class="line"><a name="l06552"></a><span class="lineno"> 6552</span>&#160;                                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irem = 0; irem &lt; HH_pyremn.num(); ++irem) {</div>
<div class="line"><a name="l06553"></a><span class="lineno"> 6553</span>&#160;                                                <span class="keywordflow">if</span>((HH_pyremn[irem].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == hadron_col) &amp;&amp; (HH_pyremn[irem].PY_stat() &gt; 0)) {ptn1 = irem;}</div>
<div class="line"><a name="l06554"></a><span class="lineno"> 6554</span>&#160;                                                <span class="keywordflow">if</span>((HH_pyremn[irem].acol() == hadron_acol) &amp;&amp; (HH_pyremn[irem].PY_stat() &gt; 0)) {ptn2 = irem;}</div>
<div class="line"><a name="l06555"></a><span class="lineno"> 6555</span>&#160;                                                <span class="keywordflow">if</span>((ptn1 &gt;= 0) &amp;&amp; (ptn2 &gt;= 0)){<span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l06556"></a><span class="lineno"> 6556</span>&#160;                                        }</div>
<div class="line"><a name="l06557"></a><span class="lineno"> 6557</span>&#160;</div>
<div class="line"><a name="l06558"></a><span class="lineno"> 6558</span>&#160;          <span class="comment">//if ptn1 or ptn2 &lt; 0, then we&#39;re giving up on this hadron (needs pythia history to properly reconstruct the mother parton(s))</span></div>
<div class="line"><a name="l06559"></a><span class="lineno"> 6559</span>&#160;                                        <span class="comment">//otherwise, we&#39;ll trace along the string from one parton end to the other (using Dijkstra) to find all mother partons</span></div>
<div class="line"><a name="l06560"></a><span class="lineno"> 6560</span>&#160;                                        <span class="keywordflow">if</span>((ptn1 &gt;= 0) &amp;&amp; (ptn2 &gt;= 0)){</div>
<div class="line"><a name="l06561"></a><span class="lineno"> 6561</span>&#160;                                                <span class="comment">//for 0th order approx, we&#39;ll just average the positions of the known parton ends</span></div>
<div class="line"><a name="l06562"></a><span class="lineno"> 6562</span>&#160;                                                <span class="keywordtype">double</span> pos_x, pos_y, pos_z, pos_t; pos_x = 0.; pos_y = 0.; pos_z = 0.; pos_t = 0.;</div>
<div class="line"><a name="l06563"></a><span class="lineno"> 6563</span>&#160;                                                pos_x += HH_pyremn[ptn1].x(); pos_y += HH_pyremn[ptn1].y(); pos_z += HH_pyremn[ptn1].z(); pos_t += HH_pyremn[ptn1].x_t();</div>
<div class="line"><a name="l06564"></a><span class="lineno"> 6564</span>&#160;                                                pos_x += HH_pyremn[ptn2].x(); pos_y += HH_pyremn[ptn2].y(); pos_z += HH_pyremn[ptn2].z(); pos_t += HH_pyremn[ptn2].x_t();</div>
<div class="line"><a name="l06565"></a><span class="lineno"> 6565</span>&#160;                                                pos_x /= 2.; pos_y /= 2.; pos_z /= 2.; pos_t /= 2.;</div>
<div class="line"><a name="l06566"></a><span class="lineno"> 6566</span>&#160;                                                hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ad237f03867b0deac0f3a803ae65a2c21">x</a>(pos_x); hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ae61e425ad622bfadcd6f769b310ed755">y</a>(pos_y); hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a2582756531f04746fa90d875fa07068a">z</a>(pos_z); hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ad0a9084d8569e7d32b3d34ccf82a7e6a">x_t</a>(pos_t);</div>
<div class="line"><a name="l06567"></a><span class="lineno"> 6567</span>&#160;                                                info_found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06568"></a><span class="lineno"> 6568</span>&#160;            Case1_hadron_idx.push_back(hadron_idx);</div>
<div class="line"><a name="l06569"></a><span class="lineno"> 6569</span>&#160;            Case1_parton1_idx.push_back(ptn1);</div>
<div class="line"><a name="l06570"></a><span class="lineno"> 6570</span>&#160;            Case1_parton2_idx.push_back(ptn2);</div>
<div class="line"><a name="l06571"></a><span class="lineno"> 6571</span>&#160;                                        }</div>
<div class="line"><a name="l06572"></a><span class="lineno"> 6572</span>&#160;        }</div>
<div class="line"><a name="l06573"></a><span class="lineno"> 6573</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>((hadron_col == hadron_acol) &amp;&amp; (hadron_col != 0)) { <span class="comment">//col==acol -&gt; this hadron traces back to a string segment; find the two partons and interpolate position</span></div>
<div class="line"><a name="l06574"></a><span class="lineno"> 6574</span>&#160;        <span class="comment">//there are 2 cases here - an easy case where the color tags match the original partons, and a hard case where we need to trace history</span></div>
<div class="line"><a name="l06575"></a><span class="lineno"> 6575</span>&#160;                                <span class="keywordtype">int</span> ptn1 = 0; <span class="keywordtype">int</span> ptn2 = 0; <span class="keywordtype">int</span> ptn3 = 0;</div>
<div class="line"><a name="l06576"></a><span class="lineno"> 6576</span>&#160;        <span class="keywordtype">bool</span> col_found = <span class="keyword">false</span>; <span class="keywordtype">bool</span> acol_found = <span class="keyword">false</span>; <span class="keywordtype">bool</span> ptn3_found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06577"></a><span class="lineno"> 6577</span>&#160;                                <span class="keywordflow">while</span>(ptn1 &lt; HH_pyremn.num()) {<span class="keywordflow">if</span>((HH_pyremn[ptn1].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == hadron_col) &amp;&amp; (HH_pyremn[ptn1].PY_stat() &gt; 0)) {col_found =<span class="keyword">true</span>; <span class="keywordflow">break</span>;} ++ptn1;}</div>
<div class="line"><a name="l06578"></a><span class="lineno"> 6578</span>&#160;                                <span class="keywordflow">while</span>(ptn2 &lt; HH_pyremn.num()) {<span class="keywordflow">if</span>((HH_pyremn[ptn2].acol() == hadron_acol)&amp;&amp; (HH_pyremn[ptn2].PY_stat() &gt; 0)) {acol_found=<span class="keyword">true</span>; <span class="keywordflow">break</span>;} ++ptn2;}</div>
<div class="line"><a name="l06579"></a><span class="lineno"> 6579</span>&#160;</div>
<div class="line"><a name="l06580"></a><span class="lineno"> 6580</span>&#160;                                col_known = col_found; acol_known = acol_found;</div>
<div class="line"><a name="l06581"></a><span class="lineno"> 6581</span>&#160;        <span class="comment">//if we don&#39;t find color/anticolor tags in input partons, we&#39;ll need to trace along pythia event/history to find either/both</span></div>
<div class="line"><a name="l06582"></a><span class="lineno"> 6582</span>&#160;                                <span class="comment">//we can grab what pythia claims are the mothers, then search that for the color tag, which should return ONE candidate</span></div>
<div class="line"><a name="l06583"></a><span class="lineno"> 6583</span>&#160;                                <span class="comment">//repeat this until event_i &lt;= HH_pyremn.num() - this will be our input</span></div>
<div class="line"><a name="l06584"></a><span class="lineno"> 6584</span>&#160;                                <span class="comment">//would it be better to start at the beginning, grab everything that doesn&#39;t have a terminal color tag in a hadron, and trace those to respective hadron(s)?</span></div>
<div class="line"><a name="l06585"></a><span class="lineno"> 6585</span>&#160;</div>
<div class="line"><a name="l06586"></a><span class="lineno"> 6586</span>&#160;        <span class="comment">//since these *only* should happen in junction systems at the junction, use the junction list to find the other 2 color tags, then find those in orig. ptns!</span></div>
<div class="line"><a name="l06587"></a><span class="lineno"> 6587</span>&#160;                                <span class="keywordflow">if</span>(!col_found){</div>
<div class="line"><a name="l06588"></a><span class="lineno"> 6588</span>&#160;                                        <span class="comment">//find the junction with matching color, grab the other 2</span></div>
<div class="line"><a name="l06589"></a><span class="lineno"> 6589</span>&#160;                                        <span class="keywordtype">int</span> coll[2] = {0,0};</div>
<div class="line"><a name="l06590"></a><span class="lineno"> 6590</span>&#160;                                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iJ = 0; iJ &lt; pythia.event.sizeJunction(); ++iJ) {</div>
<div class="line"><a name="l06591"></a><span class="lineno"> 6591</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iC = 0; iC &lt; 3; ++iC) {</div>
<div class="line"><a name="l06592"></a><span class="lineno"> 6592</span>&#160;                                                  <span class="keywordflow">if</span>(pythia.event.colJunction(iJ,iC) == hadron_col) {</div>
<div class="line"><a name="l06593"></a><span class="lineno"> 6593</span>&#160;                                                    <span class="keywordflow">if</span>(iC == 0) {coll[0] = pythia.event.colJunction(iJ,1); coll[1] = pythia.event.colJunction(iJ,2);}</div>
<div class="line"><a name="l06594"></a><span class="lineno"> 6594</span>&#160;                                                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iC == 1) {coll[0] = pythia.event.colJunction(iJ,0); coll[1] = pythia.event.colJunction(iJ,2);}</div>
<div class="line"><a name="l06595"></a><span class="lineno"> 6595</span>&#160;                                                    <span class="keywordflow">else</span>{coll[0] = pythia.event.colJunction(iJ,0); coll[1] = pythia.event.colJunction(iJ,1);}</div>
<div class="line"><a name="l06596"></a><span class="lineno"> 6596</span>&#160;                                                    col_found=<span class="keyword">true</span>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06597"></a><span class="lineno"> 6597</span>&#160;                                            }</div>
<div class="line"><a name="l06598"></a><span class="lineno"> 6598</span>&#160;                                    }</div>
<div class="line"><a name="l06599"></a><span class="lineno"> 6599</span>&#160;            <span class="keywordflow">if</span>(col_found) {<span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l06600"></a><span class="lineno"> 6600</span>&#160;          }</div>
<div class="line"><a name="l06601"></a><span class="lineno"> 6601</span>&#160;          <span class="comment">//since pythia refuses to keep track of initial junctions given to it, we&#39;ll do it manually</span></div>
<div class="line"><a name="l06602"></a><span class="lineno"> 6602</span>&#160;                                        <span class="keywordflow">if</span>(!col_found) {</div>
<div class="line"><a name="l06603"></a><span class="lineno"> 6603</span>&#160;                                                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irem = 0; irem &lt; HH_pyremn.num(); ++irem) {</div>
<div class="line"><a name="l06604"></a><span class="lineno"> 6604</span>&#160;              <span class="keywordflow">if</span>(std::abs(HH_pyremn[irem].<span class="keywordtype">id</span>()) &gt; 1112) {</div>
<div class="line"><a name="l06605"></a><span class="lineno"> 6605</span>&#160;                                                          <span class="keywordflow">if</span>(     HH_pyremn[irem].PY_tag1() == hadron_col) {coll[0] = HH_pyremn[irem].PY_tag2(); coll[1] = HH_pyremn[irem].PY_tag3(); col_found = <span class="keyword">true</span>; <span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l06606"></a><span class="lineno"> 6606</span>&#160;                                                          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(HH_pyremn[irem].PY_tag2() == hadron_col) {coll[0] = HH_pyremn[irem].PY_tag1(); coll[1] = HH_pyremn[irem].PY_tag3(); col_found = <span class="keyword">true</span>; <span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l06607"></a><span class="lineno"> 6607</span>&#160;                                                          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(HH_pyremn[irem].PY_tag3() == hadron_col) {coll[0] = HH_pyremn[irem].PY_tag1(); coll[1] = HH_pyremn[irem].PY_tag2(); col_found = <span class="keyword">true</span>; <span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l06608"></a><span class="lineno"> 6608</span>&#160;                                                  }</div>
<div class="line"><a name="l06609"></a><span class="lineno"> 6609</span>&#160;            }</div>
<div class="line"><a name="l06610"></a><span class="lineno"> 6610</span>&#160;                                        }</div>
<div class="line"><a name="l06611"></a><span class="lineno"> 6611</span>&#160;                                        <span class="comment">//now we know the color tags needed, we look for them.</span></div>
<div class="line"><a name="l06612"></a><span class="lineno"> 6612</span>&#160;                                        <span class="keywordflow">if</span>(col_found) {</div>
<div class="line"><a name="l06613"></a><span class="lineno"> 6613</span>&#160;                                                <span class="keywordtype">bool</span> found_tags[2] = {0,0}; ptn1 = 0;</div>
<div class="line"><a name="l06614"></a><span class="lineno"> 6614</span>&#160;                                                <span class="keywordflow">while</span>(ptn1&lt;HH_pyremn.num()) {<span class="keywordflow">if</span>((HH_pyremn[ptn1].acol() == coll[0]) &amp;&amp; (HH_pyremn[ptn1].PY_stat() &gt; 0)) {found_tags[0] = <span class="keyword">true</span>; <span class="keywordflow">break</span>;} ++ptn1;}</div>
<div class="line"><a name="l06615"></a><span class="lineno"> 6615</span>&#160;                                                <span class="keywordflow">while</span>(ptn3&lt;HH_pyremn.num()) {<span class="keywordflow">if</span>((HH_pyremn[ptn3].acol() == coll[1]) &amp;&amp; (HH_pyremn[ptn2].PY_stat() &gt; 0)) {found_tags[1] = <span class="keyword">true</span>; <span class="keywordflow">break</span>;} ++ptn3;}</div>
<div class="line"><a name="l06616"></a><span class="lineno"> 6616</span>&#160;                                                <span class="keywordflow">if</span>(found_tags[0] &amp;&amp; found_tags[1]) {ptn3_found = <span class="keyword">true</span>;}</div>
<div class="line"><a name="l06617"></a><span class="lineno"> 6617</span>&#160;                                        }</div>
<div class="line"><a name="l06618"></a><span class="lineno"> 6618</span>&#160;                                }</div>
<div class="line"><a name="l06619"></a><span class="lineno"> 6619</span>&#160;        <span class="keywordflow">if</span>(!acol_found) {</div>
<div class="line"><a name="l06620"></a><span class="lineno"> 6620</span>&#160;                                        <span class="comment">//check to see if there&#39;s already 3 partons - if so, then we need a warning/error!</span></div>
<div class="line"><a name="l06621"></a><span class="lineno"> 6621</span>&#160;                                        <span class="keywordflow">if</span>(ptn3_found) {<a class="code" href="../../d4/d14/JetScapeLogger_8h.html#aadd09578a18ed67cd9a08832e2246066">JSWARN</a> &lt;&lt; <span class="stringliteral">&quot;A hadron was found with more than 3 partonic parents for space-time info!&quot;</span>;}</div>
<div class="line"><a name="l06622"></a><span class="lineno"> 6622</span>&#160;                                        <span class="comment">//otherwise, works just like above...</span></div>
<div class="line"><a name="l06623"></a><span class="lineno"> 6623</span>&#160;                                        <span class="keywordtype">int</span> coll[2] = {0,0};</div>
<div class="line"><a name="l06624"></a><span class="lineno"> 6624</span>&#160;                                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iJ = 0; iJ &lt; pythia.event.sizeJunction(); ++iJ) {</div>
<div class="line"><a name="l06625"></a><span class="lineno"> 6625</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iC = 0; iC &lt; 3; ++iC) {</div>
<div class="line"><a name="l06626"></a><span class="lineno"> 6626</span>&#160;                                                  <span class="keywordflow">if</span>(pythia.event.colJunction(iJ,iC) == hadron_acol) {</div>
<div class="line"><a name="l06627"></a><span class="lineno"> 6627</span>&#160;                                                          <span class="keywordflow">if</span>(iC == 0) {coll[0] = pythia.event.colJunction(iJ,1); coll[1] = pythia.event.colJunction(iJ,2);}</div>
<div class="line"><a name="l06628"></a><span class="lineno"> 6628</span>&#160;                                                          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iC == 1) {coll[0] = pythia.event.colJunction(iJ,0); coll[1] = pythia.event.colJunction(iJ,2);}</div>
<div class="line"><a name="l06629"></a><span class="lineno"> 6629</span>&#160;                                                          <span class="keywordflow">else</span>{coll[0] = pythia.event.colJunction(iJ,0); coll[1] = pythia.event.colJunction(iJ,1);}</div>
<div class="line"><a name="l06630"></a><span class="lineno"> 6630</span>&#160;                                                          acol_found = <span class="keyword">true</span>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06631"></a><span class="lineno"> 6631</span>&#160;                                                  }</div>
<div class="line"><a name="l06632"></a><span class="lineno"> 6632</span>&#160;                                          }</div>
<div class="line"><a name="l06633"></a><span class="lineno"> 6633</span>&#160;            <span class="keywordflow">if</span>(acol_found) {<span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l06634"></a><span class="lineno"> 6634</span>&#160;          }</div>
<div class="line"><a name="l06635"></a><span class="lineno"> 6635</span>&#160;                                        <span class="comment">//since pythia refuses to keep track of initial junctions given to it, we&#39;ll do it manually</span></div>
<div class="line"><a name="l06636"></a><span class="lineno"> 6636</span>&#160;                                        <span class="keywordflow">if</span>(!acol_found) {</div>
<div class="line"><a name="l06637"></a><span class="lineno"> 6637</span>&#160;                                                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> irem = 0; irem &lt; HH_pyremn.num(); ++irem) {</div>
<div class="line"><a name="l06638"></a><span class="lineno"> 6638</span>&#160;              <span class="keywordflow">if</span>(std::abs(HH_pyremn[irem].<span class="keywordtype">id</span>()) &gt; 1112) {</div>
<div class="line"><a name="l06639"></a><span class="lineno"> 6639</span>&#160;                                                          <span class="keywordflow">if</span>(     HH_pyremn[irem].PY_tag1() == hadron_col) {coll[0] = HH_pyremn[irem].PY_tag2(); coll[1] = HH_pyremn[irem].PY_tag3(); acol_found = <span class="keyword">true</span>; <span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l06640"></a><span class="lineno"> 6640</span>&#160;                                                          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(HH_pyremn[irem].PY_tag2() == hadron_col) {coll[0] = HH_pyremn[irem].PY_tag1(); coll[1] = HH_pyremn[irem].PY_tag3(); acol_found = <span class="keyword">true</span>; <span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l06641"></a><span class="lineno"> 6641</span>&#160;                                                          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(HH_pyremn[irem].PY_tag3() == hadron_col) {coll[0] = HH_pyremn[irem].PY_tag1(); coll[1] = HH_pyremn[irem].PY_tag2(); acol_found = <span class="keyword">true</span>; <span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l06642"></a><span class="lineno"> 6642</span>&#160;                                                  }</div>
<div class="line"><a name="l06643"></a><span class="lineno"> 6643</span>&#160;            }</div>
<div class="line"><a name="l06644"></a><span class="lineno"> 6644</span>&#160;                                        }</div>
<div class="line"><a name="l06645"></a><span class="lineno"> 6645</span>&#160;                                        <span class="comment">//now we know the anti-color tags needed, we look for them.</span></div>
<div class="line"><a name="l06646"></a><span class="lineno"> 6646</span>&#160;                                        <span class="keywordflow">if</span>(acol_found){</div>
<div class="line"><a name="l06647"></a><span class="lineno"> 6647</span>&#160;                                                <span class="keywordtype">bool</span> found_tags[2] = {0,0}; ptn2 = 0;</div>
<div class="line"><a name="l06648"></a><span class="lineno"> 6648</span>&#160;                                                <span class="keywordflow">while</span>(ptn2&lt;HH_pyremn.num()){<span class="keywordflow">if</span>((HH_pyremn[ptn2].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>()==coll[0]) &amp;&amp; (HH_pyremn[ptn1].PY_stat()&gt;0)){found_tags[0]=<span class="keyword">true</span>; <span class="keywordflow">break</span>;} ++ptn2;}</div>
<div class="line"><a name="l06649"></a><span class="lineno"> 6649</span>&#160;                                                <span class="keywordflow">while</span>(ptn3&lt;HH_pyremn.num()){<span class="keywordflow">if</span>((HH_pyremn[ptn3].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>()==coll[1]) &amp;&amp; (HH_pyremn[ptn2].PY_stat()&gt;0)){found_tags[1]=<span class="keyword">true</span>; <span class="keywordflow">break</span>;} ++ptn3;}</div>
<div class="line"><a name="l06650"></a><span class="lineno"> 6650</span>&#160;                                                <span class="keywordflow">if</span>(found_tags[0] &amp;&amp; found_tags[1]){ptn3_found=<span class="keyword">true</span>;}</div>
<div class="line"><a name="l06651"></a><span class="lineno"> 6651</span>&#160;                                        }</div>
<div class="line"><a name="l06652"></a><span class="lineno"> 6652</span>&#160;                                }</div>
<div class="line"><a name="l06653"></a><span class="lineno"> 6653</span>&#160;</div>
<div class="line"><a name="l06654"></a><span class="lineno"> 6654</span>&#160;        col_known = col_found; acol_known = acol_found;</div>
<div class="line"><a name="l06655"></a><span class="lineno"> 6655</span>&#160;                                <span class="comment">//turning off warning iff things work</span></div>
<div class="line"><a name="l06656"></a><span class="lineno"> 6656</span>&#160;                                <span class="keywordflow">if</span>(col_found &amp;&amp; acol_found) {info_found = <span class="keyword">true</span>;}</div>
<div class="line"><a name="l06657"></a><span class="lineno"> 6657</span>&#160;</div>
<div class="line"><a name="l06658"></a><span class="lineno"> 6658</span>&#160;        <span class="comment">//setting position from found partons</span></div>
<div class="line"><a name="l06659"></a><span class="lineno"> 6659</span>&#160;                                <span class="keywordtype">double</span> pos_x, pos_y, pos_z, pos_t; pos_x=0.; pos_y=0.; pos_z=0.; pos_t=0.;</div>
<div class="line"><a name="l06660"></a><span class="lineno"> 6660</span>&#160;                                pos_x += HH_pyremn[ptn1].x(); pos_y += HH_pyremn[ptn1].y(); pos_z += HH_pyremn[ptn1].z(); pos_t += HH_pyremn[ptn1].x_t();</div>
<div class="line"><a name="l06661"></a><span class="lineno"> 6661</span>&#160;                                pos_x += HH_pyremn[ptn2].x(); pos_y += HH_pyremn[ptn2].y(); pos_z += HH_pyremn[ptn2].z(); pos_t += HH_pyremn[ptn2].x_t();</div>
<div class="line"><a name="l06662"></a><span class="lineno"> 6662</span>&#160;        Case2_hadron_idx.push_back(hadron_idx);</div>
<div class="line"><a name="l06663"></a><span class="lineno"> 6663</span>&#160;        Case2_parton1_idx.push_back(ptn1);</div>
<div class="line"><a name="l06664"></a><span class="lineno"> 6664</span>&#160;        Case2_parton2_idx.push_back(ptn2);</div>
<div class="line"><a name="l06665"></a><span class="lineno"> 6665</span>&#160;                                <span class="keywordflow">if</span>(ptn3_found){</div>
<div class="line"><a name="l06666"></a><span class="lineno"> 6666</span>&#160;                                        pos_x += HH_pyremn[ptn3].x(); pos_y += HH_pyremn[ptn3].y(); pos_z += HH_pyremn[ptn3].z(); pos_t += HH_pyremn[ptn3].x_t();</div>
<div class="line"><a name="l06667"></a><span class="lineno"> 6667</span>&#160;                                        pos_x /= 3.; pos_y /= 3.; pos_z /= 3.; pos_t /= 3.;</div>
<div class="line"><a name="l06668"></a><span class="lineno"> 6668</span>&#160;          Case2_parton3_idx.push_back(ptn3);</div>
<div class="line"><a name="l06669"></a><span class="lineno"> 6669</span>&#160;          Case2_junction_center = {pos_t,pos_x,pos_y,pos_z};</div>
<div class="line"><a name="l06670"></a><span class="lineno"> 6670</span>&#160;                                }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l06671"></a><span class="lineno"> 6671</span>&#160;          pos_x /= 2.; pos_y /= 2.; pos_z /= 2.; pos_t /= 2.;</div>
<div class="line"><a name="l06672"></a><span class="lineno"> 6672</span>&#160;          Case2_parton3_idx.push_back(-1);</div>
<div class="line"><a name="l06673"></a><span class="lineno"> 6673</span>&#160;        }</div>
<div class="line"><a name="l06674"></a><span class="lineno"> 6674</span>&#160;                                hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ad237f03867b0deac0f3a803ae65a2c21">x</a>(pos_x); hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ae61e425ad622bfadcd6f769b310ed755">y</a>(pos_y); hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a2582756531f04746fa90d875fa07068a">z</a>(pos_z); hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ad0a9084d8569e7d32b3d34ccf82a7e6a">x_t</a>(pos_t);</div>
<div class="line"><a name="l06675"></a><span class="lineno"> 6675</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>((hadron_col == hadron_acol) &amp;&amp; (hadron_col == 0)) { <span class="comment">//col==acol==0 -&gt; same as previous, but pythia didn&#39;t give color tag since this was from a short string q-qbar</span></div>
<div class="line"><a name="l06676"></a><span class="lineno"> 6676</span>&#160;        <span class="keywordtype">double</span> avg_x, avg_y, avg_z, avg_t; avg_x=0.; avg_y=0.; avg_z=0.; avg_t=0.;</div>
<div class="line"><a name="l06677"></a><span class="lineno"> 6677</span>&#160;                                <span class="keywordtype">int</span> n_ptns = 0; <span class="comment">//should come out to 2 in the end, but keeping track just in case.</span></div>
<div class="line"><a name="l06678"></a><span class="lineno"> 6678</span>&#160;        <span class="keywordtype">bool</span> found_first_q_or_qbar = <span class="keyword">false</span>; <span class="keywordtype">bool</span> found_second_q_or_qbar = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06679"></a><span class="lineno"> 6679</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> imot = 0; imot &lt; mothers.size(); ++imot) {</div>
<div class="line"><a name="l06680"></a><span class="lineno"> 6680</span>&#160;          <span class="keywordflow">if</span>(mothers[imot] &lt;= HH_pyremn.num()) {</div>
<div class="line"><a name="l06681"></a><span class="lineno"> 6681</span>&#160;            info_found = <span class="keyword">true</span>; <span class="comment">//if no mothers, then no position, and throw error!</span></div>
<div class="line"><a name="l06682"></a><span class="lineno"> 6682</span>&#160;                                          avg_x += HH_pyremn[mothers[imot]-1].x(); avg_y += HH_pyremn[mothers[imot]-1].y(); avg_z += HH_pyremn[mothers[imot]-1].z(); avg_t += HH_pyremn[mothers[imot]-1].x_t();</div>
<div class="line"><a name="l06683"></a><span class="lineno"> 6683</span>&#160;                                          ++n_ptns;</div>
<div class="line"><a name="l06684"></a><span class="lineno"> 6684</span>&#160;            <span class="keywordflow">if</span>(std::abs(HH_pyremn[mothers[imot]-1].<span class="keywordtype">id</span>()) &lt; 7 &amp;&amp; !found_first_q_or_qbar) {</div>
<div class="line"><a name="l06685"></a><span class="lineno"> 6685</span>&#160;              Case3_parton1_idx.push_back(mothers[imot]-1);</div>
<div class="line"><a name="l06686"></a><span class="lineno"> 6686</span>&#160;              found_first_q_or_qbar = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06687"></a><span class="lineno"> 6687</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_pyremn[mothers[imot]-1].<span class="keywordtype">id</span>()) &lt; 7 &amp;&amp; !found_second_q_or_qbar &amp;&amp; found_first_q_or_qbar) {</div>
<div class="line"><a name="l06688"></a><span class="lineno"> 6688</span>&#160;              Case3_parton2_idx.push_back(mothers[imot]-1);</div>
<div class="line"><a name="l06689"></a><span class="lineno"> 6689</span>&#160;              found_second_q_or_qbar = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06690"></a><span class="lineno"> 6690</span>&#160;            }</div>
<div class="line"><a name="l06691"></a><span class="lineno"> 6691</span>&#160;                                  }</div>
<div class="line"><a name="l06692"></a><span class="lineno"> 6692</span>&#160;        }</div>
<div class="line"><a name="l06693"></a><span class="lineno"> 6693</span>&#160;        <span class="keywordflow">if</span>(found_first_q_or_qbar &amp;&amp; found_second_q_or_qbar) {</div>
<div class="line"><a name="l06694"></a><span class="lineno"> 6694</span>&#160;          Case3_hadron_idx.push_back(hadron_idx);</div>
<div class="line"><a name="l06695"></a><span class="lineno"> 6695</span>&#160;        }</div>
<div class="line"><a name="l06696"></a><span class="lineno"> 6696</span>&#160;        <span class="keywordflow">if</span>(found_first_q_or_qbar &amp;&amp; !found_second_q_or_qbar) {</div>
<div class="line"><a name="l06697"></a><span class="lineno"> 6697</span>&#160;          Case3_parton1_idx.pop_back();</div>
<div class="line"><a name="l06698"></a><span class="lineno"> 6698</span>&#160;        }</div>
<div class="line"><a name="l06699"></a><span class="lineno"> 6699</span>&#160;                                <span class="keywordflow">if</span>(n_ptns &gt; 0) {</div>
<div class="line"><a name="l06700"></a><span class="lineno"> 6700</span>&#160;          avg_x /= <a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(n_ptns); avg_y /= <a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(n_ptns); avg_z /= <a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(n_ptns); avg_t /= <a class="code" href="../../da/d55/TPCRateLayered_8m.html#ac40e4ec8f2a74a2878f06670249eebb8">double</a>(n_ptns);</div>
<div class="line"><a name="l06701"></a><span class="lineno"> 6701</span>&#160;          Case3_partons_center = {avg_t,avg_x,avg_y,avg_z};</div>
<div class="line"><a name="l06702"></a><span class="lineno"> 6702</span>&#160;        }</div>
<div class="line"><a name="l06703"></a><span class="lineno"> 6703</span>&#160;                                hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ad237f03867b0deac0f3a803ae65a2c21">x</a>(avg_x); hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ae61e425ad622bfadcd6f769b310ed755">y</a>(avg_y); hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a2582756531f04746fa90d875fa07068a">z</a>(avg_z); hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ad0a9084d8569e7d32b3d34ccf82a7e6a">x_t</a>(avg_t);</div>
<div class="line"><a name="l06704"></a><span class="lineno"> 6704</span>&#160;      }</div>
<div class="line"><a name="l06705"></a><span class="lineno"> 6705</span>&#160;      <span class="keywordflow">if</span>(!info_found) {</div>
<div class="line"><a name="l06706"></a><span class="lineno"> 6706</span>&#160;        compute_more_precise_positions = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06707"></a><span class="lineno"> 6707</span>&#160;        warn_could_not_find_positions = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06708"></a><span class="lineno"> 6708</span>&#160;                          hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ad237f03867b0deac0f3a803ae65a2c21">x</a>(0.); hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ae61e425ad622bfadcd6f769b310ed755">y</a>(0.); hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#a2582756531f04746fa90d875fa07068a">z</a>(0.); hadron_out.<a class="code" href="../../dc/d72/classHybridHadronization_1_1HHhadron.html#ad0a9084d8569e7d32b3d34ccf82a7e6a">x_t</a>(0.);</div>
<div class="line"><a name="l06709"></a><span class="lineno"> 6709</span>&#160;      }</div>
<div class="line"><a name="l06710"></a><span class="lineno"> 6710</span>&#160;</div>
<div class="line"><a name="l06711"></a><span class="lineno"> 6711</span>&#160;                <span class="comment">//the mother procedure might skip some partons if there are junctions involved</span></div>
<div class="line"><a name="l06712"></a><span class="lineno"> 6712</span>&#160;                <span class="comment">//this can be &#39;repaired&#39; by taking a &#39;mother&#39; parton, then checking over all the partons in its string! (both adding to parents / checking if thermal)</span></div>
<div class="line"><a name="l06713"></a><span class="lineno"> 6713</span>&#160;                  <span class="comment">//this is done in hadronization calling function, after invoke_py function is finished</span></div>
<div class="line"><a name="l06714"></a><span class="lineno"> 6714</span>&#160;                final_hadrons_from_pythia.push_back(hadron_out);</div>
<div class="line"><a name="l06715"></a><span class="lineno"> 6715</span>&#160;    }</div>
<div class="line"><a name="l06716"></a><span class="lineno"> 6716</span>&#160;  }</div>
<div class="line"><a name="l06717"></a><span class="lineno"> 6717</span>&#160;</div>
<div class="line"><a name="l06718"></a><span class="lineno"> 6718</span>&#160;  <span class="comment">//warn about not found position for hadrons only once per function call</span></div>
<div class="line"><a name="l06719"></a><span class="lineno"> 6719</span>&#160;  <span class="keywordflow">if</span>(warn_could_not_find_positions &amp;&amp; GetXMLElementInt({<span class="stringliteral">&quot;Afterburner&quot;</span>, <span class="stringliteral">&quot;include_fragmentation_hadrons&quot;</span>}) == 1) {</div>
<div class="line"><a name="l06720"></a><span class="lineno"> 6720</span>&#160;    <a class="code" href="../../d1/dd2/PHG4PhenixEventAction_8cc.html#a4a20323806e186f80a443d377d400e69">VERBOSE</a>(2) &lt;&lt; <span class="stringliteral">&quot;Could not find the spacetime information for hadron in pythia event (string fragmentation attempt =&quot;</span></div>
<div class="line"><a name="l06721"></a><span class="lineno"> 6721</span>&#160;    &lt;&lt; pythia_attempt &lt;&lt; <span class="stringliteral">&quot;), set it to (0,0,0,0)&quot;</span>;</div>
<div class="line"><a name="l06722"></a><span class="lineno"> 6722</span>&#160;  }</div>
<div class="line"><a name="l06723"></a><span class="lineno"> 6723</span>&#160;</div>
<div class="line"><a name="l06724"></a><span class="lineno"> 6724</span>&#160;  <span class="comment">//now let&#39;s do it a bit more precise and distribute the positions along the string segments instead of using the average</span></div>
<div class="line"><a name="l06725"></a><span class="lineno"> 6725</span>&#160;  <span class="keywordflow">if</span>(compute_more_precise_positions) {</div>
<div class="line"><a name="l06726"></a><span class="lineno"> 6726</span>&#160;    <span class="comment">//find the more precise positions for case 1</span></div>
<div class="line"><a name="l06727"></a><span class="lineno"> 6727</span>&#160;    <span class="comment">//have to find the hadrons from the same string segment</span></div>
<div class="line"><a name="l06728"></a><span class="lineno"> 6728</span>&#160;    vector&lt;int&gt; Case1_unique_parton1_idx = Case1_parton1_idx;</div>
<div class="line"><a name="l06729"></a><span class="lineno"> 6729</span>&#160;    <a class="code" href="../../d2/da5/namespaceActs_1_1Experimental_1_1detail_1_1BlueprintHelper.html#a308a6456db2655fc6a1a916696da20c8" title="Sort the nodes in the blueprint container node.">std::sort</a>(Case1_unique_parton1_idx.begin(), Case1_unique_parton1_idx.end());</div>
<div class="line"><a name="l06730"></a><span class="lineno"> 6730</span>&#160;    Case1_unique_parton1_idx.erase(std::unique(Case1_unique_parton1_idx.begin(), Case1_unique_parton1_idx.end()), Case1_unique_parton1_idx.end());</div>
<div class="line"><a name="l06731"></a><span class="lineno"> 6731</span>&#160;    <span class="comment">// go through string segments</span></div>
<div class="line"><a name="l06732"></a><span class="lineno"> 6732</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> string_seg = 0; string_seg &lt; Case1_unique_parton1_idx.size(); string_seg++) {</div>
<div class="line"><a name="l06733"></a><span class="lineno"> 6733</span>&#160;      <span class="keywordtype">int</span> segment_parton1_idx = Case1_unique_parton1_idx.at(string_seg);</div>
<div class="line"><a name="l06734"></a><span class="lineno"> 6734</span>&#160;</div>
<div class="line"><a name="l06735"></a><span class="lineno"> 6735</span>&#160;      <span class="comment">// select the hadrons from the string which need position modification</span></div>
<div class="line"><a name="l06736"></a><span class="lineno"> 6736</span>&#160;      vector&lt;int&gt; segment_hadron_idx;</div>
<div class="line"><a name="l06737"></a><span class="lineno"> 6737</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iHad = 0; iHad &lt; Case1_hadron_idx.size(); iHad++) {</div>
<div class="line"><a name="l06738"></a><span class="lineno"> 6738</span>&#160;        <span class="keywordflow">if</span>(Case1_parton1_idx.at(iHad) == segment_parton1_idx) {</div>
<div class="line"><a name="l06739"></a><span class="lineno"> 6739</span>&#160;          segment_hadron_idx.push_back(iHad);</div>
<div class="line"><a name="l06740"></a><span class="lineno"> 6740</span>&#160;        }</div>
<div class="line"><a name="l06741"></a><span class="lineno"> 6741</span>&#160;      }</div>
<div class="line"><a name="l06742"></a><span class="lineno"> 6742</span>&#160;</div>
<div class="line"><a name="l06743"></a><span class="lineno"> 6743</span>&#160;      <span class="comment">// modify the hadron positions from the current string</span></div>
<div class="line"><a name="l06744"></a><span class="lineno"> 6744</span>&#160;      <span class="keywordtype">int</span> number_hadrons_segment = segment_hadron_idx.size();</div>
<div class="line"><a name="l06745"></a><span class="lineno"> 6745</span>&#160;      <span class="keywordflow">if</span>(number_hadrons_segment &gt; 1) {</div>
<div class="line"><a name="l06746"></a><span class="lineno"> 6746</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iHad = 0; iHad &lt; number_hadrons_segment; iHad++) {</div>
<div class="line"><a name="l06747"></a><span class="lineno"> 6747</span>&#160;          <span class="keywordtype">int</span> parton1_index = Case1_parton1_idx.at(segment_hadron_idx.at(iHad));</div>
<div class="line"><a name="l06748"></a><span class="lineno"> 6748</span>&#160;          <span class="keywordtype">int</span> parton2_index = Case1_parton2_idx.at(segment_hadron_idx.at(iHad));</div>
<div class="line"><a name="l06749"></a><span class="lineno"> 6749</span>&#160;          <span class="keywordtype">int</span> current_hadron_idx = segment_hadron_idx.at(iHad);</div>
<div class="line"><a name="l06750"></a><span class="lineno"> 6750</span>&#160;</div>
<div class="line"><a name="l06751"></a><span class="lineno"> 6751</span>&#160;          <span class="comment">//get the positions of the two partons at the ends of the string segment</span></div>
<div class="line"><a name="l06752"></a><span class="lineno"> 6752</span>&#160;          <span class="keywordtype">double</span> pos_x_ptn1 = HH_pyremn[parton1_index].x();</div>
<div class="line"><a name="l06753"></a><span class="lineno"> 6753</span>&#160;          <span class="keywordtype">double</span> pos_y_ptn1 = HH_pyremn[parton1_index].y();</div>
<div class="line"><a name="l06754"></a><span class="lineno"> 6754</span>&#160;          <span class="keywordtype">double</span> pos_z_ptn1 = HH_pyremn[parton1_index].z();</div>
<div class="line"><a name="l06755"></a><span class="lineno"> 6755</span>&#160;          <span class="keywordtype">double</span> pos_t_ptn1 = HH_pyremn[parton1_index].x_t();</div>
<div class="line"><a name="l06756"></a><span class="lineno"> 6756</span>&#160;          <span class="keywordtype">double</span> pos_x_ptn2 = HH_pyremn[parton2_index].x();</div>
<div class="line"><a name="l06757"></a><span class="lineno"> 6757</span>&#160;          <span class="keywordtype">double</span> pos_y_ptn2 = HH_pyremn[parton2_index].y();</div>
<div class="line"><a name="l06758"></a><span class="lineno"> 6758</span>&#160;          <span class="keywordtype">double</span> pos_z_ptn2 = HH_pyremn[parton2_index].z();</div>
<div class="line"><a name="l06759"></a><span class="lineno"> 6759</span>&#160;          <span class="keywordtype">double</span> pos_t_ptn2 = HH_pyremn[parton2_index].x_t();</div>
<div class="line"><a name="l06760"></a><span class="lineno"> 6760</span>&#160;</div>
<div class="line"><a name="l06761"></a><span class="lineno"> 6761</span>&#160;          <span class="keywordtype">double</span> delta_x = (pos_x_ptn2 - pos_x_ptn1) / (number_hadrons_segment+1);</div>
<div class="line"><a name="l06762"></a><span class="lineno"> 6762</span>&#160;          <span class="keywordtype">double</span> delta_y = (pos_y_ptn2 - pos_y_ptn1) / (number_hadrons_segment+1);</div>
<div class="line"><a name="l06763"></a><span class="lineno"> 6763</span>&#160;          <span class="keywordtype">double</span> delta_z = (pos_z_ptn2 - pos_z_ptn1) / (number_hadrons_segment+1);</div>
<div class="line"><a name="l06764"></a><span class="lineno"> 6764</span>&#160;          <span class="keywordtype">double</span> delta_t = (pos_t_ptn2 - pos_t_ptn1) / (number_hadrons_segment+1);</div>
<div class="line"><a name="l06765"></a><span class="lineno"> 6765</span>&#160;</div>
<div class="line"><a name="l06766"></a><span class="lineno"> 6766</span>&#160;          <span class="keywordtype">double</span> had_x = pos_x_ptn1 + (iHad+1) * delta_x;</div>
<div class="line"><a name="l06767"></a><span class="lineno"> 6767</span>&#160;          <span class="keywordtype">double</span> had_y = pos_y_ptn1 + (iHad+1) * delta_y;</div>
<div class="line"><a name="l06768"></a><span class="lineno"> 6768</span>&#160;          <span class="keywordtype">double</span> had_z = pos_z_ptn1 + (iHad+1) * delta_z;</div>
<div class="line"><a name="l06769"></a><span class="lineno"> 6769</span>&#160;          <span class="keywordtype">double</span> had_t = pos_t_ptn1 + (iHad+1) * delta_t;</div>
<div class="line"><a name="l06770"></a><span class="lineno"> 6770</span>&#160;</div>
<div class="line"><a name="l06771"></a><span class="lineno"> 6771</span>&#160;          <span class="comment">//set the hadron to the new position along the string segment</span></div>
<div class="line"><a name="l06772"></a><span class="lineno"> 6772</span>&#160;          final_hadrons_from_pythia.at(current_hadron_idx).x(had_x);</div>
<div class="line"><a name="l06773"></a><span class="lineno"> 6773</span>&#160;          final_hadrons_from_pythia.at(current_hadron_idx).y(had_y);</div>
<div class="line"><a name="l06774"></a><span class="lineno"> 6774</span>&#160;          final_hadrons_from_pythia.at(current_hadron_idx).z(had_z);</div>
<div class="line"><a name="l06775"></a><span class="lineno"> 6775</span>&#160;          final_hadrons_from_pythia.at(current_hadron_idx).x_t(had_t);</div>
<div class="line"><a name="l06776"></a><span class="lineno"> 6776</span>&#160;        }</div>
<div class="line"><a name="l06777"></a><span class="lineno"> 6777</span>&#160;      }</div>
<div class="line"><a name="l06778"></a><span class="lineno"> 6778</span>&#160;    }</div>
<div class="line"><a name="l06779"></a><span class="lineno"> 6779</span>&#160;</div>
<div class="line"><a name="l06780"></a><span class="lineno"> 6780</span>&#160;    <span class="comment">//find the more precise positions for case 2</span></div>
<div class="line"><a name="l06781"></a><span class="lineno"> 6781</span>&#160;    <span class="comment">//have to find the hadrons from the same string segment</span></div>
<div class="line"><a name="l06782"></a><span class="lineno"> 6782</span>&#160;    vector&lt;int&gt; Case2_unique_parton1_idx = Case2_parton1_idx;</div>
<div class="line"><a name="l06783"></a><span class="lineno"> 6783</span>&#160;    <a class="code" href="../../d2/da5/namespaceActs_1_1Experimental_1_1detail_1_1BlueprintHelper.html#a308a6456db2655fc6a1a916696da20c8" title="Sort the nodes in the blueprint container node.">std::sort</a>(Case2_unique_parton1_idx.begin(), Case2_unique_parton1_idx.end());</div>
<div class="line"><a name="l06784"></a><span class="lineno"> 6784</span>&#160;    Case2_unique_parton1_idx.erase(std::unique(Case2_unique_parton1_idx.begin(), Case2_unique_parton1_idx.end()), Case2_unique_parton1_idx.end());</div>
<div class="line"><a name="l06785"></a><span class="lineno"> 6785</span>&#160;</div>
<div class="line"><a name="l06786"></a><span class="lineno"> 6786</span>&#160;    <span class="comment">// go through string segments or junction legs</span></div>
<div class="line"><a name="l06787"></a><span class="lineno"> 6787</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> string_seg = 0; string_seg &lt; Case2_unique_parton1_idx.size(); string_seg++) {</div>
<div class="line"><a name="l06788"></a><span class="lineno"> 6788</span>&#160;      <span class="keywordtype">int</span> segment_parton1_idx = Case2_unique_parton1_idx.at(string_seg);</div>
<div class="line"><a name="l06789"></a><span class="lineno"> 6789</span>&#160;</div>
<div class="line"><a name="l06790"></a><span class="lineno"> 6790</span>&#160;      <span class="comment">// select the hadrons from the string which need position modification</span></div>
<div class="line"><a name="l06791"></a><span class="lineno"> 6791</span>&#160;      vector&lt;int&gt; segment_hadron_idx;</div>
<div class="line"><a name="l06792"></a><span class="lineno"> 6792</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iHad = 0; iHad &lt; Case2_hadron_idx.size(); iHad++) {</div>
<div class="line"><a name="l06793"></a><span class="lineno"> 6793</span>&#160;        <span class="keywordflow">if</span>(Case2_parton1_idx.at(iHad) == segment_parton1_idx) {</div>
<div class="line"><a name="l06794"></a><span class="lineno"> 6794</span>&#160;          segment_hadron_idx.push_back(iHad);</div>
<div class="line"><a name="l06795"></a><span class="lineno"> 6795</span>&#160;        }</div>
<div class="line"><a name="l06796"></a><span class="lineno"> 6796</span>&#160;      }</div>
<div class="line"><a name="l06797"></a><span class="lineno"> 6797</span>&#160;</div>
<div class="line"><a name="l06798"></a><span class="lineno"> 6798</span>&#160;      <span class="comment">// modify the hadron positions from the current string</span></div>
<div class="line"><a name="l06799"></a><span class="lineno"> 6799</span>&#160;      <span class="keywordtype">int</span> number_hadrons_segment = segment_hadron_idx.size();</div>
<div class="line"><a name="l06800"></a><span class="lineno"> 6800</span>&#160;      <span class="keywordflow">if</span>(number_hadrons_segment &gt; 1) { <span class="comment">// in case of a string segment use average position if only one hadron, in case of junction use center (nothing to do here)</span></div>
<div class="line"><a name="l06801"></a><span class="lineno"> 6801</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iHad = 0; iHad &lt; number_hadrons_segment; iHad++) {</div>
<div class="line"><a name="l06802"></a><span class="lineno"> 6802</span>&#160;          <span class="keywordtype">int</span> parton1_index = Case2_parton1_idx.at(segment_hadron_idx.at(iHad));</div>
<div class="line"><a name="l06803"></a><span class="lineno"> 6803</span>&#160;          <span class="keywordtype">int</span> parton2_index = Case2_parton2_idx.at(segment_hadron_idx.at(iHad));</div>
<div class="line"><a name="l06804"></a><span class="lineno"> 6804</span>&#160;          <span class="keywordtype">int</span> parton3_index = Case2_parton3_idx.at(segment_hadron_idx.at(iHad));</div>
<div class="line"><a name="l06805"></a><span class="lineno"> 6805</span>&#160;          <span class="keywordtype">int</span> current_hadron_idx = segment_hadron_idx.at(iHad);</div>
<div class="line"><a name="l06806"></a><span class="lineno"> 6806</span>&#160;</div>
<div class="line"><a name="l06807"></a><span class="lineno"> 6807</span>&#160;          <span class="keywordflow">if</span>((parton3_index == -1) &amp;&amp; (Case2_junction_center.size() == 0)) { <span class="comment">// this is the case where we have two partons at the string segment ends</span></div>
<div class="line"><a name="l06808"></a><span class="lineno"> 6808</span>&#160;            <span class="comment">//get the positions of the two partons at the ends of the string segment</span></div>
<div class="line"><a name="l06809"></a><span class="lineno"> 6809</span>&#160;            <span class="keywordtype">double</span> pos_x_ptn1 = HH_pyremn[parton1_index].x();</div>
<div class="line"><a name="l06810"></a><span class="lineno"> 6810</span>&#160;            <span class="keywordtype">double</span> pos_y_ptn1 = HH_pyremn[parton1_index].y();</div>
<div class="line"><a name="l06811"></a><span class="lineno"> 6811</span>&#160;            <span class="keywordtype">double</span> pos_z_ptn1 = HH_pyremn[parton1_index].z();</div>
<div class="line"><a name="l06812"></a><span class="lineno"> 6812</span>&#160;            <span class="keywordtype">double</span> pos_t_ptn1 = HH_pyremn[parton1_index].x_t();</div>
<div class="line"><a name="l06813"></a><span class="lineno"> 6813</span>&#160;            <span class="keywordtype">double</span> pos_x_ptn2 = HH_pyremn[parton2_index].x();</div>
<div class="line"><a name="l06814"></a><span class="lineno"> 6814</span>&#160;            <span class="keywordtype">double</span> pos_y_ptn2 = HH_pyremn[parton2_index].y();</div>
<div class="line"><a name="l06815"></a><span class="lineno"> 6815</span>&#160;            <span class="keywordtype">double</span> pos_z_ptn2 = HH_pyremn[parton2_index].z();</div>
<div class="line"><a name="l06816"></a><span class="lineno"> 6816</span>&#160;            <span class="keywordtype">double</span> pos_t_ptn2 = HH_pyremn[parton2_index].x_t();</div>
<div class="line"><a name="l06817"></a><span class="lineno"> 6817</span>&#160;</div>
<div class="line"><a name="l06818"></a><span class="lineno"> 6818</span>&#160;            <span class="keywordtype">double</span> delta_x = (pos_x_ptn2 - pos_x_ptn1) / (number_hadrons_segment+1);</div>
<div class="line"><a name="l06819"></a><span class="lineno"> 6819</span>&#160;            <span class="keywordtype">double</span> delta_y = (pos_y_ptn2 - pos_y_ptn1) / (number_hadrons_segment+1);</div>
<div class="line"><a name="l06820"></a><span class="lineno"> 6820</span>&#160;            <span class="keywordtype">double</span> delta_z = (pos_z_ptn2 - pos_z_ptn1) / (number_hadrons_segment+1);</div>
<div class="line"><a name="l06821"></a><span class="lineno"> 6821</span>&#160;            <span class="keywordtype">double</span> delta_t = (pos_t_ptn2 - pos_t_ptn1) / (number_hadrons_segment+1);</div>
<div class="line"><a name="l06822"></a><span class="lineno"> 6822</span>&#160;</div>
<div class="line"><a name="l06823"></a><span class="lineno"> 6823</span>&#160;            <span class="keywordtype">double</span> had_x = pos_x_ptn1 + (iHad+1) * delta_x;</div>
<div class="line"><a name="l06824"></a><span class="lineno"> 6824</span>&#160;            <span class="keywordtype">double</span> had_y = pos_y_ptn1 + (iHad+1) * delta_y;</div>
<div class="line"><a name="l06825"></a><span class="lineno"> 6825</span>&#160;            <span class="keywordtype">double</span> had_z = pos_z_ptn1 + (iHad+1) * delta_z;</div>
<div class="line"><a name="l06826"></a><span class="lineno"> 6826</span>&#160;            <span class="keywordtype">double</span> had_t = pos_t_ptn1 + (iHad+1) * delta_t;</div>
<div class="line"><a name="l06827"></a><span class="lineno"> 6827</span>&#160;</div>
<div class="line"><a name="l06828"></a><span class="lineno"> 6828</span>&#160;            <span class="comment">//set the hadron to the new position along the string segment</span></div>
<div class="line"><a name="l06829"></a><span class="lineno"> 6829</span>&#160;            final_hadrons_from_pythia.at(current_hadron_idx).x(had_x);</div>
<div class="line"><a name="l06830"></a><span class="lineno"> 6830</span>&#160;            final_hadrons_from_pythia.at(current_hadron_idx).y(had_y);</div>
<div class="line"><a name="l06831"></a><span class="lineno"> 6831</span>&#160;            final_hadrons_from_pythia.at(current_hadron_idx).z(had_z);</div>
<div class="line"><a name="l06832"></a><span class="lineno"> 6832</span>&#160;            final_hadrons_from_pythia.at(current_hadron_idx).x_t(had_t);</div>
<div class="line"><a name="l06833"></a><span class="lineno"> 6833</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(parton3_index &gt; -1 &amp;&amp; Case2_junction_center.size() != 0) { <span class="comment">// this is the case with a junction / antijunction</span></div>
<div class="line"><a name="l06834"></a><span class="lineno"> 6834</span>&#160;            <span class="comment">// compute the leg vectors (center is origin)</span></div>
<div class="line"><a name="l06835"></a><span class="lineno"> 6835</span>&#160;            vector&lt;double&gt; leg1_vec = {HH_pyremn[parton1_index].x_t()-Case2_junction_center[0],</div>
<div class="line"><a name="l06836"></a><span class="lineno"> 6836</span>&#160;                                      HH_pyremn[parton1_index].x()-Case2_junction_center[1],</div>
<div class="line"><a name="l06837"></a><span class="lineno"> 6837</span>&#160;                                      HH_pyremn[parton1_index].y()-Case2_junction_center[2],</div>
<div class="line"><a name="l06838"></a><span class="lineno"> 6838</span>&#160;                                      HH_pyremn[parton1_index].z()-Case2_junction_center[3]};</div>
<div class="line"><a name="l06839"></a><span class="lineno"> 6839</span>&#160;            vector&lt;double&gt; leg2_vec = {HH_pyremn[parton2_index].x_t()-Case2_junction_center[0],</div>
<div class="line"><a name="l06840"></a><span class="lineno"> 6840</span>&#160;                                      HH_pyremn[parton2_index].x()-Case2_junction_center[1],</div>
<div class="line"><a name="l06841"></a><span class="lineno"> 6841</span>&#160;                                      HH_pyremn[parton2_index].y()-Case2_junction_center[2],</div>
<div class="line"><a name="l06842"></a><span class="lineno"> 6842</span>&#160;                                      HH_pyremn[parton2_index].z()-Case2_junction_center[3]};</div>
<div class="line"><a name="l06843"></a><span class="lineno"> 6843</span>&#160;            vector&lt;double&gt; leg3_vec = {HH_pyremn[parton3_index].x_t()-Case2_junction_center[0],</div>
<div class="line"><a name="l06844"></a><span class="lineno"> 6844</span>&#160;                                      HH_pyremn[parton3_index].x()-Case2_junction_center[1],</div>
<div class="line"><a name="l06845"></a><span class="lineno"> 6845</span>&#160;                                      HH_pyremn[parton3_index].y()-Case2_junction_center[2],</div>
<div class="line"><a name="l06846"></a><span class="lineno"> 6846</span>&#160;                                      HH_pyremn[parton3_index].z()-Case2_junction_center[3]};</div>
<div class="line"><a name="l06847"></a><span class="lineno"> 6847</span>&#160;            <span class="keywordtype">double</span> abs_leg1 = std::sqrt(leg1_vec[0]*leg1_vec[0] + leg1_vec[1]*leg1_vec[1] + leg1_vec[2]*leg1_vec[2] + leg1_vec[3]*leg1_vec[3]);</div>
<div class="line"><a name="l06848"></a><span class="lineno"> 6848</span>&#160;            <span class="keywordtype">double</span> abs_leg2 = std::sqrt(leg2_vec[0]*leg2_vec[0] + leg2_vec[1]*leg2_vec[1] + leg2_vec[2]*leg2_vec[2] + leg2_vec[3]*leg2_vec[3]);</div>
<div class="line"><a name="l06849"></a><span class="lineno"> 6849</span>&#160;            <span class="keywordtype">double</span> abs_leg3 = std::sqrt(leg3_vec[0]*leg3_vec[0] + leg3_vec[1]*leg3_vec[1] + leg3_vec[2]*leg3_vec[2] + leg3_vec[3]*leg3_vec[3]);</div>
<div class="line"><a name="l06850"></a><span class="lineno"> 6850</span>&#160;            <span class="keywordflow">if</span>(abs_leg1 &lt;= 1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-6 || abs_leg2 &lt;= 1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-6 || abs_leg3 &lt;= 1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-6) {<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l06851"></a><span class="lineno"> 6851</span>&#160;            <span class="keywordtype">double</span> <a class="code" href="../../d4/d0e/namespaceActs_1_1IntegrationTest.html#a84349caa01f56751d98d87717060d399">L</a> = abs_leg1 + abs_leg2 + abs_leg3;</div>
<div class="line"><a name="l06852"></a><span class="lineno"> 6852</span>&#160;            <span class="keywordtype">double</span> delta_l = L / (number_hadrons_segment + 1); <span class="comment">// inter hadron distance</span></div>
<div class="line"><a name="l06853"></a><span class="lineno"> 6853</span>&#160;            <span class="keywordtype">double</span> <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">distance</a> = delta_l + iHad; <span class="comment">// center -&gt; end leg1, center -&gt; end leg2, center -&gt; end leg3</span></div>
<div class="line"><a name="l06854"></a><span class="lineno"> 6854</span>&#160;            <span class="keywordtype">double</span> had_t, had_x, had_y, had_z;</div>
<div class="line"><a name="l06855"></a><span class="lineno"> 6855</span>&#160;            <span class="keywordflow">if</span>(distance &lt;= abs_leg1) {</div>
<div class="line"><a name="l06856"></a><span class="lineno"> 6856</span>&#160;              had_t = leg1_vec[0] * (distance / abs_leg1);</div>
<div class="line"><a name="l06857"></a><span class="lineno"> 6857</span>&#160;              had_x = leg1_vec[1] * (distance / abs_leg1);</div>
<div class="line"><a name="l06858"></a><span class="lineno"> 6858</span>&#160;              had_y = leg1_vec[2] * (distance / abs_leg1);</div>
<div class="line"><a name="l06859"></a><span class="lineno"> 6859</span>&#160;              had_z = leg1_vec[3] * (distance / abs_leg1);</div>
<div class="line"><a name="l06860"></a><span class="lineno"> 6860</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((abs_leg1 &lt; distance) &amp;&amp; (distance &lt;= abs_leg1+abs_leg2)) {</div>
<div class="line"><a name="l06861"></a><span class="lineno"> 6861</span>&#160;              had_t = leg2_vec[0] * ((distance - abs_leg1) / abs_leg2);</div>
<div class="line"><a name="l06862"></a><span class="lineno"> 6862</span>&#160;              had_x = leg2_vec[1] * ((distance - abs_leg1) / abs_leg2);</div>
<div class="line"><a name="l06863"></a><span class="lineno"> 6863</span>&#160;              had_y = leg2_vec[2] * ((distance - abs_leg1) / abs_leg2);</div>
<div class="line"><a name="l06864"></a><span class="lineno"> 6864</span>&#160;              had_z = leg2_vec[3] * ((distance - abs_leg1) / abs_leg2);</div>
<div class="line"><a name="l06865"></a><span class="lineno"> 6865</span>&#160;            } <span class="keywordflow">else</span> { <span class="comment">// (abs_leg1+abs_leg2 &lt; distance) &amp;&amp; (distance &lt;= L)</span></div>
<div class="line"><a name="l06866"></a><span class="lineno"> 6866</span>&#160;              had_t = leg3_vec[0] * ((distance - abs_leg1 - abs_leg2) / abs_leg3);</div>
<div class="line"><a name="l06867"></a><span class="lineno"> 6867</span>&#160;              had_x = leg3_vec[1] * ((distance - abs_leg1 - abs_leg2) / abs_leg3);</div>
<div class="line"><a name="l06868"></a><span class="lineno"> 6868</span>&#160;              had_y = leg3_vec[2] * ((distance - abs_leg1 - abs_leg2) / abs_leg3);</div>
<div class="line"><a name="l06869"></a><span class="lineno"> 6869</span>&#160;              had_z = leg3_vec[3] * ((distance - abs_leg1 - abs_leg2) / abs_leg3);</div>
<div class="line"><a name="l06870"></a><span class="lineno"> 6870</span>&#160;            }</div>
<div class="line"><a name="l06871"></a><span class="lineno"> 6871</span>&#160;            <span class="comment">//set the hadron to the new position along the string segment</span></div>
<div class="line"><a name="l06872"></a><span class="lineno"> 6872</span>&#160;            final_hadrons_from_pythia.at(current_hadron_idx).x(had_x);</div>
<div class="line"><a name="l06873"></a><span class="lineno"> 6873</span>&#160;            final_hadrons_from_pythia.at(current_hadron_idx).y(had_y);</div>
<div class="line"><a name="l06874"></a><span class="lineno"> 6874</span>&#160;            final_hadrons_from_pythia.at(current_hadron_idx).z(had_z);</div>
<div class="line"><a name="l06875"></a><span class="lineno"> 6875</span>&#160;            final_hadrons_from_pythia.at(current_hadron_idx).x_t(had_t);</div>
<div class="line"><a name="l06876"></a><span class="lineno"> 6876</span>&#160;          }</div>
<div class="line"><a name="l06877"></a><span class="lineno"> 6877</span>&#160;        }</div>
<div class="line"><a name="l06878"></a><span class="lineno"> 6878</span>&#160;      }</div>
<div class="line"><a name="l06879"></a><span class="lineno"> 6879</span>&#160;    }</div>
<div class="line"><a name="l06880"></a><span class="lineno"> 6880</span>&#160;</div>
<div class="line"><a name="l06881"></a><span class="lineno"> 6881</span>&#160;    <span class="comment">//find the more precise positions for case 3</span></div>
<div class="line"><a name="l06882"></a><span class="lineno"> 6882</span>&#160;    <span class="comment">//have to find the hadrons from the same string segment</span></div>
<div class="line"><a name="l06883"></a><span class="lineno"> 6883</span>&#160;    vector&lt;int&gt; Case3_unique_parton1_idx = Case3_parton1_idx;</div>
<div class="line"><a name="l06884"></a><span class="lineno"> 6884</span>&#160;    <a class="code" href="../../d2/da5/namespaceActs_1_1Experimental_1_1detail_1_1BlueprintHelper.html#a308a6456db2655fc6a1a916696da20c8" title="Sort the nodes in the blueprint container node.">std::sort</a>(Case3_unique_parton1_idx.begin(), Case3_unique_parton1_idx.end());</div>
<div class="line"><a name="l06885"></a><span class="lineno"> 6885</span>&#160;    Case3_unique_parton1_idx.erase(std::unique(Case3_unique_parton1_idx.begin(), Case3_unique_parton1_idx.end()), Case3_unique_parton1_idx.end());</div>
<div class="line"><a name="l06886"></a><span class="lineno"> 6886</span>&#160;    <span class="comment">// go through string segments</span></div>
<div class="line"><a name="l06887"></a><span class="lineno"> 6887</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> string_seg = 0; string_seg &lt; Case3_unique_parton1_idx.size(); string_seg++) {</div>
<div class="line"><a name="l06888"></a><span class="lineno"> 6888</span>&#160;      <span class="keywordtype">int</span> segment_parton1_idx = Case3_unique_parton1_idx.at(string_seg);</div>
<div class="line"><a name="l06889"></a><span class="lineno"> 6889</span>&#160;</div>
<div class="line"><a name="l06890"></a><span class="lineno"> 6890</span>&#160;      <span class="comment">// select the hadrons from the string which need position modification</span></div>
<div class="line"><a name="l06891"></a><span class="lineno"> 6891</span>&#160;      vector&lt;int&gt; segment_hadron_idx;</div>
<div class="line"><a name="l06892"></a><span class="lineno"> 6892</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iHad = 0; iHad &lt; Case3_hadron_idx.size(); iHad++) {</div>
<div class="line"><a name="l06893"></a><span class="lineno"> 6893</span>&#160;        <span class="keywordflow">if</span>(Case3_parton1_idx.at(iHad) == segment_parton1_idx) {</div>
<div class="line"><a name="l06894"></a><span class="lineno"> 6894</span>&#160;          segment_hadron_idx.push_back(iHad);</div>
<div class="line"><a name="l06895"></a><span class="lineno"> 6895</span>&#160;        }</div>
<div class="line"><a name="l06896"></a><span class="lineno"> 6896</span>&#160;      }</div>
<div class="line"><a name="l06897"></a><span class="lineno"> 6897</span>&#160;</div>
<div class="line"><a name="l06898"></a><span class="lineno"> 6898</span>&#160;      <span class="comment">// modify the hadron positions from the current string</span></div>
<div class="line"><a name="l06899"></a><span class="lineno"> 6899</span>&#160;      <span class="keywordtype">int</span> number_hadrons_segment = segment_hadron_idx.size();</div>
<div class="line"><a name="l06900"></a><span class="lineno"> 6900</span>&#160;      <span class="keywordflow">if</span>(number_hadrons_segment &gt; 1) {</div>
<div class="line"><a name="l06901"></a><span class="lineno"> 6901</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iHad = 0; iHad &lt; number_hadrons_segment; iHad++) {</div>
<div class="line"><a name="l06902"></a><span class="lineno"> 6902</span>&#160;          <span class="keywordtype">int</span> parton1_index = Case3_parton1_idx.at(segment_hadron_idx.at(iHad));</div>
<div class="line"><a name="l06903"></a><span class="lineno"> 6903</span>&#160;          <span class="keywordtype">int</span> parton2_index = Case3_parton2_idx.at(segment_hadron_idx.at(iHad));</div>
<div class="line"><a name="l06904"></a><span class="lineno"> 6904</span>&#160;          <span class="keywordtype">int</span> current_hadron_idx = segment_hadron_idx.at(iHad);</div>
<div class="line"><a name="l06905"></a><span class="lineno"> 6905</span>&#160;</div>
<div class="line"><a name="l06906"></a><span class="lineno"> 6906</span>&#160;          vector&lt;double&gt; seg1_vec = {HH_pyremn[parton1_index].x_t()-Case3_partons_center[0],</div>
<div class="line"><a name="l06907"></a><span class="lineno"> 6907</span>&#160;                                      HH_pyremn[parton1_index].x()-Case3_partons_center[1],</div>
<div class="line"><a name="l06908"></a><span class="lineno"> 6908</span>&#160;                                      HH_pyremn[parton1_index].y()-Case3_partons_center[2],</div>
<div class="line"><a name="l06909"></a><span class="lineno"> 6909</span>&#160;                                      HH_pyremn[parton1_index].z()-Case3_partons_center[3]};</div>
<div class="line"><a name="l06910"></a><span class="lineno"> 6910</span>&#160;          vector&lt;double&gt; seg2_vec = {HH_pyremn[parton2_index].x_t()-Case3_partons_center[0],</div>
<div class="line"><a name="l06911"></a><span class="lineno"> 6911</span>&#160;                                      HH_pyremn[parton2_index].x()-Case3_partons_center[1],</div>
<div class="line"><a name="l06912"></a><span class="lineno"> 6912</span>&#160;                                      HH_pyremn[parton2_index].y()-Case3_partons_center[2],</div>
<div class="line"><a name="l06913"></a><span class="lineno"> 6913</span>&#160;                                      HH_pyremn[parton2_index].z()-Case3_partons_center[3]};</div>
<div class="line"><a name="l06914"></a><span class="lineno"> 6914</span>&#160;          <span class="keywordtype">double</span> abs_seg1 = std::sqrt(seg1_vec[0]*seg1_vec[0] + seg1_vec[1]*seg1_vec[1] + seg1_vec[2]*seg1_vec[2] + seg1_vec[3]*seg1_vec[3]);</div>
<div class="line"><a name="l06915"></a><span class="lineno"> 6915</span>&#160;          <span class="keywordtype">double</span> abs_seg2 = std::sqrt(seg2_vec[0]*seg2_vec[0] + seg2_vec[1]*seg2_vec[1] + seg2_vec[2]*seg2_vec[2] + seg2_vec[3]*seg2_vec[3]);</div>
<div class="line"><a name="l06916"></a><span class="lineno"> 6916</span>&#160;          <span class="keywordflow">if</span>(abs_seg1 &lt;= 1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-6 || abs_seg2 &lt;= 1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-6) {<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l06917"></a><span class="lineno"> 6917</span>&#160;          <span class="keywordtype">double</span> <a class="code" href="../../d4/d0e/namespaceActs_1_1IntegrationTest.html#a84349caa01f56751d98d87717060d399">L</a> = abs_seg1 + abs_seg2;</div>
<div class="line"><a name="l06918"></a><span class="lineno"> 6918</span>&#160;          <span class="keywordtype">double</span> delta_l = L / (number_hadrons_segment + 1); <span class="comment">// inter hadron distance</span></div>
<div class="line"><a name="l06919"></a><span class="lineno"> 6919</span>&#160;          <span class="keywordtype">double</span> <a class="code" href="../../d2/d5a/ExaTrkXEdgeBuildingTest_8cpp.html#a6c3fdf667362d0fcd29829e3a34003f8">distance</a> = delta_l + iHad; <span class="comment">// center -&gt; end seg1, center -&gt; end seg2</span></div>
<div class="line"><a name="l06920"></a><span class="lineno"> 6920</span>&#160;          <span class="keywordtype">double</span> had_t, had_x, had_y, had_z;</div>
<div class="line"><a name="l06921"></a><span class="lineno"> 6921</span>&#160;          <span class="keywordflow">if</span>(distance &lt;= abs_seg1) {</div>
<div class="line"><a name="l06922"></a><span class="lineno"> 6922</span>&#160;              had_t = seg1_vec[0] * (distance / abs_seg1);</div>
<div class="line"><a name="l06923"></a><span class="lineno"> 6923</span>&#160;              had_x = seg1_vec[1] * (distance / abs_seg1);</div>
<div class="line"><a name="l06924"></a><span class="lineno"> 6924</span>&#160;              had_y = seg1_vec[2] * (distance / abs_seg1);</div>
<div class="line"><a name="l06925"></a><span class="lineno"> 6925</span>&#160;              had_z = seg1_vec[3] * (distance / abs_seg1);</div>
<div class="line"><a name="l06926"></a><span class="lineno"> 6926</span>&#160;          } <span class="keywordflow">else</span> { <span class="comment">// (abs_leg1 &lt; distance) &amp;&amp; (distance &lt;= abs_leg1+abs_leg2)</span></div>
<div class="line"><a name="l06927"></a><span class="lineno"> 6927</span>&#160;              had_t = seg2_vec[0] * ((distance - abs_seg1) / abs_seg2);</div>
<div class="line"><a name="l06928"></a><span class="lineno"> 6928</span>&#160;              had_x = seg2_vec[1] * ((distance - abs_seg1) / abs_seg2);</div>
<div class="line"><a name="l06929"></a><span class="lineno"> 6929</span>&#160;              had_y = seg2_vec[2] * ((distance - abs_seg1) / abs_seg2);</div>
<div class="line"><a name="l06930"></a><span class="lineno"> 6930</span>&#160;              had_z = seg2_vec[3] * ((distance - abs_seg1) / abs_seg2);</div>
<div class="line"><a name="l06931"></a><span class="lineno"> 6931</span>&#160;          }</div>
<div class="line"><a name="l06932"></a><span class="lineno"> 6932</span>&#160;          <span class="comment">//set the hadron to the new position along the string segment</span></div>
<div class="line"><a name="l06933"></a><span class="lineno"> 6933</span>&#160;          final_hadrons_from_pythia.at(current_hadron_idx).x(had_x);</div>
<div class="line"><a name="l06934"></a><span class="lineno"> 6934</span>&#160;          final_hadrons_from_pythia.at(current_hadron_idx).y(had_y);</div>
<div class="line"><a name="l06935"></a><span class="lineno"> 6935</span>&#160;          final_hadrons_from_pythia.at(current_hadron_idx).z(had_z);</div>
<div class="line"><a name="l06936"></a><span class="lineno"> 6936</span>&#160;          final_hadrons_from_pythia.at(current_hadron_idx).x_t(had_t);</div>
<div class="line"><a name="l06937"></a><span class="lineno"> 6937</span>&#160;        }</div>
<div class="line"><a name="l06938"></a><span class="lineno"> 6938</span>&#160;      }</div>
<div class="line"><a name="l06939"></a><span class="lineno"> 6939</span>&#160;    }</div>
<div class="line"><a name="l06940"></a><span class="lineno"> 6940</span>&#160;  }</div>
<div class="line"><a name="l06941"></a><span class="lineno"> 6941</span>&#160;</div>
<div class="line"><a name="l06942"></a><span class="lineno"> 6942</span>&#160;  <span class="comment">//finally add the hadrons with position information to the HH_hadrons</span></div>
<div class="line"><a name="l06943"></a><span class="lineno"> 6943</span>&#160;  <span class="comment">//the mother procedure might skip some partons if there are junctions involved</span></div>
<div class="line"><a name="l06944"></a><span class="lineno"> 6944</span>&#160;        <span class="comment">//this can be &#39;repaired&#39; by taking a &#39;mother&#39; parton, then checking over all the partons in its string! (both adding to parents / checking if thermal)</span></div>
<div class="line"><a name="l06945"></a><span class="lineno"> 6945</span>&#160;  <span class="comment">//this is done in hadronization calling function, after this invoke_py function is finished</span></div>
<div class="line"><a name="l06946"></a><span class="lineno"> 6946</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> hadron_idx = 0; hadron_idx &lt; final_hadrons_from_pythia.size(); hadron_idx++) {</div>
<div class="line"><a name="l06947"></a><span class="lineno"> 6947</span>&#160;    HH_pythia_hadrons.add(final_hadrons_from_pythia[hadron_idx]);</div>
<div class="line"><a name="l06948"></a><span class="lineno"> 6948</span>&#160;  }</div>
<div class="line"><a name="l06949"></a><span class="lineno"> 6949</span>&#160;}</div>
<div class="line"><a name="l06950"></a><span class="lineno"> 6950</span>&#160;</div>
<div class="line"><a name="l06951"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#af2349848621f293abb976f7d0418e15b"> 6951</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#af2349848621f293abb976f7d0418e15b">HybridHadronization::bring_hadrons_to_mass_shell</a>(<a class="code" href="../../de/d96/classHybridHadronization_1_1hadron__collection.html">hadron_collection</a>&amp; HH_hadrons) {</div>
<div class="line"><a name="l06952"></a><span class="lineno"> 6952</span>&#160;  <span class="comment">//to calc. E conservation violation</span></div>
<div class="line"><a name="l06953"></a><span class="lineno"> 6953</span>&#160;  <span class="comment">//double Ebefore = 0.; double Eafter = 0.; double pTbefore = 0.; double pTafter = 0.;</span></div>
<div class="line"><a name="l06954"></a><span class="lineno"> 6954</span>&#160;  <span class="comment">//for(int iHad=0; iHad&lt;HH_hadrons.num(); ++iHad){if(!HH_hadrons[iHad].is_final()){continue;} Ebefore += HH_hadrons[iHad].e(); pTbefore += HH_hadrons[iHad].pt();}</span></div>
<div class="line"><a name="l06955"></a><span class="lineno"> 6955</span>&#160;  <span class="comment">//std::cout &lt;&lt; std::setprecision(5);</span></div>
<div class="line"><a name="l06956"></a><span class="lineno"> 6956</span>&#160;  <span class="comment">//std::ofstream eviol; std::ofstream echg; std::ofstream ptchg;</span></div>
<div class="line"><a name="l06957"></a><span class="lineno"> 6957</span>&#160;  <span class="comment">//eviol.open(&quot;Evio_hadrons.dat&quot;, std::ios::app); echg.open(&quot;Echg_hadrons.dat&quot;, std::ios::app); ptchg.open(&quot;ptchg_hadrons.dat&quot;, std::ios::app);</span></div>
<div class="line"><a name="l06958"></a><span class="lineno"> 6958</span>&#160;</div>
<div class="line"><a name="l06959"></a><span class="lineno"> 6959</span>&#160;        <span class="comment">//hadron mass adjust</span></div>
<div class="line"><a name="l06960"></a><span class="lineno"> 6960</span>&#160;        <span class="keywordtype">double</span> osf = 1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-6;</div>
<div class="line"><a name="l06961"></a><span class="lineno"> 6961</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iHad=0; iHad&lt;HH_hadrons.<a class="code" href="../../de/d96/classHybridHadronization_1_1hadron__collection.html#a999851873f2bb31cc5ed00dc32bc4e00">num</a>(); ++iHad){</div>
<div class="line"><a name="l06962"></a><span class="lineno"> 6962</span>&#160;          <span class="comment">//if this isn&#39;t a final state hadron, there&#39;s no point in fixing it.</span></div>
<div class="line"><a name="l06963"></a><span class="lineno"> 6963</span>&#160;          <span class="keywordflow">if</span>(!HH_hadrons[iHad].is_final()){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l06964"></a><span class="lineno"> 6964</span>&#160;</div>
<div class="line"><a name="l06965"></a><span class="lineno"> 6965</span>&#160;                <span class="comment">//need hadron mass and pdg (pythia) mass to check</span></div>
<div class="line"><a name="l06966"></a><span class="lineno"> 6966</span>&#160;                <span class="keywordtype">double</span> hadmass = HH_hadrons[iHad].mass();</div>
<div class="line"><a name="l06967"></a><span class="lineno"> 6967</span>&#160;    <span class="keywordtype">double</span> m1 = pythia.particleData.m0(HH_hadrons[iHad].<span class="keywordtype">id</span>());</div>
<div class="line"><a name="l06968"></a><span class="lineno"> 6968</span>&#160;                <span class="comment">//if this hadron doesn&#39;t need to be fixed, then we skip it</span></div>
<div class="line"><a name="l06969"></a><span class="lineno"> 6969</span>&#160;                <span class="keywordflow">if</span>(!(std::abs(hadmass - m1)/m1 &gt; osf)){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l06970"></a><span class="lineno"> 6970</span>&#160;</div>
<div class="line"><a name="l06971"></a><span class="lineno"> 6971</span>&#160;                <span class="comment">//this hadron needs fixing, so we prepare to find a partner hadron to adjust with it</span></div>
<div class="line"><a name="l06972"></a><span class="lineno"> 6972</span>&#160;                <span class="keywordtype">int</span> partner = -1;</div>
<div class="line"><a name="l06973"></a><span class="lineno"> 6973</span>&#160;</div>
<div class="line"><a name="l06974"></a><span class="lineno"> 6974</span>&#160;                <span class="comment">//if this hadron has colors, then we can use that info to fix it</span></div>
<div class="line"><a name="l06975"></a><span class="lineno"> 6975</span>&#160;                <span class="keywordflow">if</span>(HH_hadrons[iHad].cols.size() &gt; 0){</div>
<div class="line"><a name="l06976"></a><span class="lineno"> 6976</span>&#160;                  <span class="comment">//looking through the hadron list to find another hadron with the same color tag.</span></div>
<div class="line"><a name="l06977"></a><span class="lineno"> 6977</span>&#160;                  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jHad = 0; jHad &lt; HH_hadrons.<a class="code" href="../../de/d96/classHybridHadronization_1_1hadron__collection.html#a999851873f2bb31cc5ed00dc32bc4e00">num</a>(); ++jHad){</div>
<div class="line"><a name="l06978"></a><span class="lineno"> 6978</span>&#160;                    <span class="keywordflow">if</span>(!HH_hadrons[jHad].is_final()){<span class="keywordflow">continue</span>;} <span class="comment">//do not want a non-final hadron</span></div>
<div class="line"><a name="l06979"></a><span class="lineno"> 6979</span>&#160;                    <span class="keywordflow">if</span>(iHad == jHad){<span class="keywordflow">continue</span>;} <span class="comment">//needs to be a different hadron</span></div>
<div class="line"><a name="l06980"></a><span class="lineno"> 6980</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a> = pythia.particleData.m0(HH_hadrons[jHad].<span class="keywordtype">id</span>());</div>
<div class="line"><a name="l06981"></a><span class="lineno"> 6981</span>&#160;        <span class="keywordtype">double</span> pair_mass = std::sqrt((HH_hadrons[iHad].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() + HH_hadrons[jHad].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>())*(HH_hadrons[iHad].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() + HH_hadrons[jHad].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>())</div>
<div class="line"><a name="l06982"></a><span class="lineno"> 6982</span>&#160;            - (HH_hadrons[iHad].px() + HH_hadrons[jHad].px())*(HH_hadrons[iHad].px() + HH_hadrons[jHad].px())</div>
<div class="line"><a name="l06983"></a><span class="lineno"> 6983</span>&#160;            - (HH_hadrons[iHad].py() + HH_hadrons[jHad].py())*(HH_hadrons[iHad].py() + HH_hadrons[jHad].py())</div>
<div class="line"><a name="l06984"></a><span class="lineno"> 6984</span>&#160;            - (HH_hadrons[iHad].pz() + HH_hadrons[jHad].pz())*(HH_hadrons[iHad].pz() + HH_hadrons[jHad].pz()));</div>
<div class="line"><a name="l06985"></a><span class="lineno"> 6985</span>&#160;        <span class="comment">// variabele to compute the squared momentum difference of the partners</span></div>
<div class="line"><a name="l06986"></a><span class="lineno"> 6986</span>&#160;        <span class="comment">// if this is too small the mass adjustment procedure would fail</span></div>
<div class="line"><a name="l06987"></a><span class="lineno"> 6987</span>&#160;        <span class="keywordtype">double</span> momentum_diff = (HH_hadrons[iHad].px()-HH_hadrons[jHad].px())*(HH_hadrons[iHad].px()-HH_hadrons[jHad].px())</div>
<div class="line"><a name="l06988"></a><span class="lineno"> 6988</span>&#160;                      + (HH_hadrons[iHad].py()-HH_hadrons[jHad].py())*(HH_hadrons[iHad].py()-HH_hadrons[jHad].py())</div>
<div class="line"><a name="l06989"></a><span class="lineno"> 6989</span>&#160;                      + (HH_hadrons[iHad].pz()-HH_hadrons[jHad].pz())*(HH_hadrons[iHad].pz()-HH_hadrons[jHad].pz());</div>
<div class="line"><a name="l06990"></a><span class="lineno"> 6990</span>&#160;                    <span class="keywordflow">if</span>(HH_hadrons[jHad].cols.size() &gt; 0){<span class="comment">//if this hadron has color tags, check</span></div>
<div class="line"><a name="l06991"></a><span class="lineno"> 6991</span>&#160;          <span class="comment">//JSINFO &lt;&lt; &quot;iHad = &quot; &lt;&lt; iHad &lt;&lt; &quot;, jHad = &quot; &lt;&lt; jHad &lt;&lt; &quot;, momentum_diff = &quot; &lt;&lt; momentum_diff &lt;&lt; &quot;, pair_mass - m1 - m2 = &quot; &lt;&lt; pair_mass-m1-m2;</span></div>
<div class="line"><a name="l06992"></a><span class="lineno"> 6992</span>&#160;                          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> icol = 0; icol &lt; HH_hadrons[iHad].cols.size(); ++icol){</div>
<div class="line"><a name="l06993"></a><span class="lineno"> 6993</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jcol = 0; jcol &lt; HH_hadrons[jHad].cols.size(); ++jcol){</div>
<div class="line"><a name="l06994"></a><span class="lineno"> 6994</span>&#160;              <span class="keywordflow">if</span>(!(HH_hadrons[iHad].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>(icol) == HH_hadrons[jHad].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>(jcol)) || momentum_diff &lt; 1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-6 || (pair_mass &lt; m1+<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a>)){<span class="keywordflow">continue</span>;} <span class="comment">//color not matching</span></div>
<div class="line"><a name="l06995"></a><span class="lineno"> 6995</span>&#160;                                            <span class="comment">//if the previous condition isn&#39;t met, that means the colors match!</span></div>
<div class="line"><a name="l06996"></a><span class="lineno"> 6996</span>&#160;                                            partner = jHad; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06997"></a><span class="lineno"> 6997</span>&#160;                                    }</div>
<div class="line"><a name="l06998"></a><span class="lineno"> 6998</span>&#160;            <span class="keywordflow">if</span>(partner &gt; -1){<span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l06999"></a><span class="lineno"> 6999</span>&#160;          }</div>
<div class="line"><a name="l07000"></a><span class="lineno"> 7000</span>&#160;                    }</div>
<div class="line"><a name="l07001"></a><span class="lineno"> 7001</span>&#160;                    <span class="keywordflow">if</span>(partner &gt; -1){<span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l07002"></a><span class="lineno"> 7002</span>&#160;                  }</div>
<div class="line"><a name="l07003"></a><span class="lineno"> 7003</span>&#160;                }</div>
<div class="line"><a name="l07004"></a><span class="lineno"> 7004</span>&#160;</div>
<div class="line"><a name="l07005"></a><span class="lineno"> 7005</span>&#160;                <span class="comment">//ready to fix, if a partner has not been found, pick a close-by hadron</span></div>
<div class="line"><a name="l07006"></a><span class="lineno"> 7006</span>&#160;    <span class="comment">//make sure that there is a relative momentum to reshuffle the masses</span></div>
<div class="line"><a name="l07007"></a><span class="lineno"> 7007</span>&#160;                <span class="keywordflow">if</span>(partner == -1){</div>
<div class="line"><a name="l07008"></a><span class="lineno"> 7008</span>&#160;                  <span class="comment">//grabbing closest final state hadron before and after, if it exists</span></div>
<div class="line"><a name="l07009"></a><span class="lineno"> 7009</span>&#160;                  <span class="keywordtype">int</span> iprev = iHad-1; <span class="keywordtype">int</span> inext = iHad+1;</div>
<div class="line"><a name="l07010"></a><span class="lineno"> 7010</span>&#160;                  <span class="keywordflow">while</span>(iprev &gt;= 0){</div>
<div class="line"><a name="l07011"></a><span class="lineno"> 7011</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a> = pythia.particleData.m0(HH_hadrons[iprev].<span class="keywordtype">id</span>());</div>
<div class="line"><a name="l07012"></a><span class="lineno"> 7012</span>&#160;        <span class="keywordtype">double</span> pair_mass = std::sqrt((HH_hadrons[iHad].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() + HH_hadrons[iprev].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>())*(HH_hadrons[iHad].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() + HH_hadrons[iprev].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>())</div>
<div class="line"><a name="l07013"></a><span class="lineno"> 7013</span>&#160;            - (HH_hadrons[iHad].px() + HH_hadrons[iprev].px())*(HH_hadrons[iHad].px() + HH_hadrons[iprev].px())</div>
<div class="line"><a name="l07014"></a><span class="lineno"> 7014</span>&#160;            - (HH_hadrons[iHad].py() + HH_hadrons[iprev].py())*(HH_hadrons[iHad].py() + HH_hadrons[iprev].py())</div>
<div class="line"><a name="l07015"></a><span class="lineno"> 7015</span>&#160;            - (HH_hadrons[iHad].pz() + HH_hadrons[iprev].pz())*(HH_hadrons[iHad].pz() + HH_hadrons[iprev].pz()));</div>
<div class="line"><a name="l07016"></a><span class="lineno"> 7016</span>&#160;        <span class="keywordtype">double</span> momentum_diff = (HH_hadrons[iHad].px()-HH_hadrons[iprev].px())*(HH_hadrons[iHad].px()-HH_hadrons[iprev].px())</div>
<div class="line"><a name="l07017"></a><span class="lineno"> 7017</span>&#160;                      + (HH_hadrons[iHad].py()-HH_hadrons[iprev].py())*(HH_hadrons[iHad].py()-HH_hadrons[iprev].py())</div>
<div class="line"><a name="l07018"></a><span class="lineno"> 7018</span>&#160;                      + (HH_hadrons[iHad].pz()-HH_hadrons[iprev].pz())*(HH_hadrons[iHad].pz()-HH_hadrons[iprev].pz());</div>
<div class="line"><a name="l07019"></a><span class="lineno"> 7019</span>&#160;        <span class="keywordflow">if</span>(HH_hadrons[iprev].is_final() &amp;&amp; momentum_diff &gt;= 1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-6 &amp;&amp; pair_mass &gt;= m1+<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a>){<span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l07020"></a><span class="lineno"> 7020</span>&#160;        --iprev;</div>
<div class="line"><a name="l07021"></a><span class="lineno"> 7021</span>&#160;      }</div>
<div class="line"><a name="l07022"></a><span class="lineno"> 7022</span>&#160;                        <span class="keywordflow">while</span>(inext &lt; HH_hadrons.<a class="code" href="../../de/d96/classHybridHadronization_1_1hadron__collection.html#a999851873f2bb31cc5ed00dc32bc4e00">num</a>()){</div>
<div class="line"><a name="l07023"></a><span class="lineno"> 7023</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a> = pythia.particleData.m0(HH_hadrons[inext].<span class="keywordtype">id</span>());</div>
<div class="line"><a name="l07024"></a><span class="lineno"> 7024</span>&#160;        <span class="keywordtype">double</span> pair_mass = std::sqrt((HH_hadrons[iHad].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() + HH_hadrons[inext].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>())*(HH_hadrons[iHad].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() + HH_hadrons[inext].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>())</div>
<div class="line"><a name="l07025"></a><span class="lineno"> 7025</span>&#160;            - (HH_hadrons[iHad].px() + HH_hadrons[inext].px())*(HH_hadrons[iHad].px() + HH_hadrons[inext].px())</div>
<div class="line"><a name="l07026"></a><span class="lineno"> 7026</span>&#160;            - (HH_hadrons[iHad].py() + HH_hadrons[inext].py())*(HH_hadrons[iHad].py() + HH_hadrons[inext].py())</div>
<div class="line"><a name="l07027"></a><span class="lineno"> 7027</span>&#160;            - (HH_hadrons[iHad].pz() + HH_hadrons[inext].pz())*(HH_hadrons[iHad].pz() + HH_hadrons[inext].pz()));</div>
<div class="line"><a name="l07028"></a><span class="lineno"> 7028</span>&#160;        <span class="keywordtype">double</span> momentum_diff = (HH_hadrons[iHad].px()-HH_hadrons[inext].px())*(HH_hadrons[iHad].px()-HH_hadrons[inext].px())</div>
<div class="line"><a name="l07029"></a><span class="lineno"> 7029</span>&#160;                      + (HH_hadrons[iHad].py()-HH_hadrons[inext].py())*(HH_hadrons[iHad].py()-HH_hadrons[inext].py())</div>
<div class="line"><a name="l07030"></a><span class="lineno"> 7030</span>&#160;                      + (HH_hadrons[iHad].pz()-HH_hadrons[inext].pz())*(HH_hadrons[iHad].pz()-HH_hadrons[inext].pz());</div>
<div class="line"><a name="l07031"></a><span class="lineno"> 7031</span>&#160;        <span class="keywordflow">if</span>(HH_hadrons[inext].is_final() &amp;&amp; momentum_diff &gt;= 1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-6 &amp;&amp; pair_mass &gt;= m1+<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a>){<span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l07032"></a><span class="lineno"> 7032</span>&#160;        ++inext;</div>
<div class="line"><a name="l07033"></a><span class="lineno"> 7033</span>&#160;      }</div>
<div class="line"><a name="l07034"></a><span class="lineno"> 7034</span>&#160;</div>
<div class="line"><a name="l07035"></a><span class="lineno"> 7035</span>&#160;                  <span class="comment">//if there is no closest before, then grab closest after</span></div>
<div class="line"><a name="l07036"></a><span class="lineno"> 7036</span>&#160;                  <span class="comment">//or if no closest after, then grab closest before</span></div>
<div class="line"><a name="l07037"></a><span class="lineno"> 7037</span>&#160;                  <span class="comment">//if both exist, grab the one that&#39;s closest, unless both are the same in which case grab the one after</span></div>
<div class="line"><a name="l07038"></a><span class="lineno"> 7038</span>&#160;                  <span class="keywordflow">if</span>(iprev &lt; 0){partner = inext;}</div>
<div class="line"><a name="l07039"></a><span class="lineno"> 7039</span>&#160;                  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(inext &gt;= HH_hadrons.<a class="code" href="../../de/d96/classHybridHadronization_1_1hadron__collection.html#a999851873f2bb31cc5ed00dc32bc4e00">num</a>()){partner = iprev;}</div>
<div class="line"><a name="l07040"></a><span class="lineno"> 7040</span>&#160;                  <span class="keywordflow">else</span>{partner = (inext - iHad &lt;= iHad - iprev) ? inext : iprev;}</div>
<div class="line"><a name="l07041"></a><span class="lineno"> 7041</span>&#160;</div>
<div class="line"><a name="l07042"></a><span class="lineno"> 7042</span>&#160;      <span class="keywordflow">if</span>((partner &gt;= HH_hadrons.<a class="code" href="../../de/d96/classHybridHadronization_1_1hadron__collection.html#a999851873f2bb31cc5ed00dc32bc4e00">num</a>()) || (partner &lt; 0)) {partner = -1;}</div>
<div class="line"><a name="l07043"></a><span class="lineno"> 7043</span>&#160;                }</div>
<div class="line"><a name="l07044"></a><span class="lineno"> 7044</span>&#160;</div>
<div class="line"><a name="l07045"></a><span class="lineno"> 7045</span>&#160;    <span class="comment">//choose the hadron with the smallest pair_mass - m1 - m2 value</span></div>
<div class="line"><a name="l07046"></a><span class="lineno"> 7046</span>&#160;    <span class="keywordflow">if</span>(partner == -1){</div>
<div class="line"><a name="l07047"></a><span class="lineno"> 7047</span>&#160;      <span class="keywordtype">double</span> minimum = 1e6;</div>
<div class="line"><a name="l07048"></a><span class="lineno"> 7048</span>&#160;      <span class="keywordtype">int</span> partner_temporary = -1;</div>
<div class="line"><a name="l07049"></a><span class="lineno"> 7049</span>&#160;                  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jHad = 0; jHad &lt; HH_hadrons.<a class="code" href="../../de/d96/classHybridHadronization_1_1hadron__collection.html#a999851873f2bb31cc5ed00dc32bc4e00">num</a>(); ++jHad){</div>
<div class="line"><a name="l07050"></a><span class="lineno"> 7050</span>&#160;        <span class="keywordflow">if</span>(!HH_hadrons[jHad].is_final()){<span class="keywordflow">continue</span>;} <span class="comment">//do not want a non-final hadron</span></div>
<div class="line"><a name="l07051"></a><span class="lineno"> 7051</span>&#160;                    <span class="keywordflow">if</span>(iHad == jHad){<span class="keywordflow">continue</span>;} <span class="comment">//needs to be a different hadron</span></div>
<div class="line"><a name="l07052"></a><span class="lineno"> 7052</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a> = pythia.particleData.m0(HH_hadrons[jHad].<span class="keywordtype">id</span>());</div>
<div class="line"><a name="l07053"></a><span class="lineno"> 7053</span>&#160;        <span class="keywordtype">double</span> pair_mass = std::sqrt((HH_hadrons[iHad].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() + HH_hadrons[jHad].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>())*(HH_hadrons[iHad].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() + HH_hadrons[jHad].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>())</div>
<div class="line"><a name="l07054"></a><span class="lineno"> 7054</span>&#160;            - (HH_hadrons[iHad].px() + HH_hadrons[jHad].px())*(HH_hadrons[iHad].px() + HH_hadrons[jHad].px())</div>
<div class="line"><a name="l07055"></a><span class="lineno"> 7055</span>&#160;            - (HH_hadrons[iHad].py() + HH_hadrons[jHad].py())*(HH_hadrons[iHad].py() + HH_hadrons[jHad].py())</div>
<div class="line"><a name="l07056"></a><span class="lineno"> 7056</span>&#160;            - (HH_hadrons[iHad].pz() + HH_hadrons[jHad].pz())*(HH_hadrons[iHad].pz() + HH_hadrons[jHad].pz()));</div>
<div class="line"><a name="l07057"></a><span class="lineno"> 7057</span>&#160;        <span class="keywordflow">if</span>(std::abs(pair_mass-m1-m2) &lt; minimum){</div>
<div class="line"><a name="l07058"></a><span class="lineno"> 7058</span>&#160;          minimum = std::abs(pair_mass-m1-m2);</div>
<div class="line"><a name="l07059"></a><span class="lineno"> 7059</span>&#160;          partner_temporary = jHad;</div>
<div class="line"><a name="l07060"></a><span class="lineno"> 7060</span>&#160;        }</div>
<div class="line"><a name="l07061"></a><span class="lineno"> 7061</span>&#160;      }</div>
<div class="line"><a name="l07062"></a><span class="lineno"> 7062</span>&#160;      <span class="keywordflow">if</span>(partner_temporary != -1){</div>
<div class="line"><a name="l07063"></a><span class="lineno"> 7063</span>&#160;        partner = partner_temporary;</div>
<div class="line"><a name="l07064"></a><span class="lineno"> 7064</span>&#160;      }</div>
<div class="line"><a name="l07065"></a><span class="lineno"> 7065</span>&#160;    }</div>
<div class="line"><a name="l07066"></a><span class="lineno"> 7066</span>&#160;</div>
<div class="line"><a name="l07067"></a><span class="lineno"> 7067</span>&#160;                <span class="comment">//by now, a partner *must* have been chosen - unless there&#39;s only 1 hadron in the event, which is BAD.</span></div>
<div class="line"><a name="l07068"></a><span class="lineno"> 7068</span>&#160;                <span class="comment">//time to fix.</span></div>
<div class="line"><a name="l07069"></a><span class="lineno"> 7069</span>&#160;                <span class="comment">//if somehow everything failed, just skip this hadron...</span></div>
<div class="line"><a name="l07070"></a><span class="lineno"> 7070</span>&#160;                <span class="keywordflow">if</span>(partner == -1){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l07071"></a><span class="lineno"> 7071</span>&#160;</div>
<div class="line"><a name="l07072"></a><span class="lineno"> 7072</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;H1_before: &quot; &lt;&lt; iHad &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[iHad].id() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[iHad].px() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[iHad].py() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[iHad].pz() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[iHad].e() &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l07073"></a><span class="lineno"> 7073</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;H2_before: &quot; &lt;&lt; partner &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[partner].id() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[partner].px() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[partner].py() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[partner].pz() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[partner].e() &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l07074"></a><span class="lineno"> 7074</span>&#160;</div>
<div class="line"><a name="l07075"></a><span class="lineno"> 7075</span>&#160;                <span class="comment">//Psys</span></div>
<div class="line"><a name="l07076"></a><span class="lineno"> 7076</span>&#160;                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> Psys;</div>
<div class="line"><a name="l07077"></a><span class="lineno"> 7077</span>&#160;                Psys.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(HH_hadrons[iHad].px()+HH_hadrons[partner].px(),HH_hadrons[iHad].py()+HH_hadrons[partner].py(),HH_hadrons[iHad].pz()+HH_hadrons[partner].pz(),HH_hadrons[iHad].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>()+HH_hadrons[partner].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>());</div>
<div class="line"><a name="l07078"></a><span class="lineno"> 7078</span>&#160;</div>
<div class="line"><a name="l07079"></a><span class="lineno"> 7079</span>&#160;                <span class="comment">//CM velocity</span></div>
<div class="line"><a name="l07080"></a><span class="lineno"> 7080</span>&#160;                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> beta;</div>
<div class="line"><a name="l07081"></a><span class="lineno"> 7081</span>&#160;                beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(Psys.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()/Psys.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>(),Psys.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()/Psys.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>(),Psys.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()/Psys.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>(),0.);</div>
<div class="line"><a name="l07082"></a><span class="lineno"> 7082</span>&#160;                beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),1./(sqrt(1.-(beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>() + beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>() + beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()))));</div>
<div class="line"><a name="l07083"></a><span class="lineno"> 7083</span>&#160;</div>
<div class="line"><a name="l07084"></a><span class="lineno"> 7084</span>&#160;                <span class="comment">//boosting into CM frame</span></div>
<div class="line"><a name="l07085"></a><span class="lineno"> 7085</span>&#160;                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> p_CM[2]; p_CM[0] = HH_hadrons[iHad].boost_P(beta); p_CM[1] = HH_hadrons[partner].boost_P(beta);</div>
<div class="line"><a name="l07086"></a><span class="lineno"> 7086</span>&#160;</div>
<div class="line"><a name="l07087"></a><span class="lineno"> 7087</span>&#160;                <span class="comment">//if E1 + E2 &gt;= m1 + m2, shift momenta</span></div>
<div class="line"><a name="l07088"></a><span class="lineno"> 7088</span>&#160;                <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a> = pythia.particleData.m0(HH_hadrons[partner].<span class="keywordtype">id</span>());</div>
<div class="line"><a name="l07089"></a><span class="lineno"> 7089</span>&#160;                <span class="keywordtype">double</span> Etot = p_CM[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>() + p_CM[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>();</div>
<div class="line"><a name="l07090"></a><span class="lineno"> 7090</span>&#160;                <span class="keywordflow">if</span>(Etot &lt; m1 + m2 + 0.00001){Etot = m1 + m2 + 0.00001; <span class="comment">/*eviol &lt;&lt; Etot - (p_CM[0].t() + p_CM[1].t()) &lt;&lt; &quot;\n&quot;;*/</span>}<span class="comment">//can&#39;t shift, violating E/P cons.</span></div>
<div class="line"><a name="l07091"></a><span class="lineno"> 7091</span>&#160;                <span class="keywordtype">double</span> E1 = Etot/2. + ((m1*m1)-(m2*m2))/(2.*Etot);</div>
<div class="line"><a name="l07092"></a><span class="lineno"> 7092</span>&#160;                <span class="keywordtype">double</span> E2 = Etot/2. - ((m1*m1)-(m2*m2))/(2.*Etot);</div>
<div class="line"><a name="l07093"></a><span class="lineno"> 7093</span>&#160;                <span class="keywordtype">double</span> pmag = sqrt(p_CM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*p_CM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>() + p_CM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*p_CM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>() + p_CM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*p_CM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>());</div>
<div class="line"><a name="l07094"></a><span class="lineno"> 7094</span>&#160;                <span class="keywordtype">double</span> fac = sqrt(Etot*Etot/4. + ((m1*m1)-(m2*m2))*((m1*m1)-(m2*m2))/(4.*Etot*Etot) - ((m1*m1)+(m2*m2))/2.)/pmag;</div>
<div class="line"><a name="l07095"></a><span class="lineno"> 7095</span>&#160;</div>
<div class="line"><a name="l07096"></a><span class="lineno"> 7096</span>&#160;                <span class="comment">//rescaling in CM frame</span></div>
<div class="line"><a name="l07097"></a><span class="lineno"> 7097</span>&#160;    p_CM[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(fac*p_CM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>(), fac*p_CM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>(), fac*p_CM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>(), E1);</div>
<div class="line"><a name="l07098"></a><span class="lineno"> 7098</span>&#160;    p_CM[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(fac*p_CM[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>(), fac*p_CM[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>(), fac*p_CM[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>(), E2);</div>
<div class="line"><a name="l07099"></a><span class="lineno"> 7099</span>&#160;</div>
<div class="line"><a name="l07100"></a><span class="lineno"> 7100</span>&#160;                <span class="comment">//boosting back and setting hadron E,P to fixed values</span></div>
<div class="line"><a name="l07101"></a><span class="lineno"> 7101</span>&#160;    beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(-beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(), -beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(), -beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(), 0.);</div>
<div class="line"><a name="l07102"></a><span class="lineno"> 7102</span>&#160;    beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),1./(sqrt(1.-(beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>() + beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>() + beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()))));</div>
<div class="line"><a name="l07103"></a><span class="lineno"> 7103</span>&#160;                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> p_fin[2]; p_fin[0] = HHboost(beta, p_CM[0]); p_fin[1] = HHboost(beta, p_CM[1]);</div>
<div class="line"><a name="l07104"></a><span class="lineno"> 7104</span>&#160;                HH_hadrons[iHad].P(p_fin[0]); HH_hadrons[partner].P(p_fin[1]);</div>
<div class="line"><a name="l07105"></a><span class="lineno"> 7105</span>&#160;    HH_hadrons[iHad].mass(m1);</div>
<div class="line"><a name="l07106"></a><span class="lineno"> 7106</span>&#160;    HH_hadrons[partner].mass(m2);</div>
<div class="line"><a name="l07107"></a><span class="lineno"> 7107</span>&#160;</div>
<div class="line"><a name="l07108"></a><span class="lineno"> 7108</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;H1_after: &quot; &lt;&lt; iHad &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[iHad].id() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[iHad].px() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[iHad].py() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[iHad].pz() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[iHad].e() &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l07109"></a><span class="lineno"> 7109</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;H2_after: &quot; &lt;&lt; partner &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[partner].id() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[partner].px() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[partner].py() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[partner].pz() &lt;&lt; &quot;, &quot; &lt;&lt; HH_hadrons[partner].e() &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l07110"></a><span class="lineno"> 7110</span>&#160;  }</div>
<div class="line"><a name="l07111"></a><span class="lineno"> 7111</span>&#160;</div>
<div class="line"><a name="l07112"></a><span class="lineno"> 7112</span>&#160;  <span class="comment">//calc. Etot after</span></div>
<div class="line"><a name="l07113"></a><span class="lineno"> 7113</span>&#160;  <span class="comment">//for(int iHad=0; iHad&lt;HH_hadrons.num(); ++iHad){if(!HH_hadrons[iHad].is_final()){continue;} Eafter += HH_hadrons[iHad].e(); pTafter += HH_hadrons[iHad].pt();}</span></div>
<div class="line"><a name="l07114"></a><span class="lineno"> 7114</span>&#160;  <span class="comment">//echg &lt;&lt; Eafter-Ebefore &lt;&lt; &quot;\n&quot;; ptchg &lt;&lt; pTafter-pTbefore &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l07115"></a><span class="lineno"> 7115</span>&#160;  <span class="comment">//eviol.close(); echg.close(); ptchg.close();</span></div>
<div class="line"><a name="l07116"></a><span class="lineno"> 7116</span>&#160;}</div>
<div class="line"><a name="l07117"></a><span class="lineno"> 7117</span>&#160;</div>
<div class="line"><a name="l07118"></a><span class="lineno"><a class="code" href="../../d5/dce/classHybridHadronization.html#a435ef69f37e17c3c72589dbf61e2b3a7"> 7118</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classHybridHadronization.html#a435ef69f37e17c3c72589dbf61e2b3a7">HybridHadronization::set_initial_parton_masses</a>(<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html">parton_collection</a>&amp; HH_partons) {</div>
<div class="line"><a name="l07119"></a><span class="lineno"> 7119</span>&#160;  <span class="comment">//to calc. E conservation violation</span></div>
<div class="line"><a name="l07120"></a><span class="lineno"> 7120</span>&#160;  <span class="comment">/*double Ebefore = 0.; double Eafter = 0.; double pTbefore = 0.; double pTafter = 0.;</span></div>
<div class="line"><a name="l07121"></a><span class="lineno"> 7121</span>&#160;<span class="comment">  for(int iPart=0; iPart&lt;HH_partons.num(); ++iPart){Ebefore += HH_partons[iPart].e(); pTbefore += HH_partons[iPart].pt();}</span></div>
<div class="line"><a name="l07122"></a><span class="lineno"> 7122</span>&#160;<span class="comment">  std::cout &lt;&lt; std::setprecision(5);</span></div>
<div class="line"><a name="l07123"></a><span class="lineno"> 7123</span>&#160;<span class="comment">  std::ofstream eviol; std::ofstream echg; std::ofstream ptchg;</span></div>
<div class="line"><a name="l07124"></a><span class="lineno"> 7124</span>&#160;<span class="comment">  eviol.open(&quot;Evio_partons.dat&quot;, std::ios::app); echg.open(&quot;Echg_partons.dat&quot;, std::ios::app); ptchg.open(&quot;ptchg_partons.dat&quot;, std::ios::app);*/</span></div>
<div class="line"><a name="l07125"></a><span class="lineno"> 7125</span>&#160;</div>
<div class="line"><a name="l07126"></a><span class="lineno"> 7126</span>&#160;  <span class="comment">// case for only one parton in the event -&gt; force to parton mass</span></div>
<div class="line"><a name="l07127"></a><span class="lineno"> 7127</span>&#160;  <span class="keywordflow">if</span>(HH_partons.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>() == 1) {</div>
<div class="line"><a name="l07128"></a><span class="lineno"> 7128</span>&#160;    <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> <a class="code" href="../../d4/d8a/classparton.html">parton</a> = HH_partons[0];</div>
<div class="line"><a name="l07129"></a><span class="lineno"> 7129</span>&#160;    <span class="keywordflow">if</span>(std::abs(parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6 &amp;&amp; parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>() &lt; pythia.particleData.m0(std::abs(parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()))) { <span class="comment">// quark case</span></div>
<div class="line"><a name="l07130"></a><span class="lineno"> 7130</span>&#160;      parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l07131"></a><span class="lineno"> 7131</span>&#160;      parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l07132"></a><span class="lineno"> 7132</span>&#160;      HH_partons[0] = <a class="code" href="../../db/d20/parton_8f.html#aa0edf2e3bc4c9634a0c0e2ee25615ad2">parton</a>;</div>
<div class="line"><a name="l07133"></a><span class="lineno"> 7133</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() == 21 &amp;&amp; parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>() &lt; 2.*xmq + 0.001) { <span class="comment">// gluon case (pythia has m_g = 0.)</span></div>
<div class="line"><a name="l07134"></a><span class="lineno"> 7134</span>&#160;      parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(2.*xmq + 0.001);</div>
<div class="line"><a name="l07135"></a><span class="lineno"> 7135</span>&#160;      parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l07136"></a><span class="lineno"> 7136</span>&#160;      HH_partons[0] = <a class="code" href="../../db/d20/parton_8f.html#aa0edf2e3bc4c9634a0c0e2ee25615ad2">parton</a>;</div>
<div class="line"><a name="l07137"></a><span class="lineno"> 7137</span>&#160;    }</div>
<div class="line"><a name="l07138"></a><span class="lineno"> 7138</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l07139"></a><span class="lineno"> 7139</span>&#160;  }</div>
<div class="line"><a name="l07140"></a><span class="lineno"> 7140</span>&#160;</div>
<div class="line"><a name="l07141"></a><span class="lineno"> 7141</span>&#160;        <span class="comment">//parton mass adjust</span></div>
<div class="line"><a name="l07142"></a><span class="lineno"> 7142</span>&#160;        <span class="keywordtype">double</span> osf = 1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-6;</div>
<div class="line"><a name="l07143"></a><span class="lineno"> 7143</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iPart=0; iPart&lt;HH_partons.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++iPart){</div>
<div class="line"><a name="l07144"></a><span class="lineno"> 7144</span>&#160;          <span class="comment">//if this isn&#39;t a final state parton, there&#39;s no point in fixing it.</span></div>
<div class="line"><a name="l07145"></a><span class="lineno"> 7145</span>&#160;                <span class="keywordflow">if</span> ((HH_partons[iPart].<span class="keywordtype">id</span>() != 21) &amp;&amp; (std::abs(HH_partons[iPart].<span class="keywordtype">id</span>()) &gt; 5)){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l07146"></a><span class="lineno"> 7146</span>&#160;</div>
<div class="line"><a name="l07147"></a><span class="lineno"> 7147</span>&#160;                <span class="comment">//need parton mass and pdg (pythia) mass to check</span></div>
<div class="line"><a name="l07148"></a><span class="lineno"> 7148</span>&#160;                <span class="keywordtype">double</span> partmass = HH_partons[iPart].mass();</div>
<div class="line"><a name="l07149"></a><span class="lineno"> 7149</span>&#160;    <span class="keywordtype">double</span> m1 = 0.;</div>
<div class="line"><a name="l07150"></a><span class="lineno"> 7150</span>&#160;    <span class="keywordflow">if</span>(HH_partons[iPart].<span class="keywordtype">id</span>() == 21){</div>
<div class="line"><a name="l07151"></a><span class="lineno"> 7151</span>&#160;      m1 = 2.*xmq + 0.001;</div>
<div class="line"><a name="l07152"></a><span class="lineno"> 7152</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[iPart].<span class="keywordtype">id</span>()) &lt; 3) {</div>
<div class="line"><a name="l07153"></a><span class="lineno"> 7153</span>&#160;      m1 = xmq;</div>
<div class="line"><a name="l07154"></a><span class="lineno"> 7154</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[iPart].<span class="keywordtype">id</span>()) == 3) {</div>
<div class="line"><a name="l07155"></a><span class="lineno"> 7155</span>&#160;      m1 = xms;</div>
<div class="line"><a name="l07156"></a><span class="lineno"> 7156</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[iPart].<span class="keywordtype">id</span>()) == 4) {</div>
<div class="line"><a name="l07157"></a><span class="lineno"> 7157</span>&#160;      m1 = xmc;</div>
<div class="line"><a name="l07158"></a><span class="lineno"> 7158</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[iPart].<span class="keywordtype">id</span>()) == 5) {</div>
<div class="line"><a name="l07159"></a><span class="lineno"> 7159</span>&#160;      m1 = xmb;</div>
<div class="line"><a name="l07160"></a><span class="lineno"> 7160</span>&#160;    }</div>
<div class="line"><a name="l07161"></a><span class="lineno"> 7161</span>&#160;</div>
<div class="line"><a name="l07162"></a><span class="lineno"> 7162</span>&#160;                <span class="comment">//if this parton doesn&#39;t need to be fixed, then we skip it</span></div>
<div class="line"><a name="l07163"></a><span class="lineno"> 7163</span>&#160;                <span class="keywordflow">if</span>((std::abs(partmass - m1)/m1 &lt; osf) &amp;&amp; (std::abs(HH_partons[iPart].<span class="keywordtype">id</span>()) &lt; 6)){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l07164"></a><span class="lineno"> 7164</span>&#160;</div>
<div class="line"><a name="l07165"></a><span class="lineno"> 7165</span>&#160;    <span class="keywordflow">if</span>((HH_partons[iPart].<span class="keywordtype">id</span>() == 21) &amp;&amp; (partmass &gt; m1)){<span class="keywordflow">continue</span>;}</div>
<div class="line"><a name="l07166"></a><span class="lineno"> 7166</span>&#160;</div>
<div class="line"><a name="l07167"></a><span class="lineno"> 7167</span>&#160;                <span class="comment">//this parton needs fixing, so we prepare to find a partner to adjust with it</span></div>
<div class="line"><a name="l07168"></a><span class="lineno"> 7168</span>&#160;                <span class="keywordtype">int</span> partner = -1;</div>
<div class="line"><a name="l07169"></a><span class="lineno"> 7169</span>&#160;</div>
<div class="line"><a name="l07170"></a><span class="lineno"> 7170</span>&#160;                <span class="comment">//looking through the parton list to find another parton with the same color tag.</span></div>
<div class="line"><a name="l07171"></a><span class="lineno"> 7171</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jPart=0; jPart&lt;HH_partons.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>(); ++jPart){</div>
<div class="line"><a name="l07172"></a><span class="lineno"> 7172</span>&#160;      <span class="keywordflow">if</span>(iPart == jPart || (std::abs(HH_partons[iPart].<span class="keywordtype">id</span>()) &gt; 5 &amp;&amp; std::abs(HH_partons[iPart].<span class="keywordtype">id</span>()) &lt; 7)){<span class="keywordflow">continue</span>;} <span class="comment">//needs to be a different parton</span></div>
<div class="line"><a name="l07173"></a><span class="lineno"> 7173</span>&#160;      <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a> = 0.;</div>
<div class="line"><a name="l07174"></a><span class="lineno"> 7174</span>&#160;      <span class="keywordflow">if</span> ((HH_partons[jPart].<span class="keywordtype">id</span>() == 21) &amp;&amp; (HH_partons[jPart].mass() &lt; 2.*xmq + 0.001)){</div>
<div class="line"><a name="l07175"></a><span class="lineno"> 7175</span>&#160;        m2 = 2.*xmq + 0.001;</div>
<div class="line"><a name="l07176"></a><span class="lineno"> 7176</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((HH_partons[jPart].<span class="keywordtype">id</span>() == 21) &amp;&amp; (HH_partons[jPart].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>() &gt;= 2.*xmq + 0.001)){</div>
<div class="line"><a name="l07177"></a><span class="lineno"> 7177</span>&#160;        m2 = HH_partons[jPart].mass();</div>
<div class="line"><a name="l07178"></a><span class="lineno"> 7178</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[jPart].<span class="keywordtype">id</span>()) &lt; 3) {</div>
<div class="line"><a name="l07179"></a><span class="lineno"> 7179</span>&#160;        m2 = xmq;</div>
<div class="line"><a name="l07180"></a><span class="lineno"> 7180</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[jPart].<span class="keywordtype">id</span>()) == 3) {</div>
<div class="line"><a name="l07181"></a><span class="lineno"> 7181</span>&#160;        m2 = xms;</div>
<div class="line"><a name="l07182"></a><span class="lineno"> 7182</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[jPart].<span class="keywordtype">id</span>()) == 4) {</div>
<div class="line"><a name="l07183"></a><span class="lineno"> 7183</span>&#160;        m2 = xmc;</div>
<div class="line"><a name="l07184"></a><span class="lineno"> 7184</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[jPart].<span class="keywordtype">id</span>()) == 5) {</div>
<div class="line"><a name="l07185"></a><span class="lineno"> 7185</span>&#160;        m2 = xmb;</div>
<div class="line"><a name="l07186"></a><span class="lineno"> 7186</span>&#160;      }</div>
<div class="line"><a name="l07187"></a><span class="lineno"> 7187</span>&#160;      <span class="keywordtype">double</span> pair_mass = std::sqrt((HH_partons[iPart].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() + HH_partons[jPart].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>())*(HH_partons[iPart].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() + HH_partons[jPart].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>())</div>
<div class="line"><a name="l07188"></a><span class="lineno"> 7188</span>&#160;            - (HH_partons[iPart].px() + HH_partons[jPart].px())*(HH_partons[iPart].px() + HH_partons[jPart].px())</div>
<div class="line"><a name="l07189"></a><span class="lineno"> 7189</span>&#160;            - (HH_partons[iPart].py() + HH_partons[jPart].py())*(HH_partons[iPart].py() + HH_partons[jPart].py())</div>
<div class="line"><a name="l07190"></a><span class="lineno"> 7190</span>&#160;            - (HH_partons[iPart].pz() + HH_partons[jPart].pz())*(HH_partons[iPart].pz() + HH_partons[jPart].pz()));</div>
<div class="line"><a name="l07191"></a><span class="lineno"> 7191</span>&#160;      <span class="comment">// variabele to compute the squared momentum difference of the partners</span></div>
<div class="line"><a name="l07192"></a><span class="lineno"> 7192</span>&#160;      <span class="comment">// if this is too small the mass adjustment procedure would fail</span></div>
<div class="line"><a name="l07193"></a><span class="lineno"> 7193</span>&#160;      <span class="keywordtype">double</span> momentum_diff = (HH_partons[iPart].px()-HH_partons[jPart].px())*(HH_partons[iPart].px()-HH_partons[jPart].px())</div>
<div class="line"><a name="l07194"></a><span class="lineno"> 7194</span>&#160;                    + (HH_partons[iPart].py()-HH_partons[jPart].py())*(HH_partons[iPart].py()-HH_partons[jPart].py())</div>
<div class="line"><a name="l07195"></a><span class="lineno"> 7195</span>&#160;                    + (HH_partons[iPart].pz()-HH_partons[jPart].pz())*(HH_partons[iPart].pz()-HH_partons[jPart].pz());</div>
<div class="line"><a name="l07196"></a><span class="lineno"> 7196</span>&#160;      <span class="keywordflow">if</span>(((HH_partons[iPart].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>() == HH_partons[jPart].acol()) || (HH_partons[iPart].acol() == HH_partons[jPart].<a class="code" href="../../dc/d59/Proto4ShowerCalibFit_8m.html#a3be616147be4f0eef21e6ae2742b5d49">col</a>())) &amp;&amp; (momentum_diff &gt; 1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-6) &amp;&amp; (pair_mass &gt;= m1+m2)){</div>
<div class="line"><a name="l07197"></a><span class="lineno"> 7197</span>&#160;        <span class="keywordflow">if</span>((HH_partons[jPart].<span class="keywordtype">id</span>() == 21) &amp;&amp; (HH_partons[jPart].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>() &lt; 2.*xmq + 0.001)) {</div>
<div class="line"><a name="l07198"></a><span class="lineno"> 7198</span>&#160;          partner = jPart;</div>
<div class="line"><a name="l07199"></a><span class="lineno"> 7199</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07200"></a><span class="lineno"> 7200</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((std::abs(HH_partons[jPart].<span class="keywordtype">id</span>()) &lt; 3) &amp;&amp; (std::abs(HH_partons[jPart].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>() - xmq)/xmq &gt; osf)) {</div>
<div class="line"><a name="l07201"></a><span class="lineno"> 7201</span>&#160;          partner = jPart;</div>
<div class="line"><a name="l07202"></a><span class="lineno"> 7202</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07203"></a><span class="lineno"> 7203</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((std::abs(HH_partons[jPart].<span class="keywordtype">id</span>()) == 3) &amp;&amp; (std::abs(HH_partons[jPart].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>() - xms)/xms &gt; osf)) {</div>
<div class="line"><a name="l07204"></a><span class="lineno"> 7204</span>&#160;          partner = jPart;</div>
<div class="line"><a name="l07205"></a><span class="lineno"> 7205</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07206"></a><span class="lineno"> 7206</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((std::abs(HH_partons[jPart].<span class="keywordtype">id</span>()) == 4) &amp;&amp; (std::abs(HH_partons[jPart].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>() - xmc)/xmc &gt; osf)) {</div>
<div class="line"><a name="l07207"></a><span class="lineno"> 7207</span>&#160;          partner = jPart;</div>
<div class="line"><a name="l07208"></a><span class="lineno"> 7208</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07209"></a><span class="lineno"> 7209</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((std::abs(HH_partons[jPart].<span class="keywordtype">id</span>()) == 5) &amp;&amp; (std::abs(HH_partons[jPart].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>() - xmb)/xmb &gt; osf)) {</div>
<div class="line"><a name="l07210"></a><span class="lineno"> 7210</span>&#160;          partner = jPart;</div>
<div class="line"><a name="l07211"></a><span class="lineno"> 7211</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07212"></a><span class="lineno"> 7212</span>&#160;        }</div>
<div class="line"><a name="l07213"></a><span class="lineno"> 7213</span>&#160;      }</div>
<div class="line"><a name="l07214"></a><span class="lineno"> 7214</span>&#160;    }</div>
<div class="line"><a name="l07215"></a><span class="lineno"> 7215</span>&#160;</div>
<div class="line"><a name="l07216"></a><span class="lineno"> 7216</span>&#160;    <span class="comment">// candidate for a parton with the smallest energy loss (if no partner is found)</span></div>
<div class="line"><a name="l07217"></a><span class="lineno"> 7217</span>&#160;    <span class="keywordtype">int</span> iPartnerCandidate = -1;</div>
<div class="line"><a name="l07218"></a><span class="lineno"> 7218</span>&#160;    <span class="keywordtype">double</span> energy_loss_tracking = 1e6; <span class="comment">// just a large number</span></div>
<div class="line"><a name="l07219"></a><span class="lineno"> 7219</span>&#160;</div>
<div class="line"><a name="l07220"></a><span class="lineno"> 7220</span>&#160;                <span class="comment">//ready to fix, if a partner has not been found, pick a close-by parton</span></div>
<div class="line"><a name="l07221"></a><span class="lineno"> 7221</span>&#160;    <span class="comment">//make sure that there is a relative momentum to reshuffle the masses</span></div>
<div class="line"><a name="l07222"></a><span class="lineno"> 7222</span>&#160;                <span class="keywordflow">if</span>(partner == -1){</div>
<div class="line"><a name="l07223"></a><span class="lineno"> 7223</span>&#160;                  <span class="comment">//grabbing closest parton before and after, if it exists</span></div>
<div class="line"><a name="l07224"></a><span class="lineno"> 7224</span>&#160;                  <span class="keywordtype">int</span> iprev = iPart-1; <span class="keywordtype">int</span> inext = iPart+1;</div>
<div class="line"><a name="l07225"></a><span class="lineno"> 7225</span>&#160;                  <span class="keywordflow">while</span>(iprev &gt;= 0){</div>
<div class="line"><a name="l07226"></a><span class="lineno"> 7226</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a> = 0.;</div>
<div class="line"><a name="l07227"></a><span class="lineno"> 7227</span>&#160;        <span class="keywordflow">if</span> ((HH_partons[iprev].<span class="keywordtype">id</span>() == 21) &amp;&amp; (HH_partons[iprev].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>() &lt; 2.*xmq + 0.001)){</div>
<div class="line"><a name="l07228"></a><span class="lineno"> 7228</span>&#160;          m2 = 2.*xmq + 0.001;</div>
<div class="line"><a name="l07229"></a><span class="lineno"> 7229</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((HH_partons[iprev].<span class="keywordtype">id</span>() == 21) &amp;&amp; (HH_partons[iprev].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>() &gt;= 2.*xmq + 0.001)){</div>
<div class="line"><a name="l07230"></a><span class="lineno"> 7230</span>&#160;          m2 = HH_partons[iprev].mass();</div>
<div class="line"><a name="l07231"></a><span class="lineno"> 7231</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[iprev].<span class="keywordtype">id</span>()) &lt; 3) {</div>
<div class="line"><a name="l07232"></a><span class="lineno"> 7232</span>&#160;          m2 = xmq;</div>
<div class="line"><a name="l07233"></a><span class="lineno"> 7233</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[iprev].<span class="keywordtype">id</span>()) == 3) {</div>
<div class="line"><a name="l07234"></a><span class="lineno"> 7234</span>&#160;          m2 = xms;</div>
<div class="line"><a name="l07235"></a><span class="lineno"> 7235</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[iprev].<span class="keywordtype">id</span>()) == 4) {</div>
<div class="line"><a name="l07236"></a><span class="lineno"> 7236</span>&#160;          m2 = xmc;</div>
<div class="line"><a name="l07237"></a><span class="lineno"> 7237</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[iprev].<span class="keywordtype">id</span>()) == 5) {</div>
<div class="line"><a name="l07238"></a><span class="lineno"> 7238</span>&#160;          m2 = xmb;</div>
<div class="line"><a name="l07239"></a><span class="lineno"> 7239</span>&#160;        }</div>
<div class="line"><a name="l07240"></a><span class="lineno"> 7240</span>&#160;        <span class="keywordtype">double</span> pair_mass = std::sqrt((HH_partons[iPart].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() + HH_partons[iprev].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>())*(HH_partons[iPart].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() + HH_partons[iprev].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>())</div>
<div class="line"><a name="l07241"></a><span class="lineno"> 7241</span>&#160;            - (HH_partons[iPart].px() + HH_partons[iprev].px())*(HH_partons[iPart].px() + HH_partons[iprev].px())</div>
<div class="line"><a name="l07242"></a><span class="lineno"> 7242</span>&#160;            - (HH_partons[iPart].py() + HH_partons[iprev].py())*(HH_partons[iPart].py() + HH_partons[iprev].py())</div>
<div class="line"><a name="l07243"></a><span class="lineno"> 7243</span>&#160;            - (HH_partons[iPart].pz() + HH_partons[iprev].pz())*(HH_partons[iPart].pz() + HH_partons[iprev].pz()));</div>
<div class="line"><a name="l07244"></a><span class="lineno"> 7244</span>&#160;        <span class="keywordtype">double</span> momentum_diff = (HH_partons[iPart].px()-HH_partons[iprev].px())*(HH_partons[iPart].px()-HH_partons[iprev].px())</div>
<div class="line"><a name="l07245"></a><span class="lineno"> 7245</span>&#160;                      + (HH_partons[iPart].py()-HH_partons[iprev].py())*(HH_partons[iPart].py()-HH_partons[iprev].py())</div>
<div class="line"><a name="l07246"></a><span class="lineno"> 7246</span>&#160;                      + (HH_partons[iPart].pz()-HH_partons[iprev].pz())*(HH_partons[iPart].pz()-HH_partons[iprev].pz());</div>
<div class="line"><a name="l07247"></a><span class="lineno"> 7247</span>&#160;        <span class="keywordflow">if</span>((momentum_diff &gt; 1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-6) &amp;&amp; (pair_mass &gt;= m1+<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a>) &amp;&amp; (std::abs(HH_partons[iprev].<span class="keywordtype">id</span>()) &lt; 6 || HH_partons[iprev].id() == 21)){</div>
<div class="line"><a name="l07248"></a><span class="lineno"> 7248</span>&#160;          <span class="keywordflow">if</span>(energy_loss_tracking &gt; std::abs(pair_mass - m1 - m2)) {</div>
<div class="line"><a name="l07249"></a><span class="lineno"> 7249</span>&#160;            energy_loss_tracking = std::abs(pair_mass - m1 - m2);</div>
<div class="line"><a name="l07250"></a><span class="lineno"> 7250</span>&#160;            iPartnerCandidate = iprev;</div>
<div class="line"><a name="l07251"></a><span class="lineno"> 7251</span>&#160;          }</div>
<div class="line"><a name="l07252"></a><span class="lineno"> 7252</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07253"></a><span class="lineno"> 7253</span>&#160;        }</div>
<div class="line"><a name="l07254"></a><span class="lineno"> 7254</span>&#160;        --iprev;</div>
<div class="line"><a name="l07255"></a><span class="lineno"> 7255</span>&#160;      }</div>
<div class="line"><a name="l07256"></a><span class="lineno"> 7256</span>&#160;                        <span class="keywordflow">while</span>(inext &lt; HH_partons.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()){</div>
<div class="line"><a name="l07257"></a><span class="lineno"> 7257</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a> = 0.;</div>
<div class="line"><a name="l07258"></a><span class="lineno"> 7258</span>&#160;        <span class="keywordflow">if</span> ((HH_partons[inext].<span class="keywordtype">id</span>() == 21) &amp;&amp; (HH_partons[inext].mass() &lt; 2.*xmq + 0.001)){</div>
<div class="line"><a name="l07259"></a><span class="lineno"> 7259</span>&#160;          m2 = 2.*xmq + 0.001;</div>
<div class="line"><a name="l07260"></a><span class="lineno"> 7260</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((HH_partons[inext].<span class="keywordtype">id</span>() == 21) &amp;&amp; (HH_partons[inext].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>() &gt;= 2.*xmq + 0.001)){</div>
<div class="line"><a name="l07261"></a><span class="lineno"> 7261</span>&#160;          m2 = HH_partons[inext].mass();</div>
<div class="line"><a name="l07262"></a><span class="lineno"> 7262</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[inext].<span class="keywordtype">id</span>()) &lt; 3) {</div>
<div class="line"><a name="l07263"></a><span class="lineno"> 7263</span>&#160;          m2 = xmq;</div>
<div class="line"><a name="l07264"></a><span class="lineno"> 7264</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[inext].<span class="keywordtype">id</span>()) == 3) {</div>
<div class="line"><a name="l07265"></a><span class="lineno"> 7265</span>&#160;          m2 = xms;</div>
<div class="line"><a name="l07266"></a><span class="lineno"> 7266</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[inext].<span class="keywordtype">id</span>()) == 4) {</div>
<div class="line"><a name="l07267"></a><span class="lineno"> 7267</span>&#160;          m2 = xmc;</div>
<div class="line"><a name="l07268"></a><span class="lineno"> 7268</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[inext].<span class="keywordtype">id</span>()) == 5) {</div>
<div class="line"><a name="l07269"></a><span class="lineno"> 7269</span>&#160;          m2 = xmb;</div>
<div class="line"><a name="l07270"></a><span class="lineno"> 7270</span>&#160;        }</div>
<div class="line"><a name="l07271"></a><span class="lineno"> 7271</span>&#160;        <span class="keywordtype">double</span> pair_mass = std::sqrt((HH_partons[iPart].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() + HH_partons[inext].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>())*(HH_partons[iPart].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>() + HH_partons[inext].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>())</div>
<div class="line"><a name="l07272"></a><span class="lineno"> 7272</span>&#160;            - (HH_partons[iPart].px() + HH_partons[inext].px())*(HH_partons[iPart].px() + HH_partons[inext].px())</div>
<div class="line"><a name="l07273"></a><span class="lineno"> 7273</span>&#160;            - (HH_partons[iPart].py() + HH_partons[inext].py())*(HH_partons[iPart].py() + HH_partons[inext].py())</div>
<div class="line"><a name="l07274"></a><span class="lineno"> 7274</span>&#160;            - (HH_partons[iPart].pz() + HH_partons[inext].pz())*(HH_partons[iPart].pz() + HH_partons[inext].pz()));</div>
<div class="line"><a name="l07275"></a><span class="lineno"> 7275</span>&#160;        <span class="keywordtype">double</span> momentum_diff = (HH_partons[iPart].px()-HH_partons[inext].px())*(HH_partons[iPart].px()-HH_partons[inext].px())</div>
<div class="line"><a name="l07276"></a><span class="lineno"> 7276</span>&#160;                      + (HH_partons[iPart].py()-HH_partons[inext].py())*(HH_partons[iPart].py()-HH_partons[inext].py())</div>
<div class="line"><a name="l07277"></a><span class="lineno"> 7277</span>&#160;                      + (HH_partons[iPart].pz()-HH_partons[inext].pz())*(HH_partons[iPart].pz()-HH_partons[inext].pz());</div>
<div class="line"><a name="l07278"></a><span class="lineno"> 7278</span>&#160;        <span class="keywordflow">if</span>((momentum_diff &gt; 1<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>-6) &amp;&amp; (pair_mass &gt;= m1+<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a>) &amp;&amp; (std::abs(HH_partons[inext].<span class="keywordtype">id</span>()) &lt; 6 || HH_partons[inext].id() == 21)){</div>
<div class="line"><a name="l07279"></a><span class="lineno"> 7279</span>&#160;          <span class="keywordflow">if</span>(energy_loss_tracking &gt; std::abs(pair_mass - m1 - m2)) {</div>
<div class="line"><a name="l07280"></a><span class="lineno"> 7280</span>&#160;            energy_loss_tracking = std::abs(pair_mass - m1 - m2);</div>
<div class="line"><a name="l07281"></a><span class="lineno"> 7281</span>&#160;            iPartnerCandidate = inext;</div>
<div class="line"><a name="l07282"></a><span class="lineno"> 7282</span>&#160;          }</div>
<div class="line"><a name="l07283"></a><span class="lineno"> 7283</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07284"></a><span class="lineno"> 7284</span>&#160;        }</div>
<div class="line"><a name="l07285"></a><span class="lineno"> 7285</span>&#160;        ++inext;</div>
<div class="line"><a name="l07286"></a><span class="lineno"> 7286</span>&#160;      }</div>
<div class="line"><a name="l07287"></a><span class="lineno"> 7287</span>&#160;</div>
<div class="line"><a name="l07288"></a><span class="lineno"> 7288</span>&#160;                  <span class="comment">//if there is no closest before, then grab closest after</span></div>
<div class="line"><a name="l07289"></a><span class="lineno"> 7289</span>&#160;                  <span class="comment">//or if no closest after, then grab closest before</span></div>
<div class="line"><a name="l07290"></a><span class="lineno"> 7290</span>&#160;                  <span class="comment">//if both exist, grab the one that&#39;s closest, unless both are the same in which case grab the one after</span></div>
<div class="line"><a name="l07291"></a><span class="lineno"> 7291</span>&#160;                  <span class="keywordflow">if</span>(iprev &lt; 0){partner = inext;}</div>
<div class="line"><a name="l07292"></a><span class="lineno"> 7292</span>&#160;                  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(inext &gt;= HH_partons.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()){partner = iprev;}</div>
<div class="line"><a name="l07293"></a><span class="lineno"> 7293</span>&#160;                  <span class="keywordflow">else</span>{partner = (inext - iPart &lt;= iPart - iprev) ? inext : iprev;}</div>
<div class="line"><a name="l07294"></a><span class="lineno"> 7294</span>&#160;</div>
<div class="line"><a name="l07295"></a><span class="lineno"> 7295</span>&#160;      <span class="keywordflow">if</span>((iPartnerCandidate &gt;= HH_partons.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()) || (iPartnerCandidate &lt; 0)){iPartnerCandidate = -1;}</div>
<div class="line"><a name="l07296"></a><span class="lineno"> 7296</span>&#160;      <span class="keywordflow">if</span>((partner &gt;= HH_partons.<a class="code" href="../../d9/da5/classHybridHadronization_1_1parton__collection.html#acfd6f9170bb5efe910dc8eb15af0a1ce">num</a>()) || (partner &lt; 0)) {partner = -1;}</div>
<div class="line"><a name="l07297"></a><span class="lineno"> 7297</span>&#160;                }</div>
<div class="line"><a name="l07298"></a><span class="lineno"> 7298</span>&#160;</div>
<div class="line"><a name="l07299"></a><span class="lineno"> 7299</span>&#160;                <span class="comment">//by now, a partner *must* have been chosen - unless there&#39;s only 1 parton in the event, which is BAD.</span></div>
<div class="line"><a name="l07300"></a><span class="lineno"> 7300</span>&#160;                <span class="comment">//time to fix.</span></div>
<div class="line"><a name="l07301"></a><span class="lineno"> 7301</span>&#160;                <span class="comment">//if somehow everything failed, just skip this parton and put it to its mass shell (here we have to accept the energy conservation violation)</span></div>
<div class="line"><a name="l07302"></a><span class="lineno"> 7302</span>&#160;                <span class="keywordflow">if</span>(partner == -1 &amp;&amp; iPartnerCandidate &gt;= 0){</div>
<div class="line"><a name="l07303"></a><span class="lineno"> 7303</span>&#160;      partner = iPartnerCandidate;</div>
<div class="line"><a name="l07304"></a><span class="lineno"> 7304</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(partner == -1 &amp;&amp; iPartnerCandidate == -1) {</div>
<div class="line"><a name="l07305"></a><span class="lineno"> 7305</span>&#160;      <a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html">HHparton</a> <a class="code" href="../../d4/d8a/classparton.html">parton</a> = HH_partons[iPart];</div>
<div class="line"><a name="l07306"></a><span class="lineno"> 7306</span>&#160;      <span class="keywordflow">if</span>(std::abs(parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()) &lt; 6 &amp;&amp; parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>() &lt; pythia.particleData.m0(std::abs(parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>()))) { <span class="comment">// quark case</span></div>
<div class="line"><a name="l07307"></a><span class="lineno"> 7307</span>&#160;        parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(pythia.particleData.m0(std::abs(parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>())));</div>
<div class="line"><a name="l07308"></a><span class="lineno"> 7308</span>&#160;        parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l07309"></a><span class="lineno"> 7309</span>&#160;        HH_partons[iPart] = <a class="code" href="../../db/d20/parton_8f.html#aa0edf2e3bc4c9634a0c0e2ee25615ad2">parton</a>;</div>
<div class="line"><a name="l07310"></a><span class="lineno"> 7310</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a77380c5f7b373e91a939b79307019fe1">id</a>() == 21 &amp;&amp; parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>() &lt; 2.*xmq + 0.001) { <span class="comment">// gluon case (pythia has m_g = 0.)</span></div>
<div class="line"><a name="l07311"></a><span class="lineno"> 7311</span>&#160;        parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>(2.*xmq + 0.001);</div>
<div class="line"><a name="l07312"></a><span class="lineno"> 7312</span>&#160;        parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#aeddb07b8f8a4c0b0be1c2982c17a6955">e</a>(std::sqrt(parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#adcddf9d7cb6aa84939049398bfce1d32">px</a>() + parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a638be6247d0414ff0c3bb0f8dfcac7e8">py</a>() + parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a6e5f5221230d8ff85399c03791971ec7">pz</a>() + parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()*parton.<a class="code" href="../../d1/d15/classHybridHadronization_1_1HHparton.html#a9e3c453fd3da7a099e60993465daec0b">mass</a>()));</div>
<div class="line"><a name="l07313"></a><span class="lineno"> 7313</span>&#160;        HH_partons[iPart] = <a class="code" href="../../db/d20/parton_8f.html#aa0edf2e3bc4c9634a0c0e2ee25615ad2">parton</a>;</div>
<div class="line"><a name="l07314"></a><span class="lineno"> 7314</span>&#160;      }</div>
<div class="line"><a name="l07315"></a><span class="lineno"> 7315</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07316"></a><span class="lineno"> 7316</span>&#160;    }</div>
<div class="line"><a name="l07317"></a><span class="lineno"> 7317</span>&#160;</div>
<div class="line"><a name="l07318"></a><span class="lineno"> 7318</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;P1_before: &quot; &lt;&lt; iPart &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[iPart].id() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[iPart].px() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[iPart].py() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[iPart].pz() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[iPart].e() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[iPart].mass() &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l07319"></a><span class="lineno"> 7319</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;P2_before: &quot; &lt;&lt; partner &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[partner].id() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[partner].px() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[partner].py() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[partner].pz() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[partner].e() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[partner].mass() &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l07320"></a><span class="lineno"> 7320</span>&#160;</div>
<div class="line"><a name="l07321"></a><span class="lineno"> 7321</span>&#160;                <span class="comment">//Psys</span></div>
<div class="line"><a name="l07322"></a><span class="lineno"> 7322</span>&#160;                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> Psys;</div>
<div class="line"><a name="l07323"></a><span class="lineno"> 7323</span>&#160;                Psys.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(HH_partons[iPart].px()+HH_partons[partner].px(),HH_partons[iPart].py()+HH_partons[partner].py(),HH_partons[iPart].pz()+HH_partons[partner].pz(),HH_partons[iPart].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>()+HH_partons[partner].<a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a705fd87e8079f6d88222965eb977437a" title="Charge, native unit e (elementary charge)">e</a>());</div>
<div class="line"><a name="l07324"></a><span class="lineno"> 7324</span>&#160;</div>
<div class="line"><a name="l07325"></a><span class="lineno"> 7325</span>&#160;                <span class="comment">//CM velocity</span></div>
<div class="line"><a name="l07326"></a><span class="lineno"> 7326</span>&#160;                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> beta;</div>
<div class="line"><a name="l07327"></a><span class="lineno"> 7327</span>&#160;                beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(Psys.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()/Psys.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>(),Psys.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()/Psys.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>(),Psys.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()/Psys.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>(),0.);</div>
<div class="line"><a name="l07328"></a><span class="lineno"> 7328</span>&#160;                beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),1./(sqrt(1.-(beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>() + beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>() + beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()))));</div>
<div class="line"><a name="l07329"></a><span class="lineno"> 7329</span>&#160;</div>
<div class="line"><a name="l07330"></a><span class="lineno"> 7330</span>&#160;                <span class="comment">//boosting into CM frame</span></div>
<div class="line"><a name="l07331"></a><span class="lineno"> 7331</span>&#160;                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> p_CM[2]; p_CM[0] = HH_partons[iPart].boost_P(beta); p_CM[1] = HH_partons[partner].boost_P(beta);</div>
<div class="line"><a name="l07332"></a><span class="lineno"> 7332</span>&#160;</div>
<div class="line"><a name="l07333"></a><span class="lineno"> 7333</span>&#160;                <span class="comment">//if E1 + E2 &gt;= m1 + m2, shift momenta</span></div>
<div class="line"><a name="l07334"></a><span class="lineno"> 7334</span>&#160;                <span class="keywordtype">double</span> <a class="code" href="../../d6/d4d/namespaceActs_1_1UnitConstants.html#a42a562233a5d6d8b02e6321db94c6229">m2</a> = 0.;</div>
<div class="line"><a name="l07335"></a><span class="lineno"> 7335</span>&#160;    <span class="keywordflow">if</span> ((HH_partons[partner].<span class="keywordtype">id</span>() == 21) &amp;&amp; (HH_partons[partner].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>() &lt; 2.*xmq + 0.001)){</div>
<div class="line"><a name="l07336"></a><span class="lineno"> 7336</span>&#160;      m2 = 2.*xmq + 0.001;</div>
<div class="line"><a name="l07337"></a><span class="lineno"> 7337</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((HH_partons[partner].<span class="keywordtype">id</span>() == 21) &amp;&amp; (HH_partons[partner].<a class="code" href="../../d2/dcb/InteractionsTests_8cpp.html#aa19bfaf8cfd779867e9ce58c82e2e23d">mass</a>() &gt;= 2.*xmq + 0.001)){</div>
<div class="line"><a name="l07338"></a><span class="lineno"> 7338</span>&#160;      m2 = HH_partons[partner].mass();</div>
<div class="line"><a name="l07339"></a><span class="lineno"> 7339</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[partner].<span class="keywordtype">id</span>()) &lt; 3) {</div>
<div class="line"><a name="l07340"></a><span class="lineno"> 7340</span>&#160;      m2 = xmq;</div>
<div class="line"><a name="l07341"></a><span class="lineno"> 7341</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[partner].<span class="keywordtype">id</span>()) == 3) {</div>
<div class="line"><a name="l07342"></a><span class="lineno"> 7342</span>&#160;      m2 = xms;</div>
<div class="line"><a name="l07343"></a><span class="lineno"> 7343</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[partner].<span class="keywordtype">id</span>()) == 4) {</div>
<div class="line"><a name="l07344"></a><span class="lineno"> 7344</span>&#160;      m2 = xmc;</div>
<div class="line"><a name="l07345"></a><span class="lineno"> 7345</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(std::abs(HH_partons[partner].<span class="keywordtype">id</span>()) == 5) {</div>
<div class="line"><a name="l07346"></a><span class="lineno"> 7346</span>&#160;      m2 = xmb;</div>
<div class="line"><a name="l07347"></a><span class="lineno"> 7347</span>&#160;    }</div>
<div class="line"><a name="l07348"></a><span class="lineno"> 7348</span>&#160;                <span class="keywordtype">double</span> Etot = p_CM[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>() + p_CM[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a90f5874b7827e860c6057797df551bc0">t</a>();</div>
<div class="line"><a name="l07349"></a><span class="lineno"> 7349</span>&#160;                <span class="keywordflow">if</span>(Etot &lt; m1 + m2 + 0.00001){Etot = m1 + m2 + 0.00001; <span class="comment">/*eviol &lt;&lt; Etot - (p_CM[0].t() + p_CM[1].t()) &lt;&lt; &quot;\n&quot;;*/</span>}<span class="comment">//can&#39;t shift, violating E/P cons.</span></div>
<div class="line"><a name="l07350"></a><span class="lineno"> 7350</span>&#160;                <span class="keywordtype">double</span> E1 = Etot/2. + ((m1*m1)-(m2*m2))/(2.*Etot);</div>
<div class="line"><a name="l07351"></a><span class="lineno"> 7351</span>&#160;                <span class="keywordtype">double</span> E2 = Etot/2. - ((m1*m1)-(m2*m2))/(2.*Etot);</div>
<div class="line"><a name="l07352"></a><span class="lineno"> 7352</span>&#160;                <span class="keywordtype">double</span> pmag = sqrt(p_CM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>()*p_CM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>() + p_CM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>()*p_CM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>() + p_CM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>()*p_CM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>());</div>
<div class="line"><a name="l07353"></a><span class="lineno"> 7353</span>&#160;                <span class="keywordtype">double</span> fac = sqrt(Etot*Etot/4. + ((m1*m1)-(m2*m2))*((m1*m1)-(m2*m2))/(4.*Etot*Etot) - ((m1*m1)+(m2*m2))/2.)/pmag;</div>
<div class="line"><a name="l07354"></a><span class="lineno"> 7354</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;Etot_orig = &quot; &lt;&lt; p_CM[0].t() + p_CM[1].t() &lt;&lt; &quot; Etot = &quot; &lt;&lt; Etot &lt;&lt; &quot; pmag = &quot; &lt;&lt; pmag &lt;&lt; &quot; fac = &quot; &lt;&lt; fac &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l07355"></a><span class="lineno"> 7355</span>&#160;</div>
<div class="line"><a name="l07356"></a><span class="lineno"> 7356</span>&#160;                <span class="comment">//rescaling in CM frame</span></div>
<div class="line"><a name="l07357"></a><span class="lineno"> 7357</span>&#160;    p_CM[0].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(fac*p_CM[0].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>(), fac*p_CM[0].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>(), fac*p_CM[0].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>(), E1);</div>
<div class="line"><a name="l07358"></a><span class="lineno"> 7358</span>&#160;    p_CM[1].<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(fac*p_CM[1].<a class="code" href="../../d6/df3/namespaceambiguity__solver__full__chain.html#a5a98ca81ebd6be883836d0c8df079229">x</a>(), fac*p_CM[1].<a class="code" href="../../d7/d87/fasthadv4_8C.html#ab927965981178aa1fba979a37168db2a">y</a>(), fac*p_CM[1].<a class="code" href="../../da/dfb/namespacephysmon__track__finding__ttbar.html#a94611c039d3d047818ab5b8dcfa82d12">z</a>(), E2);</div>
<div class="line"><a name="l07359"></a><span class="lineno"> 7359</span>&#160;</div>
<div class="line"><a name="l07360"></a><span class="lineno"> 7360</span>&#160;                <span class="comment">//boosting back and setting parton E,P to fixed values</span></div>
<div class="line"><a name="l07361"></a><span class="lineno"> 7361</span>&#160;    beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(-beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(), -beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(), -beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(), 0.);</div>
<div class="line"><a name="l07362"></a><span class="lineno"> 7362</span>&#160;    beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#aa650da94f644eb777fa66cc1a6fef5b0">Set</a>(beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>(),beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>(),beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>(),1./(sqrt(1.-(beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>()*beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#ad8de53f64664fd3b36e65e2daf05e496">x</a>() + beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>()*beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a1b43841ff01c4f6a68899ad664616abc">y</a>() + beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()*beta.<a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html#a471fb5cfe3ae4402bcceee1fdce5f261">z</a>()))));</div>
<div class="line"><a name="l07363"></a><span class="lineno"> 7363</span>&#160;                <a class="code" href="../../d0/d8b/classJetscape_1_1FourVector.html">FourVector</a> p_fin[2]; p_fin[0] = HHboost(beta, p_CM[0]); p_fin[1] = HHboost(beta, p_CM[1]);</div>
<div class="line"><a name="l07364"></a><span class="lineno"> 7364</span>&#160;                HH_partons[iPart].P(p_fin[0]); HH_partons[partner].P(p_fin[1]);</div>
<div class="line"><a name="l07365"></a><span class="lineno"> 7365</span>&#160;    HH_partons[iPart].mass(m1);</div>
<div class="line"><a name="l07366"></a><span class="lineno"> 7366</span>&#160;    HH_partons[partner].mass(m2);</div>
<div class="line"><a name="l07367"></a><span class="lineno"> 7367</span>&#160;</div>
<div class="line"><a name="l07368"></a><span class="lineno"> 7368</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;P1_after: &quot; &lt;&lt; iPart &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[iPart].id() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[iPart].px() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[iPart].py() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[iPart].pz() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[iPart].e() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[iPart].mass() &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l07369"></a><span class="lineno"> 7369</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;P2_after: &quot; &lt;&lt; partner &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[partner].id() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[partner].px() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[partner].py() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[partner].pz() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[partner].e() &lt;&lt; &quot;, &quot; &lt;&lt; HH_partons[partner].mass() &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l07370"></a><span class="lineno"> 7370</span>&#160;  }</div>
<div class="line"><a name="l07371"></a><span class="lineno"> 7371</span>&#160;</div>
<div class="line"><a name="l07372"></a><span class="lineno"> 7372</span>&#160;  <span class="comment">//calc. Etot after</span></div>
<div class="line"><a name="l07373"></a><span class="lineno"> 7373</span>&#160;  <span class="comment">/*for(int iPart=0; iPart&lt;HH_partons.num(); ++iPart){Eafter += HH_partons[iPart].e(); pTafter += HH_partons[iPart].pt();}</span></div>
<div class="line"><a name="l07374"></a><span class="lineno"> 7374</span>&#160;<span class="comment">  echg &lt;&lt; Eafter-Ebefore &lt;&lt; &quot;\n&quot;; ptchg &lt;&lt; pTafter-pTbefore &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l07375"></a><span class="lineno"> 7375</span>&#160;<span class="comment">  eviol.close(); echg.close(); ptchg.close();*/</span></div>
<div class="line"><a name="l07376"></a><span class="lineno"> 7376</span>&#160;}</div>
<div class="line"><a name="l07377"></a><span class="lineno"> 7377</span>&#160;</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->

<!-- start footer part -->
<div id="nav-path" class="navpath">
	<!-- id is needed for treeview function! -->
	<ul>
		<li class="navelem"><a class="el" href="../../dir_539fda8f8e03602443ef69ba44bf4faf.html">JETSCAPE</a></li><li class="navelem"><a class="el" href="../../dir_babc5b6d3cbfd698a522392de45ce8d8.html">blob</a></li><li class="navelem"><a class="el" href="../../dir_073b32dd6276373528253fea850746b1.html">main</a></li><li class="navelem"><a class="el" href="../../dir_32b1cb8b543c8b1539f57b8951bf6b29.html">src</a></li><li class="navelem"><a class="el" href="../../dir_5bcf38ba9b52b67e54b5a023962b4c8a.html">hadronization</a></li><li class="navelem"><a class="el" href="../../d4/d49/HybridHadronization_8cc.html">HybridHadronization.cc</a></li>
		<li class="footer">
		Built by <a href="mailto:jhuang@bnl.gov">Jin Huang</a></em>.
			updated: <em>Sat Feb 17 2024 22:18:25</em> using <a
			href="http://www.doxygen.org/index.html"> <img class="footer"
				src="../../doxygen.png" alt="doxygen" /></a> 1.8.2 
				with <a href="https://github.com/sPHENIX-Collaboration">sPHENIX GitHub integration</a>
		</li>
	</ul>
</div>
</body>
</html>
